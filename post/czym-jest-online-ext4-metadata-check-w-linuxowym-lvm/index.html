<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Czym jest Online ext4 Metadata Check w linux&#39;owym LVM | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://morfikov.github.io/post/czym-jest-online-ext4-metadata-check-w-linuxowym-lvm/">
  <meta property="og:site_name" content="Morfitronik">
  <meta property="og:title" content="Czym jest Online ext4 Metadata Check w linux&#39;owym LVM">
  <meta property="og:description" content="Przeglądając dzisiaj rano logi systemowe wpadł mi w oczy komunikat, którego treść brzmiała mniej więcej tak: e2scrub Volume group &#34;wd_blue_label&#34; has insufficient free space (0 extents): 64 required , po którym z kolei można zanotować e2scrub snapshot FAILED, will not check! oraz Failed to start Online ext4 Metadata Check for /media/Debian . Oczywiście ten punkt montowania to nazwa partycji odnosząca się do jednego z dysków logicznych struktury LVM. Skąd się te błędy wzięły? Przecież jeszcze do niedawna (przez ostatnich parę lat) wszystko z moim linux&#39;em rezydującym na dysku (LUKS&#43;LVM) było w porządku, a teraz nagle takie bardzo niepokojące błędy. Czym jest w ogóle ten e2scrub i czym jest ten cały Online ext4 Metadata Check , który najwyraźniej ma coś wspólnego ze sprawdzaniem systemu plików voluminów logicznych w locie? No i najważniejsze chyba pytanie -- czemu to nie działa jak należy?">
  <meta property="og:locale" content="pl_PL">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-03-17T19:10:30+00:00">
    <meta property="article:modified_time" content="2019-03-17T19:10:30+00:00">
    <meta property="article:tag" content="Debian">
    <meta property="article:tag" content="System-Plików">
    <meta property="article:tag" content="Ext4">
    <meta property="article:tag" content="Lvm">

		
  <meta itemprop="name" content="Czym jest Online ext4 Metadata Check w linux&#39;owym LVM">
  <meta itemprop="description" content="Przeglądając dzisiaj rano logi systemowe wpadł mi w oczy komunikat, którego treść brzmiała mniej więcej tak: e2scrub Volume group &#34;wd_blue_label&#34; has insufficient free space (0 extents): 64 required , po którym z kolei można zanotować e2scrub snapshot FAILED, will not check! oraz Failed to start Online ext4 Metadata Check for /media/Debian . Oczywiście ten punkt montowania to nazwa partycji odnosząca się do jednego z dysków logicznych struktury LVM. Skąd się te błędy wzięły? Przecież jeszcze do niedawna (przez ostatnich parę lat) wszystko z moim linux&#39;em rezydującym na dysku (LUKS&#43;LVM) było w porządku, a teraz nagle takie bardzo niepokojące błędy. Czym jest w ogóle ten e2scrub i czym jest ten cały Online ext4 Metadata Check , który najwyraźniej ma coś wspólnego ze sprawdzaniem systemu plików voluminów logicznych w locie? No i najważniejsze chyba pytanie -- czemu to nie działa jak należy?">
  <meta itemprop="datePublished" content="2019-03-17T19:10:30+00:00">
  <meta itemprop="dateModified" content="2019-03-17T19:10:30+00:00">
  <meta itemprop="wordCount" content="1978">
  <meta itemprop="keywords" content="Debian,System-Plików,Ext4,Lvm">
		
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Czym jest Online ext4 Metadata Check w linux&#39;owym LVM">
  <meta name="twitter:description" content="Przeglądając dzisiaj rano logi systemowe wpadł mi w oczy komunikat, którego treść brzmiała mniej więcej tak: e2scrub Volume group &#34;wd_blue_label&#34; has insufficient free space (0 extents): 64 required , po którym z kolei można zanotować e2scrub snapshot FAILED, will not check! oraz Failed to start Online ext4 Metadata Check for /media/Debian . Oczywiście ten punkt montowania to nazwa partycji odnosząca się do jednego z dysków logicznych struktury LVM. Skąd się te błędy wzięły? Przecież jeszcze do niedawna (przez ostatnich parę lat) wszystko z moim linux&#39;em rezydującym na dysku (LUKS&#43;LVM) było w porządku, a teraz nagle takie bardzo niepokojące błędy. Czym jest w ogóle ten e2scrub i czym jest ten cały Online ext4 Metadata Check , który najwyraźniej ma coś wspólnego ze sprawdzaniem systemu plików voluminów logicznych w locie? No i najważniejsze chyba pytanie -- czemu to nie działa jak należy?">

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
  


</head>
<body class="body kind-page">
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Czym jest Online ext4 Metadata Check w linux&#39;owym LVM</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2019-03-17T19:10:30Z">Opublikowano: 17/03/2019</time>

<div class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</div>
	</div>
				<h1 class="entry__title">Czym jest Online ext4 Metadata Check w linux&#39;owym LVM</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#skąd-się-wziął-e2scrub-i-online-ext4-metadata-check">Skąd się wziął e2scrub i Online ext4 Metadata Check</a></li>
    <li><a href="#jak-przygotować-nośnik-lvm-pod-e2scrub">Jak przygotować nośnik LVM pod e2scrub</a></li>
    <li><a href="#ręczne-wymuszenie-sprawdzenia-systemu-plików">Ręczne wymuszenie sprawdzenia systemu plików</a></li>
    <li><a href="#wyłączenie-e2scrub">Wyłączenie e2scrub</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Przeglądając dzisiaj rano logi systemowe wpadł mi w oczy komunikat, którego treść brzmiała mniej
więcej tak: <code>e2scrub Volume group &quot;wd_blue_label&quot; has insufficient free space (0 extents): 64 required</code> , po którym z kolei można zanotować <code>e2scrub snapshot FAILED, will not check!</code> oraz
<code>Failed to start Online ext4 Metadata Check for /media/Debian</code> . Oczywiście ten punkt montowania to
nazwa partycji odnosząca się do jednego z dysków logicznych struktury LVM. Skąd się te błędy
wzięły? Przecież jeszcze do niedawna (przez ostatnich parę lat) wszystko z moim linux'em
rezydującym na dysku (LUKS+LVM) było w porządku, a teraz nagle takie bardzo niepokojące błędy.
Czym jest w ogóle ten <code>e2scrub</code> i czym jest ten cały <code>Online ext4 Metadata Check</code> , który
najwyraźniej ma coś wspólnego ze sprawdzaniem systemu plików voluminów logicznych w locie? No i
najważniejsze chyba pytanie -- czemu to nie działa jak należy?</p>
<h2 id="skąd-się-wziął-e2scrub-i-online-ext4-metadata-check">Skąd się wziął e2scrub i Online ext4 Metadata Check</h2>
<p>Analizując komunikaty w logu systemowym można znaleźć parę ciekawych informacji odnośnie tych
wiadomości, które zostały wymienione we wstępie artykułu. Poniżej znajduje się dokładny wycinek
logu i wypadałoby mu się nieco bardziej przyjrzeć:</p>
<pre><code>systemd[1]: Starting Online ext4 Metadata Check for /media/Debian...
e2scrub@-media-Debian[117266]:   Volume group &quot;wd_blue_label&quot; has insufficient free space (0 extents): 64 required.
e2scrub@-media-Debian[117266]: /media/Debian: e2scrub snapshot FAILED, will not check!
systemd[1]: e2scrub@-media-Debian.service: Main process exited, code=exited, status=1/FAILURE
systemd[1]: e2scrub@-media-Debian.service: Failed with result 'exit-code'.
systemd[1]: Failed to start Online ext4 Metadata Check for /media/Debian.
systemd[1]: e2scrub@-media-Debian.service: Triggering OnFailure= dependencies.
systemctl[117263]: Job for e2scrub@-media-Debian.service failed because the control process exited with error code.
systemctl[117263]: See &quot;systemctl status e2scrub@-media-Debian.service&quot; and &quot;journalctl -xe&quot; for details.
systemd[1]: Created slice system-e2scrub_fail.slice.
systemd[1]: Starting Online ext4 Metadata Check Failure Reporting for /media/Debian...
systemd[1]: e2scrub_fail@-media-Debian.service: Succeeded.
systemd[1]: Started Online ext4 Metadata Check Failure Reporting for /media/Debian.
</code></pre>
<p>To co się rzuca w oczy od razu to <code>insufficient free space (0 extents): 64 required</code> . Wymagane są
64 wolne zakresy w grupie voluminów <code>wd_blue_label</code> . Te 64 zakresy, to 256 MiB, bo każdy zakres w
LVM ma 4 MiB. I to jest w zasadzie przyczyna problemów. Widoczna jest również usługa dla systemd:
<code>e2scrub@-media-Debian.service</code> i wypadałoby sprawdzić, czy jest może ona wywoływana przez <code>cron</code>
albo też przez samego <code>systemd</code> za sprawą jego mechanizmu czasówek (timers):</p>
<pre><code>$ systemctl list-timers --all
NEXT                         LEFT         LAST                         PASSED    UNIT                         ACTIVATES
...
Sun 2019-03-24 03:10:50 CET  6 days left  Sun 2019-03-17 09:56:29 CET  7h ago    e2scrub_all.timer            e2scrub_all.service

6 timers listed.
</code></pre>
<p>Wcześniej tego zegara nie było, zatem coś musiało się zmienić w konfiguracji systemowej. Pytanie
tylko dlaczego ja nic o ty mnie wiem. :D Mając jednak punkt zaczepienia, konkretnie chodzi o tę
cyklicznie wywoływaną usługę <code>e2scrub_all.service</code> , można ustalić jaki pakiet to ustrojstwo
zainstalował:</p>
<pre><code>$ apt-file search e2scrub_all.service
e2fsprogs: /lib/systemd/system/e2scrub_all.service

$ dpkg -L e2fsprogs | grep scrub
/etc/cron.d/e2scrub_all
/etc/e2scrub.conf
/lib/systemd/system/e2scrub@.service
/lib/systemd/system/e2scrub_all.service
/lib/systemd/system/e2scrub_all.timer
/lib/systemd/system/e2scrub_fail@.service
/lib/systemd/system/e2scrub_reap.service
/lib/udev/rules.d/96-e2scrub.rules
/sbin/e2scrub
/sbin/e2scrub_all
/usr/lib/x86_64-linux-gnu/e2fsprogs/e2scrub_all_cron
/usr/lib/x86_64-linux-gnu/e2fsprogs/e2scrub_fail
/usr/share/man/man8/e2scrub.8.gz
/usr/share/man/man8/e2scrub_all.8.gz
</code></pre>
<p>Wiemy zatem, że odpowiedzialnym za te błędy w logu systemowym jest pakiet <code>e2fsprogs</code> . Wypadałoby
teraz zajrzeć w <code>changelog</code> tego pakietu w poszukiwaniu jakichś sensownych informacji odnośnie
zmian, które w tym pakiecie zostały w ostatnim casie wprowadzone:</p>
<pre><code>$ apt-get changelog e2fsprogs

e2fsprogs (1.45.0-1) unstable; urgency=medium

  ...
  * There is now an e2scrub script which will allow e2fsck to be run
    on mounted file systems using an LVM device.  There will be a systemd
    script to automatically run e2scrub on all ext4* file systems where it
    can be supported.
  ...
 -- Theodore Y. Ts'o &lt;tytso@mit.edu&gt;  Wed, 06 Mar 2019 12:55:18 -0500
</code></pre>
<p>Z komunikatu wyżej wynika jasno, że została wprowadzona nowa funkcjonalność za sprawą skryptu
<code>e2scrub</code>. Zajrzymy zatem do manuala <code>e2scrub</code> . Zgodnie z tym co można w nim wyczytać, to
<code>e2scrub</code> próbuje sprawdzić (bez naprawiania) metadane podmontowanych systemów plików z rodziny
ext2, ext3 i ext4, które rezydują w obrębie urządzenia LVM. <code>e2scrub</code> jest w stanie taki zabieg
przeprowadzić wykonując migawkę systemu plików i puszczając na niej <code>e2fsck</code> . Urządzenie LVM musi
jednak dysponować minimum 256 MiB wolnego miejsca (tych, których akurat zabrakło). To miejsce
zostanie przeznaczone na snapshot. W przypadku, gdy system plików jest dość ekstensywnie
wykorzystywany, to trzeba się liczyć z faktem, że te 256 MiB może być niewystarczające. Po
zakończonym procesie skanowania, migawka zostanie automatycznie usunięta. W przypadku, gdy nie
zostaną stwierdzone żadne błędy, licznik montowań danego systemu plików ulegnie wyzerowaniu. W taki
sposób możliwe jest przeprowadzenie reakcyjnego sprawdzania konsystencji systemu plików zamiast
cyklicznego. Przy większych partycjach, takie podejście jest w stanie zaoszczędzić nam sporo czasu
podczas startu systemu. Gdyby jednak podczas skanowania migawki jakieś błędy systemu plików się
pojawiły, to dany system plików zostanie oznaczony jako błędny i przy następnym uruchomieniu
komputera zostanie zainicjowany <code>e2fsck</code> na tej partycji, no chyba, że wcześniej sami oto się
postaramy.</p>
<p>No to już wiem dlaczego ten cały proces sprawdzania voluminów logicznych LVM się nie powiódł na
jednym z dysków w moim laptopie, bo krojąc go na partycje nie zmierzałem robić jakichkolwiek
migawek żadnego z jego dysków logicznych. Wygląda na to, że powinienem nieco zmienić układ dysków
logicznych na tym urządzeniu LVM i wykroić tak ze 4 GiB wolnego miejsca, by ten proces sprawdzania
systemu plików był w stanie działać jak należy.</p>
<h2 id="jak-przygotować-nośnik-lvm-pod-e2scrub">Jak przygotować nośnik LVM pod e2scrub</h2>
<p>Jeśli jesteśmy sytuacji, gdzie cała wolna przestrzeń grupy voluminów została przeznaczona na
logiczne dyski, to niestety trzeba jeden z tych dysków pomniejszyć, a odzyskaną w ten sposób
przestrzeń zostawić w formie nieużywanej na potrzebny snapshot'a. Poniżej znajdują się statystyki
grup voluminów w moim laptopie:</p>
<pre><code># pvscan
  PV /dev/mapper/sdb1_crypt   VG wd_blue_label    lvm2 [820.30 GiB / 0    free]
  PV /dev/mapper/sda2_crypt   VG wd_black_label   lvm2 [&lt;230.88 GiB / 4.00 GiB free]
  Total: 2 [&lt;1.03 TiB] / in use: 2 [&lt;1.03 TiB] / in no VG: 0 [0   ]
</code></pre>
<p>Grupa voluminów <code>wd_black_label</code> ma jak widać już 4 GiB wolnego miejsca, z racji wykorzystywania go
przy procesie aktualizacji systemu. Te bardziej ryzykowne aktualizacje mojego Debiana są
przeprowadzane właśnie z wykorzystaniem migawki LVM, bo jeśli coś pójdzie nie tak, to taką migawkę
można bardzo szybko usunąć cofając przy tym wszelkie zmiany, które zostały wprowadzone za sprawą
aktualizacji systemu. Natomiast jak widać w przypadku grupy voluminów <code>wd_blue_label</code> , tu już
brakuje nam wolnego miejsca i trzeba je jakoś odzyskać. Spójrzmy zatem za rozkład partycji na tym
nośniku:</p>
<pre><code># lsblk /dev/sdb
NAME                            SIZE FSTYPE      TYPE  LABEL         MOUNTPOINT     UUID
sdb                           931.5G             disk
├─sdb1                        820.3G crypto_LUKS part  wd_blue_label                66861f93-9fc7-46f9-b969-1ade25dcb898
│ └─sdb1_crypt                820.3G LVM2_member crypt                              HTmcBl-es16-2tT3-TK2n-uOyE-NaTL-ZRAT1c
│   ├─wd_blue_label-Debian      360G ext4        lvm   Debian        /media/Debian  141f5fee-3080-4852-9511-d9fb929028f7
│   ├─wd_blue_label-android     320G ext4        lvm   android       /media/Android 91f0c6ba-a318-4f7e-94ad-5ccdef94dca4
│   ├─wd_blue_label-grafi      99.3G ext4        lvm   grafi         /media/Grafi   abc7c0af-76b3-423e-8dd2-e89008614036
│   └─wd_blue_label-ccache       41G ext4        lvm   ccache        /media/ccache  d340d1a1-3a02-449c-98e4-603679fba072
├─sdb2                         62.5G ntfs        part  windows                      78E28017E27FD838
└─sdb3                         46.7G ntfs        part  win_data                     5E046FAF1D2A959B
</code></pre>
<p>Jako, że mam trochę wolnego miejsca jeszcze na partycji <code>ccache</code> , która w zasadzie i tak służy
jedynie w celach przyśpieszania kompilacji programów, to właśnie ta partycja zostanie pomniejszona
o 4 GiB. Wpisujemy zatem w terminal to poniższe polecenia:</p>
<pre><code># systemctl stop media-ccache.mount
# lvreduce -L -4G -r /dev/mapper/wd_blue_label-ccache
fsck from util-linux 2.33.1
ccache: clean, 75288/2686976 files, 1033158/10747904 blocks
resize2fs 1.45.0 (6-Mar-2019)
Resizing the filesystem on /dev/mapper/wd_blue_label-ccache to 9699328 (4k) blocks.
The filesystem on /dev/mapper/wd_blue_label-ccache is now 9699328 (4k) blocks long.

  Size of logical volume wd_blue_label/ccache changed from 41.00 GiB (10496 extents) to 37.00 GiB (9472 extents).
  Logical volume wd_blue_label/ccache successfully resized.
</code></pre>
<p>Powinniśmy już mieć wolne 4 GiB przestrzeni w grupie voluminów <code>wd_blue_label</code> :</p>
<pre><code># pvscan
  /dev/sdc: open failed: No medium found
  PV /dev/mapper/sdb1_crypt   VG wd_blue_label    lvm2 [820.30 GiB / 4.00 GiB free]
  PV /dev/mapper/sda2_crypt   VG wd_black_label   lvm2 [&lt;230.88 GiB / 4.00 GiB free]
  Total: 2 [&lt;1.03 TiB] / in use: 2 [&lt;1.03 TiB] / in no VG: 0 [0   ]
</code></pre>
<p>Gdy zegar wybije następny moment, w który <code>e2scrub</code> będzie chciał przeprowadzić skanowanie systemu
plików któregoś z dysku logicznego tej grupy voluminów, to powinno mu się to już udać.</p>
<h2 id="ręczne-wymuszenie-sprawdzenia-systemu-plików">Ręczne wymuszenie sprawdzenia systemu plików</h2>
<p>Jeśli nie chce nam się czekać parę dni na przetestowanie zmian, które wprowadziliśmy, możemy
zainicjować ręczne skanowanie systemu plików. Wystarczy, że w terminalu uruchomimy usługę
<code>e2scrub_all.service</code> :</p>
<pre><code># systemctl start  e2scrub_all.service
</code></pre>
<p>Zanim jednak tę usługę uruchomimy, warto zainteresować się plikiem <code>/etc/e2scrub.conf</code> i zmienić w
nim parametr <code>snap_size_mb=</code> tak, by pasował do ilości wolnego miejsca w grupach voluminów:</p>
<pre><code>snap_size_mb=4096
</code></pre>
<p>Po puszczeniu usługi, <code>e2scrub</code> stworzy kolejno migawkę dla każdego dysku logicznego LVM i
przeskanuje jej system plików:</p>
<pre><code># lsblk /dev/sdb
NAME                                   SIZE FSTYPE      TYPE  LABEL          MOUNTPOINT     UUID
sdb                                  931.5G             disk
├─sdb1                               820.3G crypto_LUKS part  wd_blue_label                 66861f93-9fc7-46f9-b969-1ade25dcb898
│ └─sdb1_crypt                       820.3G LVM2_member crypt                               HTmcBl-es16-2tT3-TK2n-uOyE-NaTL-ZRAT1c
│   ├─wd_blue_label-Debian-real        360G             lvm
│   │ ├─wd_blue_label-Debian           360G ext4        lvm   Debian         /media/Debian  141f5fee-3080-4852-9511-d9fb929028f7
│   │ └─wd_blue_label-Debian.e2scrub   360G ext4        lvm   Debian                        141f5fee-3080-4852-9511-d9fb929028f7
│   ├─wd_blue_label-android            320G ext4        lvm   android        /media/Android 91f0c6ba-a318-4f7e-94ad-5ccdef94dca4
│   ├─wd_blue_label-grafi             99.3G ext4        lvm   grafi          /media/Grafi   abc7c0af-76b3-423e-8dd2-e89008614036
│   ├─wd_blue_label-ccache              37G ext4        lvm   ccache                        d340d1a1-3a02-449c-98e4-603679fba072
│   └─wd_blue_label-Debian.e2scrub-cow   4G             lvm
│     └─wd_blue_label-Debian.e2scrub   360G ext4        lvm   Debian                        141f5fee-3080-4852-9511-d9fb929028f7
├─sdb2                                62.5G ntfs        part  windows                       78E28017E27FD838
└─sdb3                                46.7G ntfs        part  win_data                      5E046FAF1D2A959B
</code></pre>
<p>Jak widać volumin &quot;Debian&quot; jest ciągle aktywny, zaś w logu mamy takie oto informacje:</p>
<pre><code>systemd[1]: Starting Online ext4 Metadata Check for /media/Debian...
lvm[121988]: Monitoring snapshot wd_blue_label-Debian.e2scrub.
e2scrub@-media-Debian[128007]:   Logical volume &quot;Debian.e2scrub&quot; created.
e2scrub@-media-Debian[128007]: e2fsck 1.45.0 (6-Mar-2019)
e2scrub@-media-Debian[128007]: Pass 1: Checking inodes, blocks, and sizes
e2scrub@-media-Debian[128007]: Pass 2: Checking directory structure
e2scrub@-media-Debian[128007]: Pass 3: Checking directory connectivity
e2scrub@-media-Debian[128007]: Pass 4: Checking reference counts
e2scrub@-media-Debian[128007]: Pass 5: Checking group summary information
e2scrub@-media-Debian[128007]: Debian: 307831/23592960 files (0.2% non-contiguous), 91434555/94371840 blocks
e2scrub@-media-Debian[128007]: /media/Debian: Scrub succeeded.
e2scrub@-media-Debian[128007]: tune2fs 1.45.0 (6-Mar-2019)
e2scrub@-media-Debian[128007]: Setting current mount count to 0
e2scrub@-media-Debian[128007]: Setting time filesystem last checked to Sun Mar 17 18:42:35 2019
dmeventd[121988]: No longer monitoring snapshot wd_blue_label-Debian.e2scrub.
e2scrub@-media-Debian[128007]:   Logical volume &quot;Debian.e2scrub&quot; successfully removed
e2scrub@-media-Debian[128007]: /media/Debian: Trimming free space.
e2scrub@-media-Debian[128007]: fstrim: /media/Debian: the discard operation is not supported
systemd[1]: e2scrub@-media-Debian.service: Succeeded.
systemd[1]: Started Online ext4 Metadata Check for /media/Debian.
</code></pre>
<p>Wyżej widzimy <code>Setting current mount count to 0</code> , który resetuje licznik aktualnych montowań do 0,
bo nie stwierdzono żadnych błędów systemu plików.</p>
<p>Nie zawsze jednak będzie tak miło. Podczas sprawdzania partycji <code>/tmp/</code> log wyglądał już nieco
inaczej:</p>
<pre><code>systemd[1]: Starting Online ext4 Metadata Check for /tmp...
lvm[121988]: Monitoring snapshot wd_black_label-tmp.e2scrub.
e2scrub@-tmp[128288]:   Logical volume &quot;tmp.e2scrub&quot; created.
e2scrub@-tmp[128288]: e2fsck 1.45.0 (6-Mar-2019)
e2scrub@-tmp[128288]: Pass 1: Checking inodes, blocks, and sizes
e2scrub@-tmp[128288]: Deleted inode 40 has zero dtime.  Fix? yes
e2scrub@-tmp[128288]: Pass 2: Checking directory structure
e2scrub@-tmp[128288]: Pass 3: Checking directory connectivity
e2scrub@-tmp[128288]: /lost+found not found.  Create? yes
e2scrub@-tmp[128288]: Pass 4: Checking reference counts
e2scrub@-tmp[128288]: Pass 5: Checking group summary information
e2scrub@-tmp[128288]: Free inodes count wrong for group #0 (8149, counted=8150).
e2scrub@-tmp[128288]: Fix? yes
e2scrub@-tmp[128288]: Free inodes count wrong (262069, counted=262070).
e2scrub@-tmp[128288]: Fix? yes
e2scrub@-tmp[128288]: tmp: ***** FILE SYSTEM WAS MODIFIED *****
e2scrub@-tmp[128288]: tmp: 74/262144 files (2.7% non-contiguous), 36994/1048576 blocks
e2scrub@-tmp[128288]: /tmp: Scrub FAILED due to corruption!  Unmount and run e2fsck -y.
e2scrub@-tmp[128288]: tune2fs 1.45.0 (6-Mar-2019)
e2scrub@-tmp[128288]: Setting filesystem error flag to force fsck.
dmeventd[121988]: No longer monitoring snapshot wd_black_label-tmp.e2scrub.
e2scrub@-tmp[128288]:   Logical volume &quot;tmp.e2scrub&quot; successfully removed
systemd-journald[472]: Missed 2 kernel messages
systemd[1]: e2scrub@-tmp.service: Main process exited, code=exited, status=1/FAILURE
systemd[1]: e2scrub@-tmp.service: Failed with result 'exit-code'.
systemd[1]: Failed to start Online ext4 Metadata Check for /tmp.
systemd[1]: e2scrub@-tmp.service: Triggering OnFailure= dependencies.
systemctl[128287]: Job for e2scrub@-tmp.service failed because the control process exited with error code.
systemctl[128287]: See &quot;systemctl status e2scrub@-tmp.service&quot; and &quot;journalctl -xe&quot; for details.
systemd[1]: Starting Online ext4 Metadata Check Failure Reporting for /tmp...
systemd[1]: Starting Online ext4 Metadata Check for /var/tmp...
systemd[1]: e2scrub_fail@-tmp.service: Succeeded.
systemd[1]: Started Online ext4 Metadata Check Failure Reporting for /tmp.
</code></pre>
<p>No i tu już mamy błędy systemu plików, co oznajmia nam komunikat: <code>Scrub FAILED due to corruption!</code> . Wyżej w logu zaś mamy również informację <code>Setting filesystem error flag to force fsck</code> , która mówi nam, że system plików został oznaczony jako błędy. Przy następnej próbie
montowania tej partycji w systemie zostanie wymuszone skanowanie systemu plików.</p>
<h2 id="wyłączenie-e2scrub">Wyłączenie e2scrub</h2>
<p>Oczywiście ten mechanizm sprawdzania systemu plików na podmontowanych voluminach LVM za sprawą
<code>e2scrub</code> można wyłączyć jeśli go naturalnie nie potrzebujemy. Choć jak widać jest on bardzo
użyteczny. Jeśli nie chcemy z niego korzystać to wystarczy wpisać w terminalu te dwa poniższe
polecenia:</p>
<pre><code># systemctl disable e2scrub_all.timer
# systemctl stop e2scrub_all.timer
</code></pre>
<p>Dla pewności można sprawdzić czasówki:</p>
<pre><code># systemctl list-timers -all
</code></pre>
<p>Jeśli nie widać tam <code>e2scrub_all.timer</code> , to znaczy, że już się nam automatycznie on nie uruchomi.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">Debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/ext4/">Ext4</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/lvm/">Lvm</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&amp;text=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&amp;title=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&amp;title=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&title=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&amp;title=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fczym-jest-online-ext4-metadata-check-w-linuxowym-lvm%2f&description=Czym%20jest%20Online%20ext4%20Metadata%20Check%20w%20linux%27owym%20LVM" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>

	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/unexpected-inconsistency-inode-corrupt-extent-header/">Unexpected Inconsistency: Inode has corrupt extent header</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/data-czas-utworzenia-pliku-w-linuxie-crtime/">Data i czas utworzenia pliku w linux&#39;ie (crtime)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zmiana-identyfikatora-uuid/">Zmiana identyfikatora UUID systemu plików EXT4 i kontenera LUKS</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/instalacja-debiana-z-wykorzystaniem-debootstrap/">Instalacja debiana z wykorzystaniem debootstrap</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kopia-struktury-dysku-twardego/">Kopia struktury dysku twardego</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zmiana-rozmiaru-partycji-ext4/">Zmiana rozmiaru partycji EXT4</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-odzyskac-usuniete-z-dysku-pliki/">Jak odzyskać usunięte z dysku pliki</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://mastodon.social/@morfik">
			<svg class="social__icon" aria-label="Mastodon" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M416 197c0-74-49-96-49-96-42-22-172-24-222 0 0 0-49 22-49 96v59c2 72 14 145 81 162 33 9 89 18 140-6l-2-27s-27 7-58 7c-74 2-67-39-70-52 0 0 51 17 137 6 42-6 80-32 85-56 8-38 7-93 7-93zm-58 96h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60v91z"/></svg>
		</a>
</div>
	<div class="footer__copyright">© 2025 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
