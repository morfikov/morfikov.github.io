<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej" />
<meta property="og:description" content="Posiadacze monochromatycznych (czarnobiałych) drukarek laserowych zapewne spotkali się z problemem
drukowania kolorowych dokumentów na tego typu urządzeniach. Nie chodzi tutaj o drukowanie obrazków
czy innych elementów graficznych ale o wydrukowanie, np. zeskanowanej książki. Ostatnio przyszło mi
wydrukować dokumentację techniczną dość starego urządzenia. Problem w tym, że nie był to zwykły
kawałek książki, a jedynie jej skany, z których ktoś postanowił zrobić plik PDF . Takiego
dokumentu &quot;tekstowego&quot; za bardzo nie da się wydrukować na drukarce laserowej, przynajmniej nie bez
pchania się w ogromne koszty. Dla przykładu, w miejsce pożółkniętej kartki ze skanu, taka drukarka
wstawi jakiś odcień szarości i w ten sposób zadrukuje tą szarością całą stronę marnując przy tym
niesamowite ilości toneru, za który my będziemy musieli później zapłacić, co czyni cały proces
drukowania zeskanowanych dokumentów bardzo kosztownym. Postanowiłem jednak znaleźć jakiś sposób, by
tę dokumentację wydrukować, choć trzeba było pierw zająć się samymi skanami, tj. doprowadzić je do
stanu, w którym można by mówić o ewentualnym ich wydrukowaniu. Okazało się, że nie jest to jakoś
specjalnie trudne zadanie, zwłaszcza, gdy na linux zaprzęgnie się do tego celu ImageMagick." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/drukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-10-26T19:57:00+02:00" />
<meta property="article:modified_time" content="2021-10-26T19:57:00+02:00" />


		<meta itemprop="name" content="Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej">
<meta itemprop="description" content="Posiadacze monochromatycznych (czarnobiałych) drukarek laserowych zapewne spotkali się z problemem
drukowania kolorowych dokumentów na tego typu urządzeniach. Nie chodzi tutaj o drukowanie obrazków
czy innych elementów graficznych ale o wydrukowanie, np. zeskanowanej książki. Ostatnio przyszło mi
wydrukować dokumentację techniczną dość starego urządzenia. Problem w tym, że nie był to zwykły
kawałek książki, a jedynie jej skany, z których ktoś postanowił zrobić plik PDF . Takiego
dokumentu &quot;tekstowego&quot; za bardzo nie da się wydrukować na drukarce laserowej, przynajmniej nie bez
pchania się w ogromne koszty. Dla przykładu, w miejsce pożółkniętej kartki ze skanu, taka drukarka
wstawi jakiś odcień szarości i w ten sposób zadrukuje tą szarością całą stronę marnując przy tym
niesamowite ilości toneru, za który my będziemy musieli później zapłacić, co czyni cały proces
drukowania zeskanowanych dokumentów bardzo kosztownym. Postanowiłem jednak znaleźć jakiś sposób, by
tę dokumentację wydrukować, choć trzeba było pierw zająć się samymi skanami, tj. doprowadzić je do
stanu, w którym można by mówić o ewentualnym ich wydrukowaniu. Okazało się, że nie jest to jakoś
specjalnie trudne zadanie, zwłaszcza, gdy na linux zaprzęgnie się do tego celu ImageMagick."><meta itemprop="datePublished" content="2021-10-26T19:57:00+02:00" />
<meta itemprop="dateModified" content="2021-10-26T19:57:00+02:00" />
<meta itemprop="wordCount" content="2171">
<meta itemprop="keywords" content="debian,pdf,drukarka,imagemagick,ocr," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej"/>
<meta name="twitter:description" content="Posiadacze monochromatycznych (czarnobiałych) drukarek laserowych zapewne spotkali się z problemem
drukowania kolorowych dokumentów na tego typu urządzeniach. Nie chodzi tutaj o drukowanie obrazków
czy innych elementów graficznych ale o wydrukowanie, np. zeskanowanej książki. Ostatnio przyszło mi
wydrukować dokumentację techniczną dość starego urządzenia. Problem w tym, że nie był to zwykły
kawałek książki, a jedynie jej skany, z których ktoś postanowił zrobić plik PDF . Takiego
dokumentu &quot;tekstowego&quot; za bardzo nie da się wydrukować na drukarce laserowej, przynajmniej nie bez
pchania się w ogromne koszty. Dla przykładu, w miejsce pożółkniętej kartki ze skanu, taka drukarka
wstawi jakiś odcień szarości i w ten sposób zadrukuje tą szarością całą stronę marnując przy tym
niesamowite ilości toneru, za który my będziemy musieli później zapłacić, co czyni cały proces
drukowania zeskanowanych dokumentów bardzo kosztownym. Postanowiłem jednak znaleźć jakiś sposób, by
tę dokumentację wydrukować, choć trzeba było pierw zająć się samymi skanami, tj. doprowadzić je do
stanu, w którym można by mówić o ewentualnym ich wydrukowaniu. Okazało się, że nie jest to jakoś
specjalnie trudne zadanie, zwłaszcza, gdy na linux zaprzęgnie się do tego celu ImageMagick."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2021-10-26T19:57:00&#43;02:00">Opublikowano: 26/10/2021</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Drukowanie zeskanowanych dokumentów tekstowych na drukarce laserowej</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#problematyczne-skany-dokumentów">Problematyczne skany dokumentów</a>
      <ol>
        <li><a href="#grzbiety-i-inne-artefakty">Grzbiety i inne artefakty</a></li>
      </ol>
    </li>
    <li><a href="#podział-dokumentu-pdf-na-obrazki-pngjpeg">Podział dokumentu PDF na obrazki PNG/JPEG</a>
      <ol>
        <li><a href="#skala-szarości">Skala szarości</a></li>
        <li><a href="#głębia-koloru-1-bit-mono">Głębia koloru 1-bit (mono)</a></li>
      </ol>
    </li>
    <li><a href="#zaprzęgnięcie-do-pracy-imagemagick">Zaprzęgnięcie do pracy ImageMagick</a>
      <ol>
        <li><a href="#wyostrzenie-tekstu">Wyostrzenie tekstu</a></li>
        <li><a href="#czyszczenie-tła-dokumentu">Czyszczenie tła dokumentu</a></li>
      </ol>
    </li>
    <li><a href="#skrypt-textcleaner">Skrypt textcleaner</a></li>
    <li><a href="#konwersja-pngjpeg-do-pdf">Konwersja PNG/JPEG do PDF</a></li>
    <li><a href="#problemy-z-convert">Problemy z convert</a>
      <ol>
        <li><a href="#convert-im6q16-attempt-to-perform-an-operation-not-allowed-by-the-security-policy-pdf">convert-im6.q16: attempt to perform an operation not allowed by the security policy `PDF'</a></li>
        <li><a href="#convert-im6q16-cache-resources-exhausted">convert-im6.q16: cache resources exhausted</a></li>
      </ol>
    </li>
    <li><a href="#ocr">OCR</a></li>
    <li><a href="#scantailor-oraz-scantailor-advanced">Scantailor oraz Scantailor Advanced</a></li>
    <li><a href="#podsumowanie">Podsumowanie</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Posiadacze monochromatycznych (czarnobiałych) drukarek laserowych zapewne spotkali się z problemem
drukowania kolorowych dokumentów na tego typu urządzeniach. Nie chodzi tutaj o drukowanie obrazków
czy innych elementów graficznych ale o wydrukowanie, np. zeskanowanej książki. Ostatnio przyszło mi
wydrukować dokumentację techniczną dość starego urządzenia. Problem w tym, że nie był to zwykły
kawałek książki, a jedynie jej skany, z których ktoś postanowił zrobić plik PDF . Takiego
dokumentu &quot;tekstowego&quot; za bardzo nie da się wydrukować na drukarce laserowej, przynajmniej nie bez
pchania się w ogromne koszty. Dla przykładu, w miejsce pożółkniętej kartki ze skanu, taka drukarka
wstawi jakiś odcień szarości i w ten sposób zadrukuje tą szarością całą stronę marnując przy tym
niesamowite ilości toneru, za który my będziemy musieli później zapłacić, co czyni cały proces
drukowania zeskanowanych dokumentów bardzo kosztownym. Postanowiłem jednak znaleźć jakiś sposób, by
tę dokumentację wydrukować, choć trzeba było pierw zająć się samymi skanami, tj. doprowadzić je do
stanu, w którym można by mówić o ewentualnym ich wydrukowaniu. Okazało się, że nie jest to jakoś
specjalnie trudne zadanie, zwłaszcza, gdy na linux zaprzęgnie się do tego celu ImageMagick.</p>
<h2 id="problematyczne-skany-dokumentów">Problematyczne skany dokumentów</h2>
<p>W zasadzie nie byłoby żadnego problemu z drukowaniem zeskanowanych książek, gdyby nie fakt, że
zeskanowana biała kartka nie jest do końca biała. Przyczyny takiego stanu rzeczy mogą być różne,
np. promienie słoneczne mogą z biegiem lat degradować biel papieru. Inną przyczyną może być też
nie najlepsze oświetlenie pomieszczenia w chwili robienia fotki takiej stronie zwykłym aparatem w
telefonie. Poniżej znajduje się przykład takiej białej kartki, która została mi podsunięta do
wydrukowania:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/001.scan-image-laser-printer-print-orig-pdf.jpg" alt="scan-image-laser-printer-print-orig-pdf"    class="huge"></p>
<p>No jak widać, ta biała strona nie przypomina za bardzo tego co każdy z nas rozumie pod pojęciem
&quot;biały&quot;.</p>
<h3 id="grzbiety-i-inne-artefakty">Grzbiety i inne artefakty</h3>
<p>Patrząc na tę powyższą fotkę ze skanu dokumentacji technicznej, możemy po lewej stronie zauważyć
grzbiet tego dokumentu, który również by został wydrukowany. Tego typu elementy trzeba wstępnie
wyciąć. Do tego celu można posłużyć się narzędziem <code>krop</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/007.scan-image-laser-printer-print-krop.png" alt="scan-image-laser-printer-print-krop"    class="huge"></p>
<p>Każdy zaznaczony element na danej stronie w pliku wejściowym zostanie przekuty w osobną stronę i
zapisany w nowym dokumencie PDF.</p>
<p>W tym przypadku każda strona się nieco różniła i trzeba było przycinać je indywidualnie. W innych
przypadkach być może da radę skorzystać z opcji przycięcia dla wszystkich stron czy też stron
parzystych i nieparzystych. Jeśli jakieś strony ze źródłowego materiału chcemy pominąć, to <code>krop</code>
posiada stosowną opcję, by tych stron w wynikowym PDF nie uwzględnić. Podobnie sprawa wygląda w
przypadku ewentualnego obracania stron.</p>
<p>Tak czy inaczej, przy pomocy <code>krop</code> możemy wstępie przygotować sobie dokument, który trzeba będzie
naturalnie poddać kolejnym etapom czyszczenia.</p>
<h2 id="podział-dokumentu-pdf-na-obrazki-pngjpeg">Podział dokumentu PDF na obrazki PNG/JPEG</h2>
<p>Cała przykładowa dokumentacja techniczna składa się z około 50 takich stron, których przykład
mieliśmy na fotce wyżej. Część z tych skanów zawiera jedynie sam tekst, a na pozostałych mamy
rysunki. Przy pomocy <code>pdfimages</code> (z pakietu <code>poppler-utils</code> ) możemy uzyskać nieco informacji na
temat samych obrazków, które zostały umieszczone w dokumencie PDF:</p>
<pre><code>$ pdfimages -list skan.pdf
page   num  type   width height color comp bpc  enc interp  object ID x-ppi y-ppi size ratio
--------------------------------------------------------------------------------------------
   1     0 image     425   583  rgb     3   8  jpeg   no         9  0    52    50 22.1K 3.0%
   2     1 image     661   916  rgb     3   8  jpeg   no        15  0    80    79 35.6K 2.0%
   3     2 image     661   916  rgb     3   8  jpeg   no        20  0    80    79 44.8K 2.5%
   4     3 image     661   916  rgb     3   8  jpeg   no        25  0    80    79 37.3K 2.1%
   5     4 image     661   916  rgb     3   8  jpeg   no        30  0    80    79 57.1K 3.2%
   6     5 image     661   916  rgb     3   8  jpeg   no        35  0    80    79 60.6K 3.4%
   7     6 image     661   916  rgb     3   8  jpeg   no        40  0    80    79 71.1K 4.0%
   8     7 image     661   916  rgb     3   8  jpeg   no        45  0    80    79 77.7K 4.4%
   9     8 image     661   916  rgb     3   8  jpeg   no        50  0    80    79 76.7K 4.3%
  10     9 image     661   916  rgb     3   8  jpeg   no        55  0    80    79 74.9K 4.2%
...
</code></pre>
<p>Zatem definitywnie można powiedzieć, że mamy do czynienia ze skanem, a nie z obrazkami osadzonymi w
tekście. Mamy tutaj informacje o rozdzielczości obrazków. Wiemy też, że obrazki są kolorowe (RGB) i
zakodowane w stratnym formacie JPEG. Mamy też informacje o PPI oraz rozmiarze obrazków, który nie
napawa optymizmem.</p>
<p>Najlepiej ten dokument PDF rozbić na osobne strony, po czym zapisać każdą z tych stron w formacie
PNG/JPEG. Do tego celu można wykorzystać <code>pdfimages</code> lub <code>pdftocairo</code> .</p>
<pre><code>$ pdfimages skan.pdf page -png

$ pdftocairo skan.pdf -png
</code></pre>
<h3 id="skala-szarości">Skala szarości</h3>
<p>Wyżej mieliśmy informacje, że obrazki są kolorowe, co było też widać na podglądzie przykładowej
strony. Można by te obrazki przekonwertować z trybu kolorowego do skali szarości ale w przypadku
drukowania na drukarkach monochromatycznych na niewiele nam się to zda, bo w dalszym ciągu szare
elementy materiału źródłowego będą widoczne na wydrukowanej kartce. Jeśli jednak ktoś preferuje
odcienie szarości, to może skorzystać z tego poniższego polecenia:</p>
<pre><code>$ pdftocairo skan.pdf -png -gray
</code></pre>
<p>Te zeskanowane obrazki nie powinny już tak bardzo odstraszać swoim wyglądem:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/002.scan-image-laser-printer-print-gray-pdf.jpg" alt="scan-image-laser-printer-print-gray-pdf"    class="huge"></p>
<p>Nie da się ukryć, że tło dokumentu jest teraz bardziej białe ale do idealnej bieli ździebko jeszcze
brakuje, a ta nieidealna biel zostanie na drukarce laserowej wydrukowana. W zasadzie to w kwestii
samego wydruku raczej nic się nie zmieniło.</p>
<h3 id="głębia-koloru-1-bit-mono">Głębia koloru 1-bit (mono)</h3>
<p>Można naturalnie spróbować przerobić obrazek przy pomocy <a href="https://en.wikipedia.org/wiki/Color_depth#1-bit_color">głębi koloru 1-bit</a>, tj. dwóch kolorów,
z których jednym będzie kolor czarny (dla tekstu), a drugim biały (dla tła strony). W przypadku
dokumentów, które mają niewielki stosunek szumu tła do treści/tekstu, taki zabieg może dać nawet
dość zadowalające efekty.</p>
<p>By rozdzielić dokument PDF na obrazki i potraktować je przy tym głębią koloru 1-bit, możemy
skorzystać z poniższego polecenia:</p>
<pre><code>$ pdftocairo skan.pdf -png -mono
</code></pre>
<p>Niemniej jednak, w przypadku tego przykładowego skanu dokumentacji, efekt jest dość daleki od
jakiekolwiek formy, która ma cokolwiek wspólnego ze słowem &quot;zadowalający&quot;:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/003.scan-image-laser-printer-print-black-white-pdf.png" alt="scan-image-laser-printer-print-black-white-pdf"    class="huge"></p>
<p>No jak widać, mamy kartkę pokrytą śnieżnobiałą ... bielą ale najwyraźniej trochę zasp się porobiło
na tych czarnych literkach, przez co przeczytanie takiego tekstu graniczy z cudem.</p>
<h2 id="zaprzęgnięcie-do-pracy-imagemagick">Zaprzęgnięcie do pracy ImageMagick</h2>
<p>Może i niektóre osoby zadowoliłyby się wynikami uzyskanymi powyżej, zwłaszcza, gdy obrazki się
poprzycina i potraktuje głębią szarości ale mi ciągle brakowało jakiegoś bardziej cywilizowanego
rozwiązania. Z pomocą tutaj przyszedł ImageMagick.</p>
<p>Mając rozbity dokument PDF na pojedynce strony w postaci obrazków PNG/JPEG (kolorowych czy też w
skali szarości), możemy spróbować przerobić te obrazki przy pomocy narzędzia <code>convert</code> .</p>
<h3 id="wyostrzenie-tekstu">Wyostrzenie tekstu</h3>
<p>Najlepiej zacząć od wyostrzenia obrazka (tekstu) podając w <code>convert</code> parametr <code>-sharpen</code> ,
przykładowo:</p>
<pre><code>$ ls ./*.png | xargs -L1 -I {} convert {} -sharpen 0x1 -resize 200% {}-kopia.png
</code></pre>
<p>Im wyższą wartość określimy w opcji <code>-sharpen</code> , tym tekst może stać się ostrzejszy ale kosztem
pewnych elementów samego tekstu. Większe wartości zdają się mieć lepszy rezultat w przypadku
większego tekstu. Przy pomocy <code>-resize</code> możemy dodatkowo powiększyć sobie obrazek, co powinno
pozytywnie wpłynąć na jakość wyostrzenia. Poniżej są przykłady dla <code>-sharpen</code> o wartości <code>0x1</code> ,
<code>0x2</code> , <code>0x3</code> oraz <code>0x4</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/008.scan-image-laser-printer-print-convert-sharpen.png" alt="scan-image-laser-printer-print-convert-sharpen"    class="huge"></p>
<h3 id="czyszczenie-tła-dokumentu">Czyszczenie tła dokumentu</h3>
<p>Po opcjonalnym wyostrzeniu tekstu trzeba oczyścić stronę ze zbędnego szumu tła zostawiając tym
samym jedynie sam tekst. Możemy ten proces przeprowadzić przy pomocy tego poniższego polecenia:</p>
<pre><code>$ ls ./*.png | xargs -L1 -I {} convert {} -quality 100 -density 300 -fill white -fuzz 70% +opaque &quot;#000000&quot; {}-kopia.png
</code></pre>
<p>Kluczowe w tym poleceniu jest określenie białego koloru w parametrze <code>-fill</code> oraz odpowiednie
dobranie wartości w <code>-fuzz</code> . Jeśli <code>-fuzz</code> będzie wysoki (100%), to otrzymamy obrazek zbliżony do
oryginalnego, a jeśli niski (0%), to otrzymamy samą biel. Poniżej przykłady dla tej samej
zeskanowanej strony ale potraktowanej <code>-fuzz 25%</code> , <code>-fuzz 50%</code> oraz <code>-fuzz 80%</code> :</p>
<table>
<thead>
<tr>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td><img loading="lazy" src="https://morfikov.github.io/img/2021/10/004.scan-image-laser-printer-print-convert-fuzz.jpg" alt="scan-image-laser-printer-print-convert-fuzz"    class="small"></td>
<td><img loading="lazy" src="https://morfikov.github.io/img/2021/10/005.scan-image-laser-printer-print-convert-fuzz.jpg" alt="scan-image-laser-printer-print-convert-fuzz"    class="small"></td>
<td><img loading="lazy" src="https://morfikov.github.io/img/2021/10/006.scan-image-laser-printer-print-convert-fuzz.jpg" alt="scan-image-laser-printer-print-convert-fuzz"    class="small"></td>
</tr>
</tbody>
</table>
<p>No jak widać, w zależności od wartości <code>-fuzz</code> , tekst staje się mniej/bardziej czytelny. Im
bardziej tekst będzie czytelny, tym też więcej szumu tła będzie na kartce, który zostanie później
wydrukowany przez drukarkę laserową. Dlatego też trzeba metodą prób i błędów tę wartość <code>-fuzz</code>
sobie dobrać.</p>
<p>Można też skorzystać z poniższego polecenia:</p>
<pre><code>$ ls ./*.png | xargs -L1 -I {} convert {} -quality 100 -density 300 -colorspace rgb -monochrome -median 2 {}-kopia.png
</code></pre>
<p>Ma ono zbliżony efekt do tego poprzedniego polecenia, z tą różnicą, że tekst tutaj będzie już w
zasadzie jednolicie czarny. Podobnie jak we wcześniejszym przypadku, również i tutaj trzeba się
pobawić wartością parametru <code>-median</code> , by uzyskać jak najlepszy efekt dla danego dokumentu.
Poniżej są przykłady dla <code>-median</code> wynoszącego <code>1</code> , <code>2</code> , <code>3</code> oraz <code>4</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/10/009.scan-image-laser-printer-print-convert-median.png" alt="scan-image-laser-printer-print-convert-median"    class="huge"></p>
<h2 id="skrypt-textcleaner">Skrypt textcleaner</h2>
<p>ImageMagick ma też na wyposażeniu <a href="http://www.fmwconcepts.com/imagemagick/textcleaner/">skrypt textcleaner</a>, który jest w stanie oczyścić zeskanowane
dokumenty. Ten skrypt nie jest jednak dostępny w standardowym pakiecie <code>imagemagick</code> i trzeba go
dociągnąć sobie ręcznie ze strony projektu i wrzucić np. do <code>/usr/local/bin/</code> . Poniżej zaś
znajduje się przykładowe wywołanie skryptu <code>textcleaner</code> :</p>
<pre><code>$ textcleaner -g -e normalize -f 80 -o 15 -s 1 in.png out.png
</code></pre>
<p>To powyższe polecenie jest w stanie dać bardzo zbliżony wynik do tego, który został uzyskany w
przypadku <code>convert</code> . Tutaj też by uzyskać nieco lepsze (lub gorsze) efekty trzeba pobawić się
opcjami <code>-f</code> , <code>-o</code> oraz <code>-s</code> .</p>
<h2 id="konwersja-pngjpeg-do-pdf">Konwersja PNG/JPEG do PDF</h2>
<p>Gdy już się skończymy bawić obrazkami, można je wydrukować, choć drukowanie kilkuset stron ręcznie
jedna po drugiej mija się trochę z celem. Dlatego z takich fotek lepiej zrobić pojedynczy dokument
PDF i dopiero ten plik wydrukować. Pliki PNG/JPEG można bez większego problemu skonwertować do PDF,
wystarczy skorzystać z narzędzia <code>convert</code> :</p>
<pre><code>$ convert *.png file.pdf
</code></pre>
<h2 id="problemy-z-convert">Problemy z convert</h2>
<p>Podczas bawienia się narzędziem <code>convert</code> natrafiłem na szereg błędów, które uniemożliwiały
przeprowadzenie pewnych procesów konwersji obrazków. Poniżej znajdują się komunikaty tych błędów
wraz z informacjami na temat jak je wyeliminować.</p>
<h3 id="convert-im6q16-attempt-to-perform-an-operation-not-allowed-by-the-security-policy-pdf">convert-im6.q16: attempt to perform an operation not allowed by the security policy `PDF'</h3>
<p>Najwyraźniej konwersja do PDF może nieść ze sobą <a href="https://askubuntu.com/questions/1081895/trouble-with-batch-conversion-of-png-to-pdf-using-convert">pewne problemy natury bezpieczeństwa</a> i
domyślnie nie będzie ona możliwa, co będzie objawiać się poniższym błędem:</p>
<pre><code>convert-im6.q16: attempt to perform an operation not allowed by the security policy `PDF'
@ error/constitute.c/IsCoderAuthorized/421`
</code></pre>
<p>Możemy nieco rozluźnić politykę bezpieczeństwa określoną w pliku <code>/etc/ImageMagick-6/policy.xml</code>
przez wykomentowanie poniższej linijki:</p>
<pre><code>&lt;!-- &lt;policy domain=&quot;coder&quot; rights=&quot;none&quot; pattern=&quot;PDF&quot; /&gt; --&gt;
</code></pre>
<h3 id="convert-im6q16-cache-resources-exhausted">convert-im6.q16: cache resources exhausted</h3>
<p>Do zabawy z obrazkami czasem potrzeba większych zasobów sprzętowych (pamięć, CPU, etc). Polityka
bezpieczeństwa ImageMagick'a domyślnie limituje wykorzystanie tych zasobów w pliku
<code>/etc/ImageMagick-6/policy.xml</code> , czego efektem może być pojawienie się komunikatów podobnych do
tych poniżej:</p>
<pre><code>convert-im6.q16: cache resources exhausted `./skan.pdf'
@ error/cache.c/OpenPixelCache/4095`
</code></pre>
<p>Można nieco zwiększyć wartości w linijkach zawierających frazę <code>policy domain=&quot;resource&quot;</code> albo też
te linijki czasowo/permanentnie wykomentować:</p>
<pre><code>&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;memory&quot; value=&quot;256MiB&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;map&quot; value=&quot;512MiB&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;width&quot; value=&quot;16KP&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;height&quot; value=&quot;16KP&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;list-length&quot; value=&quot;128&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;area&quot; value=&quot;128MP&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;disk&quot; value=&quot;1GiB&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;file&quot; value=&quot;768&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;thread&quot; value=&quot;4&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;throttle&quot; value=&quot;0&quot;/&gt; --&gt;
&lt;!-- &lt;policy domain=&quot;resource&quot; name=&quot;time&quot; value=&quot;3600&quot;/&gt; --&gt;
</code></pre>
<h2 id="ocr">OCR</h2>
<p>W wątku założonym na <a href="https://forum.dug.net.pl/viewtopic.php?pid=331773">forum dug.net.pl</a>, kilku użytkowników sugerowało skorzystanie z mechanizmu
OCR (Optical Character Recognition), którego zadaniem jest rozpoznanie i wyciągnięcie tekstu z
zeskanowanych obrazków i zapisanie go w zwyczajnym dokumencie tekstowym. Problem w tym, że te skany
przykładowej dokumentacji, z którymi mamy tutaj do czynienia, są bardzo słabej jakości i OCR
popełnia dość sporo błędów. W efekcie po takim wyciągnięciu tekstu z zeskanowanego obrazka trzeba
by bardzo dokładnie ten tekst przejrzeć i ręcznie poprawić wszystkie błędy. Ten proces jest jednak
żmudny i dość czasochłonny i w mojej opinii przy tak niskiej jakości materiału wejściowego lepszym
rozwiązaniem w stosunku do OCR byłoby ręczne przepisanie tego dokumentu, co powinno przebiec o
wiele sprawniej.</p>
<p>Jeśli jednak ktoś miałby dokumenty w nieco lepszej jakości i chciałby dać szansę OCR, to trzeba by
na linux doinstalować pakiety <code>tesseract-ocr</code> i <code>tesseract-ocr-pol</code> (dla rozpoznawania języka
polskiego). Później po wstępnej obróbce materiału wejściowego, np. wyostrzeniu tekstu, można by
spróbować rozpoznać tekst przy pomocy poniższego polecenia:</p>
<pre><code>$ tesseract -l pol --dpi 300 obrazek.png text.txt
</code></pre>
<h2 id="scantailor-oraz-scantailor-advanced">Scantailor oraz Scantailor Advanced</h2>
<p>W tym podlinkowanym wyżej poście na forum pojawiły się także propozycje dedykowanych narzędzi do
obróbki skanowanych dokumentów tekstowych. Jednym z nich był <a href="https://github.com/scantailor/scantailor">Scantailor</a>, który jest już
martwym projektem i wyleciał z Debiana za sprawą zależności QT4. Kolejnym poleconym projektem był
<a href="https://github.com/4lex4/scantailor-advanced">Scantailor Advanced</a>, który jest forkiem tego poprzedniego projektu. Może i Scantailor Advanced
ma interfejs na bazie QT5, to wygląda na to, że sam projekt również jest od dłuższego czasu (około
2 lat) martwy i raczej nie ma co z nim wiązać jakichś większych nadziei. Można naturalnie ręcznie
sobie zbudować źródła tej aplikacji (<a href="https://github.com/4lex4/scantailor-libs-build">instrukcje tutaj</a>) i przy jej pomocy oczyścić skany
dokumentów ale w moim przypadku <code>convert</code> poradził sobie na tyle znośnie, że odpuściłem sobie
Scantailor'a zupełnie. Być może w przyszłości się pobawię tym oprogramowaniem.</p>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Drukowanie zeskanowanych dokumentów tekstowych może być ździebko problematyczne, zwłaszcza w
sytuacjach gdzie zależy nam na ograniczeniu zużycia zasobów tonera w drukarkach laserowych. Można
za to przy lekkim wysiłku podnieść jakość samego tekstu czyniąc go nieco bardziej czytelnym
przy jednoczesnym usunięciu kolorowego tła strony, co powinno ograniczyć dość znacznie ilość tonera
potrzebnego do wydrukowania pojedynczej kartki. Problem w tym, że nie ma w zasadzie dwóch takich
samych zeskanowanych dokumentów. Nawet pojedyncze strony w takim dokumencie mogą się bardzo różnić
pod względem jakości samego tekstu. Dlatego w przypadku tego tupu zeskanowanych dokumentów zawsze
trzeba będzie trochę poeksperymentować z wartościami różnych parametrów, co może nam dać nieco
lepszy (lub też i gorszy) wynik.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/pdf/">pdf</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/drukarka/">drukarka</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/imagemagick/">imagemagick</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/ocr/">ocr</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&amp;text=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&amp;title=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&amp;title=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&title=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&amp;title=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdrukowanie-zeskanowanych-dokumentow-tekstowych-na-drukarce-laserowej%2f&description=Drukowanie%20zeskanowanych%20dokument%c3%b3w%20tekstowych%20na%20drukarce%20laserowej" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/aktualizacja-firmware-drukarki-hp-laserjet-p2055dn-pod-linux/">Aktualizacja firmware drukarki HP LaserJet P2055dn pod linux</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/drukarka-laserowa-pod-linux-hp-laserjet-p2055dn/">Drukarka laserowa pod linux (HP LaserJet P2055dn)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/cups-konfiguracja-drukarki-pod-linuxem/">CUPS, czyli konfiguracja drukarki pod linux&#39;em</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-wylaczyc-mapowane-adresow-ipv4-na-ipv6-w-debian-linux/">Jak wyłączyć mapowanie adresów IPv4 na IPv6 w Debian linux</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-zaktualizowac-firmware-custom-rom-w-smartfonach-xiaomi/">Jak zaktualizować firmware custom ROM&#39;ów w smartfonach Xiaomi</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kopia-zapasowa-danych-smartfona-z-androidem-oandbackupx-syncthing/">Kopia zapasowa danych smartfona z Androidem (OAndBackupX, Syncthing)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kontrola-podswietlenia-klawiatury-via-udev-backlight/">Kontrola podświetlenia klawiatury via UDEV (backlight)</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script>
  var id =  577 ;

  if (id)
  {
    let url = "https://github.com/morfikov/morfitronik-comments/issues/".concat(id);
    let api_url = "https://api.github.com/repos/morfikov/morfitronik-comments/issues/".concat(id, "/comments");

    var commentsDiv = document.getElementById("comments");

    let xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("GET", api_url);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
    xhr.send();

    xhr.onload = function()
    {
      if (xhr.status != 200)
      {
        let errorText = document.createElement("p");
        errorText.innerHTML = "<i>Komentarze dla tego postu nie zostały jeszcze otworzone (albo skrypty GitHub'a są wyłączone). Być może też skończył ci się przydział 60/godzinę (limit GitHub'a).</i>";
        commentsDiv.appendChild(errorText);
      }
      else
      {
        let comments = xhr.response;

        let mainHeader = document.createElement("h3");
        mainHeader.innerHTML = "Komentarze: ".concat(comments.length);
        commentsDiv.appendChild(mainHeader);

        let issueLink = document.createElement("p");
        issueLink.innerHTML = "<i>Możesz zostawić komentarz korzystając z <a href='".concat(url, "'>GitHub issue</a>.</i>");
        commentsDiv.appendChild(issueLink);

        comments.forEach(function(comment)
        {
			const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Europe/Warsaw' };
			options.timeZoneName = 'short';
            let commentContent = document.createElement("div");
            commentContent.setAttribute('class', 'gh-comment')
            commentContent.innerHTML = "".concat(
                "<div class='gh-header'>",
                  "<img src='", comment.user.avatar_url, "' />",
                  "<div style='margin:auto 0;'>",
                    "<b><a class='gh-username' href='", comment.user.html_url, "'>", comment.user.login, "</a></b>",
                    " | <em>", (new Date(comment.created_at)).toLocaleTimeString('pl-PL', options), "</em>",
                  "</div>",
                "</div>",
                "<div class='gh-body'>",
                  comment.body_html,
                "</div>"
            );
            commentsDiv.appendChild(commentContent);
        });
      }
    };

    xhr.onerror = function()
    {
      let errorText = document.createElement("p");
      errorText.innerHTML = "<i>Wystąpił jakiś błąd przy ładowaniu komentarzy.</i>";
      commentsDiv.appendChild(errorText);
    };
  }
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
