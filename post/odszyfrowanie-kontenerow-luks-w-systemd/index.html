<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Odszyfrowanie kontenerów LUKS w systemd | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Odszyfrowanie kontenerów LUKS w systemd" />
<meta property="og:description" content="Osoby, które wykorzystują pełne szyfrowanie dysku, wiedzą, że nie zawsze da radę tak skonfigurować
swój system, by upchnąć go na jednej partycji. Nawet jeśli korzystamy z LVM wewnątrz kontenera LUKS,
to i tak zwykle możemy posiadać inne zaszyfrowane partycje, które są odrębną całością i montowane
osobno przy starcie systemu. W takim przypadku zwykle jesteśmy zmuszeni do podawania hasła do
każdego z tych dysków z osobna, co zajmuje czas. Ten problem opisałem po części przy okazji
implementacji kontenera LUKS na potrzeby
Dropbox&#39;a, jak i we wpisie poświęconym przejściu
z kontenerów TrueCrypt&#39;a na te linux&#39;owe, które są wspierane natywnie przez sam
kernel. Niemniej jednak, tamto rozwiązanie
było oparte głównie o starszy init (sysvinit), co wymagało dodatkowej konfiguracji, tak by system
otworzył się po podaniu tylko jednego hasła. W tym wpisie postaramy się wdrożyć mechanizm, który
jest oferowany przez systemd." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/odszyfrowanie-kontenerow-luks-w-systemd/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-01-01T17:18:03+00:00" />
<meta property="article:modified_time" content="2016-01-01T17:18:03+00:00" />


		<meta itemprop="name" content="Odszyfrowanie kontenerów LUKS w systemd">
<meta itemprop="description" content="Osoby, które wykorzystują pełne szyfrowanie dysku, wiedzą, że nie zawsze da radę tak skonfigurować
swój system, by upchnąć go na jednej partycji. Nawet jeśli korzystamy z LVM wewnątrz kontenera LUKS,
to i tak zwykle możemy posiadać inne zaszyfrowane partycje, które są odrębną całością i montowane
osobno przy starcie systemu. W takim przypadku zwykle jesteśmy zmuszeni do podawania hasła do
każdego z tych dysków z osobna, co zajmuje czas. Ten problem opisałem po części przy okazji
implementacji kontenera LUKS na potrzeby
Dropbox&#39;a, jak i we wpisie poświęconym przejściu
z kontenerów TrueCrypt&#39;a na te linux&#39;owe, które są wspierane natywnie przez sam
kernel. Niemniej jednak, tamto rozwiązanie
było oparte głównie o starszy init (sysvinit), co wymagało dodatkowej konfiguracji, tak by system
otworzył się po podaniu tylko jednego hasła. W tym wpisie postaramy się wdrożyć mechanizm, który
jest oferowany przez systemd."><meta itemprop="datePublished" content="2016-01-01T17:18:03+00:00" />
<meta itemprop="dateModified" content="2016-01-01T17:18:03+00:00" />
<meta itemprop="wordCount" content="1046">
<meta itemprop="keywords" content="bezpieczeństwo,luks,szyfrowanie,systemd," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Odszyfrowanie kontenerów LUKS w systemd"/>
<meta name="twitter:description" content="Osoby, które wykorzystują pełne szyfrowanie dysku, wiedzą, że nie zawsze da radę tak skonfigurować
swój system, by upchnąć go na jednej partycji. Nawet jeśli korzystamy z LVM wewnątrz kontenera LUKS,
to i tak zwykle możemy posiadać inne zaszyfrowane partycje, które są odrębną całością i montowane
osobno przy starcie systemu. W takim przypadku zwykle jesteśmy zmuszeni do podawania hasła do
każdego z tych dysków z osobna, co zajmuje czas. Ten problem opisałem po części przy okazji
implementacji kontenera LUKS na potrzeby
Dropbox&#39;a, jak i we wpisie poświęconym przejściu
z kontenerów TrueCrypt&#39;a na te linux&#39;owe, które są wspierane natywnie przez sam
kernel. Niemniej jednak, tamto rozwiązanie
było oparte głównie o starszy init (sysvinit), co wymagało dodatkowej konfiguracji, tak by system
otworzył się po podaniu tylko jednego hasła. W tym wpisie postaramy się wdrożyć mechanizm, który
jest oferowany przez systemd."/>
<meta name="twitter:site" content="@mikhailmorfikov"/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Odszyfrowanie kontenerów LUKS w systemd</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-01-01T17:18:03Z">Opublikowano: 01/01/2016</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Odszyfrowanie kontenerów LUKS w systemd</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#systemd-i-keyring-kernela">Systemd i keyring kernela</a></li>
    <li><a href="#skrypty-od-cryptsetup">Skrypty od cryptsetup</a></li>
    <li><a href="#usługi-dla-systemd">Usługi dla systemd</a></li>
    <li><a href="#jak-długo-kernel-przechowuje-hasła-do-kontenerów-luks">Jak długo kernel przechowuje hasła do kontenerów LUKS?</a></li>
    <li><a href="#bardzo-wolne-odszyfrowanie-kontenerów-luks">Bardzo wolne odszyfrowanie kontenerów LUKS</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Osoby, które wykorzystują pełne szyfrowanie dysku, wiedzą, że nie zawsze da radę tak skonfigurować
swój system, by upchnąć go na jednej partycji. Nawet jeśli korzystamy z LVM wewnątrz kontenera LUKS,
to i tak zwykle możemy posiadać inne zaszyfrowane partycje, które są odrębną całością i montowane
osobno przy starcie systemu. W takim przypadku zwykle jesteśmy zmuszeni do podawania hasła do
każdego z tych dysków z osobna, co zajmuje czas. Ten problem opisałem po części przy okazji
<a href="https://morfikov.github.io/post/dropbox-i-kontener-luks/">implementacji kontenera LUKS na potrzeby
Dropbox'a</a>, jak i we wpisie poświęconym <a href="https://morfikov.github.io/post/przejscie-z-truecrypt-na-luks/">przejściu
z kontenerów TrueCrypt'a na te linux'owe, które są wspierane natywnie przez sam
kernel</a>. Niemniej jednak, tamto rozwiązanie
było oparte głównie o starszy init (sysvinit), co wymagało dodatkowej konfiguracji, tak by system
otworzył się po podaniu tylko jednego hasła. W tym wpisie postaramy się wdrożyć mechanizm, który
jest oferowany przez systemd.</p>
<h2 id="systemd-i-keyring-kernela">Systemd i keyring kernela</h2>
<p>Systemd od jakiegoś czasu jest w stanie wykorzystywać <a href="https://www.kernel.org/doc/Documentation/security/keys.txt">keyring
kernela</a>, co przekłada się na
przechowywanie w nim pewnych haseł. Takie hasła mogą być wykorzystywane, np. <a href="https://morfikov.github.io/post/ecryptfs-jako-alternatywa-dla-encfs/">przy zaszyfrowanym
systemie plików oferowanym przez
ecryptfs</a>. Mogą one także zostać
wykorzystane we wczesnej fazie startu systemu. Każdy użytkownik ma swój własny keyring i nie może
podglądać haseł innych użytkowników. Same hasła zaś mogą mieć ustawiony termin ważności. W takiej
sytuacji, gdy otworzymy systemowy kontener podczas fazy boot, wpisana fraza (hasło) zostanie dodana
do keyring'a na pewien określony czas. Jeśli mamy kilka dodatkowych kontenerów i każdy z nich ma
ustawione to samo hasło, to zostaną one również odszyfrowane właśnie przy pomocy tego hasła, który
został dodany do keyring'a kernela. Po odszyfrowaniu kontenerów, to hasło jest już zwyczajnie zbędne
i może zostać usunięte z keyring'a.</p>
<h2 id="skrypty-od-cryptsetup">Skrypty od cryptsetup</h2>
<p>We wstępie wspomniałem, że wykorzystując stary mechanizm potrzebne nam są skrypty i odpowiednia
konfiguracja. W debianie skrypty, o których mowa, są dostarczane wraz z pakietem <code>cryptsetup</code> .
Natomiast jeśli chodzi o konfigurację, to interesuje nas głównie plik <code>/etc/crypttab</code> , który
powinien wyglądać mniej więcej tak:</p>
<pre><code># cat /etc/crypttab
# target name source device                                                         key file      options
sda1_crypt      UUID=1820485b-6587-47ab-baa4-761ecc104c25       none            luks
kabi            UUID=f3c10054-0583-4e10-937b-dcdc9a05a25c       sda1_crypt      luks,keyscript=/lib/cryptsetup/scripts/decrypt_derived,noauto,nofail
grafi           UUID=d314ed20-ffaf-4a18-98a7-91538e79d981       sda1_crypt      luks,keyscript=/lib/cryptsetup/scripts/decrypt_derived,noauto,nofail
</code></pre>
<p>Niestety, <a href="https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=618862">systemd nie potrafi jeszcze zrozumieć parametru
keyscript</a>. Dlatego też ta powyższa
konfiguracja nie zadziała z tym init'em. Na szczęście systemd ma własny mechanizm, który eliminuje
potrzebę precyzowania opcji <code>keyscript</code> .</p>
<h2 id="usługi-dla-systemd">Usługi dla systemd</h2>
<p>Niewiele osób wie, że systemd nie korzysta bezpośrednio z plików <code>/etc/crypttab</code> i <code>/etc/fstab</code> . Ma
on zaś kilka generatorów, które w oparciu o te powyższe pliki generują poszczególne usługi. Możemy
się o tym przekonać zaglądając do katalogu <code>/run/systemd/generator/</code> . Powinniśmy tam ujrzeć szereg
plików mających końcówki <code>.mount</code> . Nazwy tych plików powinny być nam raczej znajome, a ich liczba
zależy od ilości wpisów zdefiniowanych w pliku <code>fstab</code> .</p>
<p>Podobnie sprawa ma się w przypadku kontenerów LUKS, z tym, że interesujące nas pliki zaczynają się
od <code>systemd-cryptsetup@</code> . Zawierają one konfigurację zdefiniowaną w pliku <code>crypttab</code> i ich liczba
również zależy od ilości zdefiniowanych tam wpisów.</p>
<p>Generalnie rzecz biorąc, w większości przypadków, proces odszyfrowania i montowania zasobów powinien
przebiegać automatycznie. Unikajmy jednak dublowania konfiguracji i jeśli definiujemy jakieś wpisy w
plikach <code>fstab</code> i <code>crypttab</code> , to nie piszmy osobnych usług pod te zasoby.</p>
<p>Poniżej są przykładowe pliki <code>systemd-cryptsetup@</code> i <code>.mount</code> na wypadek, gdyby ktoś chciał sobie
takie usługi napisać:</p>
<p>Plik usługi otwierającej zaszyfrowany kontener LUKS,
<code>/etc/systemd/system/systemd-cryptsetup@kabi.service</code> :</p>
<pre><code>[Unit]
Description=Cryptography Setup for %I
Documentation=man:man:systemd-cryptsetup@.service(8)
IgnoreOnIsolate=true
DefaultDependencies=no
After=dev-disk-by\x2duuid-f3c10054\x2d0583\x2d4e10\x2d937b\x2ddcdc9a05a25c.device
After=cryptsetup-pre.target
After=systemd-fsck-root.service
Before=systemd-fsck@dev-mapper-kabi.service media-Kabi.mount
Before=cryptsetup.target
Before=umount.target shutdown.target
Conflicts=umount.target shutdown.target
BindsTo=dev-mapper-%i.device
BindsTo=dev-disk-by\x2duuid-f3c10054\x2d0583\x2d4e10\x2d937b\x2ddcdc9a05a25c.device

[Service]
Type=oneshot
RemainAfterExit=yes
TimeoutSec=30
ExecStart=/lib/systemd/systemd-cryptsetup attach 'kabi' '/dev/disk/by-uuid/f3c10054-0583-4e10-937b-dcdc9a05a25c' 'none' 'luks'
ExecStop=/lib/systemd/systemd-cryptsetup detach 'kabi'

[Install]
WantedBy=cryptsetup.target
</code></pre>
<p>W sekcji <code>[Unit]</code> , na pozycjach <code>After</code> oraz <code>BindsTo</code> mamy określone linki do urządzeń w katalogu
<code>/dev/disk/by-uuid/</code> . Natomiast <code>\x2d</code> oznacza <code>-</code> . Dlatego te ścieżki tak dziwacznie wyglądają. Z
kolei sekcja <code>[Service]</code> wygląda bardzo znajomo, zwłaszcza pozycja <code>ExecStart</code> . Jest to dokładnie
ta sama linka, która widnieje w pliku <code>/etc/crypttab</code> , z tym, że bez zbędnych opcji.</p>
<p>Plik usługi montującej odszyfrowany zasób, <code>/etc/systemd/system/media-Kabi.mount</code>:</p>
<pre><code>[Unit]
Documentation=man:fstab(5)
Requires=systemd-fsck@dev-mapper-kabi.service
Requires=systemd-cryptsetup@kabi.service
After=systemd-fsck@dev-mapper-kabi.service
After=systemd-cryptsetup@kabi.service
Before=cloud_storage-mega.encrypted.service
Before=qbittorrent-nox.service
Before=local-fs.target

[Mount]
What=/dev/disk/by-uuid/b47e6dcd-924e-40fa-a8b1-7593419f86d7
Where=/media/Kabi
Type=ext4
Options=defaults,errors=remount-ro,commit=10
</code></pre>
<p>Tutaj podobnie, sekcja <code>[Mount]</code> jest żywcem wyjęta z pliku <code>/etc/fstab</code> .</p>
<p>W obu powyższych przypadkach możemy manipulować kolejnością odpalania usług. W taki sposób mamy
pewność, że określone zasoby są zawsze zamontowane i gotowe do użycia, gdy usługa ich wymagająca
zostanie odpalona. W przeciwnym razie, ta usługa zwyczajnie się nam nie uruchomi, ewentualnie
pociągnie za sobą start tych powyższych usług.</p>
<h2 id="jak-długo-kernel-przechowuje-hasła-do-kontenerów-luks">Jak długo kernel przechowuje hasła do kontenerów LUKS?</h2>
<p>To jak długo hasło do kontenera LUKS jest przechowywane w keyring'u kernela zależy od konfiguracji
systemd. Domyślnie jest to <code>60s</code> . Niemniej jednak, każdorazowe skorzystanie z takiego klucza, tj.
otwieranie kolejnego kontenera, odświeża ten czas i te 60 sekund należy liczyć od ostatniego użycia
klucza. Zatem jest wielce prawdopodobne, że ten klucz straci ważność chwile po starcie systemu i nie
da rady odczytać hasła:</p>
<pre><code># keyctl list @u
1 key in keyring:
402183021: --alswrv     0     0 user: cryptsetup

# keyctl list @u
1 key in keyring:
402183021: key inaccessible (Key has expired)

# keyctl print 402183021
keyctl_read_alloc: Key has expired
</code></pre>
<h2 id="bardzo-wolne-odszyfrowanie-kontenerów-luks">Bardzo wolne odszyfrowanie kontenerów LUKS</h2>
<p>Do tej pory korzystałem ze skryptów dostarczanych w pakiecie <code>cryptsetup</code> . Przy przejściu na
mechanizm oferowany przez kernel linux'a oraz systemd, moje kontenery LUKS otwierały się
dramatycznie wolno. Był to rząd wielkości parunastu sekund, co efektywnie spowalniało start systemu.
Początkowo myślałem, że może to są jakieś błędy w samym systemd ale ostatecznie udało mi się ten
problem rozwiązać. Okazało się bowiem, że znaczenie ma to, który keyslot w nagłówku kontenera
zawiera hasło mające być wykorzystane do automatycznego odszyfrowania kontenera, a tych slotów jest
8 (do podejrzenia w <code>cryptsetup luksDump</code> ).</p>
<p>W przypadku, gdy wykorzystujemy tylko jeden keyslot, to nie musimy się o nic martwić. Problem
pojawia się, gdy tych haseł mamy kilka. W takim przypadku musimy wskazać, z którego keyslot'a
zamierzamy korzystać przy pomocy opcji <code>key-slot</code> w pliku usługi. Jeśli tego nie zrobimy, to każdy
kolejny keyslot będzie sprawdzamy pod kątem wpisanego hasła. Poniżej mamy porównanie dwóch zasobów,
z których jeden ma hasło na pozycji 0, natomiast drugi na pozycji 2:</p>
<pre><code># systemd-analyze blame
      10.234s systemd-cryptsetup@kabi.service
      2.693s systemd-cryptsetup@grafi.service
</code></pre>
<p>Zatem różnica jest znaczna. Im więcej mamy haseł i im dalej się znajduje to, które ma zostać użyte w
procesie odszyfrowania, tym wolniej będzie przebiegał proces automatycznego otwierania takiego
kontenera LUKS podczas startu systemu. Zatem jeśli mamy zajętych kilka keyslot'ów, przeróbmy linijkę
z <code>ExecStart</code> do poniższej
postaci:</p>
<pre><code>ExecStart=/lib/systemd/systemd-cryptsetup attach 'kabi' '/dev/disk/by-uuid/f3c10054-0583-4e10-937b-dcdc9a05a25c' 'none' 'luks,key-slot=3'
</code></pre></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/bezpieczenstwo/">bezpieczeństwo</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/luks/">luks</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/szyfrowanie/">szyfrowanie</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/systemd/">systemd</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&amp;text=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&amp;title=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&amp;title=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&title=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&amp;title=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fodszyfrowanie-kontenerow-luks-w-systemd%2f&description=Odszyfrowanie%20kontener%c3%b3w%20LUKS%20w%20systemd" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/dropbox-i-kontener-luks/">Dropbox i kontener LUKS</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/przejscie-z-truecrypt-na-luks/">Przejście z Truecrypt na LUKS</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/dnscrypt-proxy-czyli-szyfrowanie-zapytan-dns/">DNScrypt-proxy, czyli szyfrowanie zapytań DNS</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kontener-truecrypt-trzymany-na-dropboxie/">Kontener TrueCrypt trzymany na dropbox&#39;ie</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/implementacja-encfs-na-dropboxie/">Implementacja encfs na dropbox&#39;ie</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zaszyfrowana-przestrzen-wymiany-swap/">Zaszyfrowana przestrzeń wymiany SWAP</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/szyfrowanie-katalogu-home-przy-pomocy-encfs/">Szyfrowanie katalogu /home/ przy pomocy encfs</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2023 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
