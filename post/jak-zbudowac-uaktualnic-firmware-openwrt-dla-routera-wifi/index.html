<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi" />
<meta property="og:description" content="Od dłuższego już czasu na swoich routerach WiFi wykorzystuję firmware OpenWRT. W przypadku mojego
domowego routera TP-Link Archer C7 v2 zarządzanie jego oprogramowaniem sprowadza się w zasadzie do
przeprowadzania aktualizacji raz na kilka tygodni czy miesięcy. Z reguły nie jest to jakoś
czasochłonne zadanie, bo wystarczy pobrać stosowny obraz z serwera eko.one.pl i wrzucić go na
router czy to przez interfejs LuCI, czy też przez sysupgrade . No tak tylko, że po wgraniu
OpenWRT na flash routera trzeba zwykle też dograć szereg pakietów, których nie ma w standardzie,
przynajmniej jeśli chodzi akurat o ten mój router bezprzewodowy. Podobnie sprawa ma się z
odtwarzaniem konfiguracji, której pewne elementy pozostają niezmienne nawet po aktualizacji ze
starszego wydania OpenWRT do nowszego. Postanowiłem zatem zgłębić nieco proces kompilacji źródeł i
budowy obrazu z firmware OpenWRT, tak by nieco zautomatyzować sobie (czy też wręcz wyeliminować)
chociaż część z kroków, które zwykle przeprowadzam chwilę po wgraniu obrazu na router. Cały ten
proces budowy obrazu zostanie opisany przy wykorzystaniu dystrybucji Debian linux." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/jak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-04-13T21:03:00&#43;00:00" />
<meta property="article:modified_time" content="2020-04-13T21:03:00&#43;00:00" />


		<meta itemprop="name" content="Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi">
<meta itemprop="description" content="Od dłuższego już czasu na swoich routerach WiFi wykorzystuję firmware OpenWRT. W przypadku mojego
domowego routera TP-Link Archer C7 v2 zarządzanie jego oprogramowaniem sprowadza się w zasadzie do
przeprowadzania aktualizacji raz na kilka tygodni czy miesięcy. Z reguły nie jest to jakoś
czasochłonne zadanie, bo wystarczy pobrać stosowny obraz z serwera eko.one.pl i wrzucić go na
router czy to przez interfejs LuCI, czy też przez sysupgrade . No tak tylko, że po wgraniu
OpenWRT na flash routera trzeba zwykle też dograć szereg pakietów, których nie ma w standardzie,
przynajmniej jeśli chodzi akurat o ten mój router bezprzewodowy. Podobnie sprawa ma się z
odtwarzaniem konfiguracji, której pewne elementy pozostają niezmienne nawet po aktualizacji ze
starszego wydania OpenWRT do nowszego. Postanowiłem zatem zgłębić nieco proces kompilacji źródeł i
budowy obrazu z firmware OpenWRT, tak by nieco zautomatyzować sobie (czy też wręcz wyeliminować)
chociaż część z kroków, które zwykle przeprowadzam chwilę po wgraniu obrazu na router. Cały ten
proces budowy obrazu zostanie opisany przy wykorzystaniu dystrybucji Debian linux."><meta itemprop="datePublished" content="2020-04-13T21:03:00&#43;00:00" />
<meta itemprop="dateModified" content="2020-04-13T21:03:00&#43;00:00" />
<meta itemprop="wordCount" content="4176">
<meta itemprop="keywords" content="router,kompilacja,tp-link," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi"/>
<meta name="twitter:description" content="Od dłuższego już czasu na swoich routerach WiFi wykorzystuję firmware OpenWRT. W przypadku mojego
domowego routera TP-Link Archer C7 v2 zarządzanie jego oprogramowaniem sprowadza się w zasadzie do
przeprowadzania aktualizacji raz na kilka tygodni czy miesięcy. Z reguły nie jest to jakoś
czasochłonne zadanie, bo wystarczy pobrać stosowny obraz z serwera eko.one.pl i wrzucić go na
router czy to przez interfejs LuCI, czy też przez sysupgrade . No tak tylko, że po wgraniu
OpenWRT na flash routera trzeba zwykle też dograć szereg pakietów, których nie ma w standardzie,
przynajmniej jeśli chodzi akurat o ten mój router bezprzewodowy. Podobnie sprawa ma się z
odtwarzaniem konfiguracji, której pewne elementy pozostają niezmienne nawet po aktualizacji ze
starszego wydania OpenWRT do nowszego. Postanowiłem zatem zgłębić nieco proces kompilacji źródeł i
budowy obrazu z firmware OpenWRT, tak by nieco zautomatyzować sobie (czy też wręcz wyeliminować)
chociaż część z kroków, które zwykle przeprowadzam chwilę po wgraniu obrazu na router. Cały ten
proces budowy obrazu zostanie opisany przy wykorzystaniu dystrybucji Debian linux."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2020-04-13T21:03:00Z">Opublikowano: 13/04/2020</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/openwrt/" rel="category">OpenWRT</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Jak zbudować/uaktualnić firmware OpenWRT dla routera WiFi</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#instalowanie-potrzebnych-zależności">Instalowanie potrzebnych zależności</a></li>
    <li><a href="#pobieranie-źródeł-openwrt">Pobieranie źródeł OpenWRT</a></li>
    <li><a href="#warning-makefile-packagemakefile-has-a-dependency-on--which-does-not-exist">WARNING: Makefile 'package/.../Makefile' has a dependency on '...', which does not exist</a></li>
    <li><a href="#wstępna-konfiguracja-openwrt">Wstępna konfiguracja OpenWRT</a></li>
    <li><a href="#pobieranie-źródeł-projektów-zależnych">Pobieranie źródeł projektów zależnych</a></li>
    <li><a href="#kompilacja-źródeł-openwrt">Kompilacja źródeł OpenWRT</a>
      <ol>
        <li><a href="#wgrywanie-obrazu-na-router">Wgrywanie obrazu na router</a></li>
      </ol>
    </li>
    <li><a href="#importowanie-starej-konfiguracji">Importowanie starej konfiguracji</a></li>
    <li><a href="#dostosowanie-konfiguracji-kernela">Dostosowanie konfiguracji kernela</a></li>
    <li><a href="#czyszczenie-środowiska-kompilacji">Czyszczenie środowiska kompilacji</a>
      <ol>
        <li><a href="#make-clean">make clean</a></li>
        <li><a href="#make-dirclean">make dirclean</a></li>
        <li><a href="#make-distclean">make distclean</a></li>
        <li><a href="#make-targetlinuxclean">make target/linux/clean</a></li>
        <li><a href="#make-packageclean">make package/*/clean</a></li>
      </ol>
    </li>
    <li><a href="#pakiety-spoza-repozytorium-openwrt">Pakiety spoza repozytorium OpenWRT</a></li>
    <li><a href="#budowanie-obrazów-dla-kilku-routerów">Budowanie obrazów dla kilku routerów</a></li>
    <li><a href="#aktualizacja-źródeł-openwrt">Aktualizacja źródeł OpenWRT</a></li>
    <li><a href="#edycja-plików-w-obrazie">Edycja plików w obrazie</a>
      <ol>
        <li><a href="#podejrzenie-wynikowego-obrazu">Podejrzenie wynikowego obrazu</a></li>
      </ol>
    </li>
    <li><a href="#podsumowanie">Podsumowanie</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Od dłuższego już czasu na swoich routerach WiFi wykorzystuję firmware OpenWRT. W przypadku mojego
domowego routera TP-Link Archer C7 v2 zarządzanie jego oprogramowaniem sprowadza się w zasadzie do
przeprowadzania aktualizacji raz na kilka tygodni czy miesięcy. Z reguły nie jest to jakoś
czasochłonne zadanie, bo wystarczy pobrać stosowny obraz z <a href="http://dl.eko.one.pl/openwrt-19.07/targets/ath79/generic/">serwera eko.one.pl</a> i wrzucić go na
router czy to przez interfejs LuCI, czy też przez <code>sysupgrade</code> . No tak tylko, że po wgraniu
OpenWRT na flash routera trzeba zwykle też dograć szereg pakietów, których nie ma w standardzie,
przynajmniej jeśli chodzi akurat o ten mój router bezprzewodowy. Podobnie sprawa ma się z
odtwarzaniem konfiguracji, której pewne elementy pozostają niezmienne nawet po aktualizacji ze
starszego wydania OpenWRT do nowszego. Postanowiłem zatem zgłębić nieco proces kompilacji źródeł i
budowy obrazu z firmware OpenWRT, tak by nieco zautomatyzować sobie (czy też wręcz wyeliminować)
chociaż część z kroków, które zwykle przeprowadzam chwilę po wgraniu obrazu na router. Cały ten
proces budowy obrazu zostanie opisany przy wykorzystaniu dystrybucji Debian linux.</p>
<h2 id="instalowanie-potrzebnych-zależności">Instalowanie potrzebnych zależności</h2>
<p>Jako, że w grę wchodzić będzie kompilacja, to musimy odpowiednio przygotować sobie system, by ten
proces przebiegł nam bez większych problemów. Przede wszystkim, w naszym Debianie musimy
<a href="https://openwrt.org/docs/guide-developer/quickstart-build-images">doinstalować szereg pakietów</a>. Ta poniższa lista może być niekompletna. Czasami mogą być
potrzebne również dodatkowe rzeczy, a wszystko zależy od tego co tak naprawdę będziemy chcieli
zbudować. W tym przypadku zainstalowanie tych poniższych zależności zdaje się być optymalnym
rozwiązaniem:</p>
<pre><code># aptitude install \
            git subversion build-essential \
            python3 python3-distutils \
            zlib1g-dev libncurses5-dev \
            gawk gettext unzip file \
            libssl-dev wget libelf-dev \
            ecj fastjar binutils \
            bzip2 patch flex
</code></pre>
<h2 id="pobieranie-źródeł-openwrt">Pobieranie źródeł OpenWRT</h2>
<p>Źródła OpenWRT są utrzymywane w systemie kontroli wersji git i są dostępne pod adresem
<a href="https://git.openwrt.org/openwrt/openwrt.git">https://git.openwrt.org/openwrt/openwrt.git</a>. Te źródła musimy pobrać na dysk za pomocą
polecenia <code>git clone</code> . Same źródła nie ważą sporo, bo jest to 153.67 MiB dla pełnego klonu i
11.67 MiB dla płytkiego. Niemniej jednak, to jest rozmiar danych, które trzeba pobrać przez sieć.
Te dane są skompresowane i <code>git</code> po pobraniu nam je automatycznie wypakuje i troszkę ich objętość
wzrośnie: 252 MiB vs. 96 MiB. To w dalszym ciągu nie jest pełny rozmiar źródeł OpenWRT, bo w skład
tego projektu wchodzi cała masa innych pakietów, które będą dociągane w późniejszym czasie. W taki
oto sposób całe źródła OpenWRT mogą ważyć nawet kilkanaście-kilkadziesiąt GiB, w zależności od tego
co będziemy budować. Poniżej przykład:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/000-kompilacja-firmware-openwrt-rozmiar-dysk.png" alt=""    class="big"></p>
<p>Dlatego też dobrze jest sobie zawczasu wygospodarować wolne miejsce, by uniknąć problemów później.</p>
<p>Jeśli chcemy pobrać pełne źródła OpenWRT, to korzystamy z poniższego polecenia:</p>
<pre><code>$ git clone https://git.openwrt.org/openwrt/openwrt.git
Cloning into 'openwrt'...
remote: Enumerating objects: 508113, done.
remote: Counting objects: 100% (508113/508113), done.
remote: Compressing objects: 100% (137368/137368), done.
remote: Total 508113 (delta 353835), reused 502462 (delta 349504)
Receiving objects: 100% (508113/508113), 153.67 MiB | 295.00 KiB/s, done.
Resolving deltas: 100% (353835/353835), done.
Updating files: 100% (8924/8924), done.
</code></pre>
<p>Jeśli zaś interesuje nas jedynie płytki klon repozytorium konkretnego wydania, np v19.07, to
wpisujemy w terminal poniższą linijkę:</p>
<pre><code>$ git clone --depth=1 https://git.openwrt.org/openwrt/openwrt.git -b openwrt-19.07 openwrt-v19.07

Cloning into 'openwrt-v19.07'...
remote: Enumerating objects: 9975, done.
remote: Counting objects: 100% (9975/9975), done.
remote: Compressing objects: 100% (8633/8633), done.
remote: Total 9975 (delta 2255), reused 4467 (delta 630)
Receiving objects: 100% (9975/9975), 11.67 MiB | 763.00 KiB/s, done.
Resolving deltas: 100% (2255/2255), done.
</code></pre>
<p>W tym drugim poleceniu w przełączniku <code>-b</code> trzeba określić tag/gałąź. <a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=tags">Tutaj znajduje się lista
tagów</a>, a tutaj <a href="https://git.openwrt.org/?p=openwrt/openwrt.git;a=heads">lista gałęzi</a>, które możemy sobie określić przy pobieraniu źródeł OpenWRT.</p>
<p>Jeśli nie zamierzamy przyczyniać się do rozwoju projektu OpenWRT, to naturalnie możemy skorzystać z
tego drugiego rozwiązania. Nic też nie stoi na przeszkodzie by pobrać źródła przy pomocy tego
pierwszego polecenia i przełączyć się do nowej gałęzi w poniższy sposób:</p>
<pre><code>$ cd openwrt/
$ git checkout openwrt-19.07
Updating files: 100% (7970/7970), done.
Branch 'openwrt-19.07' set up to track remote branch 'openwrt-19.07' from 'origin'.
Switched to a new branch 'openwrt-19.07'
</code></pre>
<h2 id="warning-makefile-packagemakefile-has-a-dependency-on--which-does-not-exist">WARNING: Makefile 'package/.../Makefile' has a dependency on '...', which does not exist</h2>
<p>Przy wydawaniu poleceń, które pojawią się w późniejszej części tego artykułu, można zaobserwować
pewne ostrzeżenia dotyczące problemów z zależnościami. By uniknąć błędów podobnych do tych poniżej,
dobrze jest skonfigurować sobie <a href="https://openwrt.org/docs/guide-developer/feeds">OpenWRT Feeds</a>:</p>
<pre><code>WARNING: Makefile 'package/utils/busybox/Makefile' has a dependency on 'libpam', which does not exist
WARNING: Makefile 'package/utils/busybox/Makefile' has a build dependency on 'libpam', which does not exist
WARNING: Makefile 'package/network/utils/curl/Makefile' has a dependency on 'libgnutls', which does not exist
WARNING: Makefile 'package/network/utils/curl/Makefile' has a dependency on 'libopenldap', which does not exist
WARNING: Makefile 'package/network/utils/curl/Makefile' has a dependency on 'libidn2', which does not exist
WARNING: Makefile 'package/network/utils/curl/Makefile' has a dependency on 'libssh2', which does not exist
WARNING: Makefile 'package/boot/kexec-tools/Makefile' has a dependency on 'liblzma', which does not exist
WARNING: Makefile 'package/network/services/lldpd/Makefile' has a dependency on 'libnetsnmp', which does not exist
...
</code></pre>
<p>Feeds'y figurują w zasadzie w pliku <code>feeds.conf</code> (ewentualnie też w <code>feeds.conf.default</code> , jeśli
<code>feeds.conf</code> nie istnieje). Zwykle nie ma potrzeby ruszać tego pliku ale po pobraniu źródeł OpenWRT
trzeba wydać te dwa poniższe polecenia, by te feeds'y pobrać:</p>
<pre><code>$ ./scripts/feeds update -a
$ ./scripts/feeds install -a
</code></pre>
<p>Gdzieniegdzie można się spotkać także z alternatywnym poleceniem wykorzystującym <code>make</code> i target
<code>package/symlinks</code> , przykładowo:</p>
<pre><code>$ make package/symlinks
</code></pre>
<p>Niemniej jednak, to polecenie robi dokładnie to samo co te dwa wyżej, o czym można się przekonać
zaglądając do pliku <code>include/toplevel.mk</code> .</p>
<h2 id="wstępna-konfiguracja-openwrt">Wstępna konfiguracja OpenWRT</h2>
<p>Mając już źródła na dysku, możemy przejść do ich konfiguracji. Do wyboru mamy konfigurację w trybie
tekstowym za pomocą polecenia <code>make menuconfig</code> , jak i też konfigurację w trybie graficznym za
sprawą polecenia <code>make xconfig</code> . W tym artykule zostanie opisany ten drugi sposób ale nic nie stoi
na przeszkodzie by korzystać z trybu tekstowego. Wpisujemy zatem w oknie terminala to poniższe
polecenie:</p>
<pre><code>$ make xconfig
</code></pre>
<p>Naszym oczom powinno ukazać się okienko z całą masą opcji, w którym musimy określić minimum trzy
rzeczy.</p>
<p>Pierwszą z nich jest <code>Target System</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/001-kompilacja-firmware-openwrt-config-target.png" alt=""    class="huge"></p>
<p>Jeśli nie wiemy jaki target wybrać, to dobrze jest poszukać naszego routera WiFi na
<a href="https://openwrt.org/toh/hwdata/tp-link/tp-link_archer_c7_ac1750_v2.0">wiki OpenWRT</a> lub też na <a href="https://wikidevi.wi-cat.ru/TP-LINK_Archer_C7_v2.x">wikidevi</a>. Tam powinien być podany target:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/002-kompilacja-firmware-openwrt-config-target.png" alt=""    class="huge"></p>
<p>W tym przypadku jest <code>ar71xx-ath79</code> , co oznacza, że akurat ten router występuje zarówno w targecie
<code>ar71xx</code> jak i <code>ath79</code> i można określić jeden albo drugi.</p>
<p>Drugą opcją, którą musimy określić, jest <code>Subtarget</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/003-kompilacja-firmware-openwrt-config-target.png" alt=""    class="huge"></p>
<p>W zasadzie jeśli nasz router nie dysponujemy małym flash lub flash'em opartym o technologię NAND,
to wybieramy <code>TARGET_ath79_generic</code> .</p>
<p>Jeśli poprawnie wybraliśmy te dwie poprzednie opcje, to w trzeciej opcji powinien być widoczny
model naszego routera:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/004-kompilacja-firmware-openwrt-config-target.png" alt=""    class="huge"></p>
<p>I jak widać jest do wyboru <code>TARGET_ath79_generic_DEVICE_tplink_archer-c7-v2</code> .</p>
<p>Te trzy opcje są w stanie wybrać cały niezbędny zestaw pakietów, które nasz router potrzebuje do
poprawnego działania. Niemniej jednak, jak się przyjrzymy tej liście, to jest tam bardzo dużo opcji.
Jeśli potrzebujemy w późniejszym czasie pracy routera instalować jakieś aplikacje czy pakiety z
modułami kernela, to przydałoby się te rzeczy uwzględnić zaznaczając stosowne pozycje.</p>
<p>Każda z opcji na liście może zostać włączona lub wyłączona. Niektóre pozycje zależą od innych i nie
da się ich włączyć lub wyłączyć bez uprzedniego rozwiązania problemów z zależnościami. Weźmy dla
przykładu ten poniższy <code>PACKAGE_luci</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/005-kompilacja-firmware-openwrt-config-zaleznosci.png" alt=""    class="huge"></p>
<p>Nie możemy go ani włączyć ani wyłączyć, zatem jest on włączony czy wyłączony? Pozycja <code>Symbol: PACKAGE_luci [=y]</code> wskazuje, że jest włączony. Co zatem aktywuje tę pozycję? Odpowiedź jest w
ostatniej linijce <code>Selected by: PACKAGE_luci-ssl [=n] || PACKAGE_luci-ssl-openssl [=y] || PACKAGE_luci-app-noddos [=n]</code> . Czyli jesli jedna z tych trzech opcji będzie włączona ( <code>||</code>
oznacza lub), to <code>PACKAGE_luci</code> zostanie automatycznie włączony. I jak możemy wywnioskować z
powyższego obrazka, opcja <code>PACKAGE_luci-ssl-openssl</code> jest włączona. Jeśli chcielibyśmy pozbyć się
interfejsu LuCI całkowicie z firmware routera, to trzeba by pierw odznaczyć
<code>PACKAGE_luci-ssl-openssl</code> , a dopiero później <code>PACKAGE_luci</code> .</p>
<p>Zgodnie z tym co można <a href="https://eko.one.pl/?p=openwrt-kompilacja">wyczytać tutaj</a>, to nie powinno się dołączać do obrazu pakietów, które
często podlegają aktualizacji. Chodzi o to, że jeśli taki pakiet dołączymy do obrazu, to późniejsza
jego aktualizacja wgra na flash routera (<a href="https://en.wikipedia.org/wiki/OverlayFS">za sprawą mechanizmu overlayfs</a>) drugą, nowszą wersję
aplikacji. W efekcie na flash'u będziemy mieć dwie wersje z tym, że będzie wykorzystywana ta nowsza,
a ta starsza wersja będzie jedynie marnować miejsce. W przypadku gdybyśmy ręcznie zainstalowali ten
pakiet po wgraniu firmware OpenWRT, to późniejsza jego aktualizacja bez problemu by zastąpiła pliki.
Oczywiście jeśli rzadko kiedy aktualizujemy oprogramowanie routera, tj. raz na parę tygodni czy
miesięcy wgrywamy jedynie nowy obraz, to naturalnie możemy sobie wszystkie niezbędne nam pakiety
wbudować bezpośrednio w obraz.</p>
<h2 id="pobieranie-źródeł-projektów-zależnych">Pobieranie źródeł projektów zależnych</h2>
<p>Mając wstępnie skonfigurowane źródła OpenWRT, możemy przejść do ich kompilacji. Niemniej jednak,
zanim przejdziemy do samego procesu kompilacji źródeł, to dobrze jest pobrać źródła wszystkich
projektów, które wybraliśmy wcześniej. Chodzi generalnie o to, że te źródła będą dociągane podczas
procesu kompilacji. Jeśli chcemy przeprowadzić kompilację w trybie offline, to możemy wszystkie
niezbędne źródła pobrać przed procesem kompilacji. W tym celu wpisujemy w terminal polecenie
<code>make download</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/006-kompilacja-firmware-openwrt-make-download.png" alt=""    class="huge"></p>
<h2 id="kompilacja-źródeł-openwrt">Kompilacja źródeł OpenWRT</h2>
<p>Pozostało nam już w zasadzie uruchomienie procesu kompilacji przy pomocy <code>make</code> . Zgodnie z tym co
<a href="https://openwrt.org/docs/guide-user/additional-software/beginners-build-guide">jest napisane tutaj</a>, to powinno się uważać przy korzystaniu z przełącznika <code>-j</code> , który
określa ilość jednoczesnych wątków kompilacji mających na celu przyśpieszenie całego procesu, ze
względu na fakt, że może to prowadzić do różnych błędów. Część z tych błędów można wyeliminować
uprzednio wydając polecenie <code>make download</code> , tak by wszystkie niezbędne źródła były dostępne
lokalnie przed rozpoczęciem procesu kompilacji. Ja budowałem źródła z <code>-j4</code> i nic strasznego się
nie stało z tego powodu. Niemniej jednak, jeśli już napotkamy błędy podczas procesu budowania
obrazu z firmware, to dobrze jest określić jeden wątek <code>-j1</code> oraz włączyć tryb rozmowny za sprawą
<code>V=s</code> (<a href="https://oldwiki.archive.openwrt.org/doc/techref/buildroot#warnings_errors_and_tracing">stdout+stderr</a>). W taki sposób zostanie zwrócona masa informacji, które mogą nam pomóc
w ustaleniu przyczyny problemu. Dobrze jest także <a href="https://oldwiki.archive.openwrt.org/doc/howto/build#troubleshooting">zajrzeć tutaj</a>. Odpalamy zatem już
kompilację:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/007-kompilacja-firmware-openwrt-make.png" alt=""    class="huge"></p>
<p>Proces kompilacji potrwa dłuższą chwilę (parę godzin). Jeśli z jakiegoś powodu nie będziemy mogli
go ukończyć, np. nie będziemy mieć czasu, to zawsze ten proces można przerwać i później kontynuować
od miejsca, w którym skończyliśmy bez potrzeby rekompilacji wszystkiego od początku.</p>
<p>Po udanym procesie kompilacji, pliki z obrazem firmware OpenWRT będą na nas czekać w katalogu
<code>bin/targets/ath79/generic/</code> . Będzie tam kilka plików mających sufiks <code>.bin</code> :</p>
<pre><code>$  ls -alh bin/targets/ath79/generic | grep bin
-rw-r--r-- 1 morfik morfik 9.7M 2020-04-04 20:50:50 openwrt-ath79-generic-tplink_archer-c7-v2-initramfs-kernel.bin
-rw-r--r-- 1 morfik morfik  16M 2020-04-04 20:50:36 openwrt-ath79-generic-tplink_archer-c7-v2-squashfs-factory-eu.bin
-rw-r--r-- 1 morfik morfik  16M 2020-04-04 20:50:35 openwrt-ath79-generic-tplink_archer-c7-v2-squashfs-factory-us.bin
-rw-r--r-- 1 morfik morfik  16M 2020-04-04 20:50:35 openwrt-ath79-generic-tplink_archer-c7-v2-squashfs-factory.bin
-rw-r--r-- 1 morfik morfik  11M 2020-04-04 20:50:36 openwrt-ath79-generic-tplink_archer-c7-v2-squashfs-sysupgrade.bin
</code></pre>
<p>Zgodnie z tym co można <a href="https://eko.one.pl/?p=openwrt-19.07">wyczytać tutaj</a>, to obraz mający w nazwie <code>factory</code> służy do przejścia
z oryginalnego oprogramowania producenta routera, na firmware OpenWRT. Tam wyżej mamy dodatkowo
obrazy przeznaczone do aktualizacji routerów sprzedawanych na terenie Stanów Zjednoczonych
( <code>-us</code> ) i Unii Europejskiej ( <code>-eu</code> ). Jeśli zaś chodzi o obraz mający w nazwie <code>initramfs</code> , to
niektóre urządzenia wymagają takich obrazów, by w ogóle móc na nich zainstalować OpenWRT. W
przypadku routera Archer C7 v2, ten obraz <code>initramfs</code> jest zupełnie zbędny i można wyłączyć jego
budowę odznaczając opcję <code>TARGET_ROOTFS_INITRAMFS</code> w konfiguracji. Obraz mający w nazwie
<code>sysupgrade</code> służy do aktualizacji w obrębie firmware OpenWRT (za sprawą <code>sysupgrade</code> lub panelu
webowego LuCI czy Gargoyle) i to ten obraz nas najbardziej będzie interesować.</p>
<h3 id="wgrywanie-obrazu-na-router">Wgrywanie obrazu na router</h3>
<p>Mając gotowy obraz, musimy go jeszcze przesłać na router. W tym przypadku akurat wykorzystywany
jest panel LuCI ale nic nie stoi na przeszkodzie by skorzystać z <code>sysupgrade</code> .</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/008-kompilacja-firmware-openwrt-flash-image-luci.png" alt=""    class="huge"></p>
<p>Możemy naturalnie sprawdzić sumę kontrolną via <code>sha256sum</code> ale nie jest to konieczne z racji, że
obraz był budowany lokalnie.</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/010-kompilacja-firmware-openwrt-flash-image-luci.png" alt=""    class="huge"></p>
<p>Proces powinien zakończyć się powodzeniem, a router zrestartować.</p>
<h2 id="importowanie-starej-konfiguracji">Importowanie starej konfiguracji</h2>
<p>Jeśli w przeszłości przygotowywaliśmy sobie obraz z firmware OpenWRT dla naszego routera WiFi, to
zapewne mamy na dysku plik <code>.config</code> , który zawiera konfigurację takiego obrazu. By zaoszczędzić
sobie trochę czasu, możemy ten plik zaimportować do nowych źródeł. Problem w tym, że z czasem opcje
konfiguracji ulegają zmianie i ten nasz stary plik <code>.config</code> może zawierać nieistniejące pozycje,
lub też nie posiadać tych, które zostały utworzone przy wprowadzaniu zmian w OpenWRT. Trzeba zatem
taki plik konfiguracyjny zaktualizować i mamy do wyboru dwie opcje: <code>make defconfig</code> oraz
<code>make oldconfig</code> .</p>
<p>W przypadku korzystania z <code>make defconfig</code> , ze starego pliku <code>.config</code> zostaną podebrane tylko te
istniejące opcje, zaś wartości nowych opcji zostaną ustawione na domyślne. Jeśli chodzi o
<code>make oldconfig</code> , to sprawa wygląda podobnie ale w przypadku nowych opcji będziemy ręcznie musieli
określić ich wartości. Zatem jeśli importujemy konfigurację, to mamy do wyboru:</p>
<pre><code>$ cp /old/openwrt/.config ./.config
$ make defconfig
</code></pre>
<p>lub:</p>
<pre><code>$ cp /old/openwrt/.config ./.config
$ make oldconfig
</code></pre>
<h2 id="dostosowanie-konfiguracji-kernela">Dostosowanie konfiguracji kernela</h2>
<p>W przypadku gdybyśmy chcieli nieco inaczej skonfigurować sam kernel, to standardowe
<code>make menuconfig</code> czy <code>make xconfig</code> nam tego nie umożliwi. Mamy jednak do dyspozycji jeszcze
target <code>make kernel_menuconfig</code> (brak odpowiednika z xconfig) i przy pomocy tego targetu jesteśmy
w stanie zmienić opcje kernela tak jak uważamy za stosowne.</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/014-kompilacja-firmware-openwrt-config-kernel.png" alt=""    class="huge"></p>
<p>Po dokonaniu zmian w konfiguracji kernela, trzeba jeszcze raz zbudować cały obraz z firmware
OpenWRT.</p>
<h2 id="czyszczenie-środowiska-kompilacji">Czyszczenie środowiska kompilacji</h2>
<p>Od czasu do czasu będziemy musieli przeczyścić środowisko kompilacji. Zwykle będziemy to robić przy
napotkaniu różnych błędów lub też profilaktycznie raz na jakiś czas. Warto zatem wiedzieć, że
istnieją targety dla <code>make</code> , które w czyszczeniu źródeł mogą nam pomóc.</p>
<h3 id="make-clean">make clean</h3>
<p>Przede wszystkim jest <code>make clean</code> , który w zasadzie czyści zawartość katalogów <code>bin/</code> oraz
<code>build_dir/</code> . Czyści on także tylko tę architekturę/targety, które są określone w pliku <code>.config</code> .
Dobrą praktyką jest wydawanie <code>make clean</code> za każdym razem przed kompilacją, by mieć pewność, że
nie ma żadnych pozostałości po poprzedniej kompilacji.</p>
<h3 id="make-dirclean">make dirclean</h3>
<p>Dalej mamy <code>make dirclean</code> , który czyści zawartość katalogów <code>bin/</code> , <code>build_dir/</code> ,
<code>staging_dir/</code> , <code>toolchain/</code> , <code>tmp/</code> oraz <code>logs/</code> (jeśli istnieje) .</p>
<h3 id="make-distclean">make distclean</h3>
<p>Jest jeszcze <code>make distclean</code> , który to czyści wszystko co zostało skompilowane lub skonfigurowane
(w tym plik <code>.config</code> ). Ten target także usuwa wszystkie pobrane feeds'y i źródła pakietów.
Korzystanie z <code>make distclean</code> powinno mieć w zasadzie miejsce jedynie wtedy gdy zamierzamy
całkowicie zresetować środowisko kompilacji przywracając je do stanu chwilę po pobraniu źródeł
OpenWRT.</p>
<h3 id="make-targetlinuxclean">make target/linux/clean</h3>
<p>Te trzy powyższe targety czyszczą dość sporo rzeczy. Jeśli istnieje potrzeba by wyczyścić tylko
obiekty kernela, to możemy skorzystać z <code>make target/linux/clean</code> .</p>
<h3 id="make-packageclean">make package/*/clean</h3>
<p>Podobnie sprawa wygląda w przypadku czyszczenia pojedynczych pakietów. Wystarczy odszukać
odpowiednią ścieżkę ze źródłami pakietu (w katalogu <code>package/</code>). Dla przykładu, jeśli chcemy
wyczyścić kompilację interfejsu LuCI, to musimy określić <code>make package/feeds/luci/luci/clean</code> .</p>
<h2 id="pakiety-spoza-repozytorium-openwrt">Pakiety spoza repozytorium OpenWRT</h2>
<p>W OpenWRT jest skonfigurowanych kilka dodatkowych źródeł pakietów zwanych feeds. Te standardowe
źródła są uwzględnione w pliku <code>feeds.conf.default</code> . Jeśli będziemy chcieli wbudować w obraz
pakiety, których nie ma w tych domyślnych feeds'ach, ale są przy tym w jakichś innych, to te
dodatkowe feeds'y trzeba będzie dodać do pliku <code>feeds.conf</code> .</p>
<p>Dla przykładu weźmy sobie dwa użyteczne narzędzia z <code>eko.one.pl</code> . Pierwszym z nich jest
<code>sysinfo.sh</code> zwracającym dodatkowe informacje przy logowaniu się na router przez SSH. Drugim zaś
jest <code>stat.sh</code> , który <a href="http://dl.eko.one.pl/stat.html">zgłasza statystyki routera</a>. Te skrypty siedzą odpowiednio w pakietach
<code>ekooneplstat</code> , <code>luci-app-ekooneplstat</code> oraz <code>sysinfo</code> z tym, że są one dostępne w <a href="https://github.com/obsy/packages">repozytorium
git obsy/packages</a>. By być w stanie zbudować i dołączyć do wynikowego obrazu te pakiety, to
musimy pierw dodać to powyższe repozytorium git do pliku <code>feeds.conf</code> .</p>
<p>Kopiujemy zatem domyślny plik z feeds'ami i zmieniamy mu nazwę na <code>feeds.conf</code> :</p>
<pre><code>$ cp feeds.conf.default feeds.conf
</code></pre>
<p>Na jego końcu dopisujemy jeszcze tę  poniższą linijkę:</p>
<pre><code>src-git obsy_packages https://github.com/obsy/packages.git
</code></pre>
<p>Następnie aktualizujemy feeds'y:</p>
<pre><code>$ make package/symlinks
</code></pre>
<p>Mając już zaktualizowane feeds'y, powinniśmy być w stanie dostrzec każdy z tych pakietów na liście
w <code>make menuconfig</code> lub <code>make xconfig</code> , przykładowo:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/011-kompilacja-firmware-openwrt-add-feeds.png" alt=""    class="huge"></p>
<p>Wystarczy teraz je już tylko zaznaczyć tak jak to zwykle czynimy w przypadku każdej innej pozycji
na liście i przebudować obraz z firmware.</p>
<h2 id="budowanie-obrazów-dla-kilku-routerów">Budowanie obrazów dla kilku routerów</h2>
<p>O ile budowanie obrazu OpenWRT na pojedynczy router WiFi nie powinno stanowić problemów, to w
przypadku wielu urządzeń możemy napotkać problem natury konfiguracyjnej. Chodzi o to, że np. plik
<code>.config</code> trzeba przepisywać ilekroć tylko zmieniany jest target. Takie ciągłe przepisywanie
targetu i wszystkich zależnych od niego opcji mija się trochę z celem, podobnie też pozbawione jest
sensu kopiowanie konfiguracji i odtwarzanie jej ilekroć tylko będziemy chcieli zbudować obraz z
firmware na inny router. Dlatego też deweloperzy OpenWRT postanowili rozwiązać ten problem poprzez
zaimplementowanie <a href="https://openwrt.org/docs/guide-developer/env">osobnych środowisk kompilacji</a> (Build Environments), w których to zarówno
plik <code>.config</code> jak i katalog <code>files/</code> (oraz pliki w nim) są rozdzielone dla każdego z tych
środowisk. Technicznie rzecz biorąc, to w dalszym ciągu mamy jeden plik <code>.config</code> i jeden katalog
<code>files/</code> ale z racji zaprzęgnięcia git'a i jego gałęzi możemy stworzyć całą masę targetów
przełączając się między tymi gałęziami git'a. Cały ten mechanizm jest zarządzany przez skrypt
<code>scripts/env</code> , a sterowanie nim odbywa się w poniższy sposób.</p>
<p>Na samym początku przy pomocy <code>./scripts/env new</code> tworzymy osobne środowiska kompilacji dla każdego
z routerów, na które chcemy zbudować firmware OpenWRT. W tym przypadku będą dwa -- Archer C7 v2 i
Archer C2600:</p>
<pre><code>$ ./scripts/env new archer_c7_v2
$ ./scripts/env new archer_c2600
</code></pre>
<p>Mając więcej niż jedno środowisko kompilacji trzeba się miedzy nimi jakoś przełączać. Do tego celu
służy <code>./scripts/env switch</code></p>
<pre><code>$ ./scripts/env switch archer_c7_v2
Switched to branch 'archer_c7_v2'

$ ./scripts/env switch archer_c2600
Switched to branch 'archer_c2600'
</code></pre>
<p>Będąc już w konkretnym środowisku kompilacji, konfigurujemy target za pomocą <code>make menuconfig</code> lub
<code>make xconfig</code> . Wszystkie zmiany, które poczynimy w konfiguracji możemy podejrzeć przez
<code>./scripts/env diff</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/012-kompilacja-firmware-openwrt-diff.png" alt=""    class="huge"></p>
<p>I jeśli uważamy, że wszystko jest w porządku, to zapisujemy konfigurację obrazu za sprawą
poniższego polecenia:</p>
<pre><code>$ ./scripts/env save
</code></pre>
<p>By teraz zbudować obraz dla któregoś z tych dwóch routerów, to trzeba najpierw wybrać stosowne
środowisko kompilacji. Po tym jak już je wybierzemy, wystarczy wydać polecenie <code>make</code> .</p>
<p>Obraz zostanie zbudowany jedynie dla tego routera, w którego środowisku kompilacji się znajdujemy.
By zbudować obraz dla pozostałych routerów, trzeba się przełączyć do ich środowisk kompilacji i
również wydać polecenie <code>make</code> . Póki co nie ma żadnego automatu, który by budował wiele obrazów
OOTB i trzeba się ratować własnym skryptem.</p>
<p>Warto tutaj wspomnieć, że to powyższe rozwiązanie dotyczy jedynie sytuacji, w której kilka różnych
routerów ma inny target. Jeśli zarówno <code>Target System</code> oraz <code>Subtarget</code> są takie same dla
posiadanych przez nas urządzeń, to możemy budować obrazy dla tych routerów w jednym podejściu.
Wystarczy wybrać <code>Multiple devices</code> (opcja <code>TARGET_MULTI_PROFILE</code> ) na liście <code>Target Profile</code> . W
taki sposób zostanie mam udostępniona lista wielokrotnego wyboru, w której to będziemy mogli
zaznaczyć interesujące nas modele routerów:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/016-kompilacja-firmware-openwrt-image-config-multiple-routers.png" alt=""    class="huge"></p>
<h2 id="aktualizacja-źródeł-openwrt">Aktualizacja źródeł OpenWRT</h2>
<p>W późniejszym czasie zapewne zajdzie potrzeba zaktualizowania firmware routera do nowszej wersji.
Gdy ten moment nastąpi, to trzeba będzie zaktualizować źródła OpenWRT wraz ze źródłami wszystkich
projektów, które zamierzamy budować. Ten proces na szczęście nie jest jakoś skomplikowany, bo
sprowadza się do wydania kilku prostych poleceń.</p>
<p>Najpierw trzeba pobrać informacje ze zdalnego repozytorium git, by ustalić czy pojawiły się nowe
commit'y:</p>
<pre><code>$ git remote update &amp;&amp; git status
...
Your branch is behind 'origin/master' by 105 commits, and can be fast-forwarded.
  (use &quot;git pull&quot; to update your local branch)
</code></pre>
<p>Jak widać, od czasu ostatniej aktualizacji pojawiło się 105 nowych commit'ów. Jeśli interesuje nas
jedynie co się zmieniło, to możemy na szybko przejrzeć komentarze w commit'ach:</p>
<pre><code>$ git log -105 --pretty=oneline
</code></pre>
<p>Jeśli zaś chcemy zsynchronizować nasze lokalne repozytorium z tym zdalnym i pobrać te 105
brakujących commit'ów, to wydajemy to poniższe polecenie:</p>
<pre><code>$ git pull
</code></pre>
<p>Dodatkowo trzeba także zaktualizować feeds'y (przy pomocy <code>make package/symlinks</code> ), bo lista
pakietów w repozytoriach ulega zmianie i jedne pakiety wypadają, a inne są z kolei dodawane.
Poniżej przykład:</p>
<pre><code>$ make package/symlinks
Updating feed 'packages' from 'https://git.openwrt.org/feed/packages.git^99efce0cd27adfcc53384fba93f37e5ee2e517de' ...
Create index file './feeds/packages.index'
Updating feed 'luci' from 'https://git.openwrt.org/project/luci.git^13dd17fca148965d38f0d4e578b19679a7c4daa2' ...
Create index file './feeds/luci.index'
Updating feed 'routing' from 'https://git.openwrt.org/feed/routing.git^efa6e5445adda9c6545f551808829ec927cbade8' ...
Create index file './feeds/routing.index'
Updating feed 'telephony' from 'https://git.openwrt.org/feed/telephony.git^6f95d6ab3f359ee2ce81c20522700937424d1591' ...
Create index file './feeds/telephony.index'
Updating feed 'obsy_packages' from 'https://github.com/obsy/packages.git' ...
remote: Enumerating objects: 17, done.
remote: Counting objects: 100% (17/17), done.
remote: Compressing objects: 100% (7/7), done.
remote: Total 16 (delta 1), reused 16 (delta 1), pack-reused 0
Unpacking objects: 100% (16/16), 2.65 KiB | 159.00 KiB/s, done.
From https://github.com/obsy/packages
   5f5a4b5..e5a3d14  master     -&gt; origin/master
Updating 5f5a4b5..e5a3d14
Fast-forward
 luci-app-ekooneplstat/Makefile                                           | 44 ++++++++++++++++++++++++++++++++++++++++++++
 luci-app-ekooneplstat/files/usr/lib/lua/luci/controller/ekooneplstat.lua | 13 +++++++++++++
 luci-app-ekooneplstat/files/usr/lib/lua/luci/i18n/ekooneplstat.po        | 33 +++++++++++++++++++++++++++++++++
 luci-app-ekooneplstat/files/usr/lib/lua/luci/model/cbi/ekooneplstat.lua  | 43 +++++++++++++++++++++++++++++++++++++++++++
 4 files changed, 133 insertions(+)
 create mode 100644 luci-app-ekooneplstat/Makefile
 create mode 100644 luci-app-ekooneplstat/files/usr/lib/lua/luci/controller/ekooneplstat.lua
 create mode 100644 luci-app-ekooneplstat/files/usr/lib/lua/luci/i18n/ekooneplstat.po
 create mode 100644 luci-app-ekooneplstat/files/usr/lib/lua/luci/model/cbi/ekooneplstat.lua
Create index file './feeds/obsy_packages.index'
Collecting package info: done
/bin/sh: 1: 8: Bad file descriptor
Collecting package info: done
Installing all packages from feed packages.
Installing all packages from feed luci.
Installing all packages from feed routing.
Installing all packages from feed telephony.
Installing all packages from feed obsy_packages.
Installing package 'luci-app-ekooneplstat' from obsy_packages
</code></pre>
<p>Jak widać wyżej, do repo <code>obsy_packages</code> trafiła nowa paczka <code>luci-app-ekooneplstat</code> i bez
aktualizacji tego feeds'a nie bylibyśmy w stanie jej dostrzec, zbudować i dołączyć do wynikowego
obrazu.</p>
<p>Po zaktualizowaniu źródeł, trzeba także zaktualizować konfigurację w pliku <code>.config</code> przy pomocy
<code>make defconfig</code> lub <code>make oldconfig</code> . W tym przypadku został użyty ten drugi z racji, że ja
zawsze wolę sprawdzić co uległo zmianie w konfiguracji:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/013-kompilacja-firmware-openwrt-config-update.png" alt=""    class="huge"></p>
<p>Jak widać wyżej, mamy informację o nowym pakiecie i musimy zdecydować czy chcemy go zbudować czy
też nie. Domyślna akcja jest oznaczona dużą literą, w tym przypadku <code>N</code> . Gdybyśmy skorzystali z
<code>make defconfig</code> , to tego powyższego zapytania by nie było i <code>N</code> by zostało ustawione domyślnie.</p>
<p>W przypadku posiadania wielu środowisk kompilacji (utworzonych za sprawą <code>./scripts/env new</code> ),
aktualizację pliku <code>.config</code> trzeba niestety przeprowadzać osobno dla każdego środowiska oddzielnie.</p>
<h2 id="edycja-plików-w-obrazie">Edycja plików w obrazie</h2>
<p>Wynikowy obraz nadaje się do wgrania na router praktycznie chwilę po zbudowaniu. Niemniej jednak,
taki obraz, który ma dołączone nasze pakiety, trzeba będzie po wgraniu na router skonfigurować.
Możemy sobie nieco ułatwić to zadanie prekonfigurując obraz. Dla przykładu, ja korzystam z
internetu LTE i muszę utworzyć i skonfigurować to połączenie. Idąc dalej, muszę także skonfigurować
domową sieć WiFi, której parametry zostają w zasadzie niezmienne. Podobnie sprawa wygląda z
kluczami SSH, które ciągle trzeba kopiować na router chwilę po wgraniu firmware. Te wszystkie
rzeczy (i też całą masę innych) można bez problemu ogarnąć przed zbudowaniem obrazu, tak by nie
trzeba było tych czynności przeprowadzać po wgraniu obrazu na router.</p>
<p>W przypadku chęci zmiany konfiguracji obrazu lepiej jest <a href="https://openwrt.org/docs/guide-user/base-system/uci">zaprzęgnąć UCI (Unified Configuration
Interface)</a> zamiast wgrywać własne pliki. Chodzi generalnie o fakt, że te pliki mogą ulec
zmianie wraz z rozwojem OpenWRT, co może być przyczyną różnych błędów w działaniu routera. W
zasadzie to będzie nam potrzebny jeden skrypt, w którym te wszystkie polecenia zostaną zebrane. Z
początku operowanie na UCI może być trudne ale zawsze można podejrzeć aktualną konfigurację
któregoś podsystemu przez <code>uci show</code> (np. <code>uci show dhcp</code> ). By dodać wpisy trzeba korzystać z
<code>uci add</code> , by je zmienić <code>uci set</code> , a by skasować <code>uci del</code> . Można także w panelu webowym LuCI
routera zapisać konfigurację bez wprowadzania zmian i podejrzeć jakie polecenia UCI system ma
zamiar wydać (w prawym górnym rogu interfejsu).</p>
<p>Stwórzmy sobie zatem strukturę plików i katalogów, która będzie nam potrzebna:</p>
<pre><code>$ mkdir -p files/etc/uci-defaults/
$ touch files/etc/uci-defaults/01-config.sh
$ chmod +x files/etc/uci-defaults/01-config.sh
$ echo &quot;#!/bin/sh&quot; &gt; files/etc/uci-defaults/01-config.sh
</code></pre>
<p>Do pliku <code>01-config.sh</code> dodajemy teraz polecenia UCI. Poniżej jest kilka przykładów.</p>
<p>Konfiguracja interfejsu LTE:</p>
<pre><code>uci set network.lte=interface
uci set network.lte.proto='ncm'
uci set network.lte.device='/dev/cdc-wdm0'
uci set network.lte.service='preferlte'
uci set network.lte.pdptype='IP'
uci set network.lte.apn='internet'
uci set network.lte.pincode='internet'
uci set network.lte.ipv6='auto'

uci del firewall.@zone[1].network
uci set firewall.@zone[1].network='wan wan6 lte'
</code></pre>
<p>Konfiguracja WiFi</p>
<pre><code>uci set wireless.default_radio0.ssid='Ever_Vigilant_5G'
uci set wireless.default_radio0.encryption='psk2+ccmp'
uci set wireless.default_radio0.key='pass'
uci set wireless.default_radio0.wpa_disable_eapol_key_retries='1'
uci set wireless.default_radio0.ifname='wifi5g'
uci del wireless.default_radio0.disabled
uci set wireless.radio0.country='PL'
uci del wireless.radio0.disabled

uci set wireless.default_radio1.ssid='Ever_Vigilant'
uci set wireless.default_radio1.encryption='psk2+ccmp'
uci set wireless.default_radio1.key='pass'
uci set wireless.default_radio1.wpa_disable_eapol_key_retries='1'
uci set wireless.default_radio1.ifname='wifi2g'
uci del wireless.default_radio1.disabled
uci set wireless.radio1.country='PL'
uci del wireless.radio1.disabled
</code></pre>
<p>Taki zestaw poleceń jest w stanie skonfigurować nasz router w taki sposób, że my nie będziemy
musieli w zasadzie w ogóle ruszać routera po wgraniu firmware. Na końcu skryptu <code>01-config.sh</code>
dodajemy jeszcze poniższe polecenia:</p>
<pre><code>uci commit
reload_config
</code></pre>
<p>Oczywiście nie każdy aspekt konfiguracyjny da radę ogarnąć przez zastosowanie poleceń UCI. W takich
sytuacjach będziemy potrzebować fizycznych plików, które zostaną podmienione lub dodane (jeśli nie
istnieją) w wynikowym obrazie. Przykładem mogą być wspomniane wcześniej klucze SSH, które rezydują
w pliku <code>/etc/dropbear/authorized_keys</code> na routerze. Możemy ten plik skopiować z routera i umieścić
w katalogu <code>files/</code> , przez co ten plik zostanie dodany do obrazu, a my nie będziemy musieli dodać
kluczy SSH do routera.</p>
<pre><code>$ mkdir -p files/etc/dropbear/
$ cp /router/authorized_keys files/etc/dropbear/authorized_keys
</code></pre>
<h3 id="podejrzenie-wynikowego-obrazu">Podejrzenie wynikowego obrazu</h3>
<p>Jeśli nie mamy pewności czy nasze pliki zostały dodane w odpowiednie miejsce w wynikowym obrazie,
to zawsze możemy ten fakt zweryfikować przez podejrzenie zawartości obrazu z firmware. Podejrzeć
pliki w takim obrazie możemy wypakowując gotowy obraz przy pomocy <a href="https://github.com/ReFirmLabs/binwalk">binwalk</a>, choć w przypadku
tego narzędzia potrzebne są dodatkowe zależności, których w Debianie brakuje (np. <a href="https://github.com/devttys0/sasquatch">sasquatch</a>,
czyli łatki na <code>squashfs-tools</code> ). Alternatywnym podejściem jest sprawdzenie co do obrazu firmware
trafi przed jego zbudowaniem. Wszystkie pliki, które zostaną załączone w wynikowym obrazie znajdują
się  w katalogu <code>build_dir/target-mips_24kc_musl/root-ath79/</code> . Warto tutaj zaznaczyć, że chodzi o
katalog <code>root-ath79/</code> , a nie o <code>root.orig-ath79/</code> . Ten <code>root.orig-ath79/</code> zawiera jedynie
podstawowe pliki OpenWRT, zaś w <code>root-ath79/</code> znajdują się pliki wymagane przez konkretny model
routera, w tym też pliki z katalogu <code>files/</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2020/04/015-kompilacja-firmware-openwrt-image-files-root-orig.png" alt=""    class="huge"></p>
<p>Jeśli pliki znajdują się w <code>root-ath79/</code> w odpowiednim miejscu w strukturze drzewa katalogów, to
możemy być pewni, że w obrazie wynikowym również będą w tym konkretnym miejscu.</p>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Jak widać budowanie obrazu z firmware OpenWRT na swój domowy router WiFi nie jest jakoś
skomplikowane, choć pewne umiejętności trzeba posiadać by płynnie przez ten proces przebrnąć.
Niewątpliwym plusem tego rozwiązania jest fakt, że przyzwoicie skonfigurowany obraz jest nam w
stanie zaoszczędzić sporo pracy przy aktualizacji firmware routera, bo nie trzeba w kółko
przeprowadzać tych samych czynności.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/router/">router</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/kompilacja/">kompilacja</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/tp-link/">tp-link</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&amp;text=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&amp;title=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&amp;title=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&title=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&amp;title=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-zbudowac-uaktualnic-firmware-openwrt-dla-routera-wifi%2f&description=Jak%20zbudowa%c4%87%2fuaktualni%c4%87%20firmware%20OpenWRT%20dla%20routera%20WiFi" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-ustalic-ip-i-nazwe-pliku-trybu-recovery-w-routerach-tp-link/">Jak ustalić IP i nazwę pliku trybu recovery w routerach TP-Link</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-wymusic-pasmo-czestotliwosc-lte-pod-lede-openwrt/">Jak wymusić pasmo/częstotliwość LTE pod LEDE/OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/recenzja-router-lte-archer-mr200-tp-link/">Recenzja: Router LTE Archer MR200 od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-skonfigurowac-klienta-vpn-na-routerze-z-ledeopenwrt/">Jak skonfigurować klienta VPN na routerze z LEDE/OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/aplikacja-tpmifi-do-zarzadzania-routerami-3g-lte-tp-link/">Aplikacja tpMiFi do zarządzania routerami 3G/LTE od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/aplikacja-tether-do-zarzadzania-urzadzeniami-tp-link-przez-smartfon/">Aplikacja Tether do zarządzania urządzeniami TP-LINK przez smartfon</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przy-pomocy-trybu-recovery-odzyskac-router-tp-link/">Jak przy pomocy trybu recovery odzyskać router TP-LINK</a></li>
		
	</ul>
</div>

	

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script data-goatcounter="https://morfik.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>
</body>
</html>
