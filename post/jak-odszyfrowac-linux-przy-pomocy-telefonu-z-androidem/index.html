<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem" />
<meta property="og:description" content="Zaszyfrowane systemy (desktopy/laptopy) mają jeden poważny problem, gdy chodzi o zapewnianie
bezpieczeństwa chronionym plikom przechowywanym na dyskach twardych. Gdy siedzimy obok naszej
maszyny, możemy czuć się bezpiecznie, bo przecież nikt nie może się włamać do jej systemu bez
naszej wiedzy. Nawet jeśli ktoś będzie próbował się dostać do naszego PC, to istnieje spora szansa,
że takie działanie zostałoby natychmiast przez nas wykryte, przez co moglibyśmy w odpowiedni sposób
zareagować na zaistniałe zagrożenie. Co jednak w przypadku, gdy zostawiamy przykładowo naszego
laptopa samego? Nawet jeśli zablokujemy mu ekran, wyłączymy go albo zahibernujemy, to ta maszyna
wciąż nie jest odpowiednio zabezpieczona, by uniemożliwić osobom postronnym dostęp do naszych
wrażliwych danych. Problem leży w fizycznym dostępie do sprzętu, który ludzie mogą uzyskać, gdy nas
nie ma w pobliżu naszego komputera. W taki sposób osoby trzecie mogą wykorzystać fakt, że tracimy
maszynę z oczu i być w stanie zastawić na nas różne pułapki. By uniknąć zagrożenia związanego z
zostawieniem laptopa/desktopa bez nadzoru, nie możemy w zasadzie pozostawiać tego urządzenia samego,
co jest zadaniem praktycznie nie do wykonania. Komputery stacjonarne czy nawet laptopy nie są
urządzeniami o małych gabarytach i zwykle nie możemy ich wszędzie zabrać ze sobą, w przeciwieństwie
do smartfonów. Postanowiłem zatem tak skonfigurować swojego linux&#39;a, by jego zaszyfrowany dysk
(LUKS &#43; LVM) można było odszyfrować jedynie przy pomocy mojego telefonu z Androidem, z którym w
zasadzie się nie rozstaję." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/jak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2020-08-15T02:43:00&#43;02:00" />
<meta property="article:modified_time" content="2020-08-15T02:43:00&#43;02:00" />


		<meta itemprop="name" content="Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem">
<meta itemprop="description" content="Zaszyfrowane systemy (desktopy/laptopy) mają jeden poważny problem, gdy chodzi o zapewnianie
bezpieczeństwa chronionym plikom przechowywanym na dyskach twardych. Gdy siedzimy obok naszej
maszyny, możemy czuć się bezpiecznie, bo przecież nikt nie może się włamać do jej systemu bez
naszej wiedzy. Nawet jeśli ktoś będzie próbował się dostać do naszego PC, to istnieje spora szansa,
że takie działanie zostałoby natychmiast przez nas wykryte, przez co moglibyśmy w odpowiedni sposób
zareagować na zaistniałe zagrożenie. Co jednak w przypadku, gdy zostawiamy przykładowo naszego
laptopa samego? Nawet jeśli zablokujemy mu ekran, wyłączymy go albo zahibernujemy, to ta maszyna
wciąż nie jest odpowiednio zabezpieczona, by uniemożliwić osobom postronnym dostęp do naszych
wrażliwych danych. Problem leży w fizycznym dostępie do sprzętu, który ludzie mogą uzyskać, gdy nas
nie ma w pobliżu naszego komputera. W taki sposób osoby trzecie mogą wykorzystać fakt, że tracimy
maszynę z oczu i być w stanie zastawić na nas różne pułapki. By uniknąć zagrożenia związanego z
zostawieniem laptopa/desktopa bez nadzoru, nie możemy w zasadzie pozostawiać tego urządzenia samego,
co jest zadaniem praktycznie nie do wykonania. Komputery stacjonarne czy nawet laptopy nie są
urządzeniami o małych gabarytach i zwykle nie możemy ich wszędzie zabrać ze sobą, w przeciwieństwie
do smartfonów. Postanowiłem zatem tak skonfigurować swojego linux&#39;a, by jego zaszyfrowany dysk
(LUKS &#43; LVM) można było odszyfrować jedynie przy pomocy mojego telefonu z Androidem, z którym w
zasadzie się nie rozstaję."><meta itemprop="datePublished" content="2020-08-15T02:43:00&#43;02:00" />
<meta itemprop="dateModified" content="2020-08-15T02:43:00&#43;02:00" />
<meta itemprop="wordCount" content="2951">
<meta itemprop="keywords" content="debian,szyfrowanie,luks,smartfon," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem"/>
<meta name="twitter:description" content="Zaszyfrowane systemy (desktopy/laptopy) mają jeden poważny problem, gdy chodzi o zapewnianie
bezpieczeństwa chronionym plikom przechowywanym na dyskach twardych. Gdy siedzimy obok naszej
maszyny, możemy czuć się bezpiecznie, bo przecież nikt nie może się włamać do jej systemu bez
naszej wiedzy. Nawet jeśli ktoś będzie próbował się dostać do naszego PC, to istnieje spora szansa,
że takie działanie zostałoby natychmiast przez nas wykryte, przez co moglibyśmy w odpowiedni sposób
zareagować na zaistniałe zagrożenie. Co jednak w przypadku, gdy zostawiamy przykładowo naszego
laptopa samego? Nawet jeśli zablokujemy mu ekran, wyłączymy go albo zahibernujemy, to ta maszyna
wciąż nie jest odpowiednio zabezpieczona, by uniemożliwić osobom postronnym dostęp do naszych
wrażliwych danych. Problem leży w fizycznym dostępie do sprzętu, który ludzie mogą uzyskać, gdy nas
nie ma w pobliżu naszego komputera. W taki sposób osoby trzecie mogą wykorzystać fakt, że tracimy
maszynę z oczu i być w stanie zastawić na nas różne pułapki. By uniknąć zagrożenia związanego z
zostawieniem laptopa/desktopa bez nadzoru, nie możemy w zasadzie pozostawiać tego urządzenia samego,
co jest zadaniem praktycznie nie do wykonania. Komputery stacjonarne czy nawet laptopy nie są
urządzeniami o małych gabarytach i zwykle nie możemy ich wszędzie zabrać ze sobą, w przeciwieństwie
do smartfonów. Postanowiłem zatem tak skonfigurować swojego linux&#39;a, by jego zaszyfrowany dysk
(LUKS &#43; LVM) można było odszyfrować jedynie przy pomocy mojego telefonu z Androidem, z którym w
zasadzie się nie rozstaję."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2020-08-15T02:43:00&#43;02:00">Opublikowano: 15/08/2020</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>, 
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/android/" rel="category">Android</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#usb-mountr-i-obraz-partycji-boot">USB Mountr i obraz partycji /boot/</a></li>
    <li><a href="#tworzenie-obrazu-partycji-boot">Tworzenie obrazu partycji /boot/</a>
      <ol>
        <li><a href="#zmiana-rozmiaru-obrazu-partycji-boot">Zmiana rozmiaru obrazu partycji /boot/</a></li>
        <li><a href="#tworzenie-mbr-i-tablicy-partycji-w-obrazie">Tworzenie MBR i tablicy partycji w obrazie</a></li>
        <li><a href="#instalacja-bootloadera-w-obrazie">Instalacja bootloader'a w obrazie</a></li>
      </ol>
    </li>
    <li><a href="#testowanie-obrazu">Testowanie obrazu</a></li>
    <li><a href="#usuwanie-partycji-boot-z-dysku">Usuwanie partycji /boot/ z dysku</a>
      <ol>
        <li><a href="#flagi-noauto-i-nofail-w-etcfstab">Flagi noauto i nofail w /etc/fstab</a></li>
      </ol>
    </li>
    <li><a href="#nagłówki-luks">Nagłówki LUKS</a>
      <ol>
        <li><a href="#regeneracja-obrazu-initramfsinitrd">Regeneracja obrazu initramfs/initrd</a></li>
        <li><a href="#skrypty-dla-initramfs-tools">Skrypty dla initramfs-tools</a></li>
      </ol>
    </li>
    <li><a href="#jak-aktualizować-system">Jak aktualizować system</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Zaszyfrowane systemy (desktopy/laptopy) mają jeden poważny problem, gdy chodzi o zapewnianie
bezpieczeństwa chronionym plikom przechowywanym na dyskach twardych. Gdy siedzimy obok naszej
maszyny, możemy czuć się bezpiecznie, bo przecież nikt nie może się włamać do jej systemu bez
naszej wiedzy. Nawet jeśli ktoś będzie próbował się dostać do naszego PC, to istnieje spora szansa,
że takie działanie zostałoby natychmiast przez nas wykryte, przez co moglibyśmy w odpowiedni sposób
zareagować na zaistniałe zagrożenie. Co jednak w przypadku, gdy zostawiamy przykładowo naszego
laptopa samego? Nawet jeśli zablokujemy mu ekran, wyłączymy go albo zahibernujemy, to ta maszyna
wciąż nie jest odpowiednio zabezpieczona, by uniemożliwić osobom postronnym dostęp do naszych
wrażliwych danych. Problem leży w fizycznym dostępie do sprzętu, który ludzie mogą uzyskać, gdy nas
nie ma w pobliżu naszego komputera. W taki sposób osoby trzecie mogą wykorzystać fakt, że tracimy
maszynę z oczu i być w stanie zastawić na nas różne pułapki. By uniknąć zagrożenia związanego z
zostawieniem laptopa/desktopa bez nadzoru, nie możemy w zasadzie pozostawiać tego urządzenia samego,
co jest zadaniem praktycznie nie do wykonania. Komputery stacjonarne czy nawet laptopy nie są
urządzeniami o małych gabarytach i zwykle nie możemy ich wszędzie zabrać ze sobą, w przeciwieństwie
do smartfonów. Postanowiłem zatem tak skonfigurować swojego linux'a, by jego zaszyfrowany dysk
(LUKS + LVM) można było odszyfrować jedynie przy pomocy mojego telefonu z Androidem, z którym w
zasadzie się nie rozstaję.</p>
<h2 id="usb-mountr-i-obraz-partycji-boot">USB Mountr i obraz partycji /boot/</h2>
<p>W zasadzie, to każdy z nas obecnie wykorzystuje smartfon do całej masy codziennych czynności. Jeśli
ten telefon ma na pokładzie Androida, to jest też spora szansa, że to urządzenie może wspierać
niestandardowe ROM'y na bazie <a href="https://source.android.com/">AOSP</a>, np.<a href="https://www.lineageos.org/">LineageOS</a>. W taki sposób możemy mieć naprawdę
przyjazne pod kątem prywatności i bezpieczeństwa urządzenie, które może zostać użyte jako swojego
rodzaju token przy dostępie do zaszyfrowanego komputera. Wszystko dzięki komponentowi USB MSD,
który jest obecny w kernelu Androida. Sprawia on, że możliwe jest, np. uruchomienie obrazu systemu
live bezpośrednio z telefonu po podłączeniu go do portu USB (przy wykorzystaniu aplikacji
<a href="https://github.com/Streetwalrus/android_usb_msd">USB Mountr</a>). Nie jest to jednak jedyne zastosowanie tej aplikacji, które może nam się do
czegoś przydać. Możemy też przykładowo stworzyć boot'owalny obraz partycji <code>/boot/</code> naszego linux'a
i umieścić w nim nagłówki zaszyfrowanych kontenerów LUKS. W ten sposób możemy uniknąć ataków na MBR,
ataków na bootloader oraz ataków na initramfs/initrd, czyniąc tym samym praktycznie niemożliwym
dostęp do naszego desktopa/laptopa bez przejęcia jednocześnie kontroli nad naszym smartfonem. Co
więcej, po przeniesieniu nagłówków LUKS do obrazu partycji <code>/boot/</code> , klucz szyfrujący dane na
dysku twardym komputera zostanie z niego usunięty, przez co nikt nie będzie w stanie
wydobyć/odszyfrować tego klucza nawet w przypadku, gdyby ten ktoś zdołał przechwycić w jakiś sposób
hasło wpisywane podczas startu maszyny.</p>
<p>Spróbujmy zatem utworzyć obraz partycji <code>/boot/</code> , który będzie zawierał bootloader extlinux (może
być także GRUB/GRUB2), konfigurację dla tego bootloader'a, obraz initramfs/initrd oraz nagłówki
LUKS. Stworzony przez nas obraz będzie także zawierał MBR i tablicę partycji MS-DOS. Zatem do
dzieła.</p>
<h2 id="tworzenie-obrazu-partycji-boot">Tworzenie obrazu partycji /boot/</h2>
<p>Zaczynamy od stworzenia obrazu na pliki partycji <code>/boot/</code> . To zadanie możemy zrealizować na dwa
sposoby. Pierwszym rozwiązaniem jest kopia całej partycji <code>/boot/</code> do pliku (przy pomocy <code>dd</code> ),
Natomiast drugi ze sposobów zakłada stworzenie nowego obrazu (via <code>dd</code> ), utworzenie w tym obrazie
systemu plików (via <code>mkfs</code> ) i skopiowanie do niego zawartości (plików) partycji <code>/boot/</code> . Oba te
rozwiązania mają swoje wady i zalety ale w tym artykule skorzystamy z pierwszego z nich:</p>
<pre><code># mkdir /media/boot/
# cd /media/boot/
# dd if=/dev/sda1 bs=1M | pv -s 2G &gt; ./boot-2g.img
</code></pre>
<p>Następnie konfigurujemy urządzenie <code>loop</code> pod nasz obraz:</p>
<pre><code># losetup /dev/loop4 boot-2g.img
# losetup -a
/dev/loop4: [65031]:6815746 (/media/boot/boot-2g.img)
# mount -o ro /dev/loop4 /mnt
# df -h /mnt
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/loop4     ext4  2.0G   51M  1.8G   3% /mnt
</code></pre>
<p>W tym przypadku, partycja <code>/boot/</code> waży 2 GiB i zwykle przeznaczanie na nią tyle miejsca jest
marnowaniem przestrzeni. Jak możemy zauważyć wyżej, pliki w obrębie tego systemu plików
wykorzystują 51 MiB. Możemy skurczyć rozmiar obrazu, np. do 256 MiB. Jeśli chcemy to zrobić, to
wcześniej trzeba skurczyć system plików obrazu.</p>
<h3 id="zmiana-rozmiaru-obrazu-partycji-boot">Zmiana rozmiaru obrazu partycji /boot/</h3>
<p>Do zmiany rozmiaru systemu plików w obrazie partycji <code>/boot/</code> będziemy korzystać z narzędzia
<code>resize2fs</code> . Robimy to w poniższy sposób:</p>
<pre><code># umount /mnt
# resize2fs -p /dev/loop4 256M
resize2fs 1.44.0 (7-Mar-2018)
Resizing the filesystem on /dev/loop4 to 65536 (4k) blocks.
Begin pass 2 (max = 16475)
Relocating blocks             XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Begin pass 3 (max = 16)
Scanning inode table          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
The filesystem on /dev/loop4 is now 65536 (4k) blocks long.
</code></pre>
<p>System plików obrazu ma obecnie 65536 bloków, czyli 65536*4096=268435456 bajtów albo 256 MiB.
Pamiętajmy jednak, że nie tylko regularne pliki znajdują się w tym obrazie. Jest też w nim zawarta
struktura systemu plików EXT4, tj. metadane opisujące pliki, w tym też dziennik (ext4 journal),
który w tym przypadku ma 32 MiB:</p>
<pre><code># dumpe2fs /dev/loop4 | grep &quot;Journal size&quot;
Journal size:             32M
</code></pre>
<p>Dlatego właśnie ustawiliśmy rozmiar obrazu na 256 MiB, zostawiając tym samym trochę wolnego miejsca
na przyszłe wykorzystanie.</p>
<p>Po zmniejszeniu systemu plików, trzeba obciąć resztę obrazu, bo nie jest nam ona już do niczego
potrzebna:</p>
<pre><code># losetup -d /dev/loop4
# dd if=./boot-2g.img of=./boot-256m bs=4K count=65536
65536+0 records in
65536+0 records out
268435456 bytes (268 MB, 256 MiB) copied, 2.25373 s, 119 MB/s
</code></pre>
<p>Możemy przetestować czy system plików w obrazie jest w dobrym stanie i nie został w żaden sposób
uszkodzony. Trzeba go tylko zamontować:</p>
<pre><code># losetup /dev/loop4 boot-256m
# mount -o ro /dev/loop4 /mnt
# df -h /mnt
Filesystem     Type  Size  Used Avail Use% Mounted on
/dev/loop4     ext4  188M   49M  122M  29% /mnt
</code></pre>
<p>Jeśli nie ma żadnych błędów, to znaczy, że wszystko jest w porządku. Odmontujmy teraz ten obraz:</p>
<pre><code># umount /mnt
# losetup -d /dev/loop4
</code></pre>
<p>Gdy sprawdzimy obraz w <code>parted</code> , to zobaczymy, że na początku tego obrazu nie ma ani jednego
bitu wolnego miejsca:</p>
<pre><code># parted boot-256m
GNU Parted 3.2
Using /media/boot/boot-256m
Welcome to GNU Parted! Type 'help' to view a list of commands.
(parted) unit s
(parted) print free
Model:  (file)
Disk /media/boot/boot-256m: 524288s
Sector size (logical/physical): 512B/512B
Partition Table: loop
Disk Flags:

Number  Start  End      Size     File system  Flags
1      0s     524287s  524288s  ext4
</code></pre>
<p>Bez wolnego miejsca na początku, nie da rady utworzyć MBR ani tablicy partycji. Trzeba zatem dodać
trochę wolnego miejsca na początku obrazu.</p>
<h3 id="tworzenie-mbr-i-tablicy-partycji-w-obrazie">Tworzenie MBR i tablicy partycji w obrazie</h3>
<p>Kolejnym krokiem jest stworzenie MBR oraz tablicy partycji wewnątrz obrazu. W tym przypadku będzie
wykorzystywana tablica partycji MS-DOS. Zanim jednak stworzymy tablicę partycji, trzeba utworzyć
kolejny obraz przy pomocy <code>dd</code> :</p>
<pre><code># dd if=/dev/zero of=./free-space.img bs=512 count=2048
2048+0 records in
2048+0 records out
1048576 bytes (1.0 MB, 1.0 MiB) copied, 0.0180124 s, 58.2 MB/s
</code></pre>
<p>Ten obraz ma rozmiar jedynie 1 MiB ale powinien nam w zupełności wystarczyć. Chodzi o to, że
wszystkie narzędzia partycjonujące dyski twarde równają partycje do 1 MiB przy tworzeniu pierwszej
partycji.</p>
<p>Łączymy teraz te dwa obrazy w jeden:</p>
<pre><code># pv boot-256m &gt;&gt; free-space.img
256MiB 0:00:02 [ 116MiB/s] [===========================&gt;] 100%
# mv free-space.img new-boot.img
# ls -al new-boot.img
-rw-r--r-- 1 root root 257M 2018-03-15 17:57:37 new-boot.img
</code></pre>
<p>Tworzymy teraz tablicę partycji w obrazie przy wykorzystaniu narzędzia <code>fdisk</code> :</p>
<pre><code># fdisk new-boot.img

Welcome to fdisk (util-linux 2.31.1).
Changes will remain in memory only, until you decide to write them.
Be careful before using the write command.

Device does not contain a recognized partition table.
Created a new DOS disklabel with disk identifier 0x105e4249.

Command (m for help): n
Partition type
 p   primary (0 primary, 0 extended, 4 free)
 e   extended (container for logical partitions)
Select (default p): p
Partition number (1-4, default 1): 1
First sector (2048-526335, default 2048): 2048
Last sector, +sectors or +size{K,M,G,T,P} (2048-526335, default 526335):

Created a new partition 1 of type 'Linux' and of size 256 MiB.
Partition #1 contains a ext4 signature.

Do you want to remove the signature? [Y]es/[N]o: n
</code></pre>
<p>Ustawiamy także flagę <code>boot</code> :</p>
<pre><code>Command (m for help): a
Selected partition 1
The bootable flag on partition 1 is enabled now.
</code></pre>
<p>Sprawdzamy teraz czy wszystko jest w porządku:</p>
<pre><code>Command (m for help): p
Disk new-boot.img: 257 MiB, 269484032 bytes, 526336 sectors
Units: sectors of 1 * 512 = 512 bytes
Sector size (logical/physical): 512 bytes / 512 bytes
I/O size (minimum/optimal): 512 bytes / 512 bytes
Disklabel type: dos
Disk identifier: 0x105e4249

Device        Boot Start    End Sectors  Size Id Type
new-boot.img1 *     2048 526335  524288  256M 83 Linux
</code></pre>
<p>I jeśli tak, to zapisujemy tablicę partycji w obrazie:</p>
<pre><code>Command (m for help): w
The partition table has been altered.
Syncing disks.
</code></pre>
<p>Gdy teraz będziemy tworzyć urządzenie <code>loop</code> dla tego nowego obrazu, powinniśmy zaobserwować pewne
zmiany w stosunku do tworzonych urządzeń w katalogu <code>/dev/</code>:</p>
<pre><code># losetup /dev/loop4 new-boot.img
# losetup -a
/dev/loop4: [65031]:6815748 (/media/boot/new-boot.img)
# ls -al /dev/loop4*
brw-rw---- 1 root disk 7, 128 2018-03-15 18:03:33 /dev/loop4
brw-rw---- 1 root disk 7, 129 2018-03-15 18:03:33 /dev/loop4p1
</code></pre>
<p>Mamy dodatkowe urządzenie w postaci <code>/dev/loop4p1</code> , a to z tego powodu, że w obrazie jest zawarta
partycja i tak ten obraz jest widziany przez naszego linux'a:</p>
<pre><code># file new-boot.img
new-boot.img: DOS/MBR boot sector; partition 1 :
ID=0x83,
start-CHS (0x0,32,33),
end-CHS (0x20,194,34),
startsector 2048,
524288 sectors,
extended partition table (last)
</code></pre>
<p>W taki sposób, partycja <code>/boot/</code> jest podpięta pod urządzenie <code>/dev/loop4p1</code> , a plik obrazu
pod <code>/dev/loop4</code> . Gdyby w obrazie były 4 partycje, to mielibyśmy urządzenia <code>loop4p1</code> , <code>loop4p2</code> ,
<code>loop4p3</code> i <code>loop4p4</code> , każde dla osobnej partycji w obrazie.</p>
<p>Musimy teraz zamontować partycję <code>/boot/</code> i jeśli wszystko będzie w porządku, to pliki wciąż
powinny w tym obrazie być widoczne:</p>
<pre><code># mount -o ro /dev/loop4p1 /mnt
# ls -al /mnt
total 45M
drwxr-xr-x  4 root root 4.0K 2018-03-14 19:15:28 ./
drwxr-xr-x 25 root root 4.0K 2018-03-01 18:54:11 ../
drwxr-xr-x  2 root root 4.0K 2018-02-26 18:00:35 extlinux/
drwx------  2 root root  16K 2018-02-17 16:34:18 lost+found/
-rw-r--r--  1 root root 3.0M 2018-02-18 09:36:49 System.map-4.15.0-1-amd64
-rw-r--r--  1 root root 194K 2018-02-18 09:36:49 config-4.15.0-1-amd64
-rw-r--r--  1 root root  37M 2018-03-14 19:15:26 initrd.img-4.15.0-1-amd64
-rw-r--r--  1 root root 179K 2015-06-25 19:16:52 memtest86+.bin
-rw-r--r--  1 root root 181K 2015-06-25 19:16:52 memtest86+_multiboot.bin
-rw-r--r--  1 root root 4.7M 2018-02-18 09:36:49 vmlinuz-4.15.0-1-amd64
</code></pre>
<p>Jeśli nie ma błędów w syslog'u, to proces przygotowania obrazu zakończył się powodzeniem. Nie jest
to jednak koniec pracy. Musimy jeszcze zainstalować jakiś bootloader w MBR tego obrazu. W tym
przypadku będzie to syslinux/extlinux.</p>
<h3 id="instalacja-bootloadera-w-obrazie">Instalacja bootloader'a w obrazie</h3>
<p>By zainstalować bootloader syslinux/extlinux w obrazie, musimy zrobić dwie rzeczy. Po pierwsze
trzeba zainstalować kod MBR bootloader'a w pierwszym sektorze obrazu:</p>
<pre><code># dd bs=440 count=1 conv=notrunc if=/usr/lib/syslinux/mbr/mbr.bin of=/dev/loop4
</code></pre>
<p>Po drugie, musimy zainstalować VBR (Volume Boot Record) extlinux'a  na partycji <code>/boot/</code> :</p>
<pre><code># extlinux --install /mnt/extlinux
/mnt/extlinux is device /dev/loop4p1
Warning: unable to obtain device geometry (defaulting to 64 heads, 32 sectors)
        (on hard disks, this is usually harmless.)
</code></pre>
<p>Powyższe ostrzeżenie może zostać zignorowane.</p>
<h2 id="testowanie-obrazu">Testowanie obrazu</h2>
<p>Te powyżej przeprowadzone kroki powinny uczynić obraz boot'owalnym. Możemy przesłać teraz plik
obrazu na kartę SD czy pamięć smartfona i przetestować go przy pomocy aplikacji USB Mountr na
Androida. W tym przypadku udało się uruchomić system mojego laptopa bez żadnego problemu.</p>
<h2 id="usuwanie-partycji-boot-z-dysku">Usuwanie partycji /boot/ z dysku</h2>
<p>Możemy teraz usunąć zawartość katalogu <code>/boot/</code> dysku twardego czy też skasować całą partycję
<code>/boot/</code> , bo nie jest ona nam już do niczego potrzeba -- kopia tej partycji została przeniesiona
do smartfona. Nie musimy też zmieniać żadnych wpisów w pliku <code>/etc/fstab</code> , bo numerek UUID
partycji w obrazie jest dokładnie taki sam jak numerek partycji /boot/ na dysku komputera. Jeśli
jednak chcielibyśmy zachować starą partycję <code>/boot/</code> , to musimy się upewnić, że zmieniliśmy UUID
systemu plików w stworzonym obrazie:</p>
<pre><code># umount /mnt
# uuidgen
6f3b0020-0491-4a12-98ca-c97a7a80f5b7
# tune2fs /dev/loop4p1 -U 6f3b0020-0491-4a12-98ca-c97a7a80f5b7
tune2fs 1.44.0 (7-Mar-2018)
Setting UUID on a checksummed filesystem could take some time.
Proceed anyway (or wait 5 seconds to proceed) ? (y,N) &lt;proceeding&gt;
# lsblk /dev/loop4
NAME       SIZE FSTYPE TYPE LABEL MOUNTPOINT UUID
loop4      257M        loop
└─loop4p1  256M ext4   loop boot             6f3b0020-0491-4a12-98ca-c97a7a80f5b7
</code></pre>
<p>I teraz jeszcze zmieniamy UUID w <code>/etc/fstab</code> , tak by pasował do tego wygenerowanego wyżej:</p>
<pre><code># &lt;file system&gt;					&lt;mount point&gt;	&lt;type&gt;	&lt;options&gt;			&lt;dump&gt;  &lt;pass&gt;
....
UUID=6f3b0020-0491-4a12-98ca-c97a7a80f5b7	/boot           ext4    defaults,errors=remount-ro,noauto,nofail,commit=10 0 2
</code></pre>
<h3 id="flagi-noauto-i-nofail-w-etcfstab">Flagi noauto i nofail w /etc/fstab</h3>
<p>Jeszcze taka informacja odnośnie flag <code>noauto</code> oraz <code>nofail</code> . Jak możemy wyczytać w manualu
<code>mount</code> :</p>
<blockquote>
<p>nofail -- Do not report errors for this device if it does not exist.</p>
<p>noauto -- Can only be mounted explicitly (i.e., the -a option will not cause the filesystem to
be mounted).</p>
</blockquote>
<p>Zatem opcja <code>noauto</code> jest dla nas użyteczna, bo nie chcemy by partycja <code>/boot/</code> była zamontowana
cały czas w systemie (może być to niebezpieczne dla jej systemu plików). W zasadzie, to
potrzebujemy tej partycji jedynie w momencie startu systemu oraz przy ewentualnej aktualizacji
systemu lub też, gdy majstrujemy przy obrazie initramfs/initrd albo zmieniamy konfigurację
bootloader'a. Poza tymi wyżej wymienionymi rzeczami, partycja <code>/boot/</code> niekoniecznie musi być
obecna w systemie, co daje nam możliwość odłączenia i podłączenia smartfona do portu USB komputera,
gdy będziemy tego potrzebować. Niemniej jednak, gdy odłączymy telefon, nasz linux będzie miał z
tym faktem pewne problemy i wypisze w logu poniższe komunikaty:</p>
<pre><code>systemd[1]: dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.device: Job dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.device/start timed out.
systemd[1]: Timed out waiting for device dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.device.
systemd[1]: Dependency failed for /boot.
systemd[1]: boot.mount: Job boot.mount/start failed with result 'dependency'.
systemd[1]: Dependency failed for File System Check on /dev/disk/by-uuid/6f3b0020-0491-4a12-98ca-c97a7a80f5b7.
systemd[1]: systemd-fsck@dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.service: Job systemd-fsck@dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.service/start failed with result 'dependency'.
systemd[1]: dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.device: Job dev-disk-by\x2duuid-6f3b0020\x2d0491\x2d4a12\x2d98ca\x2dc97a7a80f5b7.device/start failed with result 'timeout'.
</code></pre>
<p>Ta powyższa wiadomość jest nieszkodliwa ale cześć usług (takich jak <code>mount</code> i <code>fsck</code> ) ma
zależności w postaci urządzenia partycji <code>/boot/</code> i dlatego te powyższe błędy będą wypisywane w
logu po odłączeniu telefonu. Możemy jednak nakazać linux'owi, by ignorował fakt braku obecności
urządzenia partycji <code>/boot/</code> przez dodanie tej drugiej flagi, tj. <code>nofail</code> .</p>
<h2 id="nagłówki-luks">Nagłówki LUKS</h2>
<p>Przyszedł czas by zatroszczyć się o nagłówki LUKS. Skopiujemy nagłówki LUKS do obrazu (na partycję
<code>/boot/</code> ) i zarazem usuniemy te nagłówki z dysku twardego, zostawiając na tym nośniku jedynie
zaszyfrowane dane. W ten sposób nawet jeśli ktoś by nam zabrał dysk twardy (albo i komputer), to
nie będzie on w stanie zdeszyfrować informacji w nim zawartych, bo na dysku nie będzie klucza
głównego. Bez naszego smartfona, nikt nie będzie w stanie nawet powiedzieć czy dysk jest
zaszyfrowany czy też nie. Zatem jeśli chcemy dołączyć nagłówki LUKS do partycji <code>/boot/</code> w
wygenerowanym powyższym sposobem obrazie, możemy to zrobić w poniższy sposób.</p>
<p>Najpierw tworzymy backup nagłówka LUKS:</p>
<pre><code># mount /dev/loop4p1 /mnt
# mkdir /mnt/headers
# cryptsetup luksHeaderBackup /dev/sda2 --header-backup-file /mnt/headers/head.img
# ls -al /mnt/headers/head.img
-r-------- 1 root root 4.0M 2018-03-15 18:58:39 /mnt/headers/head.img
</code></pre>
<p>Rozmiar tego nagłówka w tym przypadku ma 4 MiB, dlatego też trzeba będzie nadpisać te 4 MiB na
dysku zaczynając od początku zaszyfrowanej partycji:</p>
<pre><code># dd if=/dev/urandom of=/dev/sda2 bs=1M count=4
</code></pre>
<p>Następnie aktualizujemy plik <code>/etc/crypttab</code> :</p>
<pre><code>#sda2_crypt	UUID=e017ac1c-c46f-4b3f-a319-e1f5ed15144a  none  luks
sda2_crypt	UUID=e017ac1c-c46f-4b3f-a319-e1f5ed15144a  none  luks,header=/boot/headers/head.img
</code></pre>
<h3 id="regeneracja-obrazu-initramfsinitrd">Regeneracja obrazu initramfs/initrd</h3>
<p>Ostatnim krokiem jest regeneracja obrazu initramfs/initrd ale by to zrobić, musimy pierw
odmontować starą partycję <code>/boot/</code> i podmontować w jej miejsce tę nową:</p>
<pre><code># umount /boot
# mount /boot
# lsblk | grep boot
NAME                              SIZE FSTYPE      TYPE  LABEL          MOUNTPOINT     UUID
├─sda1                              2G ext4        part  boot                          37a2b033-c47c-4c41-9287-b2f2a44e1bcd
└─sdc1                            256M ext4        part  boot           /boot          6f3b0020-0491-4a12-98ca-c97a7a80f5b7
</code></pre>
<h3 id="skrypty-dla-initramfs-tools">Skrypty dla initramfs-tools</h3>
<p>Kolejnym krokiem jest dodanie dwóch skryptów do obrazu initramfs/initrd. Pierwszy skrypt będzie
miał za zadanie zamontować partycję <code>/boot/</code> w fazie initramfs/initrd, drugi skrypt zaś odmontuje
tę partycję zanim główny system plików zostanie zamontowany.</p>
<p>Poniżej jest skrypt <code>/etc/initramfs-tools/scripts/local-top/mount-boot</code> :</p>
<pre><code>#!/bin/sh
PREREQ=&quot;&quot;
prereqs()
{
	echo &quot;$PREREQ&quot;
}

case $1 in
prereqs)
	prereqs
	exit 0
	;;
esac

. /scripts/functions

export PATH=/sbin:/usr/sbin:/bin:/usr/bin

[ -d /boot ] || mkdir -m 0755 /boot

DEVICE=/dev/disk/by-uuid/6f3b0020-0491-4a12-98ca-c97a7a80f5b7
if [ ! -b &quot;$DEVICE&quot; ]; then
	echo &quot;Waiting for device...&quot; &gt;&amp;2
	until [ -b &quot;$DEVICE&quot; ]; do
        sleep 1
	done
fi

mount -t ext4 -o ro &quot;$DEVICE&quot; /boot

exit 0
</code></pre>
<p>Niżej zaś jest skrypt <code>/etc/initramfs-tools/scripts/local-bottom/umount-boot</code> :</p>
<pre><code>#!/bin/sh
PREREQ=&quot;&quot;
prereqs()
{
	echo &quot;$PREREQ&quot;
}

case $1 in
prereqs)
	prereqs
	exit 0
	;;
esac

. /scripts/functions

export PATH=/sbin:/usr/sbin:/bin:/usr/bin

#umount /boot
mount -o move /boot ${rootmnt}/boot

exit 0
</code></pre>
<p>Te dwa plik muszą mieć być wykonywalne:</p>
<pre><code># chmod +x /etc/initramfs-tools/scripts/local-top/mount-boot
# chmod +x /etc/initramfs-tools/scripts/local-bottom/umount-boot
</code></pre>
<p>Teraz regenerujemy obraz initramfs/initrd przy pomocy poniższego polecenia:</p>
<pre><code># update-initramfs -u -k all
update-initramfs: Generating /boot/initrd.img-4.15.0-1-amd64
</code></pre>
<p>I to w zasadzie tyle. Możemy jeszcze sprawdzić czy nasz linux uruchamia się w pełni z obrazu, który
mamy w smartfonie -- mój nie ma z tym problemów.</p>
<h2 id="jak-aktualizować-system">Jak aktualizować system</h2>
<p>Przy aktualizacji systemu musimy pamiętać, by telefon uprzednio podłączyć do portu USB komputera,
tak by partycja <code>/boot/</code> została poprawnie zamontowana na czas procesu instalacji pakietów. Zwykle
partycja <code>/boot/</code> jest montowana w trybie zapisu, przez co mamy możliwość zmiany jej systemu plików.
Niemniej jednak, w takiej konfiguracji, jaką sobie zaprojektowaliśmy tutaj, nie powinniśmy montować
tej partycji domyślnie z prawami zapisu (w naszym przypadku nie montujemy jej w ogóle). Chodzi
generalnie o to, że możemy uszkodzić jej system plików zapominając go odmontować przed odłączeniem
telefonu od komputera. W ten sposób istnieje ryzyko utraty nagłówków LUKS, a jeśli je stracimy, to
nawet my nie będziemy w stanie uruchomić naszego linux'a, no chyba, że zrobiliśmy backup tych
nagłówków.</p>
<p>Co jednak począć w przypadku aktualizacji systemu? Mało praktycznym jest manualne montowanie
partycji <code>/boot/</code> w tryb do odczytu potem do zapisu i znowu do odczytu. W Debianie możemy
skorzystać z pliku <code>/etc/apt/apt.conf</code> dodając do niego poniższą konfigurację:</p>
<pre><code>DPkg
{
  Pre-Invoke
  {
    &quot;if grep -q boot /proc/mounts; then mount -o remount,rw /boot; else mount -o rw /boot; fi&quot;;
  };

  Post-Invoke
  {
    &quot;test ${NO_APT_REMOUNT:-no} = yes || umount /boot || true&quot;;
  };
};
</code></pre>
<p>W ten sposób za każdym razem jak będziemy chcieli aktualizować system (instalować pakiety),
<code>apt-get</code>/<code>aptitude</code> zamontuje partycję <code>/boot/</code> za nas automatycznie z prawami do zapisu, a gdy
proces aktualizacji się zakończy, to ta partycja zostanie również w sposób automatyczny odmontowana.</p>
<blockquote>
<p>Ten artykuł został pierwotnie napisany po angielsku i <a href="https://gist.github.com/morfikov/0bd574817143d0239c5a0e1259613b7d">opublikowany w GitHub Gist</a> ponad 2
lata temu. Za sprawą pewnego osobnika postanowiłem ten tekst przepisać na język polski, tak by
osoby niewładające angielskim zbyt dobrze, mogły bez większego problemu opisane tutaj rozwiązanie
wdrożyć u siebie i w nieco większym stopniu zabezpieczyć swoją maszynę przed nieautoryzowanym
dostępem.</p>
</blockquote></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/szyfrowanie/">szyfrowanie</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/luks/">luks</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/smartfon/">smartfon</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&amp;text=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&amp;title=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&amp;title=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&title=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&amp;title=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fjak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem%2f&description=Jak%20odszyfrowa%c4%87%20linux%27a%20przy%20pomocy%20telefonu%20z%20Androidem" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/persistence-czyli-zachowanie-zmian-w-systemie-live/">Persistence, czyli zachowanie zmian w systemie live</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-wlaczyc-w-firefox-esni-encrypted-sni/">Jak włączyć w Firefox ESNI (Encrypted SNI)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/linux-kernel-efi-boot-stub-i-zaszyfrowany-debian-luks-lvm/">Linux kernel EFI boot stub i zaszyfrowany Debian (LUKS&#43;LVM)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przepisac-linki-initrd-img-old-i-vmlinuz-old-do-boot/">Jak przepisać linki initrd.img{,.old} i vmlinuz{,.old} z / do /boot/</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kernel-crash-przy-szyfrowaniu-smartfona-lub-probie-resetu-ustawien-do-fabrycznych/">Kernel crash przy szyfrowaniu smartfona lub próbie resetu ustawień do fabrycznych</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zmiana-domyslnego-hasla-szyfrujacego-klucz-glowny-w-neffos-x1-i-x1-max/">Zmiana domyślnego hasła szyfrującego klucz główny w Neffos X1 i X1 Max</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/szyfrowanie-rozmow-i-smsow-na-smartfonie-z-androidem-signal/">Szyfrowanie rozmów i SMS&#39;ów na smartfonie z Androidem (Signal)</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script>
  var id =  34 ;

  if (id)
  {
    let url = "https://github.com/morfikov/morfitronik-comments/issues/".concat(id);
    let api_url = "https://api.github.com/repos/morfikov/morfitronik-comments/issues/".concat(id, "/comments");

    var commentsDiv = document.getElementById("comments");

    let xhr = new XMLHttpRequest();
    xhr.responseType = "json";
    xhr.open("GET", api_url);
    xhr.setRequestHeader("Accept", "application/vnd.github.v3.html+json");
    xhr.send();

    xhr.onload = function()
    {
      if (xhr.status != 200)
      {
        let errorText = document.createElement("p");
        errorText.innerHTML = "<i>Komentarze dla tego postu nie zostały jeszcze otworzone (albo skrypty GitHub'a są wyłączone).</i>";
        commentsDiv.appendChild(errorText);
      }
      else
      {
        let comments = xhr.response;

        let mainHeader = document.createElement("h3");
        mainHeader.innerHTML = "Komentarze: ".concat(comments.length);
        commentsDiv.appendChild(mainHeader);

        let issueLink = document.createElement("p");
        issueLink.innerHTML = "<i>Możesz zostawić komentarz korzystając z <a href='".concat(url, "'>GitHub issue</a>.</i>");
        commentsDiv.appendChild(issueLink);

        comments.forEach(function(comment)
        {
			const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', timeZone: 'Europe/Warsaw' };
			options.timeZoneName = 'short';
            let commentContent = document.createElement("div");
            commentContent.setAttribute('class', 'gh-comment')
            commentContent.innerHTML = "".concat(
                "<div class='gh-header'>",
                  "<img src='", comment.user.avatar_url, "' />",
                  "<div style='margin:auto 0;'>",
                    "<b><a class='gh-username' href='", comment.user.html_url, "'>", comment.user.login, "</a></b>",
                    " | <em>", (new Date(comment.created_at)).toLocaleTimeString('pl-PL', options), "</em>",
                  "</div>",
                "</div>",
                "<div class='gh-body'>",
                  comment.body_html,
                "</div>"
            );
            commentsDiv.appendChild(commentContent);
        });
      }
    };

    xhr.onerror = function()
    {
      let errorText = document.createElement("p");
      errorText.innerHTML = "<i>Wystąpił jakiś błąd przy ładowaniu komentarzy.</i>";
      commentsDiv.appendChild(errorText);
    };
  }
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
</body>
</html>
