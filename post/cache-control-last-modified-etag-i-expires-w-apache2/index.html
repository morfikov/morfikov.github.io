<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Cache-Control, Last-Modified, ETag i Expires w Apache2 | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Cache-Control, Last-Modified, ETag i Expires w Apache2" />
<meta property="og:description" content="Każda przeglądarka internetowa potrafi buforować dane w swoim cache w celach optymalizacji
przeglądanych stron www. Dzięki temu, szereg elementów odwiedzonych już witryn nie musi być
ponownie pobieranych z serwera. Zyskuje na tym nie tylko serwer ale również i sam klient, któremu
strona ładuje się parokrotnie szybciej. Pod ten mechanizm podpadają nie tylko pliki graficzne ale
również style CSS, skrypty JS, a nawet pliki .html . Generalnie rzecz ujmując, wszystko co serwer
www jest w stanie przesłać przeglądarce. Problemem może jednak się okazać zbyt krótki/długi okres
ważności cache. Jeśli ten czas jest za krótki, to elementy strony będą niepotrzebnie utylizować
łącze, nie tylko nasze ale również i serwera www. Z kolei, jeśli okres ważności będzie za długi,
to będziemy odwiedzać nieaktualną stronę. Optymalnym rozwiązaniem byłaby taka konfiguracja serwera
www, gdzie dla konkretnych elementów strony sami moglibyśmy ustalić czas ważności cache. Apache2
daje nam taką możliwość przez ustawienie nagłówków HTTP Cache-Control , Expires , ETag oraz
Last-Modified ." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/cache-control-last-modified-etag-i-expires-w-apache2/" />
<meta property="article:published_time" content="2016-08-01T18:50:48+00:00" />
<meta property="article:modified_time" content="2016-08-01T18:50:48+00:00" />

		<meta itemprop="name" content="Cache-Control, Last-Modified, ETag i Expires w Apache2">
<meta itemprop="description" content="Każda przeglądarka internetowa potrafi buforować dane w swoim cache w celach optymalizacji
przeglądanych stron www. Dzięki temu, szereg elementów odwiedzonych już witryn nie musi być
ponownie pobieranych z serwera. Zyskuje na tym nie tylko serwer ale również i sam klient, któremu
strona ładuje się parokrotnie szybciej. Pod ten mechanizm podpadają nie tylko pliki graficzne ale
również style CSS, skrypty JS, a nawet pliki .html . Generalnie rzecz ujmując, wszystko co serwer
www jest w stanie przesłać przeglądarce. Problemem może jednak się okazać zbyt krótki/długi okres
ważności cache. Jeśli ten czas jest za krótki, to elementy strony będą niepotrzebnie utylizować
łącze, nie tylko nasze ale również i serwera www. Z kolei, jeśli okres ważności będzie za długi,
to będziemy odwiedzać nieaktualną stronę. Optymalnym rozwiązaniem byłaby taka konfiguracja serwera
www, gdzie dla konkretnych elementów strony sami moglibyśmy ustalić czas ważności cache. Apache2
daje nam taką możliwość przez ustawienie nagłówków HTTP Cache-Control , Expires , ETag oraz
Last-Modified .">
<meta itemprop="datePublished" content="2016-08-01T18:50:48+00:00" />
<meta itemprop="dateModified" content="2016-08-01T18:50:48+00:00" />
<meta itemprop="wordCount" content="1885">



<meta itemprop="keywords" content="apache2,cache," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Cache-Control, Last-Modified, ETag i Expires w Apache2"/>
<meta name="twitter:description" content="Każda przeglądarka internetowa potrafi buforować dane w swoim cache w celach optymalizacji
przeglądanych stron www. Dzięki temu, szereg elementów odwiedzonych już witryn nie musi być
ponownie pobieranych z serwera. Zyskuje na tym nie tylko serwer ale również i sam klient, któremu
strona ładuje się parokrotnie szybciej. Pod ten mechanizm podpadają nie tylko pliki graficzne ale
również style CSS, skrypty JS, a nawet pliki .html . Generalnie rzecz ujmując, wszystko co serwer
www jest w stanie przesłać przeglądarce. Problemem może jednak się okazać zbyt krótki/długi okres
ważności cache. Jeśli ten czas jest za krótki, to elementy strony będą niepotrzebnie utylizować
łącze, nie tylko nasze ale również i serwera www. Z kolei, jeśli okres ważności będzie za długi,
to będziemy odwiedzać nieaktualną stronę. Optymalnym rozwiązaniem byłaby taka konfiguracja serwera
www, gdzie dla konkretnych elementów strony sami moglibyśmy ustalić czas ważności cache. Apache2
daje nam taką możliwość przez ustawienie nagłówków HTTP Cache-Control , Expires , ETag oraz
Last-Modified ."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/wsparcie/">
					
					<span class="main-nav__text">Wsparcie</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Cache-Control, Last-Modified, ETag i Expires w Apache2</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-08-01T18:50:48Z">Opublikowano: 01/08/2016</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Cache-Control, Last-Modified, ETag i Expires w Apache2</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#jak-działa-cache">Jak działa cache</a></li>
    <li><a href="#nagłówki-last-modified-i-etag">Nagłówki Last-Modified i ETag</a>
      <ol>
        <li><a href="#kod-błędu-304">Kod błędu 304</a></li>
      </ol>
    </li>
    <li><a href="#nagłówek-expires">Nagłówek Expires</a></li>
    <li><a href="#nagłówek-cache-control">Nagłówek Cache-Control</a></li>
    <li><a href="#z-których-nagłówków-http-korzystać">Z których nagłówków HTTP korzystać</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Każda przeglądarka internetowa potrafi buforować dane w swoim cache w celach optymalizacji
przeglądanych stron www. Dzięki temu, szereg elementów odwiedzonych już witryn nie musi być
ponownie pobieranych z serwera. Zyskuje na tym nie tylko serwer ale również i sam klient, któremu
strona ładuje się parokrotnie szybciej. Pod ten mechanizm podpadają nie tylko pliki graficzne ale
również style CSS, skrypty JS, a nawet pliki <code>.html</code> . Generalnie rzecz ujmując, wszystko co serwer
www jest w stanie przesłać przeglądarce. Problemem może jednak się okazać zbyt krótki/długi okres
ważności cache. Jeśli ten czas jest za krótki, to elementy strony będą niepotrzebnie utylizować
łącze, nie tylko nasze ale również i serwera www. Z kolei, jeśli okres ważności będzie za długi,
to będziemy odwiedzać nieaktualną stronę. Optymalnym rozwiązaniem byłaby taka konfiguracja serwera
www, gdzie dla konkretnych elementów strony sami moglibyśmy ustalić czas ważności cache. Apache2
daje nam taką możliwość przez ustawienie nagłówków HTTP <code>Cache-Control</code> , <code>Expires</code> , <code>ETag</code> oraz
<code>Last-Modified</code> .</p>
<h2 id="jak-działa-cache">Jak działa cache</h2>
<p>Po wejściu na przykładową stronę www, serwer przesyła treść witryny klientowi, którym zwykle jest
przeglądarka internetowa, ewentualnie jakiś serwer proxy. Nagłówki protokołu HTTP są wysyłane zanim
zostanie przesłany faktyczny zasób, który ma być wyświetlony u nas na ekranie. Dopiero po otrzymaniu
tego nagłówka przesyłana jest treść komunikatu, a przeglądarka w oparciu o dane w nagłówku wie co ma
z tym dokumentem zrobić. Tych nagłówków może być kilka czy nawet kilkanaście, w zależności od
konfiguracji serwera www.</p>
<p>Po otrzymaniu dokumentu, przeglądarka zapisuje sobie jego kopię w swoim lokalnym cache. Podobnie ona
postępuje w przypadku wysłanego żądanie do serwera oraz otrzymanej odpowiedzi. Poniżej jest przykład
zapytania i
odpowiedzi:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/1.etag-last-modified-header-naglowek-przegladarka.png" alt=""></p>
<p><code>Request Headers</code> , to są nagłówki zapytania, które przesłała przeglądarka serwerowi. Po otrzymaniu
ich, serwer wysłał odpowiedź z szeregiem nagłówków, które są widoczne w <code>Response Headers</code> . Nas na
dobrą sprawę interesują tylko dwa nagłówki w odpowiedzi: <code>Last-Modified</code> oraz <code>ETag</code> .</p>
<h2 id="nagłówki-last-modified-i-etag">Nagłówki Last-Modified i ETag</h2>
<p>Powyższa strona jest obsługiwana przez serwer Apache2. Ten z kolei domyślnie przesyła dwa
standardowe nagłówki HTTP, które dotyczą konfiguracji cache. Są to <code>ETag</code> oraz <code>Last-Modified</code> .
Gdybyśmy teraz w przeglądarce załadowali następną stronę w obrębie tej witryny, to praktycznie
wszystkie jej elementy (za wyjątkiem głównego pliku <code>text/html</code> ) zostaną wczytane z cache:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/2.przegladarka-cache-zasobow.png" alt=""></p>
<p>Nagłówki <code>Last-Modified</code> oraz <code>ETag</code> to walidatory (validators), które mają za zadanie zweryfikować
aktualność zasobu, czyli nakazać przeglądarce wysłanie do serwera zapytania warunkowego (conditional
request) w odpowiednim momencie. Zapytania warunkowe są wysyłane w oparciu o informacje dotyczące
świeżości zasobów, a te z kolei mogą być dostarczane przez nagłówki <code>Expires</code> i <code>Cache-Control</code> .
Niemniej jednak, tutaj żaden z tych nagłówków nie został uwzględniony w odpowiedzi serwera. To nie
problem, bo w przypadku braku tych nagłówków, przeglądarka sama może zdecydować jaką wartość mają
przybrać atrybuty świeżości.</p>
<p>Nagłówki <code>Last-Modified</code> oraz <code>ETag</code> przesyłają przeglądarce ważne informacje na temat stanu danego
zasobu. Nagłówek <code>Last-Modified</code> mówi jej, kiedy dokładnie na serwerze został zmodyfikowany dany
plik. Z kolei <a href="https://httpd.apache.org/docs/2.2/mod/core.html#FileETag">nagłówek ETag zawiera sumę
kontrolną</a> kilku elementów składowych.
Mogą to być: <code>INode</code> (numer i-węzła) , <code>MTime</code> (czas modyfikacji) oraz <code>Size</code> (rozmiar w bajtach).
Domyślnie są wykorzystywane jedynie te dwa ostatnie. Im więcej elementów zostanie uwzględnionych,
tym wolniej będzie przetwarzane zapytanie ale też tym bardziej akuratny wynik.</p>
<p>Nagłówek <code>Etag</code> jest też bardziej wiarygodny niż <code>Last-Modified</code> w sytuacjach, gdzie nie przechowuje
się (nie utrzymuje) się dat modyfikacji plików, lub też w przypadku, gdy rozdzielczość zegara HTTP
(1s) jest niewystarczająca. Stwarza on także zagrożenie dla prywatności klientów i <a href="https://stackoverflow.com/questions/499966/etag-vs-header-expires">powoduje
problemy</a> przy implementacji
mechanizmu równoważącego ruch.</p>
<p>Domyślnie Apache2 robi użytek z obu tych walidatorów i nie generuje w odpowiedziach informacji na
temat świeżości zasobu (brak nagłówków <code>Expires</code> i <code>Cache-Control</code>). Jeśli zrezygnujemy z obu tych
walidatorów, to przeglądarka <a href="https://www.mnot.net/cache_docs/#VALIDATE">w ogóle nie będzie przechowywać odpowiedzi w
cache</a>.</p>
<p>Zakładając jednak, że chcemy, aby pewne elementy naszej witryny były buforowane, musimy
skonfigurować co najmniej jeden walidator. Oczywiście można korzystać z obu ale to przyczynia się
do wzrostu obciążenia serwera oraz też nagłówek dostaje kilka dodatkowych bajtów. Którą opcję
wybierzemy, zależy głównie od rodzaju serwisu, który prowadzimy. W przypadku statycznych plików
galerii WordPress'a, raczej wystarczy nam nagłówek <code>Last-Modified</code> .</p>
<p>Jeśli zdecydujemy się na usunięcie nagłówka <code>ETag</code> , to do konfiguracji Apache2, w pliku
<code>/etc/apache2/apache2.conf</code> musimy dodać poniższą zwrotkę:</p>
<pre><code>&lt;Directory /apache2&gt;
    Header unset ETag
    FileETag None
&lt;/Directory&gt;
</code></pre>
<h3 id="kod-błędu-304">Kod błędu 304</h3>
<p>Na tej pierwszej fotce wyżej mamy datę pobrania nagłówka oraz datę ostatniej modyfikacji pliku.
Jeśli te dwie wartości są zbliżone do siebie, to zasób jest traktowany jako świeży i będzie
serwowany bezpośrednio z cache przeglądarki bez odpytywania serwera www. W przypadku, gdy data
modyfikacji odbiega znacząco od daty zapytania, wtedy klient poprosi serwer o walidację tego zasobu,
by upewnić się, że wciąż jest on ważny.</p>
<p>Za każdym razem, gdy zachodzi potrzeba walidacji zasobu, wartości nagłówków <code>ETag</code> i <code>Last-Modified</code>
są przesyłane przez przeglądarkę do serwera. Serwer może odpowiedzieć na to zapytanie pozytywnie
albo negatywnie. W pierwszym przypadku zostanie zwrócony kod błędu 304 (Not Modified) i plik
zostanie załadowany z cache przeglądarki. Natomiast w drugim przypadku, przeglądarka będzie musiała
wysłać zapytanie GET i pobrać raz jeszcze cały zasób, który stracił ważność. Poniżej jest
zobrazowana ta sytuacja:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/3.etag-last-modified-304-walidacja.png" alt=""></p>
<p>Widzimy tutaj dwie dyrektywy: <code>If-Modified-Since:Mon, 01 Aug 2016 09:53:38 GMT</code> oraz
<code>If-None-Match:&quot;717-538ff93078200&quot;</code> . To są warunki zapytania warunkowego. Jeśli, któryś z nich nie
jest spełniony, to zasób zostanie pobrany ponownie. W tym przypadku <code>If-Modified-Since</code> wskazuje tę
samą wartość co nagłówek <code>Last-Modified</code> na pierwszej fotce wyżej, a wartość <code>If-None-Match</code> jest
dokładnie taka sama co w nagłówku <code>ETag</code> . Zatem zasób nie uległ zmianie i nie ma potrzeby przesyłać
go przez sieć.</p>
<p>Tego typu zachowanie generuje jednak ruch. Za każdym razem, gdy zasób musi przejść procedurę
walidacji pakiety latają na linii przeglądarka - serwer. Nie jest to pożądany efekt, bo pociąga to
za sobą dodatkowe opóźnienia. Tę niedogodność można wyeliminować stosując jeden z dwóch dodatkowych
nagłówków: <code>Cache-Control</code> lub <code>Expires</code> .</p>
<h2 id="nagłówek-expires">Nagłówek Expires</h2>
<p>Nagłówek <code>Expires</code> odpowiada za informacje o świeżości zasobu, tj. przez jaki czas klient nie musi
pobierać danego pliku z serwera. Generalnie rzecz ujmując, ten nagłówek nadpisuje ustawienia
przeglądarki. Jeśli go określimy na serwerze, zostanie także ustawiony parametr <code>max-age</code> w
nagłówku <code>Cache-Control</code> .</p>
<p>Za ustawienie nagłówka <code>Expires</code> w Apache2 odpowiada <a href="https://httpd.apache.org/docs/current/mod/mod_expires.html">moduł
mod_expires</a>. Jeśli zamierzamy ten
nagłówek włączyć w odpowiedzi serwera, musimy pierw włączyć moduł <code>mod_expires</code> w konfiguracji
Apache2:</p>
<pre><code># a2enmod expires
# systemctl restart apache2
</code></pre>
<p>Następnie w pliku <code>/etc/apache2/apache2.conf</code> (ew. w pliku <code>.htaccess</code> ) musimy dodać zwrotkę
podobną do tej poniżej:</p>
<pre><code>&lt;Directory /apache2&gt;
    &lt;IfModule mod_expires.c&gt;
        ExpiresActive On
        ExpiresDefault M172800
        ExpiresByType text/css A7200
        ExpiresByType image/png M604800
    &lt;/IfModule&gt;
&lt;/Directory&gt;
</code></pre>
<p>Dyrektywa <code>ExpiresActive</code> aktywuje dodawanie nagłówka <code>Expires</code> i <code>Cache-Control</code> w odpowiedzi
serwera dla plików znajdujących się w katalogu określonym przez dyrektywę
<a href="https://httpd.apache.org/docs/2.4/mod/core.html#directory">Directory</a>. Oczywiście możemy skorzystać
z innych dyrektyw do oznaczenia plików, np.
<a href="https://httpd.apache.org/docs/2.4/mod/core.html#files">Files</a>,
<a href="https://httpd.apache.org/docs/2.4/mod/core.html#filesmatch">FilesMatch</a> czy też
<a href="https://httpd.apache.org/docs/2.4/mod/core.html#directorymatch">DirectoryMatch</a>. Dalej mamy
dyrektywę <code>ExpiresDefault</code> , która ustawia domyślny czas świeżości dla wszystkich plików w tym
katalogu. Z kolei dyrektywy <code>ExpiresByType</code> są w stanie ustawić inny czas dla plików o określonych
typach MIME.</p>
<p>Wartości liczbowe widoczne wyżej są wyrażone w sekundach. Każda z tych wartości musi być poprzedzona
literką <code>A</code> (czas dostępu) lub <code>M</code> (czas modyfikacji). W przypadku ustawienia <code>A</code> na danym typie
plików, każdy klient będzie miał ustawiony osobny zegar w swoim cache w oparciu o czas dostępu do
zasobu. Z kolei, gdy ustawimy <code>M</code> , to wszyscy klienci będą mięć ustawiony taki sam czas świeżości
cache, który tym razem będzie się odnosił do czasu modyfikacji pliku na serwerze. Poniżej jest fotka
obrazująca nagłówek <code>Expires</code>
:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/4.expires-cache-control-header-naglowek-przegladarka.png" alt=""></p>
<p>Widzimy, że nagłówek <code>Expires</code> wskazuje konkretną datę w przyszłości: <code>Mon, 08 Aug 2016 14:56:15 GMT</code> . Jeśli przeliczyć sekundy, to okaże się, że są one równe tej wartości, która figuruje w
nagłówku <code>Cache-Control</code> w <code>max-age=604800</code> , czyli równo 7 dni. Przez ten czas, przeglądarka
będzie wczytywać zasoby ze swojego cache.</p>
<h2 id="nagłówek-cache-control">Nagłówek Cache-Control</h2>
<p>Wszystkie instrukcje zawarte w nagłówkach <code>Last-Modified</code> , <code>Etag</code> czy <code>Expires</code> mogą zostać
nadpisane przez nagłówek <code>Cache-Control</code> . Nagłówek ten został wprowadzony w HTTP/1.1 i miał
zaadresować problem z ograniczeniami wynikającymi ze stosowania nagłówka <code>Expires</code> . Jeśli chcemy
mieć większą swobodę w dostosowaniu cache, możemy skorzystać z tych dodatkowych opcji, które oferuje
nam nagłówek <code>Cache-Control</code> . Niemniej jednak, by z nich skorzystać, musimy ustawić poszczególne
parametry nagłówka przy pomocy dyrektywy <code>Header</code> , która jest obsługiwana przez moduł
<a href="https://httpd.apache.org/docs/current/mod/mod_headers.html">mod_headers</a>. Ten moduł musi być
włączony w konfiguracji Apache2:</p>
<pre><code># a2enmod headers
# systemctl restart apache2
</code></pre>
<p>Dyrektywa <code>Header</code> może przeprowadzać szereg akcji na nagłówku. Nas głównie będą interesować te
poniższe:</p>
<ul>
<li><code>append</code> -- dodaje wartości do istniejącego już nagłówka w odpowiedzi serwera.</li>
<li><code>set</code> -- tworzy nowy nagłówek i ewentualnie zastępuje inne, które mają tę samą nazwę.</li>
<li><code>unset</code> -- usuwa nagłówek o określonej nazwie, o ile ten istnieje.</li>
</ul>
<p>Generalnie, to do ustawienia nagłówka <code>Cache-Control</code> będziemy używać opcji <code>set</code> . Jeśli będziemy
korzystać także z nagłówka <code>Expires</code> , to zamiast <code>set</code> trzeba korzystać z <code>append</code> . Podobnie jak w
przypadku nagłówka <code>Expires</code> , możemy korzystać z dyrektyw dopasowujących pliki i katalogi.</p>
<p>Opcje używane <a href="https://tools.ietf.org/html/rfc7234">w nagłówku Cache-Control są opisane tutaj</a>.
Generalnie są dwa rodzaje opcji: te używane w zapytaniu oraz te używane w odpowiedzi. Jako, że my
konfigurujemy serwer Apache2, to nas interesują nagłówki przesyłane w odpowiedziach:</p>
<ul>
<li><code>must-revalidate</code> -- gdy odpowiedź w cache przestaje być świeża, nie może zostać użyta bez
uprzedniej walidacji na serwerze.</li>
<li><code>no-cache</code> -- odpowiedź z serwera nie może zostać użyta bez uprzedniej pomyślnej walidacji na
serwerze.</li>
<li><code>no-store</code> -- przeglądarka lub proxy nie mogą buforować zasobów.</li>
<li><code>no-transform</code> -- proxy <a href="https://stackoverflow.com/questions/20134257/any-reason-not-to-add-cache-control-no-transform-header-to-every-page">nie może zmienić payload'u
wiadomości</a>.</li>
<li><code>public</code> -- zarówno przeglądarka jak i proxy mogą buforować zasoby.</li>
<li><code>private</code> -- tylko przeglądarka może buforować zasoby.</li>
<li><code>proxy-revalidate</code> -- ma takie samo znaczenie co <code>must-revalidate</code> z tym, że nie odnosi się do
cache prywatnego.</li>
<li><code>max-age</code> -- po tym okresie czasu, odpowiedź z serwera ma przestać być traktowana jako świeża, a
klient będzie musiał zweryfikować ją w następnym żądaniu.</li>
<li><code>s-maxage</code> -- w przypadku cache współdzielonego, wiek określony w tej dyrektywie nadpisze wiek w
<code>max-age</code> lub w nagłówku <code>Expires</code> . Dodatkowo, ta dyrektywa implikuje także zachowanie
określone przez dyrektywę <code>proxy-revalidate</code> .</li>
</ul>
<p>W przypadku, gdy zarówno nagłówek <code>Expires</code> i <code>Cache-Control</code> są określone w odpowiedzi serwera,
<a href="https://devcenter.heroku.com/articles/increasing-application-performance-with-http-cache-headers#expires">max-age zawsze jest barny pod uwagę w pierwszej
kolejności.</a></p>
<p>Poniżej jest przykład ustawienia nagłówka <code>Cache-Control</code> . Ten kawałek kodu trzeba dopisać do pliku
<code>/etc/apache2/apache2.conf</code> :</p>
<pre><code>&lt;FilesMatch &quot;\.(flv|ico|pdf|avi|mov|ppt|doc|mp3|wmv|wav)$&quot;&gt;
    Header set Cache-Control &quot;max-age=29030400, private&quot;
&lt;/FilesMatch&gt;
</code></pre>
<h2 id="z-których-nagłówków-http-korzystać">Z których nagłówków HTTP korzystać</h2>
<p>Na dobrą sprawę to mamy cztery różne nagłówki, które są w stanie skonfigurować cache przeglądarek:
<code>Last-Modified</code> , <code>ETag</code> , <code>Expires</code> oraz <code>Cache-Control</code> . Dwa pierwsze to walidatory, a dwa
ostatnie dostarczają informacje o świeżości. Zdania na temat ich wykorzystania są podzielone. Jedni
uważają, że wystarczy korzystać z jednego walidatora i jednego nagłówka zawierającego informacje o
świeżości zasobu. Inni zaś mówią, że najlepiej korzystać ze wszystkich czterech. Z kolei na necie
notuje się przeważnie trzy nagłówki i są to kombinacje <code>Last-Modified</code>-<code>Expires</code>-<code>Cache-Control</code> lub
<code>ETag</code>-<code>Expires</code>-<code>Cache-Control</code> .</p>
<p>Chyba najlepszą opcją są własne eksperymenty. Jeśli potrzebujemy jakiegoś mechanizmu, który nam
zweryfikuje ustawienia nagłówków konkretnych zasobów w serwisie, to zawsze możemy <a href="https://redbot.org/">skorzystać z
redbot</a>, który nam wyrzuci przyjazne
podsumowanie:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/5.cache-control-expires-last-modified-etag-redbot-test.png" alt=""></p>
<p><a href="https://developers.google.com/web/fundamentals/performance/optimizing-content-efficiency/http-caching">Pod tym
linkiem</a>
z kolei jest ciekawa rozpiska na temat wykorzystania nagłówków HTTP odpowiedzialnych za instrukcje
dla cache przeglądarek. Jest tam min. ta poniższa fotka:</p>
<p><img src="https://morfikov.github.io
/img/2016/08/http-cache-decision-tree.png" alt=""></p>
<p>Widzimy zatem, że są wykorzystane jedynie dwa nagłówki: <code>Cache-Control</code> i <code>ETag</code> . Z tym, że ten
drugi jest używany jedynie w przypadku, gdy odpowiedź z serwera ma podlegać buforowaniu. Wszystkie
opcje dla cache są dostosowywane przez poszczególne parametry nagłówka <code>Cache-Control</code> . Dlaczego
zatem niektóre strony wykorzystują nawet wszystkie cztery nagłówki? Być może to przez kompatybilność
wsteczną dla bardzo starych przeglądarek, które nie wiedzą jak zinterpretować te nowe nagłówki
wprowadzone w wersji 1.1 protokołu HTTP. To jedyne wytłumaczenie, które przychodzi mi do głowy.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/apache2/">apache2</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/cache/">cache</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&amp;text=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&amp;title=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&amp;title=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&title=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&amp;title=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fcache-control-last-modified-etag-i-expires-w-apache2%2f&description=Cache-Control%2c%20Last-Modified%2c%20ETag%20i%20Expires%20w%20Apache2" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/internal-dummy-connection-apache2-mpm_prefork/">&#34;Internal dummy connection&#34; w logu Apache2 (mpm_prefork)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-wersja-plikow-css-js-na-blogu/">WordPress: Wersja plików .css/.js na blogu</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/certyfikat-letsencrypt-dla-bloga-certbot/">Certyfikat Let&#39;s Encrypt dla bloga WordPress (certbot)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zablokowac-hotlink-apache2/">Jak zablokować hotlink&#39;i w Apache2</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/http-strict-transport-security-hsts-apache2/">HTTP Strict Transport Security (HSTS) w Apache2</a></li>
		
	</ul>
</div>

	
<section class="comments block">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "morfitronik" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2020 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
			<img alt="Licencja Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
		</a>
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
</body>
</html>