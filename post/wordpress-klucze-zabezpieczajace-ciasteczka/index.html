<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>WordPress: Klucze zabezpieczające ciasteczka | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WordPress: Klucze zabezpieczające ciasteczka" />
<meta property="og:description" content="WordPress stara się dbać o bezpieczeństwo swoich użytkowników najlepiej jak potrafi. Dowodem na to
mogą być unikalne klucze i sole uwierzytelniające (Authentication Unique Keys and Salts) wprowadzone
w wersji 2.5 oraz nieco rozbudowane w wersji 2.7. Ten mechanizm nie wykorzystuje sesji PHP do
śledzenia np. statusu zalogowania, tylko zaprzęga do tego celu ciasteczka, by utrudnić (albo raczej
uniemożliwić) potencjalnemu atakującemu dostęp do witryny. Bez tych kluczy i soli jesteśmy w stanie
przewidzieć wszystkie składowe hasha danego ciasteczka, dlatego też powinniśmy pokusić się o ich
implementację na swojej stronie. Niemniej jednak, na necie jest bardzo dużo niskiej jakości
informacji na temat działania mechanizmu walidacji ciasteczek, a artykuły, które
potrafią
go
opisać
w szerszym stopniu, są już lekko nieaktualne, bo zmienia się on praktycznie z każdą nową wersją
WordPressa. Zanim jednak przejdziemy do samych kluczy/soli, powinniśmy się zaznajomić ze sposobem w
jaki WordPress generuje i sprawdza wspomniane ciasteczka, na podstawie których to autoryzowane są
działania użytkowników naszego bloga." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/wordpress-klucze-zabezpieczajace-ciasteczka/" />
<meta property="article:published_time" content="2015-06-06T06:36:59+00:00" />
<meta property="article:modified_time" content="2015-06-06T06:36:59+00:00" />

		<meta itemprop="name" content="WordPress: Klucze zabezpieczające ciasteczka">
<meta itemprop="description" content="WordPress stara się dbać o bezpieczeństwo swoich użytkowników najlepiej jak potrafi. Dowodem na to
mogą być unikalne klucze i sole uwierzytelniające (Authentication Unique Keys and Salts) wprowadzone
w wersji 2.5 oraz nieco rozbudowane w wersji 2.7. Ten mechanizm nie wykorzystuje sesji PHP do
śledzenia np. statusu zalogowania, tylko zaprzęga do tego celu ciasteczka, by utrudnić (albo raczej
uniemożliwić) potencjalnemu atakującemu dostęp do witryny. Bez tych kluczy i soli jesteśmy w stanie
przewidzieć wszystkie składowe hasha danego ciasteczka, dlatego też powinniśmy pokusić się o ich
implementację na swojej stronie. Niemniej jednak, na necie jest bardzo dużo niskiej jakości
informacji na temat działania mechanizmu walidacji ciasteczek, a artykuły, które
potrafią
go
opisać
w szerszym stopniu, są już lekko nieaktualne, bo zmienia się on praktycznie z każdą nową wersją
WordPressa. Zanim jednak przejdziemy do samych kluczy/soli, powinniśmy się zaznajomić ze sposobem w
jaki WordPress generuje i sprawdza wspomniane ciasteczka, na podstawie których to autoryzowane są
działania użytkowników naszego bloga.">
<meta itemprop="datePublished" content="2015-06-06T06:36:59+00:00" />
<meta itemprop="dateModified" content="2015-06-06T06:36:59+00:00" />
<meta itemprop="wordCount" content="1586">



<meta itemprop="keywords" content="cookies,blog," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WordPress: Klucze zabezpieczające ciasteczka"/>
<meta name="twitter:description" content="WordPress stara się dbać o bezpieczeństwo swoich użytkowników najlepiej jak potrafi. Dowodem na to
mogą być unikalne klucze i sole uwierzytelniające (Authentication Unique Keys and Salts) wprowadzone
w wersji 2.5 oraz nieco rozbudowane w wersji 2.7. Ten mechanizm nie wykorzystuje sesji PHP do
śledzenia np. statusu zalogowania, tylko zaprzęga do tego celu ciasteczka, by utrudnić (albo raczej
uniemożliwić) potencjalnemu atakującemu dostęp do witryny. Bez tych kluczy i soli jesteśmy w stanie
przewidzieć wszystkie składowe hasha danego ciasteczka, dlatego też powinniśmy pokusić się o ich
implementację na swojej stronie. Niemniej jednak, na necie jest bardzo dużo niskiej jakości
informacji na temat działania mechanizmu walidacji ciasteczek, a artykuły, które
potrafią
go
opisać
w szerszym stopniu, są już lekko nieaktualne, bo zmienia się on praktycznie z każdą nową wersją
WordPressa. Zanim jednak przejdziemy do samych kluczy/soli, powinniśmy się zaznajomić ze sposobem w
jaki WordPress generuje i sprawdza wspomniane ciasteczka, na podstawie których to autoryzowane są
działania użytkowników naszego bloga."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/wsparcie/">
					
					<span class="main-nav__text">Wsparcie</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">WordPress: Klucze zabezpieczające ciasteczka</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2015-06-06T06:36:59Z">Opublikowano: 06/06/2015</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/wordpress/" rel="category">WordPress</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">WordPress: Klucze zabezpieczające ciasteczka</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#co-wiemy-o-danych-ciasteczka">Co wiemy o danych ciasteczka?</a>
      <ol>
        <li><a href="#nazwa-ciasteczka">Nazwa ciasteczka</a></li>
        <li><a href="#nazwa-użytkownika">Nazwa użytkownika</a></li>
        <li><a href="#czas-ważności-ciasteczka">Czas ważności ciasteczka</a></li>
        <li><a href="#token">Token</a></li>
        <li><a href="#hash">Hash</a></li>
      </ol>
    </li>
    <li><a href="#klucze-i-sole-zdefiniowane-w-wp-configphp">Klucze i sole zdefiniowane w wp-config.php</a></li>
    <li><a href="#zabezpieczamy-ciasteczka">Zabezpieczamy ciasteczka</a>
      <ol>
        <li><a href="#stała-cookiehash">Stała COOKIEHASH</a></li>
      </ol>
    </li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>WordPress stara się dbać o bezpieczeństwo swoich użytkowników najlepiej jak potrafi. Dowodem na to
mogą być unikalne klucze i sole uwierzytelniające (Authentication Unique Keys and Salts) wprowadzone
w wersji 2.5 oraz nieco rozbudowane w wersji 2.7. Ten mechanizm nie wykorzystuje sesji PHP do
śledzenia np. statusu zalogowania, tylko zaprzęga do tego celu ciasteczka, by utrudnić (albo raczej
uniemożliwić) potencjalnemu atakującemu dostęp do witryny. Bez tych kluczy i soli jesteśmy w stanie
przewidzieć wszystkie składowe hasha danego ciasteczka, dlatego też powinniśmy pokusić się o ich
implementację na swojej stronie. Niemniej jednak, na necie jest bardzo dużo niskiej jakości
informacji na temat działania mechanizmu walidacji ciasteczek, a artykuły, które
<a href="https://boren.blog/2008/07/14/ssl-and-cookies-in-wordpress-26/">potrafią</a>
<a href="http://www.securitysift.com/understanding-wordpress-auth-cookies/">go</a>
<a href="http://codeseekah.com/2012/04/09/why-wordpress-authentication-unique-keys-and-salts-are-important/">opisać</a>
w szerszym stopniu, są już lekko nieaktualne, bo zmienia się on praktycznie z każdą nową wersją
WordPressa. Zanim jednak przejdziemy do samych kluczy/soli, powinniśmy się zaznajomić ze sposobem w
jaki WordPress generuje i sprawdza wspomniane ciasteczka, na podstawie których to autoryzowane są
działania użytkowników naszego bloga.</p>
<h2 id="co-wiemy-o-danych-ciasteczka">Co wiemy o danych ciasteczka?</h2>
<p>Gdy użytkownik odwiedza nasz serwis i uzyskuje dostęp do określonych jego zasobów, np. dashboard,
przesyłane są przy pomocy ciasteczka dane uwierzytelniające, które są następnie sprawdzane przez
funkcję <code>wp_validate_auth_cookie()</code> . Poniżej jest wyciągnięte ciasteczko przy pomocy snifera
wireshark:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2015/05/1.wordpress-cookie.png" alt=""    class="huge"></p>
<p>Jeśli komuś udałoby się podrobić te zaznaczoną pozycję, mógłby on uzyskać dostęp do konta na
stronie. Poniżej sprawdzimy czy wykucie takiego ciasteczka i tym samym obejście zabezpieczeń
WordPressa jest w ogóle możliwe.</p>
<p>Przede wszystkim, poszczególne parametry ciasteczka są od siebie oddzielone przy pomocy <code>|</code> ale
wyżej w kodzie reprezentacją tego znaku jest <code>%7C</code> . Całe ciasteczko można więc rozbić na poniższe
wartości:</p>
<pre><code>wordpress_d6ea62b26612d05d8092cb54fc07b67d
morfik
1433146289
o9F7AdaHdVVM8peu4XzAHFgXSo0QGiXmUpe47K5PPtP
cea82a90a7cfb6d4f1aa676c52de77795eb3fbfaa630c6a9d031523224be46b8
</code></pre>
<p>Pierwsza linijka to nazwa ciasteczka. Następnie mamy nazwę użytkownika, który wysłał ciasteczko do
sprawdzenia. Dalej zaś jest linuxowy timestamp , a później mamy token oraz hash. By podrobić
ciasteczko, potrzebujemy wszystkich tych danych.</p>
<p>Jako, że Wordpress to projekt opensource, możemy skorzystać z tego przywileju i zajrzeć w jego kod.
Interesować nas będą głównie dwa pliki: <code>wp-includes/default-constants.php</code> oraz
<code>wp-includes/pluggable.php</code> . To na ich podstawie możemy ocenić czy mechanizm uwierzytelniający,
który WordPress ma zaimplementowany, jest bezpieczny.</p>
<h3 id="nazwa-ciasteczka">Nazwa ciasteczka</h3>
<p>Za nazwę, jaką przybierze ciasteczko, odpowiada plik <code>default-constants.php</code> , a konkretnie poniższy
jego kod:</p>
<pre><code>if ( !defined( 'COOKIEHASH' ) ) {
      $siteurl = get_site_option( 'siteurl' );
      if ( $siteurl )
            define( 'COOKIEHASH', md5( $siteurl ) );
      else
            define( 'COOKIEHASH', '' );
}

...

if ( !defined('AUTH_COOKIE') )
      define('AUTH_COOKIE', 'wordpress_' . COOKIEHASH);
</code></pre>
<p><code>COOKIEHASH</code> to hash md5 adresu bloga. Trzeba jednak pamiętać, że ten hash będzie się różnił w
zależności od tego czy w grę wchodzi protokół SSL, który przepisuje adres z http na https. Zatem
nazwa ciasteczka, zdefiniowana wyżej jako <code>AUTH_COOKIE</code> , składa się z dwóch połączonych ze sobą
wartości: <code>wordpress_</code> oraz tego hasha md5.</p>
<p>Jeśli ktoś chciałby uzyskać hash md5 jakiejś witryny, może to zrobić przy pomocy poniższego
polecenia:</p>
<pre><code>$ echo -n http://blog.lh | md5sum
1d8e95c9e916e9c049bad8285a33990a  -
</code></pre>
<p>Tutaj mała uwaga -- nie możemy dodawać do adresu <code>/</code> na jego końcu.</p>
<h3 id="nazwa-użytkownika">Nazwa użytkownika</h3>
<p>Nazwa użytkownika zwykle jest znana, przynajmniej <a href="https://morfikov.github.io/post/wordpress-administrator-bloga/">jeśli nie
zadbamy</a> o nią odpowiednio. Jeśli jednak
podjęliśmy ku temu stosowne kroki, to może być tutaj pewna rozbieżność.</p>
<h3 id="czas-ważności-ciasteczka">Czas ważności ciasteczka</h3>
<p>Ciasteczka generowane przez WordPress mają pewien określony termin ważności, po którym to takie
ciastko staje się zwyczajnie bezużyteczne. W standardzie są to <code>2</code> dni, liczone od utworzenia
ciasteczka. Sama forma tego parametru, to linuxowy timestamp. Zrzućmy zatem okiem na plik
<code>pluggable.php</code> , bo ten czas jest tam dokładnie
określony:</p>
<pre><code>$expiration = time() + apply_filters( 'auth_cookie_expiration', 2 * DAY_IN_SECONDS, $user_id, $remember );
</code></pre>
<p>Jeśli <code>$remember</code> zostałby ustawiony, wtedy ważność ciasteczka zostanie przeciągnięta do <code>14</code> dni.
Natomiast WordPress zaakceptuje każde ciasteczko pod warunkiem, że jego czas będzie ważny, czyli
będzie miał mniej niż <code>2</code> lub <code>14</code> dni. Ważność ciasteczka możemy za to sprawdzić przy pomocy
poniższego polecenia:</p>
<pre><code>$ date -d &quot;@1433146289&quot;
Mon Jun  1 10:11:29 CEST 2015
</code></pre>
<h3 id="token">Token</h3>
<p>Bez tokenów nie jesteśmy w stanie opublikować postu/strony ani też nawet zaktualizować skryptu
WordPressa czy jego wtyczek. Okazuje się bowiem, że w przypadku gdy <a href="https://core.trac.wordpress.org/ticket/20276">wyraźnie wylogujemy się z
systemu</a> (przez wciśnięcie wyloguj), to ciasteczka w
dalszym ciągu mogą być używane. Token ma na celu poprawienie tego problemu. Nie wpływa on jednak na
losowość ciastka, a ma jedynie za zadanie przywiązać ciasteczka do sesji użytkownika, która może
wygasnąć:</p>
<pre><code>if ( ! $token ) {
      $manager = WP_Session_Tokens::get_instance( $user_id );
      $token = $manager-&gt;create( $expiration );
}
</code></pre>
<h3 id="hash">Hash</h3>
<p>Rodzaj hasha jaki zostanie użyty zależy od właściwości serwera, a konkretnie od konfiguracji PHP,
tj. czy będą do dyspozycji dodatkowe algorytmy. Taki warunek widnieje w pliku <code>pluggable.php</code> :</p>
<pre><code>$algo = function_exists( 'hash' ) ? 'sha256' : 'sha1';
</code></pre>
<p>Krótko mówiąc, jeśli istnieje jest funkcja <code>hash</code> to zostanie użyty <code>sha256</code> , w przeciwnym wypadku
<code>sha1</code> . Chodzi o to, że funkcja PHP <code>hash_hmac()</code> nie obsługuje <code>sha256</code> . Jeśli nie wiemy, który
hash zostanie użyty na konkretnym serwerze, zawsze możemy to sprawdzić via <code>&lt;php phpinfo() ?&gt;</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2015/05/2.php-hash.png" alt=""    class="huge"></p>
<p>Dalej w pliku mamy kod odpowiadający za generowanie samego hasha:</p>
<pre><code>$hash = hash_hmac( $algo, $user-&gt;user_login . '|' . $expiration . '|' . $token, $key );
</code></pre>
<p>W zależności od użytego algorytmu, hash będzie miał, albo 64 (sha256) znaki, albo 40(sha1). W tym
przypadku został wykorzystany algorytm <code>sha256</code> . Natomiast w skład ciągu, który zostanie
zahashowany wchodzi nazwa użytkownika, linuxowy timestamp oraz token. Funkcja <code>hash_hmac()</code>
wykorzystuje także tajny klucz
współdzielony:</p>
<pre><code>$key = wp_hash( $user-&gt;user_login . '|' . $pass_frag . '|' . $expiration . '|' . $token, $scheme );
</code></pre>
<p>Jest to hash md5 nazwy użytkownika połączonej z kawałkiem hasha jego hasła, linuxowym timestampem
oraz tokenem i scheme.</p>
<p>Zmienna <code>$pass_frag</code> to <code>4</code> znaki hasha hasła od pozycji <code>8</code>:</p>
<pre><code>$pass_frag = substr($user-&gt;user_pass, 8, 4);
</code></pre>
<p>Zatem jeśli hasło w bazie danych ma postać <code>$P$B5TB6BnD0szKav74fMjSP77UAr3LoI/</code> , to wyciągnięte w
ten sposób znaki odpowiadają <code>BnD0</code> . Ten hash hasła składa się z dużych i małych liter, cyfr i
dwóch znaków specjalnych <code>.</code> oraz <code>/</code> , zatem ilość kombinacji nie powala i jest to 16,777,216,
przy czym, nie ma tutaj znaczenia czy użytkownik wybrał sobie hasło 4 czy 40 znakowe.</p>
<p>Jeśli chodzi zaś o zmienną <code>scheme</code> , to przybiera ona jedną z 3 wartości <code>auth</code>, <code>secure_auth</code> oraz
<code>logged_in</code> . Domyślnie jest to <code>auth</code> .</p>
<h2 id="klucze-i-sole-zdefiniowane-w-wp-configphp">Klucze i sole zdefiniowane w wp-config.php</h2>
<p>Wszystkie z powyższych parametrów można przewidzieć z większym lub mniejszym prawdopodobieństwem i
tu właśnie do gry wchodzi plik <code>wp-config.php</code> i zdefiniowane w nim klucze oraz sole. Samym plikiem
<code>wp-config.php</code> zajmiemy się później, teraz zaś rzućmy okiem jeszcze na plik <code>pluggable.php</code> . Mamy
tam poniższy kod:</p>
<pre><code>function wp_hash($data, $scheme = 'auth') {
      $salt = wp_salt($scheme);

      return hash_hmac('md5', $data, $salt);
}
</code></pre>
<p>I jak widzimy, zaprzęgnięta jest do roboty funkcja <code>wp_salt()</code> , która generuje sól z podanych w
<code>wp-config.php</code> wartości (akurat w tym przypadku) <code>AUTH_KEY</code> oraz <code>AUTH_SALT</code> :</p>
<pre><code>$cached_salts[ $scheme ] = $values['key'] . $values['salt'];
</code></pre>
<p>W ten sposób zasolonych ciasteczek nie da się przewidzieć.</p>
<h2 id="zabezpieczamy-ciasteczka">Zabezpieczamy ciasteczka</h2>
<p>Do dyspozycji mamy 4 pary klucz-sól: <code>AUTH_KEY/AUTH_SALT</code> , <code>SECURE_AUTH_KEY/SECURE_AUTH_SALT</code> ,
<code>LOGGED_IN_KEY/LOGGED_IN_SALT</code> oraz <code>NONCE_KEY/NONCE_SALT</code> . Pierwsze trzy pary zabezpieczeają
ciasteczka, ostatnia para zaś jest odpowiedzialna za <a href="https://codex.wordpress.org/WordPress_Nonces">ochronę danych
przesyłanych</a> w URLach oraz formularzach przed
pewnymi rodzajami nadużyć.</p>
<p>Ciasteczka, nazwijmy je roboczo <code>AUTH</code> oraz <code>SECURE_AUTH</code> , są przesyłane w przypadku korzystania z
protokołów <code>http</code> oraz <code>https</code> i odpowiadają jedynie za panel admina dając tym samym możliwość
wprowadzania zmian na blogu. W zależności od tego czy podczas logowania korzystamy z protokołu SSL,
zostanie wysłane tylko jedno z tych ciasteczek. Natomiast ciasteczko <code>LOGGED_IN</code> jest odpowiedzialne
za status zalogowania na blogu i jest przesyłane zawsze bez znaczenia czy przeglądamy stronę po http
czy https. Nie uzyskamy za jego pomocą dostępu do panelu administracyjnego i nie wprowadzimy żadnych
zmian w serwisie.</p>
<p>Te klucze są bardzo pożądane z punktu widzenia bezpieczeństwa witryny. WordPress ułatwia nawet ich
generowanie przy pomocy <a href="https://api.wordpress.org/secret-key/1.1/salt/">tego adresu</a> . Możemy
oczywiście sami sobie wygenerować te 64 znakowe ciągi, z tym, że nie wiem czy są jakieś ograniczenia
co do ich długości. Na stronie WordPressa jest jedynie informacja, że te klucze powinny być długie i
możliwie losowe, no i oczywiście, każdy z nich inny. Jako, że takie ciasteczko jest proste do
przechwycenia, powinniśmy <a href="https://morfikov.github.io/post/wordpress-szyfrowanie-ssltls/">rozważyć wymuszenie korzystania z protokołu
SSL</a> przynajmniej w przypadku logowania i
korzystania z panelu administracyjnego.</p>
<p>Jeśli nie podamy tych kluczy w pliku <code>wp-config.php</code> , zostaną one automatycznie wygenerowane przez
WordPressa i umieszczone w bazie danych w tabeli <code>wp_options</code> . Trzeba się liczyć z faktem, że jest
to zagrożenie bezpieczeństwa i nie powinniśmy do takiej sytuacji doprowadzać. Choć znowu bez
przesady w drugą stronę, bo potencjalny atakujący musiałby uzyskać dostęp do bazy danych. Niemniej
jednak, jeśli klucze i sole trzymamy osobno w pliku, ten ktoś musiałby również uzyskać dostęp do
systemu plików serwera tak by i ten plik pozyskać. Dlatego trzeba pamiętać, że <a href="https://morfikov.github.io/post/wordpress-ograniczone-prawa-dostepu/">prawa dostępu do
pliku</a> <code>wp-config.php</code> powinny być
bardzo restrykcyjne.</p>
<p>Nie musimy się tymi kluczami za to zbytnio przejmować w środowisku produkcyjnym, tj. nic się nie
stanie jeśli je zgubimy i będziemy musieli wygenerować nowe klucze. Niemniej jednak, gdy to robimy,
ciasteczka wszystkich użytkowników, których mamy w swojej bazie danych, z automatu przestaną
działać. Ale bez obaw, taki użytkownik będzie mógł się bez problemu zalogować i zostaną mu
przesłane nowe ciasteczka z hashem wygenerowanym przy pomocy nowych kluczy. Raz na jakiś czas
powinniśmy wygenerować nowe klucze/sole tak by unieważnić w ten sposób wszelkie potencjalnie
skompromitowane ciasteczka.</p>
<h3 id="stała-cookiehash">Stała COOKIEHASH</h3>
<p>Domyślnie stała <code>COOKIEHASH</code> jest ustawiona na hash md5 URLu strony bloga (bez końcowego <code>/</code>) i by
utrudnić potencjalnemu atakującemu zadanie, przydałoby się przepisać ten parametr, tak by nie był
znowu aż tak przewidywalny. Możemy to zrobić przez plik <code>wp-config.php</code> dodając w nim poniższy kod:</p>
<pre><code>define('COOKIEHASH', md5($siteurl . 'rozowe-misie'));
</code></pre>
<p>Nie zmieniliśmy dużo, jedynie dodaliśmy do adresu URL strony jakiś ciąg znaków i teraz hash md5
zostanie wygenerowany w oparciu o <code>http://moj-blog.comrozowe-misie</code> , co powinno nieco utrudnić
odgadnięcie wartości stałej <code>COOKIEHASH</code> .</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/cookies/">cookies</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/blog/">blog</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&amp;text=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&amp;title=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&amp;title=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&title=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&amp;title=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwordpress-klucze-zabezpieczajace-ciasteczka%2f&description=WordPress%3a%20Klucze%20zabezpieczaj%c4%85ce%20ciasteczka" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-graficzne-emotikonki/">WordPress: Graficzne emotikonki</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-wylaczenie-protokolu-xml-rpc/">WordPress: Wyłączenie protokołu XML-RPC</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-krotki-link-do-umieszczenia-na-twitterze/">WordPress: Krótki link do umieszczenia na Twitterze</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-edycja-i-modyfikacja-plikow-dodatkow/">WordPress: Edycja i modyfikacja plików dodatków</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wordpress-kosz-i-jego-cykliczne-oproznianie/">WordPress: Kosz i jego cykliczne opróżnianie</a></li>
		
	</ul>
</div>

	

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
</body>
</html>
