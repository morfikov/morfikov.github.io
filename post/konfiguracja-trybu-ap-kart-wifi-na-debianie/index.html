<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Konfiguracja trybu AP kart WiFi na Debianie | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Konfiguracja trybu AP kart WiFi na Debianie" />
<meta property="og:description" content="Jakiś czas temu dokonałem zakupu adaptera WiFi TP-Link
TL-WN722n, a to z tego względu, że
potrzebowałem zewnętrznej karty sieciowej do mojego laptopa. Chodziło generalnie o to, że ten
wbudowany w niego broadcom nie był w stanie robić kilku użytecznych rzeczy, min. testów
penetracyjnych mojej bezprzewodowej sieci domowej. Jak się później okazało, ten zakupiony adapter
posiada też dodatkowy ficzer, którym jest tryb AP (Access Point). Wprawdzie ta karta nie może się
równać z routerami WiFi, bo te zwykle mają więcej anten, z których każda jest lepszej jakości ale
jesteśmy w stanie połączyć ze sobą bezprzewodowo kilka stacji roboczych. Trzeba jednak wziąć po
uwagę, że zasięg jak i transfer będą w dużej mierze ograniczone. W tym wpisie postaramy się
przerobić zwykłą maszynę, na której jest zainstalowany Debian, na punkt dostępowy sieci WiFi." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/konfiguracja-trybu-ap-kart-wifi-na-debianie/" />
<meta property="article:published_time" content="2016-06-04T15:26:58+00:00" />
<meta property="article:modified_time" content="2016-06-04T15:26:58+00:00" />

		<meta itemprop="name" content="Konfiguracja trybu AP kart WiFi na Debianie">
<meta itemprop="description" content="Jakiś czas temu dokonałem zakupu adaptera WiFi TP-Link
TL-WN722n, a to z tego względu, że
potrzebowałem zewnętrznej karty sieciowej do mojego laptopa. Chodziło generalnie o to, że ten
wbudowany w niego broadcom nie był w stanie robić kilku użytecznych rzeczy, min. testów
penetracyjnych mojej bezprzewodowej sieci domowej. Jak się później okazało, ten zakupiony adapter
posiada też dodatkowy ficzer, którym jest tryb AP (Access Point). Wprawdzie ta karta nie może się
równać z routerami WiFi, bo te zwykle mają więcej anten, z których każda jest lepszej jakości ale
jesteśmy w stanie połączyć ze sobą bezprzewodowo kilka stacji roboczych. Trzeba jednak wziąć po
uwagę, że zasięg jak i transfer będą w dużej mierze ograniczone. W tym wpisie postaramy się
przerobić zwykłą maszynę, na której jest zainstalowany Debian, na punkt dostępowy sieci WiFi.">
<meta itemprop="datePublished" content="2016-06-04T15:26:58+00:00" />
<meta itemprop="dateModified" content="2016-06-04T15:26:58+00:00" />
<meta itemprop="wordCount" content="1415">



<meta itemprop="keywords" content="wifi,debian,sieć," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Konfiguracja trybu AP kart WiFi na Debianie"/>
<meta name="twitter:description" content="Jakiś czas temu dokonałem zakupu adaptera WiFi TP-Link
TL-WN722n, a to z tego względu, że
potrzebowałem zewnętrznej karty sieciowej do mojego laptopa. Chodziło generalnie o to, że ten
wbudowany w niego broadcom nie był w stanie robić kilku użytecznych rzeczy, min. testów
penetracyjnych mojej bezprzewodowej sieci domowej. Jak się później okazało, ten zakupiony adapter
posiada też dodatkowy ficzer, którym jest tryb AP (Access Point). Wprawdzie ta karta nie może się
równać z routerami WiFi, bo te zwykle mają więcej anten, z których każda jest lepszej jakości ale
jesteśmy w stanie połączyć ze sobą bezprzewodowo kilka stacji roboczych. Trzeba jednak wziąć po
uwagę, że zasięg jak i transfer będą w dużej mierze ograniczone. W tym wpisie postaramy się
przerobić zwykłą maszynę, na której jest zainstalowany Debian, na punkt dostępowy sieci WiFi."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/wsparcie/">
					
					<span class="main-nav__text">Wsparcie</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Konfiguracja trybu AP kart WiFi na Debianie</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-06-04T15:26:58Z">Opublikowano: 04/06/2016</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Konfiguracja trybu AP kart WiFi na Debianie</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#czy-moja-karta-wifi-obsługuje-tryb-ap">Czy moja karta WiFi obsługuje tryb AP</a></li>
    <li><a href="#firmware-i-oprogramowanie">Firmware i oprogramowanie</a></li>
    <li><a href="#konfiguracja-interfejsu-punktu-dostępowego">Konfiguracja interfejsu punktu dostępowego</a></li>
    <li><a href="#konfiguracja-hostapd">Konfiguracja hostapd</a></li>
    <li><a href="#skanowanie-eteru-w-poszukiwaniu-ap">Skanowanie eteru w poszukiwaniu AP</a></li>
    <li><a href="#konfiguracja-dnsmasq">Konfiguracja dnsmasq</a></li>
    <li><a href="#podłączanie-się-do-ap">Podłączanie się do AP</a></li>
    <li><a href="#ap-z-dostępem-do-internetu">AP z dostępem do internetu</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Jakiś czas temu dokonałem zakupu adaptera WiFi <a href="https://morfikov.github.io/post/recenzja-karta-wifi-tp-link-tl-wn722n/">TP-Link
TL-WN722n</a>, a to z tego względu, że
potrzebowałem zewnętrznej karty sieciowej do mojego laptopa. Chodziło generalnie o to, że ten
wbudowany w niego broadcom nie był w stanie robić kilku użytecznych rzeczy, min. testów
penetracyjnych mojej bezprzewodowej sieci domowej. Jak się później okazało, ten zakupiony adapter
posiada też dodatkowy ficzer, którym jest tryb AP (Access Point). Wprawdzie ta karta nie może się
równać z routerami WiFi, bo te zwykle mają więcej anten, z których każda jest lepszej jakości ale
jesteśmy w stanie połączyć ze sobą bezprzewodowo kilka stacji roboczych. Trzeba jednak wziąć po
uwagę, że zasięg jak i transfer będą w dużej mierze ograniczone. W tym wpisie postaramy się
przerobić zwykłą maszynę, na której jest zainstalowany Debian, na punkt dostępowy sieci WiFi.</p>
<h2 id="czy-moja-karta-wifi-obsługuje-tryb-ap">Czy moja karta WiFi obsługuje tryb AP</h2>
<p>Zwykle karty WiFi nie posiadają trybu AP, a jedynie tryb STA (Station). Czasem też jest dostępny
dodatkowy tryb Monitor. Jeśli dana karta nie posiada trybu AP, to bezpośrednia komunikacja dwóch
maszyn nie jest możliwa. Jeśli nie wiemy czy nasza karta WiFi potrafi przełączyć się w tryb AP,
możemy to sprawdzić przez wydanie poniższego polecenia:</p>
<pre><code># iw list
Wiphy phy0
...
    Supported interface modes:
        * IBSS
        * managed
        * AP
        * AP/VLAN
        * monitor
        * mesh point
        * P2P-client
        * P2P-GO
...
</code></pre>
<h2 id="firmware-i-oprogramowanie">Firmware i oprogramowanie</h2>
<p>Adapter TP-Link TL-WN722n do poprawnego działania wymaga doinstalowania odpowiedniego
<a href="https://pl.wikipedia.org/wiki/Firmware">firmware</a>. W Debianie, pakietów zawierających firmware do
określonych urządzeń jest dość sporo, a to jaki pakiet musimy zainstalować możemy odczytać z logu
systemowego po podpięciu adaptera do portu USB. Poniżej przykład:</p>
<pre><code>usb 1-3: New USB device found, idVendor=0cf3, idProduct=9271
...
usb 1-3: ath9k_htc: Firmware htc_9271.fw requested
...
</code></pre>
<p>Zatem potrzebny jest nam plik <code>htc_9271.fw</code> . Jeśli mamy problemy z odnalezieniem odpowiedniego
pakietu, to zawsze możemy <a href="https://morfikov.github.io/post/przeszukiwanie-zawartosci-pakietow-apt-file/">przeszukać ich zawartość przy pomocy
apt-file</a>. Tak czy inaczej, w
tym przypadku trzeba zainstalować pakiet <code>firmware-atheros</code> . Po zainstalowaniu firmware podłączamy
ponownie adapter do portu USB. W tym momencie powinniśmy mieć w systemie nowy interfejs sieciowy,
<code>wlan*</code> .</p>
<p>Musimy także zainstalować odpowiednie oprogramowanie. W sumie będą to trzy pakiety: <code>hostapd</code> ,
<code>dnsmasq</code> i <code>crda</code> . Jeśli ktoś miał do czynienia z <a href="https://openwrt.org/">OpenWRT</a>, to powinien
kojarzyć te narzędzia. W OpenWRT są one wykorzystywane dokładnie w tym samym celu, w którym my
zamierzamy ich używać na Debianie. Jeśli chcemy połączyć tylko dwie maszyny ze sobą, to
niekoniecznie potrzebujemy <a href="http://www.thekelleys.org.uk/dnsmasq/doc.html">dnsmasq</a> . Odpowiada on
bowiem za usługi takie jak DNS i DHCP, z których możemy bez problemu zrezygnować na rzecz ręcznej
<a href="https://morfikov.github.io/post/konfiguracja-polaczenia-wifi-pod-debianem/">konfiguracji połączenia WiFi</a> na
maszynie klienckiej. Natomiast, jeśli w grę wchodzi więcej maszyn, to praktycznym rozwiązaniem
byłoby zaprzęgnąć serwer DHCP, który automatycznie będzie konfigurował wszystkie stacje robocze. W
obu przypadkach możemy korzystać z zewnętrznego serwera DNS albo też skonfigurować sobie <a href="https://morfikov.github.io/post/dnscrypt-proxy-czyli-szyfrowanie-zapytan-dns/">szyfrowany
DNS przy pomocy
DNScrypt-proxy</a>.</p>
<h2 id="konfiguracja-interfejsu-punktu-dostępowego">Konfiguracja interfejsu punktu dostępowego</h2>
<p>By AP był w stanie się komunikować z bezprzewodowymi stacjami roboczymi, musimy skonfigurować mu
interfejs sieciowy. Edytujemy zatem plik <code>/etc/network/interfaces</code> i dopisujemy w nim ten poniższy
blok kodu:</p>
<pre><code>auto wlan1
#allow-hotplug wlan1
iface wlan1 inet static
    address 192.168.20.1
    network 192.168.20.0/24
    netmask 255.255.255.0
    broadcast 192.168.20.255
</code></pre>
<p>Konfiguracja dla tego interfejsu musi być przypisana statycznie. Podnosimy teraz interfejs i w tej
chwili karta powinna już posiadać adres IP:</p>
<pre><code># ifup wlan1

# ip addr show wlan1
11: wlan1: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc mq state DOWN group default qlen 1000
    link/ether e8:94:f6:1e:15:e9 brd ff:ff:ff:ff:ff:ff
    inet 192.168.20.1/24 brd 192.168.20.255 scope global wlan1
       valid_lft forever preferred_lft forever
</code></pre>
<h2 id="konfiguracja-hostapd">Konfiguracja hostapd</h2>
<p>Przechodzimy do konfiguracji <code>hostapd</code> . Edytujemy plik <code>/etc/default/hostapd</code> i dostosowujemy w nim
tę poniższą linijkę:</p>
<pre><code>DAEMON_CONF=&quot;/etc/hostapd/hostapd.conf&quot;
</code></pre>
<p>Z pakietem <code>hostapd</code> jest dostarczany obszerny plik konfiguracyjny <code>hostapd.conf.gz</code> , który
znajduje się w katalogu <code>/usr/share/doc/hostapd/examples/</code> . Wypakowujemy go i kopiujemy do wyżej
określonej lokalizacji:</p>
<pre><code># zcat /usr/share/doc/hostapd/examples/hostapd.conf.gz &gt; /etc/hostapd/hostapd.conf
</code></pre>
<p>Następnie edytujemy plik <code>hostapd.conf</code> , tak by zawierał poniższą konfigurację:</p>
<pre><code>interface=wlan1
driver=nl80211
logger_syslog=-1
logger_syslog_level=2
logger_stdout=-1
logger_stdout_level=2
ctrl_interface=/var/run/hostapd
ctrl_interface_group=0
ssid=Winter_Is_Coming
utf8_ssid=1
country_code=PL
ieee80211d=1
ieee80211h=1
hw_mode=g
channel=11
acs_num_scans=10
beacon_int=100
dtim_period=2
max_num_sta=255
rts_threshold=2347
fragm_threshold=2346
preamble=1
macaddr_acl=0
auth_algs=1
ignore_broadcast_ssid=0
wmm_enabled=0
wmm_ac_bk_cwmin=4
wmm_ac_bk_cwmax=10
wmm_ac_bk_aifs=7
wmm_ac_bk_txop_limit=0
wmm_ac_bk_acm=0
wmm_ac_be_aifs=3
wmm_ac_be_cwmin=4
wmm_ac_be_cwmax=10
wmm_ac_be_txop_limit=0
wmm_ac_be_acm=0
wmm_ac_vi_aifs=2
wmm_ac_vi_cwmin=3
wmm_ac_vi_cwmax=4
wmm_ac_vi_txop_limit=94
wmm_ac_vi_acm=0
wmm_ac_vo_aifs=2
wmm_ac_vo_cwmin=2
wmm_ac_vo_cwmax=3
wmm_ac_vo_txop_limit=47
wmm_ac_vo_acm=0
ap_max_inactivity=300
skip_inactivity_poll=0
disassoc_low_ack=1
ap_isolate=1
ieee80211n=1
ht_capab=[HT40-][SHORT-GI-20][SHORT-GI-40][RX-STBC1][MAX-AMSDU-3839][DSSS_CCK-40]
require_ht=0
eapol_version=2
eapol_key_index_workaround=0
eap_reauth_period=3600
eap_server=0
own_ip_addr=127.0.0.1
wpa=2
wpa_psk=
wpa_psk_radius=0
wpa_key_mgmt=WPA-PSK WPA-PSK-SHA256
wpa_pairwise=CCMP
rsn_pairwise=CCMP
wpa_group_rekey=600
wpa_gmk_rekey=21600
wpa_ptk_rekey=600
peerkey=1
okc=0
ap_table_max_size=255
ap_table_expiration_time=3600
wps_state=2
wps_independent=0
ap_setup_locked=1
uuid=7b3fb0ea-f068-446d-b803-7c1924b69613
wps_pin_requests=/var/run/hostapd_wps_pin_requests
device_name=Winter_Is_Coming
device_type=1-0050F204-1
config_methods=push_button
wps_rf_bands=g
time_zone=CET-1CEST,M3.5.0/2,M10.5.0/3
access_network_type=0
internet=1
</code></pre>
<p>W <code>wpa_psk</code> wpisujemy hasło do sieci WiFi. Możemy tutaj określić zwykłe hasło (8-63 znaków), lub też
możemy je wygenerować przy pomocy <code>wpa_passphrase</code> . Istnieje także możliwość sprecyzowania więcej
niż jednego hasła do sieci WiFi. W tym celu potrzebny będzie osobny plik, za który odpowiada
parametr <code>wpa_psk_file</code> . My tutaj ograniczymy się do jednego hasła zakodowanego w base64. Nazwę
sieci wpisujemy w <code>ssid</code> . Musimy także określić parametr <code>ht_capab</code> , który różni się w zależności
od posiadanego sprzętu. By odpowiednio uzupełnić wartość tej opcji, musimy zobaczyć co nam zwróci
polecenie <code>iw list</code> :</p>
<pre><code># iw list
...
    Band 1:
        Capabilities: 0x116e
            HT20/HT40
            SM Power Save disabled
            RX HT20 SGI
            RX HT40 SGI
            RX STBC 1-stream
            Max AMSDU length: 3839 bytes
            DSSS/CCK HT40
...
</code></pre>
<p>Każda z tych możliwości, które zostały wypisane powyżej, musi zostać uwzględniona w <code>ht_capab</code> .
Jako, że ta karta obsługuje szerokość kanałów 40 MHz, to określamy <code>[HT40-]</code> (dla kanałów 5-13) lub
<code>[HT40+]</code> (dla kanałów 1-7) w zależności od tego, który kanał wybraliśmy. Dla <code>RX HT20 SGI</code> oraz <code>RX HT40 SGI</code> dodajemy <code>[SHORT-GI-20]</code> i <code>[SHORT-GI-40]</code> . W przypadku <code>RX STBC 1-stream</code> dajemy
<code>[RX-STBC1]</code> . Następnie mamy <code>Max AMSDU length: 3839 bytes</code> i tutaj dajemy <code>[MAX-AMSDU-3839]</code>
(długość musi pasować). Ostatnia możliwość to <code>DSSS/CCK HT40</code> i w jej przypadku ustawiamy
<code>[DSSS_CCK-40]</code> . Jeśli nasza karta dysponuje innymi możliwościami, to trzeba zajrzeć w opis
konfiguracji <code>hostapd</code> , gdzie jest krótka instrukcja na temat uzupełniania tych możliwości. Więcej
informacji na temat wykorzystanych wyżęj parametrów można znaleźć
<a href="https://wireless.wiki.kernel.org/en/users/Documentation/hostapd">tutaj</a>. Zapisujemy plik i
restartujemy demona <code>hostapd</code> .</p>
<h2 id="skanowanie-eteru-w-poszukiwaniu-ap">Skanowanie eteru w poszukiwaniu AP</h2>
<p>Nasz AP powinien już rozgłaszać w eterze swoją obecność. Przechodzimy na stację kliencką i skanujemy
z niej eter w poszukiwaniu punktu dostępowego, który utworzyliśmy. Można to zrobić na kilka
sposobów. My skorzystamy do tego celu z narzędzia <code>wpa_cli</code> , które jest dostarczane z pakietem
<code>wpasupplicant</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2015/11/1.wpa_cli-ap-access-point-punkt-dostepu-skanowanie.png" alt=""    class="huge"></p>
<p>Widzimy, że nasz AP jest na liście.</p>
<h2 id="konfiguracja-dnsmasq">Konfiguracja dnsmasq</h2>
<p>Dostęp do sieci nam się na wiele nie zda bez odpowiedniej konfiguracji interfejsów na kliencie.
Jeśli mamy jedną maszynę, to raczej możemy ustawić wszystko ręcznie. Natomiast, jeśli posiadamy
wiele komputerów, które chcemy podłączyć do internetu, to dobrze jest skonfigurować sobie serwer
DHCP i DNS. Za te dwa w/w odpowiada narzędzie <code>dnsmasq</code> . Konfiguracja serwera DHCP i DNS trzymana
jest w pliku <code>/etc/dnsmasq.conf</code> ale zanim tam przejdziemy, zajrzyjmy pierw do pliku
<code>/etc/default/dnsmasq</code> i upewnijmy się, że <code>dnsmasq</code> jest włączony. Poniżej zaś znajdują się wpisy,
które trzeba umieścić w pliku <code>dnsmasq.conf</code> :</p>
<pre><code>domain-needed
bogus-priv
local=/mhouse/
interface=wlan1
no-hosts
expand-hosts
domain=mhouse.lh
dhcp-range=192.168.20.100,192.168.20.250,2h
#read-ethers
dhcp-lease-max=150
dhcp-leasefile=/etc/dnsmasq.leases
dhcp-authoritative
cache-size=1000
no-negcache
</code></pre>
<p>Gdybyśmy chcieli statyczne lease DHCP, możemy usunąć hash z linijki zawierającej <code>read-ethers</code> . W
takim przypadku będzie czytany plik <code>/etc/ethers</code> , w którym znajdują się party MAC-IP. Możemy także
konfigurować hosty bezpośrednio w konfiguracji <code>dnsmasq</code> przy pomocy wpisów takich jak ten poniżej:</p>
<pre><code>dhcp-host=c0:cb:38:01:f0:f5,morfikownia,192.168.20.200,2h
</code></pre>
<p>Powyższa linijka przydziela hostowi o adresie MAC <code>c0:cb:38:01:f0:f5</code> adres IP <code>192.168.20.200</code> i
nazwę <code>morfikownia</code> na <code>2</code> godziny.</p>
<p>Od tego momentu interfejsy sieciowe maszyn klienckich będą konfigurowane za pomocą protokołu DHCP.
Pamiętajmy by odpowiednio dostosować plik <code>/etc/network/interfaces</code> na wszystkich klientach.</p>
<h2 id="podłączanie-się-do-ap">Podłączanie się do AP</h2>
<p>Tak powyżej skonfigurowana sieć będzie dostępna dla klientów, którzy będą posiadać poniższą
konfigurację wpisaną do pliku <code>/etc/wpa_supplicant/wpa_supplicant.conf</code> :</p>
<pre><code>network={
      id_str=&quot;home_WiFi_static&quot;
      priority=5
      ssid=&quot;Winter_Is_Coming&quot;
      bssid=e8:94:f6:1e:15:e9
      psk=
      proto=RSN
      key_mgmt=WPA-PSK-SHA256
      pairwise=CCMP
      group=CCMP
      auth_alg=OPEN
      scan_ssid=0
      disabled=0
}
</code></pre>
<p>Sprawdźmy czy klientowi zostanie przydzielony adres IP:</p>
<pre><code># ifup wlan0
...
DHCPDISCOVER on wlan0 to 255.255.255.255 port 67 interval 6
DHCPREQUEST on wlan0 to 255.255.255.255 port 67
DHCPOFFER from 192.168.20.1
DHCPACK from 192.168.20.1
bound to 192.168.20.200 -- renewal in 2903 seconds.
</code></pre>
<p>Jeśli planujemy wdrożyć jakiś filtr pakietów na punkcie dostępowym, trzeba uwzględnić w nim regułki
przepuszczające ruch na portach 53/udp (DNS) oraz 67/udp i 68/udp (DHCP).</p>
<h2 id="ap-z-dostępem-do-internetu">AP z dostępem do internetu</h2>
<p>Stworzony w powyższy sposób bezprzewodowy punkt dostępowy nie będzie miał połączenia z internetem. W
przypadku jednak gdybyśmy chcieli go podłączyć pod tę sieć globalną, to musimy przeprowadzić kilka
dodatkowych czynności. Przede wszystkim włączamy forwarding pakietów w kernelu poprzez dopisanie do
pliku <code>/etc/sysctl.conf</code> tych poniższych parametrów:</p>
<pre><code>net.ipv4.ip_forward = 1
net.ipv6.conf.all.forwarding = 1
</code></pre>
<p>Musimy także odpowiednio skonfigurować sobie <a href="https://morfikov.github.io/post/firewall-na-linuxowe-maszyny-klienckie/">skrypt
firewall'a</a>:</p>
<pre><code>iptables -t nat -A POSTROUTING -o eth0 -s 192.168.20.0/24 -d 0/0 -j MASQUERADE

iptables -t filter -A fw-interfaces -i wlan1 -o eth0 -s 192.168.20.0/24 -j ACCEPT
</code></pre>
<p>Parametr <code>-o eth0</code> określa, przez który interfejs jest wyjście na świat. W taki oto sposób mamy
bardzo niskobudżetowy AP sieci WiFi z Debianem na pokładzie.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/wifi/">wifi</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/sie%C4%87/">sieć</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&amp;text=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&amp;title=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&amp;title=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&title=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&amp;title=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fkonfiguracja-trybu-ap-kart-wifi-na-debianie%2f&description=Konfiguracja%20trybu%20AP%20kart%20WiFi%20na%20Debianie" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przypisac-losowy-adres-mac-interfejsu/">Jak przypisać losowy adres MAC do interfejsu</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-interfejsow-bond-bonding/">Jak skonfigurować bonding w Debian linux (eth0&#43;wlan0)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-polaczenia-wifi-pod-debianem/">Konfiguracja połączenia WiFi pod debianem</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-ukryc-hostname-w-protokole-dhcp/">Jak ukryć hostname w protokole DHCP</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/rownowazenie-ruchu-lacz-kilku-isp-load-balancing/">Równoważenie ruchu łącz kilku ISP (load balancing)</a></li>
		
	</ul>
</div>

	
<section class="comments block">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "morfitronik" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2020 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
</body>
</html>
