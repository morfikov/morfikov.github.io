<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK" />
<meta property="og:description" content="Analizując sobie fabryczny podział przestrzeni flash w TP-LINK&#39;owych smartfonach, a konkretnie w
modelach Neffos C5 i C5 MAX, doszedłem do wniosku, że producent tych urządzeń nieco zaszalał
przeznaczając aż 4 GiB przestrzeni na partycję /system/ . W zasadzie ROM w tych telefonach zajmuje
około 2 GiB. Zatem pozostałe 2 GiB zwyczajnie się marnuje i przeciętny użytkownik smartfona nie
będzie w stanie tego obszaru w żaden sposób wykorzystać. Można by zatem inaczej przepartycjonować
ten flash, tak by nieco skurczyć samą partycję /system/ , przeznaczając jednocześnie odzyskane
miejsce na powiększenie partycji /data/ . W tym wpisie postaramy się właśnie taki zabieg zmiany
rozmiaru partycji /system/ przeprowadzić dla tych dwóch wyżej wymienionych modeli smartfonów." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/repartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-04-03T19:51:32&#43;00:00" />
<meta property="article:modified_time" content="2017-04-03T19:51:32&#43;00:00" />


		<meta itemprop="name" content="Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK">
<meta itemprop="description" content="Analizując sobie fabryczny podział przestrzeni flash w TP-LINK&#39;owych smartfonach, a konkretnie w
modelach Neffos C5 i C5 MAX, doszedłem do wniosku, że producent tych urządzeń nieco zaszalał
przeznaczając aż 4 GiB przestrzeni na partycję /system/ . W zasadzie ROM w tych telefonach zajmuje
około 2 GiB. Zatem pozostałe 2 GiB zwyczajnie się marnuje i przeciętny użytkownik smartfona nie
będzie w stanie tego obszaru w żaden sposób wykorzystać. Można by zatem inaczej przepartycjonować
ten flash, tak by nieco skurczyć samą partycję /system/ , przeznaczając jednocześnie odzyskane
miejsce na powiększenie partycji /data/ . W tym wpisie postaramy się właśnie taki zabieg zmiany
rozmiaru partycji /system/ przeprowadzić dla tych dwóch wyżej wymienionych modeli smartfonów."><meta itemprop="datePublished" content="2017-04-03T19:51:32&#43;00:00" />
<meta itemprop="dateModified" content="2017-04-03T19:51:32&#43;00:00" />
<meta itemprop="wordCount" content="3544">
<meta itemprop="keywords" content="flash,tp-link,smartfon,lollipop,neffos," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK"/>
<meta name="twitter:description" content="Analizując sobie fabryczny podział przestrzeni flash w TP-LINK&#39;owych smartfonach, a konkretnie w
modelach Neffos C5 i C5 MAX, doszedłem do wniosku, że producent tych urządzeń nieco zaszalał
przeznaczając aż 4 GiB przestrzeni na partycję /system/ . W zasadzie ROM w tych telefonach zajmuje
około 2 GiB. Zatem pozostałe 2 GiB zwyczajnie się marnuje i przeciętny użytkownik smartfona nie
będzie w stanie tego obszaru w żaden sposób wykorzystać. Można by zatem inaczej przepartycjonować
ten flash, tak by nieco skurczyć samą partycję /system/ , przeznaczając jednocześnie odzyskane
miejsce na powiększenie partycji /data/ . W tym wpisie postaramy się właśnie taki zabieg zmiany
rozmiaru partycji /system/ przeprowadzić dla tych dwóch wyżej wymienionych modeli smartfonów."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2017-04-03T19:51:32Z">Opublikowano: 03/04/2017</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/android/" rel="category">Android</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Repartycjonowanie flash&#39;a w Neffos C5 i C5 MAX od TP-LINK</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#czy-zmieniać-układ-flasha-na-smartfonie">Czy zmieniać układ flash'a na smartfonie</a></li>
    <li><a href="#fabryczny-układ-flasha-w-neffos-c5-i-neffos-c5-max">Fabryczny układ flash'a w Neffos C5 i Neffos C5 MAX</a></li>
    <li><a href="#tworzenie-nowego-układu-partycji-na-flashu-smartfona">Tworzenie nowego układu partycji na flash'u smartfona</a>
      <ol>
        <li><a href="#backup-tablicy-partycji-do-pliku">Backup tablicy partycji do pliku</a></li>
        <li><a href="#jak-usunąć-partycje-system--cache-i-data">Jak usunąć partycje /system/ , /cache/ i /data/</a></li>
        <li><a href="#jak-zmienić-rozmiar-partycji-system--cache-i-data">Jak zmienić rozmiar partycji /system/ , /cache/ i /data/</a></li>
        <li><a href="#podejrzenie-nowego-układu-flasha">Podejrzenie nowego układu flash'a</a></li>
        <li><a href="#formatowanie-partycji">Formatowanie partycji</a></li>
      </ol>
    </li>
    <li><a href="#problemy-z-wgraniem-systemu-z-pliku-updatezip-przez-adb-sideload">Problemy z wgraniem systemu z pliku update.zip przez ADB Sideload</a></li>
    <li><a href="#przepakowanie-stockowego-obrazu-systemimg-z-pliku-updatezip">Przepakowanie stock'owego obrazu system.img z pliku update.zip</a>
      <ol>
        <li><a href="#wypakowanie-zawartości-pliku-updatezip">Wypakowanie zawartości pliku update.zip</a></li>
        <li><a href="#dekompresja-pliku-systemnewdat-do-surowego-obrazu-ext4">Dekompresja pliku system.new.dat do surowego obrazu EXT4</a></li>
        <li><a href="#tworzenie-surowego-obrazu-ext4-o-mniejszym-rozmiarze">Tworzenie surowego obrazu EXT4 o mniejszym rozmiarze</a></li>
        <li><a href="#kompresja-surowego-obrazu-ext4">Kompresja surowego obrazu EXT4</a></li>
        <li><a href="#konwersja-do-pliku-dat">Konwersja do pliku DAT</a></li>
        <li><a href="#tworzenie-nowego-pliku-updatezip">Tworzenie nowego pliku update.zip</a></li>
      </ol>
    </li>
    <li><a href="#wgrywanie-świeżego-systemu-na-partycję-system">Wgrywanie świeżego systemu na partycję /system/</a></li>
    <li><a href="#alternatywna-metoda-na-wgranie-obrazu-systemimg">Alternatywna metoda na wgranie obrazu system.img</a>
      <ol>
        <li><a href="#jak-przyciąć-stockowy-obraz-systemimg">Jak przyciąć stock'owy obraz system.img</a></li>
        <li><a href="#wgrywanie-przyciętego-obrazu-przez-sp-flash-tool">Wgrywanie przyciętego obrazu przez SP Flash Tool</a></li>
        <li><a href="#wgrywanie-przyciętego-obrazu-przez-twrp-recovery">Wgrywanie przyciętego obrazu przez TWRP recovery</a></li>
      </ol>
    </li>
    <li><a href="#sprawdzenie-nowego-układu-partycji-z-poziomu-androida">Sprawdzenie nowego układu partycji z poziomu Androida</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Analizując sobie fabryczny podział przestrzeni flash w TP-LINK'owych smartfonach, a konkretnie w
modelach Neffos C5 i C5 MAX, doszedłem do wniosku, że producent tych urządzeń nieco zaszalał
przeznaczając aż 4 GiB przestrzeni na partycję <code>/system/</code> . W zasadzie ROM w tych telefonach zajmuje
około 2 GiB. Zatem pozostałe 2 GiB zwyczajnie się marnuje i przeciętny użytkownik smartfona nie
będzie w stanie tego obszaru w żaden sposób wykorzystać. Można by zatem inaczej przepartycjonować
ten flash, tak by nieco skurczyć samą partycję <code>/system/</code> , przeznaczając jednocześnie odzyskane
miejsce na powiększenie partycji <code>/data/</code> . W tym wpisie postaramy się właśnie taki zabieg zmiany
rozmiaru partycji <code>/system/</code> przeprowadzić dla tych dwóch wyżej wymienionych modeli smartfonów.</p>
<h2 id="czy-zmieniać-układ-flasha-na-smartfonie">Czy zmieniać układ flash'a na smartfonie</h2>
<p>Zarówno Neffos C5 jak i Neffos C5 MAX dysponują flash'em 16 GiB. Jak wspomniane zostało we wstępie,
4 GiB z tej przestrzeni jest zarezerwowane na partycję <code>/system/</code> . Rzadko się jednak zdarzy tak, że
stock'owy ROM TP-LINK'a będzie tyle zajmował. W zasadzie to raczej jest bardzo małe
prawdopodobieństwo, że rozmiar tego ROM'u przekroczy 2,5 GiB. Możemy zatem spokojnie wykroić 1,5
GiB z tej partycji i mieć więcej miejsca na dane użytkownika, np. zdjęcia czy filmy.</p>
<p>Oczywiście partycji <code>/system/</code> nie można przyciąć za bardzo. Nawet jeśli wykroimy sobie dokładnie
tyle miejsca, by zmieścił się nam na tej partycji stock'owy ROM, to w dalszym ciągu cześć aplikacji
wymagających uprawnień root może chcieć zapisywać pewne informacje na partycji <code>/system/</code> . Jeśli te
programiki nie będą w stanie tego uczynić, to może to doprowadzić do niestabilności systemu, czy
nawet problemów z uruchomieniem się Androida. Trzeba zatem zostawić trochę miejsca ale znowu bez
przesady.</p>
<p>Musimy także liczyć się z powiększeniem ROM'u po ewentualnych aktualizacjach, które będziemy w
stanie pobrać via OTA Update. Te aktualizacje nie są duże, a sam ROM od nich zwykle nie tyje ale w
przypadku gdyby TP-LINK wypuścił aktualizację Androida z Lollipop do Marshmallow, to już zmiana w
rozmiarze ROM'u może być widoczna. W dalszym jednak ciągu uważam, że przeznaczenie 4 GiB na partycję
<code>/system/</code> to szaleństwo i przydałoby się nieco zoptymalizować podział flash'a.</p>
<h2 id="fabryczny-układ-flasha-w-neffos-c5-i-neffos-c5-max">Fabryczny układ flash'a w Neffos C5 i Neffos C5 MAX</h2>
<p>Zacznijmy może od fabrycznego układu flash'a w Neffos C5 i C5 MAX. Układ w tych dwóch modelach jest
bardzo podobny ale nie jest dokładnie taki sam. W zasadzie ta rzecz, która nas interesuje zdaje się
być stała. Chodzi o kolejność partycji. W przypadku tych dwóch smartfonów, partycja <code>/system/</code> na
numer 20, partycja <code>/cache/</code> ma numer 21, a partycja <code>/data/</code> ma numer 22. Zatem mamy trzy partycje
jedna po drugiej, które musimy usunąć i stworzyć na nowo. Telefon po usunięciu tych trzech partycji
powinien się nam uruchomić bez problemu, choć z oczywistych względów nie załaduje nam systemu.</p>
<p>Użytkowników smartfonów Neffos Y5 i Y5L, którzy zastanawiają się dlaczego nie opisuję w tym artykule
również i tych dwóch urządzeń, informuję, że układ flash'a w tych dwóch telefonach znacznie się
różni w stosunku do tego, z którym mamy do czynienia w Neffos C5 i C5 MAX. W przypadku Y5 i Y5L
trzeba usunąć 9 z 29 partycji wliczając w to partycję <code>/recovery/</code> . Istnieje zatem podwyższone
ryzyko uwalenia telefonu na dobre, a biorąc pod uwagę, że przeprowadzane kroki i tak będą się
różniły, to postanowiłem nie mieszać wszystkich czterech urządzeń i zrobić 2 osobne artykuły.</p>
<p>Poniżej jest fotka obrazująca układ flash'a dla smartfona Neffos
C5.</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/001.tp-link-neffos-c5-max-flash-repartycjonowanie-fabryczny-uklad.png" alt=""    class="huge"></p>
<h2 id="tworzenie-nowego-układu-partycji-na-flashu-smartfona">Tworzenie nowego układu partycji na flash'u smartfona</h2>
<p>Wiemy zatem, że mamy usunąć trzy partycje: <code>/system/</code> , <code>/cache/</code> oraz <code>/data/</code> . Problem w tym, że
by usunąć partycję z flash'a smartfona, potrzebne nam są prawa administratora root. Nie koniecznie
musimy przeprowadzać proces ukorzeniania Androida. <a href="http://tplink-forum.pl/index.php?/topic/5854-jak-przeprowadzi%C4%87-root-na-smartfonach-neffos-od-tp-link/#comment-49408">Wystarczy wgrać na telefon obraz TWRP
recovery</a>,
czy to przy pomocy <code>fastboot</code> , czy też via <a href="http://spflashtool.com/">SP Flash Tool</a>. Mając wgrany
TWRP, odpalamy telefon w trybie recovery (przyciski VolUp+Power). Będąc w trybie recovery,
podłączamy smartfon do portu USB komputera, na którym to uruchamiamy terminal i wpisujemy poniższe
polecenie:</p>
<pre><code># adb shell
~ #
</code></pre>
<p>To polecenie zapewni nam dostęp root i będziemy mogli bardziej swobodnie operować na smartfonie przy
pomocy naszego komputera.</p>
<h3 id="backup-tablicy-partycji-do-pliku">Backup tablicy partycji do pliku</h3>
<p>Zanim cokolwiek zaczniemy zmieniać w układzie partycji na flash'u smartfona, zróbmy sobie kopię
tablicy partycji i zapiszmy ją w pliku gdzieś na karcie SD. Nie zapisujmy tego pliku w pamięci
telefonu, bo jak coś uszkodzimy w układzie partycji, to nie będziemy mieć dostępu do backup'u.
Backup tablicy partycji robimy w poniższy sposób:</p>
<pre><code>~ # sgdisk --backup=/sdcard1/backup-partition-table /dev/block/mmcblk0
</code></pre>
<h3 id="jak-usunąć-partycje-system--cache-i-data">Jak usunąć partycje /system/ , /cache/ i /data/</h3>
<p>Mając backup tablicy partycji, możemy przystąpić do usuwania wpisów z tej tablicy. Przed usunięciem
jakiekolwiek partycji, trzeba ją pierw odmontować. Wpiszmy zatem w terminalu te poniższe polecenia:</p>
<pre><code>~ # umount /cache
~ # umount /data
~ # umount /sdcard
~ # umount /system
</code></pre>
<p>Teraz możemy usunąć te trzy partycje przy pomocy narzędzia <code>sgdisk</code> w poniższy sposób:</p>
<pre><code>~ # sgdisk --delete=20 /dev/block/mmcblk0
~ # sgdisk --delete=21 /dev/block/mmcblk0
~ # sgdisk --delete=22 /dev/block/mmcblk0
</code></pre>
<h3 id="jak-zmienić-rozmiar-partycji-system--cache-i-data">Jak zmienić rozmiar partycji /system/ , /cache/ i /data/</h3>
<p>Teraz tworzymy na nowo partycję <code>/system/</code> , zaraz za partycją numer 19. Musimy określić trzy
wartości. Numer tworzonej partycji, sektor początkowy oraz rozmiar partycji. Numer jest znany,
tj. 20. Rozmiar też znamy, np. 2,5 GiB. Jak określić początek tej partycji? Możemy go wywnioskować z
wyjścia poniższego polecenia:</p>
<pre><code>~ # sgdisk --print /dev/block/mmcblk0
Number  Start (sector)    End (sector)  Size       Code  Name

...
  19          284672          360447   37.0 MiB    0700  metadata
...
</code></pre>
<p>Ta partycja numer 19 była przed partycją <code>/system/</code> . Widzimy, że mamy określony tam końcowy sektor,
tj. <code>360447</code> . Następna partycja ma zaczynać się na sektorze o jeden większym, czyli <code>360448</code> .
Rozmiar nowej partycji <code>/system/</code> podajemy jako +2560M, czyli 2,5G. W terminalu zatem wpisujemy
poniższe polecenie:</p>
<pre><code>~ # sgdisk --new=20:360448:+2560M /dev/block/mmcblk0
</code></pre>
<p>Nadajemy jeszcze nazwę tej partycji:</p>
<pre><code>~ # sgdisk --change-name=20:system /dev/block/mmcblk0
</code></pre>
<p>Powyższy krok z tworzeniem partycji i zmianą nazwy powtarzamy dla partycji <code>/cache/</code> :</p>
<pre><code>~ # sgdisk --new=21:5603328:+512M /dev/block/mmcblk0
~ # sgdisk --change-name=21:cache /dev/block/mmcblk0
</code></pre>
<p>Podobnie postępujemy w przypadku partycji <code>/data/</code> , z tym, że tutaj jako rozmiar partycji podajemy
sektor początkowy ostatniej partycji odejmując od tej wartości 1:</p>
<pre><code>~ # sgdisk --new=22:6651904:30501887 /dev/block/mmcblk0
~ # sgdisk --change-name=22:userdata /dev/block/mmcblk0
</code></pre>
<p>Ustawiamy typy nowo utworzonych partycji na <code>0700</code> :</p>
<pre><code>~ # sgdisk --typecode=20:0700 /dev/block/mmcblk0
~ # sgdisk --typecode=21:0700 /dev/block/mmcblk0
~ # sgdisk --typecode=22:0700 /dev/block/mmcblk0
</code></pre>
<h3 id="podejrzenie-nowego-układu-flasha">Podejrzenie nowego układu flash'a</h3>
<p>Po utworzeniu nowych partycji i określeniu ich rozmiaru, nazw oraz typów sprawdzamy czy wszystko się
zgadza:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/002.tp-link-neffos-c5-max-flash-repartycjonowanie-zmiana-ukladu.png" alt=""    class="huge"></p>
<p>Jak widać, w tej chwili nasz smartfon ma około 11,5 GiB na partycji <code>/data/</code> w stosunku do starych
10 GiB, czyli zysk na poziomie 15%.</p>
<h3 id="formatowanie-partycji">Formatowanie partycji</h3>
<p>Jeśli nowy układ partycji spełnia nasze oczekiwania, to wypadałoby teraz sformatować wszystkie trzy
partycje systemem plików EXT4 przy pomocy narzędzia <code>mke2fs</code> :</p>
<pre><code>~ # mke2fs -t ext4 /dev/block/mmcblk0p20
~ # mke2fs -t ext4 /dev/block/mmcblk0p21
~ # mke2fs -t ext4 /dev/block/mmcblk0p22
</code></pre>
<p>Montujemy te zasoby, czy to przy pomocy polecenia <code>mount</code> , czy też z GUI TWRP. Sprawdzamy też, czy
te partycje zostały poprawnie zamontowane w systemie:</p>
<pre><code>~ # mount | grep -i block
/dev/block/mmcblk0p20 on /system type ext4 (rw,seclabel,relatime,data=ordered)
/dev/block/mmcblk0p21 on /cache type ext4 (rw,seclabel,relatime,data=ordered)
/dev/block/mmcblk0p22 on /data type ext4 (rw,seclabel,relatime,data=ordered)
</code></pre>
<p>Powyższy wynik świadczy o tym, że repartycjonowanie flash'a w naszym smartfonie przebiegło z
powodzeniem.</p>
<h2 id="problemy-z-wgraniem-systemu-z-pliku-updatezip-przez-adb-sideload">Problemy z wgraniem systemu z pliku update.zip przez ADB Sideload</h2>
<p>Nasz smartfon w tej chwili nie ma jeszcze wgranego żadnego systemu operacyjnego. Musimy zatem jakoś
ten system zainstalować. Opcji jest kilka. Najprostszym rozwiązaniem wydawałoby się postaranie się o
<a href="https://morfikov.github.io/post/android-wgrywanie-update-zip-przez-adb-sideload-via-twrp-recovery/">plik update.zip i wgranie go via ADB Sideload z poziomu TWRP
recovery</a>.
Plik z firmware można pobrać z oficjalnej strony TP-LINK/Neffos. Problem w tym, że tak łatwo nie
będzie i wgranie systemu z pliku <code>update.zip</code> zakończy się niepowodzeniem.</p>
<p>Z początku nie wiedziałem w czym rzecz. No bo przecież TP-LINK'owy ROM do Neffos C5 i C5 MAX ma
około 2 GiB, a przy wgrywaniu go za pomocą ADB Sideload przez TWRP recovery, system wyrzuca
informację o braku miejsca:</p>
<pre><code>sideload-host file size 993462838 block size 65536
Installing zip file '/sideload/package.zip'
I:Update binary zip
I:Zip contains SELinux file_contexts file in its root. Extracting to /file_contexts
I:Legacy property environment initialized.

====== Updater-Script:
getprop(&quot;ro.product.device&quot;) == &quot;C5&quot; || abort(&quot;This package is for \&quot;C5\&quot; devices; this is a \&quot;&quot; + getprop(&quot;ro.product.device&quot;) + &quot;\&quot;.&quot;);
show_progress(0.750000, 0);
ui_print(&quot;Patching system image unconditionally...&quot;);
block_image_update(&quot;system&quot;, package_extract_file(&quot;system.transfer.list&quot;), &quot;system.new.dat&quot;, &quot;system.patch.dat&quot;);
show_progress(0.050000, 5);
assert(package_extract_file(&quot;boot.img&quot;, &quot;/tmp/boot.img&quot;),
       write_raw_image(&quot;/tmp/boot.img&quot;, &quot;bootimg&quot;),
       delete(&quot;/tmp/boot.img&quot;));
assert(package_extract_file(&quot;mobicore.bin&quot;, &quot;/tmp/tee1.img&quot;),
       write_raw_image(&quot;/tmp/tee1.img&quot;, &quot;tee1&quot;),
       delete(&quot;/tmp/tee1.img&quot;));
show_progress(0.200000, 10);
apply_sig(package_extract_file(&quot;sig/boot.sig&quot;), &quot;bootimg&quot;);

Patching system image unconditionally...
blockimg version is 2
  erasing 1048576 blocks
    blkdiscard failed: Invalid argument
  writing 521761 blocks of new data

ioctl(): blank: Invalid argument
write failed: No space left on device
lseek64 failed: Invalid argument
Updater process ended with ERROR: 1
I:Legacy property environment disabled.
I:Install took 274 second(s).
I:Signaling child sideload process to exit.
I:Waiting for child sideload process to exit.
sideload_host finished
</code></pre>
<p>Postanowiłem poszukać informacji na ten temat i <a href="http://forum.android.com.pl/topic/313401-na-jakiej-zasadzie-dzia%C5%82a-adb-sideload/">użytkownicy @maxprzemo oraz @piskorfa z
forum.android.com.pl nakierowali mnie na właściwy
trop</a>.
Okazuje się bowiem, że trzeba będzie się trochę napracować, by wgrać system ze stock'owego pliku
<code>update.zip</code> .</p>
<p>Rozchodzi się o to, że aktualizacja czy też instalacja systemu z pliku <code>update.zip</code> w Androidach
począwszy od wersji 5.0 (Lollipop) <a href="https://source.android.com/devices/tech/ota/block">wykorzystuje zapis
blokowy</a>. Ten mechanizm zatem będzie próbował
wgrać na partycję <code>/system/</code> obraz o pewnym określonym rozmiarze (w tym przypadku 4 GiB). Nie można
więc skrócić tej partycji do 2,5 GiB, tak jak to zrobiliśmy wyżej, tzn. można ale by zainstalować
system z pliku <code>update.zip</code> , trzeba go pierw przepakować i zmienić w nim informację dotyczącą
rozmiaru obrazu z tych 4 GiB na 2,5 GiB.</p>
<h2 id="przepakowanie-stockowego-obrazu-systemimg-z-pliku-updatezip">Przepakowanie stock'owego obrazu system.img z pliku update.zip</h2>
<p>Wiemy co mamy czynić, zatem do roboty. Przede wszystkim, musimy się zaopatrzyć w odpowiednie
narzędzia. W repozytorium dystrybucji Debian znajduje się pakiet <code>android-tools-fsutils</code> . W nim
zaś mamy narzędzia takie jakie <code>make_ext4fs</code> , <code>img2simg</code> oraz <code>simg2img</code> . Brakuje jednak dwóch
narzędzi, których będziemy również potrzebować, tj.
<a href="https://github.com/xpirt/sdat2img/blob/master/sdat2img.py">sdat2img</a> oraz
<a href="https://github.com/xpirt/img2sdat/blob/master/img2sdat.py">img2sdat</a>. Trzeba te dwa skrypty
dociągnąć z GitHub'a.</p>
<p>Dokładna <a href="https://forum.xda-developers.com/android/software-hacking/how-to-conver-lollipop-dat-files-to-t2978952">instrukcja przepakowania
obrazu</a>
znajduje się na forum XDA. Poniżej zaś znajduje się skrócony zapis poszczególnych kroków.</p>
<h3 id="wypakowanie-zawartości-pliku-updatezip">Wypakowanie zawartości pliku update.zip</h3>
<p>Na sam początek pobieramy ze strony TP-LINK/Neffos plik firmware dla Neffos C5 lub C5 MAX w
zależności od tego, który z ww. modeli smartfona posiadamy. Ten plik trzeba wypakować. Zawartość
tego pliku po wypakowaniu jest następująca:</p>
<pre><code># tree -sh img
img
├── [4.0K]  META-INF
│   ├── [1.5K]  CERT.RSA
│   ├── [1.2K]  CERT.SF
│   ├── [1.0K]  MANIFEST.MF
│   └── [4.0K]  com
│       ├── [4.0K]  android
│       │   ├── [ 129]  metadata
│       │   └── [1.4K]  otacert
│       └── [4.0K]  google
│           └── [4.0K]  android
│               ├── [564K]  update-binary
│               └── [ 738]  updater-script
├── [7.2M]  boot.img
├── [ 32K]  file_contexts
├── [ 60K]  mobicore.bin
├── [ 431]  scatter.txt
├── [4.0K]  sig
│   ├── [ 256]  boot.sig
│   └── [ 256]  recovery.sig
├── [2.0G]  system.new.dat
├── [   0]  system.patch.dat
├── [ 778]  system.transfer.list
└── [   1]  type.txt

6 directories, 17 files
</code></pre>
<p>Obraz partycji <code>/system/</code> znajduje się w pliku <code>system.new.dat</code> . Ten plik, jak widzimy wyżej,
zajmuje 2 GiB, a nie 4 GiB. Jest on zatem w jakiś sposób skompresowany i musimy go pierw
zdekompresować.</p>
<h3 id="dekompresja-pliku-systemnewdat-do-surowego-obrazu-ext4">Dekompresja pliku system.new.dat do surowego obrazu EXT4</h3>
<p>Do dekompresji pliku <code>system.new.dat</code> posłuży nam skrypt <code>sdat2img.py</code> . Przyjmuje on trzy
argumenty, z których pierwszy to ścieżka do pliku <code>system.transfer.list</code> , drugi to ścieżka do pliku
<code>system.new.dat</code> , z trzeci na nazwa surowego obrazu zawierającego już system plików EXT4, który
zostanie utworzony. Wpisujemy zatem w terminal poniższe polecenie:</p>
<pre><code>$ ./sdat2img.py img/system.transfer.list img/system.new.dat system.img
sdat2img binary - version: 1.0

Android Lollipop 5.1 detected!

Skipping command erase...
Copying 32770 blocks into position 0...
Copying 2 blocks into position 33025...
Copying 31996 blocks into position 33539...
...
Copying 2 blocks into position 983040...
Copying 2 blocks into position 1015808...
Done! Output image: /media/Kabi/neffos/system.img
</code></pre>
<p>Po chwili w katalogu roboczym powinniśmy ujrzeć plik <code>system.img</code> :</p>
<pre><code># ls -al system.img
-rw-r--r-- 1 root root 4.0G 2017-04-03 09:29:38 system.img
</code></pre>
<p>Jak widać, z 2 GiB zrobiło nam się 4 GiB i to jest właśnie surowy obraz, który można wgrać na
partycję <code>/system/</code> , gdy ta ma rozmiar 4 GiB. My ten rozmiar zmieniliśmy do 2,5 GiB i dlatego
trzeba ten obraz nieco przyciąć.</p>
<h3 id="tworzenie-surowego-obrazu-ext4-o-mniejszym-rozmiarze">Tworzenie surowego obrazu EXT4 o mniejszym rozmiarze</h3>
<p>Musimy teraz wydobyć pliki ze starego obrazu i z nich wygenerować nowy surowy obraz EXT4. Wobec tego
montujemy ten powyższy plik <code>system.img</code> w jakimś katalogu:</p>
<pre><code># mount -t ext4 -o loop system.img /mnt
</code></pre>
<p>Przy pomocy narzędzia <code>make_ext4fs</code> tworzymy obraz o określonym rozmiarze z zawartości katalogu, do
którego podmontowaliśmy wcześniej obraz <code>system.img</code> :</p>
<pre><code># make_ext4fs -T 0 -S img/file_contexts -l 2684354560 -a system system_new.img /mnt/
Creating filesystem with parameters:
    Size: 2684354560
    Block size: 4096
    Blocks per group: 32768
    Inodes per group: 8192
    Inode size: 256
    Journal blocks: 10240
    Label:
    Blocks: 655360
    Block groups: 20
    Reserved block group size: 159
Created filesystem with 2788/163840 inodes and 526016/655360 blocks
</code></pre>
<p>W parametrze <code>-S</code> musimy podać ścieżkę do pliku <code>file_contexts</code> . Natomiast opcja <code>-l</code> odpowiada za
rozmiar (w bajtach) nowo wygenerowanego obrazu (2,5 GiB). Po zakończeniu procesu pakowania
powinniśmy otrzymać plik <code>system_new.img</code> o zmniejszonym rozmiarze:</p>
<pre><code># ls -al system_new.img
-rw-r--r-- 1 root root 2.5G 2017-04-03 00:30:59 system_new.img
</code></pre>
<p>No i nasz obraz ma już taki rozmiar jaki chcemy. Ten plik jeszcze trzeba skompresować.</p>
<h3 id="kompresja-surowego-obrazu-ext4">Kompresja surowego obrazu EXT4</h3>
<p>Przy pomocy narzędzia <code>img2simg</code> kompresujemy wyżej utworzony obraz systemu:</p>
<pre><code># img2simg system_new.img system_new.img-sparse

# ls -al system_new.img-sparse
-rw-r--r-- 1 root root 2.0G 2017-04-03 09:43:00 system_new.img-sparse
</code></pre>
<h3 id="konwersja-do-pliku-dat">Konwersja do pliku DAT</h3>
<p>Tak powstały plik <code>system_new.img-sparse</code> trzeba jeszcze przekonwertować do formatu DAT. Do tego
celu wykorzystamy skrypt <code>img2sdat.py</code> podając w argumencie ścieżkę do skompresowanego obrazu:</p>
<pre><code># ./img2sdat/img2sdat.py system_new.img-sparse
img2sdat binary - version: 1.2

            1. Android Lollipop 5.0
            2. Android Lollipop 5.1
            3. Android Marshmallow 6.0
            4. Android Nougat 7.0

Choose system version: 2
Total of 655360 4096-byte output blocks in 2605 input chunks.
Generating digraph...
Finding vertex sequence...
Reversing backward edges...
  0/0 dependencies (0.00%) were violated; 0 source blocks stashed.
Improving vertex order...
Reticulating splines...
max stashed blocks: 0  (0 bytes), limit:

Done! Output files: .
</code></pre>
<p>W katalogu roboczym powinny zostać utworzone trzy nowe pliki: <code>system.new.dat</code> , <code>system.patch.dat</code>
oraz <code>system.transfer.list</code> :</p>
<pre><code># ls -al
-rw-r--r-- 1 root   root   2.0G 2017-04-03 09:54:11 system.new.dat
-rw-r--r-- 1 root   root      0 2017-04-03 09:54:11 system.patch.dat
-rw-r--r-- 1 root   root    43K 2017-04-03 09:54:11 system.transfer.list
</code></pre>
<h3 id="tworzenie-nowego-pliku-updatezip">Tworzenie nowego pliku update.zip</h3>
<p>Te trzy pliki trzeba podmienić w katalogu z zawartością, która została wyodrębniona z pliku
<code>update.zip</code> :</p>
<pre><code># mv system.new.dat system.patch.dat system.transfer.list ./img/
</code></pre>
<p>Następnie całość trzeba spakować:</p>
<pre><code># cd ./img/
# zip -r update.zip *
  adding: META-INF/ (stored 0%)
  adding: META-INF/CERT.RSA (deflated 25%)
  adding: META-INF/MANIFEST.MF (deflated 46%)
  adding: META-INF/com/ (stored 0%)
  adding: META-INF/com/google/ (stored 0%)
  adding: META-INF/com/google/android/ (stored 0%)
  adding: META-INF/com/google/android/update-binary (deflated 35%)
  adding: META-INF/com/google/android/updater-script (deflated 56%)
  adding: META-INF/com/android/ (stored 0%)
  adding: META-INF/com/android/metadata (deflated 6%)
  adding: META-INF/com/android/otacert (deflated 28%)
  adding: META-INF/CERT.SF (deflated 51%)
  adding: boot.img (deflated 0%)
  adding: file_contexts (deflated 80%)
  adding: mobicore.bin (deflated 57%)
  adding: scatter.txt (deflated 52%)
  adding: sig/ (stored 0%)
  adding: sig/recovery.sig (stored 0%)
  adding: sig/boot.sig (stored 0%)
  adding: system.new.dat (deflated 52%)
  adding: system.patch.dat (stored 0%)
  adding: system.transfer.list (deflated 71%)
  adding: type.txt (stored 0%)
</code></pre>
<p>W ten sposób przygotowany plik <code>update.zip</code> nadaje się do wgrania przez ADB Sideload ale tylko i
wyłącznie z poziomu TWRP. Chodzi o to, że firmware wypuszczany przez TP-LINK/Neffos jest podpisany
w przeciwieństwie do naszej
paczki:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/003.tp-link-neffos-c5-max-flash-repartycjonowanie-update.png" alt=""    class="huge"></p>
<p>My nie możemy wykorzystać klucza, którym takie archiwum zostało podpisane i nasza paczka nie będzie
honorowana przez mechanizm aktualizacji. Na szczęście w ustawieniach TWRP można pominąć weryfikację
pliku ZIP i wgrać system bez względu na to czy firmware jest podpisany czy też i nie jest.</p>
<h2 id="wgrywanie-świeżego-systemu-na-partycję-system">Wgrywanie świeżego systemu na partycję /system/</h2>
<p>Wracamy na smartfon i włączamy tryb ADB Sideload z menu TWRP (Advanced =&gt; ADB Sideload). W
terminalu na komputerze zaś wydajemy poniższe polecenie:</p>
<pre><code># adb sideload update.zip
Total xfer: 1.00x
</code></pre>
<p>Z logu TWRP możemy wyczytać, że ta operacja zakończyła się powodzeniem:</p>
<pre><code>sideload-host file size 995870531 block size 65536
Installing zip file '/sideload/package.zip'
I:Update binary zip
I:Zip contains SELinux file_contexts file in its root. Extracting to /file_contexts
I:Legacy property environment initialized.

====== Updater-Script:
getprop(&quot;ro.product.device&quot;) == &quot;C5&quot; || abort(&quot;This package is for \&quot;C5\&quot; devices; this is a \&quot;&quot; + getprop(&quot;ro.product.device&quot;) + &quot;\&quot;.&quot;);
show_progress(0.750000, 0);
ui_print(&quot;Patching system image unconditionally...&quot;);
block_image_update(&quot;system&quot;, package_extract_file(&quot;system.transfer.list&quot;), &quot;system.new.dat&quot;, &quot;system.patch.dat&quot;);
show_progress(0.050000, 5);
assert(package_extract_file(&quot;boot.img&quot;, &quot;/tmp/boot.img&quot;),
       write_raw_image(&quot;/tmp/boot.img&quot;, &quot;bootimg&quot;),
       delete(&quot;/tmp/boot.img&quot;));
assert(package_extract_file(&quot;mobicore.bin&quot;, &quot;/tmp/tee1.img&quot;),
       write_raw_image(&quot;/tmp/tee1.img&quot;, &quot;tee1&quot;),
       delete(&quot;/tmp/tee1.img&quot;));
show_progress(0.200000, 10);
apply_sig(package_extract_file(&quot;sig/boot.sig&quot;), &quot;bootimg&quot;);


Patching system image unconditionally...
blockimg version is 2
  writing 512 blocks of new data
  writing 512 blocks of new data
  writing 512 blocks of new data
...
  zeroing 1024 blocks
  zeroing 1024 blocks
  zeroing 1024 blocks
...
  writing 512 blocks of new data
  writing 512 blocks of new data
  writing 512 blocks of new data
...
wrote 655360 blocks; expected 655360
max alloc needed was 4096
kernel_page_cnt:3117 ramdisk_page_cnt:565 second_page_cnt:0 partion_end_offset:0x731800
script result was [pass]
I:Updater process ended with RC=0
I:Legacy property environment disabled.
I:Install took 357 second(s).
I:Signaling child sideload process to exit.
I:Waiting for child sideload process to exit.
sideload_host finished
</code></pre>
<p>Czyścimy cache i robimy Factory Reset, by potwierdzić, że z pozostałymi partycjami nie ma żadnych
problemów:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/004.tp-link-neffos-c5-max-flash-repartycjonowanie-factory-reset-twrp.png" alt=""    class="small"></p>
<p>Cały proces ze zmianą układu flash'a w smartfonach Neffos C5 i C5 MAX nie był jakoś szczególnie
skomplikowany ale takie przepakowywanie pliku <code>update.zip</code> nie należy do przyjemnych. Na dobrą
sprawę, każdy plik <code>update.zip</code> z nowszym firmware wypuszczony przez TP-LINK/Neffos, który będziemy
chcieli wgrać na smartfon przy pomocy ADB Sideload, musimy w powyższy sposób przepakować. Oczywiście
aktualizacje OTA Update będą działać bez zarzutu ale w przypadku uszkodzenia w jakiś sposób systemu
telefonu, warto taką przerobioną paczkę <code>.zip</code> posiadać.</p>
<h2 id="alternatywna-metoda-na-wgranie-obrazu-systemimg">Alternatywna metoda na wgranie obrazu system.img</h2>
<p>Ponowne instalowanie systemu z wykorzystaniem mechanizmu ADB Sideload nie jest jednak jedynym
rozwiązaniem, które możemy wykorzystać, by przywrócić system w telefonie. Ten sposób jest nieco
prostszy ale opiera się na backup'ie stock'owej partycji <code>/system/</code> , który można wykonać albo przez
SP Flash Tool, albo też z poziomu TWRP recovery przy pomocy narzędzia <code>dd</code> . Niezależnie od sposobu,
na dysku powinniśmy mieć surowy obraz partycji <code>/system/</code> o rozmiarze 4 GiB. Rozmiar tego pliku
trzeba przyciąć do 2,5 GiB i wgrać na smartfon.</p>
<h3 id="jak-przyciąć-stockowy-obraz-systemimg">Jak przyciąć stock'owy obraz system.img</h3>
<p>Wyciągnijmy sobie najpierw obraz <code>system.img</code> z backup'u flash'a. Montujemy obraz przy pomocy
poniższego polecenia (być może trzeba będzie <a href="https://morfikov.github.io/post/obsluga-wielu-partycji-w-module-loop/">dostosować moduł
loop</a>):</p>
<pre><code># losetup /dev/loop0 tp-link-neffos-c5-orig.img
</code></pre>
<p>Upewniamy się co do numeru partycji <code>/system/</code> w tym obrazie:</p>
<pre><code># gdisk -l tp-link-neffos-c5-orig.img | grep system
  20          360448         8749055   4.0 GiB     0700  system
</code></pre>
<p>Kopiujemy zawartość tej partycji na dysk przy pomocy <code>dd</code> :</p>
<pre><code># dd if=/dev/loop0p20 of=./c5-p20-system.orig
</code></pre>
<p>Sprawdzamy system plików pod kątem błędów i zmieniamy rozmiar systemu plików w obrazie na 2,5 GiB:</p>
<pre><code># e2fsck -f c5-p20-system.orig

# resize2fs -p c5-p20-system.orig 2560M
resize2fs 1.43.4 (31-Jan-2017)
Resizing the filesystem on c5-p20-system.orig to 655360 (4k) blocks.
Begin pass 2 (max = 147513)
Relocating blocks             XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
Begin pass 3 (max = 32)
Scanning inode table          XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
The filesystem on c5-p20-system.orig is now 655360 (4k) blocks long.
</code></pre>
<p>Po zakończonym procesie, rozmiar pliku <code>c5-p20-system.orig</code> powinien wynosić 2,5 GiB:</p>
<pre><code># ls -al c5-p20-system.orig
-rw-r--r-- 1 morfik morfik 2.5G 2017-04-03 02:08:18 c5-p20-system.orig
</code></pre>
<p>Ten obraz trzeba teraz załadować na smartfon, z tym, że jeśli chcemy do tego celu wykorzystać SP
Flash Tool, to musimy odpowiednio przepisać sobie plik <code>scatter.txt</code> . Możemy też naturalnie ten
obraz przesłać przez ADB na partycję <code>/data/</code> i wgrać go przy pomocy <code>dd</code> na stosowne urządzenie
blokowe. Sposób z SP Flash Tool jest nieco mniej inwazyjny, bo nie trzeba zapisywać dwa razy pamięci
telefonu. Którą opcję wybierzemy, to już zależy w zasadzie tylko od nas.</p>
<h3 id="wgrywanie-przyciętego-obrazu-przez-sp-flash-tool">Wgrywanie przyciętego obrazu przez SP Flash Tool</h3>
<p>Narzędzie SP Flash Tool operuje na pliku <code>scatter.txt</code> . Jeśli wykonaliśmy backup flash'a przy
pomocy tego oprogramowania, to <a href="http://tplink-forum.pl/pub/neffos/">powinniśmy mieć ten plik</a>.
Niestety nie możemy go wykorzystać w momencie, gdy zmieniamy układ partycji na flash. W zasadzie, to
musimy w tym pliku przepisać pozycje odpowiadające za opis partycji <code>/system/</code> , <code>/cache/</code> oraz
<code>/data/</code> , bo to one uległy zmianie. Przepisujemy te pozycje do poniższej postaci (zawsze możemy
pomagać sobie plikiem <code>/proc/partinfo</code> ):</p>
<pre><code>...
- partition_index: SYS21
  partition_name: system
  file_name:
  is_download: true
  type: EXT4_IMG
  linear_start_addr: 0xb000000
  physical_start_addr: 0xb000000
  partition_size: 0xa0000000
  region: EMMC_USER
  storage: HW_STORAGE_EMMC
  boundary_check: true
  is_reserved: false
  operation_type: UPDATE
  reserve: 0x00

- partition_index: SYS22
  partition_name: cache
  file_name:
  is_download: true
  type: EXT4_IMG
  linear_start_addr: 0xab000000
  physical_start_addr: 0xab000000
  partition_size: 0x20000000
  region: EMMC_USER
  storage: HW_STORAGE_EMMC
  boundary_check: true
  is_reserved: false
  operation_type: UPDATE
  reserve: 0x00

- partition_index: SYS23
  partition_name: userdata
  file_name:
  is_download: true
  type: EXT4_IMG
  linear_start_addr: 0xcb000000
  physical_start_addr: 0xcb000000
  partition_size: 0x2d7d80000
  region: EMMC_USER
  storage: HW_STORAGE_EMMC
  boundary_check: true
  is_reserved: false
  operation_type: UPDATE
  reserve: 0x00
...
</code></pre>
<p>Zapisujemy plik <code>scatter.txt</code> i ładujemy go w SP Flash Tool. Wskazujemy także plik obrazu dla
partycji <code>/system/</code> no i oczywiście wciskamy przycisk
&quot;Download&quot;:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/005.tp-link-neffos-c5-max-flash-repartycjonowanie-sp-flash-tool.png" alt=""    class="huge"></p>
<h3 id="wgrywanie-przyciętego-obrazu-przez-twrp-recovery">Wgrywanie przyciętego obrazu przez TWRP recovery</h3>
<p>Odpalamy smartfon w trybie recovery (TWRP) i upewniamy się, że partycja <code>/system/</code> nie jest
zamontowana oraz, że partycja <code>/data/</code> jest zamontowana. W terminalu na komputerze wpisujemy
poniższe polecenie:</p>
<pre><code># adb push c5-p20-system.orig /data/
</code></pre>
<p>Czekamy, aż plik zostanie przesłany. Następnie wgrywamy ten obraz na urządzenie blokowe
odpowiadające za partycję <code>/system/</code> :</p>
<pre><code># adb shell

~ # dd if=/data/c5-p20-system.orig of=/dev/block/bootdevice/by-name/system
5242880+0 records in
5242880+0 records out
2684354560 bytes (2.5GB) copied, 530.597107 seconds, 4.8MB/s
</code></pre>
<h2 id="sprawdzenie-nowego-układu-partycji-z-poziomu-androida">Sprawdzenie nowego układu partycji z poziomu Androida</h2>
<p>Po wgraniu systemu na smartfon dowolną metodą, restartujemy urządzenie. Telefon będzie się
uruchamiał dłuższą chwilę ale ostatecznie powinniśmy zobaczyć ekran wyboru języka. Przechodzimy
naturalnie przez proces wstępnej konfiguracji telefonu. Następnie sprawdzamy już tylko w ramach
formalności czy system widzi poprawną ilość miejsca na partycji <code>/system/</code> , <code>/cache/</code> i <code>/data/</code> ,
np. w <a href="https://play.google.com/store/apps/details?id=me.kuder.diskinfo">aplikacji
Diskinfo</a>:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2017/04/006.tp-link-neffos-c5-max-flash-repartycjonowanie-diskinfo.png" alt=""    class="huge"></p>
<p>Jak widać repartycjonowanie flash'a w smartfonach Neffos C5 i C5 MAX wyposażonych w system Android w
wersji 5.1 (Lollipop) nie obyło się bez komplikacji. Grunt jednak, że smartfon nie ma problemów już
z nowym układem flash'a, a my odzyskaliśmy 1,5 GiB, które możemy sobie dodatkowo przeznaczyć na dane
użytkownika.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/flash/">flash</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/tp-link/">tp-link</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/smartfon/">smartfon</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/lollipop/">lollipop</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/neffos/">neffos</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&amp;text=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&amp;title=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&amp;title=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&title=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&amp;title=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2frepartycjonowanie-flash-w-neffos-c5-i-c5-max-od-tp-link%2f&description=Repartycjonowanie%20flash%27a%20w%20Neffos%20C5%20i%20C5%20MAX%20od%20TP-LINK" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przeprowadzic-unroot-na-smartfonie-neffos-c5-max-od-tp-link/">Jak przeprowadzić unroot na smartfonie Neffos C5 MAX od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/android-root-smartfona-neffos-c5-max-od-tp-link/">Android: Root smartfona Neffos C5 MAX od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przeprowadzic-unroot-na-smartfonie-neffos-c5-od-tp-link/">Jak przeprowadzić unroot na smartfonie Neffos C5 od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/android-root-smartfona-neffos-c5-od-tp-link/">Android: Root smartfona Neffos C5 od TP-LINK</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/root-w-smartfonach-neffos-od-tp-link-x1-c5-c5-max-y5-y5l/">Root w smartfonach Neffos od TP-LINK (X1, C5, C5 MAX, Y5, Y5L)</a></li>
		
	</ul>
</div>

	

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script data-goatcounter="https://morfik.goatcounter.com/count"
  async src="//gc.zgo.at/count.js"></script>
</body>
</html>
