<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Stałe nazwy urządzeń w OpenWRT (hotplug, udev) | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:url" content="https://morfikov.github.io/post/stale-nazwy-urzadzen-openwrt-hotplug-udev/">
  <meta property="og:site_name" content="Morfitronik">
  <meta property="og:title" content="Stałe nazwy urządzeń w OpenWRT (hotplug, udev)">
  <meta property="og:description" content="Bezprzewodowy router WiFi to w miarę proste urządzenie, które w zasadzie realizuje kilka podstawowych aspektów pracy sieci domowej. Wielu użytkownikom jednak jest nieustannie potrzebna jakaś nowa funkcjonalność, której oryginalny firmware producenta nie oferuje. Dlatego też mamy do dyspozycji OpenWRT będący minimalistyczną formą bardziej rozbudowanej dystrybucji linux&#39;a. Może i OpenWRT daje nam możliwość zaawansowanej konfiguracji naszej sieci ale tego typu opcja powoduje też szereg problemów. Chodzi o to, że kernel dynamicznie tworzy nazwy dla wszystkich podłączanych urządzeń do routera. W dużych dystrybucjach linux&#39;a do ogarnięcia tych nazw wykorzystywany jest UDEV. W przypadku OpenWRT też możemy skorzystać tego mechanizmu. Jeśli jednak mamy niewiele miejsca na pamięci flash routera, to możemy też skorzystać ze zdarzeń hotplug. W tym wpisie postaramy się przepisać nazwy pendrive/dysków twardych oraz modemów USB (LTE), tak by ich kolejność podłączania do routera nie stwarzała problemów w konfiguracji.">
  <meta property="og:locale" content="pl_PL">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2016-06-20T16:46:48+00:00">
    <meta property="article:modified_time" content="2016-06-20T16:46:48+00:00">
    <meta property="article:tag" content="Pendrive">
    <meta property="article:tag" content="Udev">
    <meta property="article:tag" content="Chaos-Calmer">
    <meta property="article:tag" content="Router">
    <meta property="article:tag" content="Modem">
    <meta property="article:tag" content="Huawei">

		
  <meta itemprop="name" content="Stałe nazwy urządzeń w OpenWRT (hotplug, udev)">
  <meta itemprop="description" content="Bezprzewodowy router WiFi to w miarę proste urządzenie, które w zasadzie realizuje kilka podstawowych aspektów pracy sieci domowej. Wielu użytkownikom jednak jest nieustannie potrzebna jakaś nowa funkcjonalność, której oryginalny firmware producenta nie oferuje. Dlatego też mamy do dyspozycji OpenWRT będący minimalistyczną formą bardziej rozbudowanej dystrybucji linux&#39;a. Może i OpenWRT daje nam możliwość zaawansowanej konfiguracji naszej sieci ale tego typu opcja powoduje też szereg problemów. Chodzi o to, że kernel dynamicznie tworzy nazwy dla wszystkich podłączanych urządzeń do routera. W dużych dystrybucjach linux&#39;a do ogarnięcia tych nazw wykorzystywany jest UDEV. W przypadku OpenWRT też możemy skorzystać tego mechanizmu. Jeśli jednak mamy niewiele miejsca na pamięci flash routera, to możemy też skorzystać ze zdarzeń hotplug. W tym wpisie postaramy się przepisać nazwy pendrive/dysków twardych oraz modemów USB (LTE), tak by ich kolejność podłączania do routera nie stwarzała problemów w konfiguracji.">
  <meta itemprop="datePublished" content="2016-06-20T16:46:48+00:00">
  <meta itemprop="dateModified" content="2016-06-20T16:46:48+00:00">
  <meta itemprop="wordCount" content="1818">
  <meta itemprop="keywords" content="Pendrive,Udev,Chaos-Calmer,Router,Modem,Huawei,E3372">
		
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Stałe nazwy urządzeń w OpenWRT (hotplug, udev)">
  <meta name="twitter:description" content="Bezprzewodowy router WiFi to w miarę proste urządzenie, które w zasadzie realizuje kilka podstawowych aspektów pracy sieci domowej. Wielu użytkownikom jednak jest nieustannie potrzebna jakaś nowa funkcjonalność, której oryginalny firmware producenta nie oferuje. Dlatego też mamy do dyspozycji OpenWRT będący minimalistyczną formą bardziej rozbudowanej dystrybucji linux&#39;a. Może i OpenWRT daje nam możliwość zaawansowanej konfiguracji naszej sieci ale tego typu opcja powoduje też szereg problemów. Chodzi o to, że kernel dynamicznie tworzy nazwy dla wszystkich podłączanych urządzeń do routera. W dużych dystrybucjach linux&#39;a do ogarnięcia tych nazw wykorzystywany jest UDEV. W przypadku OpenWRT też możemy skorzystać tego mechanizmu. Jeśli jednak mamy niewiele miejsca na pamięci flash routera, to możemy też skorzystać ze zdarzeń hotplug. W tym wpisie postaramy się przepisać nazwy pendrive/dysków twardych oraz modemów USB (LTE), tak by ich kolejność podłączania do routera nie stwarzała problemów w konfiguracji.">

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
  


</head>
<body class="body kind-page">
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Stałe nazwy urządzeń w OpenWRT (hotplug, udev)</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-06-20T16:46:48Z">Opublikowano: 20/06/2016</time>

<div class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/openwrt/" rel="category">OpenWRT</a>
	</span>
</div>
	</div>
				<h1 class="entry__title">Stałe nazwy urządzeń w OpenWRT (hotplug, udev)</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#problematyczne-nazwy-urządzeń">Problematyczne nazwy urządzeń</a></li>
    <li><a href="#zmiana-nazwy-urządzeń-w-openwrt-przy-pomocy-udeva">Zmiana nazwy urządzeń w OpenWRT przy pomocy UDEV'a</a>
      <ol>
        <li><a href="#zmiana-nazwy-pendrive-i-dysku-twardego">Zmiana nazwy pendrive i dysku twardego</a></li>
        <li><a href="#zmiana-nazwy-modemu">Zmiana nazwy modemu</a></li>
      </ol>
    </li>
    <li><a href="#zmiana-nazwy-urządzeń-w-openwrt-przez-zdarzenia-hotplug">Zmiana nazwy urządzeń w OpenWRT przez zdarzenia hotplug</a>
      <ol>
        <li><a href="#zmiana-nazwy-modemu-1">Zmiana nazwy modemu</a></li>
        <li><a href="#zmiana-nazwy-pendrive-i-dysku-twardego-1">Zmiana nazwy pendrive i dysku twardego</a></li>
        <li><a href="#problemy-ze-zdarzeniami-hotplug">Problemy ze zdarzeniami hotplug</a></li>
      </ol>
    </li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Bezprzewodowy router WiFi to w miarę proste urządzenie, które w zasadzie realizuje kilka
podstawowych aspektów pracy sieci domowej. Wielu użytkownikom jednak jest nieustannie potrzebna
jakaś nowa funkcjonalność, której oryginalny firmware producenta nie oferuje. Dlatego też mamy do
dyspozycji OpenWRT będący minimalistyczną formą bardziej rozbudowanej dystrybucji linux'a. Może i
OpenWRT daje nam możliwość zaawansowanej konfiguracji naszej sieci ale tego typu opcja powoduje też
szereg problemów. Chodzi o to, że kernel dynamicznie tworzy nazwy dla wszystkich podłączanych
urządzeń do routera. W dużych dystrybucjach linux'a do ogarnięcia tych nazw wykorzystywany jest
UDEV. W przypadku OpenWRT też możemy skorzystać tego mechanizmu. Jeśli jednak mamy niewiele miejsca
na pamięci flash routera, to możemy też skorzystać ze zdarzeń hotplug. W tym wpisie postaramy się
przepisać nazwy pendrive/dysków twardych oraz modemów USB (LTE), tak by ich kolejność podłączania do
routera nie stwarzała problemów w konfiguracji.</p>
<h2 id="problematyczne-nazwy-urządzeń">Problematyczne nazwy urządzeń</h2>
<p>Jak zostało już nadmienione w wstępie, kernel linux'a musi jakoś oznaczyć urządzenia, do których się
odwołują programy. Wszystkie te urządzenia znajdują się w katalogu <code>/dev/</code> . Po podpięciu do
routera, np. pendrive, system je rozpoznaje i udostępnia nam kilka interfejsów (pliki w katalogu
<code>/dev/</code> ). Ile tych interfejsów zostanie dodanych, to już zależy generalnie od sprzętu, który
zostanie podłączony. Niemniej jednak, wspólną cechą nazewniczą jest podbijanie numerka końcowego
danej klasy urządzeń. Dla przykładu weźmy sobie wspomniany pendrive lub dysk twardy. Pierwszy dysk
zostanie rozpoznany jako <code>sda</code> , drugi zaś <code>sdb</code> , itd. Każda partycja na takim nośniku jest
numerowana od 1 wzwyż. W taki sposób otrzymujemy <code>sda1</code> , <code>sda2</code> , <code>sdb1</code> , <code>sdb2</code> . Podobnie sprawa
wygląda w przypadku modemów USB. Z tym, że tutaj mamy nazwy typu <code>ttyUSB0</code> , <code>ttyUSB1</code> , itd.
Logiczne jest zatem, że gdy w konfiguracji demona, który działa na routerze, określimy ścieżkę do
urządzenia jako <code>/dev/ttyUSB1</code> , to przy innej kolejności podłączenia urządzeń, ten demon będzie
odwoływał się nie do tego sprzętu co trzeba.</p>
<p>Oczywiście, w przypadku routerów zwykle nie podłączamy całej masy dodatkowego sprzętu, tak jak to ma
miejsce przy standardowych PC. Niemnie jednak, OpenWRT zachęca do eksperymentów i ani się nie
obejrzymy, a taki router pod względem funkcjonalności zacznie przypominać nasz desktop. Wypadałoby
zatem pomyśleć już zawczasu, jak rozwiązać kwestię nazywania sprzętu oraz tego, by te nazwy były
stałe i powiązane z konkretnym urządzeniem. Wtedy mielibyśmy pewność, że konfiguracja, np. demona
wysyłającego i odbierającego SMS, działa bez względu na to w jakiej kolejności podłączymy urządzenia
do routera.</p>
<p>W OpenWRT mamy dostępny pakiet <code>udev</code> i można skorzystać z tego narzędzia pisząc odpowiednie reguły,
które przepiszą nazwy urządzeń. Niemniej jednak, nie jest to jedyny sposób. Szukając rozwiązania,
trafiłem także na <a href="http://eko.one.pl/?p=openwrt-linkidoportowszeregowych">ten wpis</a>. Zdaje się on
adresować po części ten problem, któremu i nam przyszło stawić czoła. W podlinkowanym artykule jest
jedynie informacja dotycząca bezpośrednio samych modemów USB ale nam to raczej nie powinno
przeszkadzać i myślę, że uda nam się wypracować jakieś rozsądne rozwiązanie ułatwiające operowanie
na urządzeniach podłączanych do routera domowego.</p>
<h2 id="zmiana-nazwy-urządzeń-w-openwrt-przy-pomocy-udeva">Zmiana nazwy urządzeń w OpenWRT przy pomocy UDEV'a</h2>
<p>Jednym z bardziej wyrafinowanych rozwiązań jest zaimplementowanie na routerze mechanizmu UDEV. Wiąże
się to z zainstalowaniem kilku pakietów ważących łącznie około 300-400 KiB. Jeśli mamy tyle miejsca
na flash'u, to wgrajmy sobie te poniższe pakiety (zależności zostaną automatycznie pociągnięte):</p>
<pre><code># opkg update
# opkg install udev blkid
</code></pre>
<p>W wersji Chaos Calmer jest jaki błąd związany z <code>blkid</code> . Chodzi generalnie o ścieżkę dostępu do
pliku wykonywalnego. W efekcie w logu UDEV'a pojawia się ten poniższy
komunikat:</p>
<pre><code>[2252.968182] [2080] spawn_read: '/sbin/blkid -o udev -p /dev/sda'(err) 'failed to execute '/sbin/blkid' '/sbin/blkid -o udev -p /dev/sda': No such file or directory'
</code></pre>
<p>Plik o który chodzi to <code>/sbin/blkid</code> ale pakiet <code>blkid</code> wgrywa ten plik do <code>/usr/sbin/blkid</code> .
Możemy to w prosty sposób poprawić linkując ten plik do wskazanej lokalizacji:</p>
<pre><code># ln -s /usr/sbin/blkid /sbin/blkid
</code></pre>
<p>Problem jest też w samym UDEV'ie, bo ten nie ma dostarczanego skryptu startowego. W efekcie demon
<code>udevd</code> nie jest uruchamiany wraz ze startem routera. Musimy zatem sobie taki <a href="https://morfikov.github.io/post/skrypty-startowe-init-w-openwrt/">skrypt startowy
napisać</a>. W tym celu tworzymy plik
<code>/etc/init.d/udevd</code> i wrzucamy do niego poniższy kod:</p>
<pre><code>#!/bin/sh /etc/rc.common

START=05

start() {
    /sbin/udevd --daemon
}
</code></pre>
<p>Nadajemy skryptowi prawa wykonywania ( <code>chmod +x</code> ) oraz dodajemy go do autostartu:</p>
<pre><code># /etc/init.d/udevd enable
</code></pre>
<h3 id="zmiana-nazwy-pendrive-i-dysku-twardego">Zmiana nazwy pendrive i dysku twardego</h3>
<p>Poniżej jest przykład rozpoznania przez system routera pendrive (log pochodzi z <code>logread</code>
):</p>
<pre><code>kern.info kernel: [   93.730000] usb 1-1.2: new high-speed USB device number 3 using ehci-platform
kern.info kernel: usb-storage 1-1.2:1.0: USB Mass Storage device detected
kern.info kernel: scsi host0: usb-storage 1-1.2:1.0
kern.notice kernel: scsi 0:0:0:0: Direct-Access     Kingston DataTraveler 3.0 PMAP PQ: 0 ANSI: 6
kern.notice kernel: sd 0:0:0:0: [sda] 15360000 512-byte logical blocks: (7.86 GB/7.32 GiB)
kern.notice kernel: sd 0:0:0:0: [sda] Write Protect is off
kern.debug kernel: sd 0:0:0:0: [sda] Mode Sense: 23 00 00 00
kern.err kernel: sd 0:0:0:0: [sda] No Caching mode page found
kern.err kernel: sd 0:0:0:0: [sda] Assuming drive cache: write through
kern.info kernel:  sda: sda1 sda2 sda3
kern.notice kernel: sd 0:0:0:0: [sda] Attached SCSI removable disk
</code></pre>
<p>Mamy zatem dysk <code>sda</code> z trzema partycjami <code>sda1</code> , <code>sda2</code> oraz <code>sda3</code> . W przypadku, gdy chcemy, by
te poszczególne partycje miały prefiks <code>king</code> , musimy <a href="https://morfikov.github.io/post/udev-czyli-jak-pisac-reguly-dla-urzadzen/">utworzyć stosowne reguły dla
UDEV'a</a>. Nie będę tutaj opisywał
całej procedury tworzenia reguł ale jeśli ktoś jest ciekaw jak ten proces przebiega, to zapraszam
pod podlinkowany wyżej artykuł. Tutaj ograniczymy się jedynie do stworzenia pliku reguły w
<code>/etc/udev/rules.d/90-dysk.rules</code> . Do tego pliku wrzucamy poniższą zawartość:</p>
<pre><code>ACTION==&quot;add&quot;, SUBSYSTEM==&quot;block&quot;, \
    ENV{ID_SERIAL_SHORT}==&quot;0019E06B9C8ABE41C7A2C3EC&quot;, \
    SYMLINK+=&quot;king%n&quot;
</code></pre>
<p>Zmienna <code>ENV{ID_SERIAL_SHORT}</code> odpowiada za numer seryjny pendrive. Możemy go odczytać w poniższy
sposób:</p>
<pre><code># udevadm info --name /dev/sda --attribute-walk | grep -i serial
    ATTRS{serial}==&quot;0019E06B9C8ABE41C7A2C3EC&quot;
</code></pre>
<p>Po uzupełnieniu pliku, musimy jeszcze przeładować reguły UDEV'a:</p>
<pre><code># udevadm control --reload
</code></pre>
<p>No i oczywiście wyciągamy i podłączamy ponownie pendrive. Po chwili nowe nazwy urządzeń powinny
widnieć w katalogu <code>/dev/</code> :</p>
<pre><code># ls -al /dev/king*
lrwxrwxrwx    1 root     root             3 Jun 20 13:10 /dev/king -&gt; sda
lrwxrwxrwx    1 root     root             4 Jun 20 13:13 /dev/king1 -&gt; sda1
lrwxrwxrwx    1 root     root             4 Jun 20 13:14 /dev/king2 -&gt; sda2
lrwxrwxrwx    1 root     root             4 Jun 20 13:14 /dev/king3 -&gt; sda3
</code></pre>
<h3 id="zmiana-nazwy-modemu">Zmiana nazwy modemu</h3>
<p>Drugim popularnym urządzeniem podpinanym do portów USB routera jest modem LTE. W tym przypadku mamy
model Huawei E3372s-153 w wersji NON-HiLink. Jest on wykrywany przez OpenWRT w poniższy
sposób:</p>
<pre><code>kern.info kernel: [ 4118.360000] usb 1-1.2: new high-speed USB device number 9 using ehci-platform
kern.info kernel: option 1-1.2:1.0: GSM modem (1-port) converter detected
kern.info kernel: usb 1-1.2: GSM modem (1-port) converter now attached to ttyUSB0
kern.info kernel: option 1-1.2:1.1: GSM modem (1-port) converter detected
kern.info kernel: usb 1-1.2: GSM modem (1-port) converter now attached to ttyUSB1
kern.info kernel: usb-storage 1-1.2:1.3: USB Mass Storage device detected
kern.info kernel: scsi host6: usb-storage 1-1.2:1.3
kern.notice kernel: scsi 6:0:0:0: Direct-Access     HUAWEI   TF CARD Storage  2.31 PQ: 0 ANSI: 2
kern.notice kernel: sd 6:0:0:0: [sda] Attached SCSI removable disk
</code></pre>
<p>Widzimy wyżej, że zostały utworzone dwa interfejsy <code>ttyUSB0</code> oraz <code>ttyUSB1</code> . To właśnie te dwie
nazwy musimy przepisać. Trzeba jednak pamiętać, że modem USB może mieć więcej interfejsów w
zależności od konfiguracji urządzenia. Tak czy inaczej, podobnie jak w przypadku pendrive, musimy
pokusić się o napisanie odpowiedniej reguły, która przepisze nazwy wszystkich interfejsów tego
urządzenia. Tworzymy zatem plik <code>/etc/udev/rules.d/90-modem.rules</code> i wrzucamy do niego poniższą
zawartość:</p>
<pre><code>ACTION==&quot;add&quot;, KERNEL==&quot;ttyUSB?&quot;, SUBSYSTEM==&quot;tty&quot;, \
    ENV{ID_VENDOR_ID}==&quot;12d1&quot;, \
    ENV{ID_MODEL_ID}==&quot;15b6&quot;, \
    SYMLINK+=&quot;huawei-E3372-%n&quot;
</code></pre>
<p>Zmienne <code>ENV{ID_VENDOR_ID}</code> oraz <code>ENV{ID_MODEL_ID}</code> możemy odczytać w poniższy sposób:</p>
<pre><code># udevadm info --name /dev/ttyUSB0 --attribute-walk | egrep &quot;idV|idP&quot;
    ATTRS{idVendor}==&quot;12d1&quot;
    ATTRS{idProduct}==&quot;15b6&quot;
    ATTRS{idVendor}==&quot;05e3&quot;
    ATTRS{idProduct}==&quot;0608&quot;
    ATTRS{idVendor}==&quot;1d6b&quot;
    ATTRS{idProduct}==&quot;0002&quot;
</code></pre>
<p>Mamy tutaj kilka identyfikatorów. Nas jednak interesują te dwa pierwsze. Na koniec przeładowujemy
konfigurację UDEV'a</p>
<pre><code># udevadm control --reload
</code></pre>
<p>Wyciągamy teraz modem LTE z portu USB i podłączamy go ponownie. W katalogu <code>/dev/</code> powinny widnieć
teraz poniższe urządzenia:</p>
<pre><code>/# ls -al /dev/ | grep huawei
lrwxrwxrwx    1 root     root             7 Jun 20 14:22 huawei-E3372-0 -&gt; ttyUSB0
lrwxrwxrwx    1 root     root             7 Jun 20 14:22 huawei-E3372-1 -&gt; ttyUSB1
</code></pre>
<h2 id="zmiana-nazwy-urządzeń-w-openwrt-przez-zdarzenia-hotplug">Zmiana nazwy urządzeń w OpenWRT przez zdarzenia hotplug</h2>
<p>Jeśli nie mamy na flash'u routera wystarczającej ilości miejsca, to możemy odpuścić sobie sposób z
przepisywaniem nazw przy pomocy UDEV'a. Alternatywą jest skorzystanie ze <a href="https://wiki.openwrt.org/doc/techref/hotplug">zdarzeń
hotplug</a>. W OpenWRT, hotplug zastępuje mechanizm
UDEV'a, który zaimplementowaliśmy wyżej. Nie musimy też instalować żadnych dodatkowych pakietów.</p>
<p>Hotplug wykonuje skrypty zlokalizowane w katalogu <code>/etc/hotplug.d/</code> w momencie zaistnienia
określonego zdarzenia, np. podniesienie interfejsu sieciowego, przyciśnięcie jakiegoś przycisku na
routerze, czy też wykrycie jakiegoś urządzenia. W w/w katalogu mamy kilka podkatalogów. Jako, że my
chcemy przepisywać nazwy urządzeń podpiętych do portu USB, to interesuje nas katalog
<code>/etc/hotplug.d/usb/</code> (modemy) oraz <code>/etc/hotplug.d/block/</code> (dyski/pendrive). W zależności od
urządzenia, wybieramy odpowiedni folder i tworzymy w nim plik <code>10-env</code> . Następnie wrzucamy do
niego poniższą treść:</p>
<pre><code>#!/bin/sh
echo &quot;----&quot; &gt;&gt; /tmp/env
env &gt;&gt; /tmp/env
</code></pre>
<p>W pliku <code>/tmp/env</code> znajdować się będzie szereg zmiennych, w oparciu o które będziemy mogli napisać
skrypt.</p>
<h3 id="zmiana-nazwy-modemu-1">Zmiana nazwy modemu</h3>
<p>Podłączamy teraz do portu USB modem LTE i zaglądamy do pliku <code>/tmp/env</code> :</p>
<pre><code>----
UDEV_LOG=3
USER=root
ACTION=add
SHLVL=2
HOME=/
SEQNUM=497
HOTPLUG_TYPE=usb
DEVPATH=/devices/platform/ehci-platform/usb1/1-1/1-1.2/1-1.2:1.2
DEVICENAME=1-1.2:1.2
LOGNAME=root
TERM=linux
SUBSYSTEM=usb
board=TL-WDR4300
PATH=/usr/sbin:/usr/bin:/sbin:/bin
MODALIAS=usb:v12D1p15B6d0102dc00dsc00dp00icFFisc03ip16in02
TYPE=0/0/0
INTERFACE=255/3/22
PRODUCT=12d1/15b6/102
PWD=/
DEVTYPE=usb_interface
</code></pre>
<p>Widzimy tutaj szereg zmiennych, które są przekazywane do skryptu, który ma się wykonać w momencie
podłączenia modemu LTE do portu USB. W oparciu o te zmienne możemy zatem napisać instrukcję, która
będzie aplikowana jedynie w przypadku konkretnego urządzenia. Poniżej jest przykładowy kod, który
zapisujemy w <code>/etc/hotplug.d/usb/10-serial</code> :</p>
<pre><code>#!/bin/sh
if [ &quot;$DEVTYPE&quot; = &quot;usb_interface&quot; ] &amp;&amp; [ &quot;$ACTION&quot; = &quot;add&quot; ]; then
    for tty in /sys/$DEVPATH/ttyUSB*; do
        [ -d &quot;$tty&quot; ] || continue
        OLDD=${tty##*/}

        # to jest E3372s-153
        if [ &quot;x$PRODUCT&quot; = &quot;x12d1/15b6/102&quot; ]; then
            NEWD=&quot;modem_e3372s_&quot;${DEVPATH##*.}
            rm /dev/$NEWD
            ln -s /dev/$OLDD /dev/$NEWD
        fi
    done
fi
</code></pre>
<p>Instrukcja warunkowa pod <code># to jest E3372s-153</code> odnosi się tylko tego konkretnego modemu. Jeśli mamy
kilka różnych modemów USB, musimy dodać kolejne instrukcje i odpowiednio dostosować warunek. Efektem
są poniższe dowiązania w katalogu <code>/dev/</code> :</p>
<pre><code>/# ls -al /dev/modem*
lrwxrwxrwx    1 root     root            12 Jun 20 15:14 /dev/modem_e3372s_0 -&gt; /dev/ttyUSB0
lrwxrwxrwx    1 root     root            12 Jun 20 15:14 /dev/modem_e3372s_1 -&gt; /dev/ttyUSB1
</code></pre>
<h3 id="zmiana-nazwy-pendrive-i-dysku-twardego-1">Zmiana nazwy pendrive i dysku twardego</h3>
<p>Jeśli chcemy przepisać nazwy urządzeń takich jak pendrive czy dyski twarde przy pomocy zdarzeń
hotplug, to musimy nieco bardziej wytężyć nasz umysł. Chodzi generalnie o to, że skrypt <code>10-env</code>
umieszczony w katalogu <code>/etc/hotplug.d/block/</code> nie zwróci nam ani numeru seryjnego urządzenia, ani
też żadnego identyfikatora (VendorID, ProductID). Poniżej są zmienne, które zostały zalogowane po
podłączeniu pendrive do routera:</p>
<pre><code>----
DEVNAME=sda3
USER=root
ACTION=add
SHLVL=2
HOME=/
SEQNUM=502
HOTPLUG_TYPE=block
MAJOR=8
DEVPATH=/devices/platform/ehci-platform/usb1/1-1/1-1.2/1-1.2:1.0/host0/target0:0:0/0:0:0:0/block/sda/sda3
DEVICENAME=sda3
LOGNAME=root
TERM=linux
SUBSYSTEM=block
board=TL-WDR4300
PATH=/usr/sbin:/usr/bin:/sbin:/bin
MINOR=3
PWD=/
DEVTYPE=partition
</code></pre>
<p>Niemniej jednak, numer seryjny pendrive możemy wyciągnąć odpowiednio zmieniając ścieżkę w zmiennej
<code>$DEVPATH</code> . Mając numer seryjny, możemy napisać warunek. Poniżej przykładowy skrypt, który
umieszczamy w pod <code>/etc/hotplug.d/block/10-pen</code> :</p>
<pre><code>#!/bin/sh

new_devpath=&quot;$(echo &quot;$DEVPATH&quot; | cut -d/ -f 1-7)&quot;
serial=&quot;$(cat /sys/$new_devpath/serial)&quot;

if [ &quot;$serial&quot; = &quot;0019E06B9C8ABE41C7A2C3EC&quot; ] &amp;&amp; [ &quot;$ACTION&quot; = &quot;add&quot; ]; then

    old_dev=&quot;$DEVICENAME&quot;
    new_dev=&quot;king&quot;${DEVICENAME##sd[a-z]}

    rm /dev/$new_dev
    ln -s /dev/$old_dev /dev/$new_dev

fi
</code></pre>
<h3 id="problemy-ze-zdarzeniami-hotplug">Problemy ze zdarzeniami hotplug</h3>
<p>Wszystkie linki utworzone za pomocą mechanizmu hotplug nie są usuwane przy wyciąganiu urządzenia z
portu USB. W ten sposób inne urządzenie podpięte do portu USB może przejąc te linki i o tym trzeba
pamiętać. Niemniej jednak, gdy podłączymy urządzenie, do którego skrypt ma się odwołać, to te stare
linki zostaną zaktualizowane.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/pendrive/">Pendrive</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/udev/">Udev</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/chaos-calmer/">Chaos-Calmer</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/router/">Router</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/modem/">Modem</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/huawei/">Huawei</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/e3372/">E3372</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&amp;text=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&amp;title=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&amp;title=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&title=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&amp;title=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fstale-nazwy-urzadzen-openwrt-hotplug-udev%2f&description=Sta%c5%82e%20nazwy%20urz%c4%85dze%c5%84%20w%20OpenWRT%20%28hotplug%2c%20udev%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/obsluga-sms-kodow-ussd-w-openwrt/">Obsługa SMS i kodów USSD w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/monitor-polaczenia-3glte-w-openwrt-3ginfo/">Monitor połączenia 3G/LTE W OpenWRT (3ginfo)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-polaczenia-aero2-na-openwrt/">Konfiguracja połączenia Aero2 na OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/modem-lte-pod-openwrt/">Modem LTE pod OpenWRT (Huawei E3372s-153)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zmiana-nazwy-interfejsu-modemu-ttyusb0/">Zmiana nazwy interfejsu modemu ttyUSB0</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/smstools-smsd-automat-wysylania-sms/">SMStools i smsd, czyli automat do wysyłania SMS</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przypisac-losowy-adres-mac-interfejsu/">Jak przypisać losowy adres MAC do interfejsu</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://mastodon.social/@morfik">
			<svg class="social__icon" aria-label="Mastodon" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M416 197c0-74-49-96-49-96-42-22-172-24-222 0 0 0-49 22-49 96v59c2 72 14 145 81 162 33 9 89 18 140-6l-2-27s-27 7-58 7c-74 2-67-39-70-52 0 0 51 17 137 6 42-6 80-32 85-56 8-38 7-93 7-93zm-58 96h-35v-88c0-18-8-27-23-27-18 0-27 11-27 33v47h-34v-47c0-22-9-33-27-33-15 0-23 9-23 27v88h-35v-91c0-18 5-60 52-60 39 0 50 37 50 37s10-37 50-37c45 0 52 42 52 60v91z"/></svg>
		</a>
</div>
	<div class="footer__copyright">© 2025 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
