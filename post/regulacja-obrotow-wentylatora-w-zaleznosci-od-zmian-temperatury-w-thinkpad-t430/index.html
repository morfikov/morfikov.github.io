<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430 | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430" />
<meta property="og:description" content="Ostatnio udało mi się nabyć dość niedrogo laptop Lenovo, a konkretnie był to model ThinkPad T430.
Maszyna jakby nie patrzeć jest bardzo kompatybilna z linux i w zasadzie nie mogę jej nic zarzucić,
przynajmniej póki co. Niemniej jednak, jest pewien szkopuł, który mnie zaczął ździebko irytować od
praktycznie samego początku jak tylko podłączyłem ten komputer do prądu. Chodzi o wentylator
chłodzący radiator procesora, który no troszkę daje o sobie znać i to mimo faktu, że temperatura
CPU jest w granicach 40 stopni. Przeglądając opcje w BIOS nie natrafiłem na nic co mogło by te
obroty wyregulować. Na szczęście w przypadku laptopów Lenovo można programowo zdefiniować obroty
wiatraka posługując się narzędziem thinkfan." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/regulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430/" />
<meta property="article:published_time" content="2020-02-28T23:00:00+00:00" />
<meta property="article:modified_time" content="2020-02-28T23:00:00+00:00" />

		<meta itemprop="name" content="Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430">
<meta itemprop="description" content="Ostatnio udało mi się nabyć dość niedrogo laptop Lenovo, a konkretnie był to model ThinkPad T430.
Maszyna jakby nie patrzeć jest bardzo kompatybilna z linux i w zasadzie nie mogę jej nic zarzucić,
przynajmniej póki co. Niemniej jednak, jest pewien szkopuł, który mnie zaczął ździebko irytować od
praktycznie samego początku jak tylko podłączyłem ten komputer do prądu. Chodzi o wentylator
chłodzący radiator procesora, który no troszkę daje o sobie znać i to mimo faktu, że temperatura
CPU jest w granicach 40 stopni. Przeglądając opcje w BIOS nie natrafiłem na nic co mogło by te
obroty wyregulować. Na szczęście w przypadku laptopów Lenovo można programowo zdefiniować obroty
wiatraka posługując się narzędziem thinkfan.">
<meta itemprop="datePublished" content="2020-02-28T23:00:00+00:00" />
<meta itemprop="dateModified" content="2020-02-28T23:00:00+00:00" />
<meta itemprop="wordCount" content="2006">



<meta itemprop="keywords" content="debian,acpi,thinkpad,lenovo,t430," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430"/>
<meta name="twitter:description" content="Ostatnio udało mi się nabyć dość niedrogo laptop Lenovo, a konkretnie był to model ThinkPad T430.
Maszyna jakby nie patrzeć jest bardzo kompatybilna z linux i w zasadzie nie mogę jej nic zarzucić,
przynajmniej póki co. Niemniej jednak, jest pewien szkopuł, który mnie zaczął ździebko irytować od
praktycznie samego początku jak tylko podłączyłem ten komputer do prądu. Chodzi o wentylator
chłodzący radiator procesora, który no troszkę daje o sobie znać i to mimo faktu, że temperatura
CPU jest w granicach 40 stopni. Przeglądając opcje w BIOS nie natrafiłem na nic co mogło by te
obroty wyregulować. Na szczęście w przypadku laptopów Lenovo można programowo zdefiniować obroty
wiatraka posługując się narzędziem thinkfan."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2020-02-28T23:00:00Z">Opublikowano: 28/02/2020</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Regulacja obrotów wentylatora w zależności od zmian temperatury w ThinkPad T430</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#moduł-thinkpad_acpi-i-parametr-fan_control">Moduł thinkpad_acpi i parametr fan_control</a></li>
    <li><a href="#konfiguracja-thinkfan">Konfiguracja thinkfan</a>
      <ol>
        <li><a href="#wybór-wentylatora">Wybór wentylatora</a></li>
        <li><a href="#wybór-czujnikaczujników-temperatury">Wybór czujnika/czujników temperatury</a>
          <ol>
            <li><a href="#regulacja-czujników-temperatury">Regulacja czujników temperatury</a></li>
          </ol>
        </li>
        <li><a href="#regulacja-obrotów-wentylatora">Regulacja obrotów wentylatora</a></li>
      </ol>
    </li>
    <li><a href="#monitorowanie-temperatury-z-thinkfan">Monitorowanie temperatury z thinkfan</a></li>
    <li><a href="#zamiana-modułów-i-zmiana-ścieżek">Zamiana modułów i zmiana ścieżek</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Ostatnio udało mi się nabyć dość niedrogo laptop Lenovo, a konkretnie był to model ThinkPad T430.
Maszyna jakby nie patrzeć jest bardzo kompatybilna z linux i w zasadzie nie mogę jej nic zarzucić,
przynajmniej póki co. Niemniej jednak, jest pewien szkopuł, który mnie zaczął ździebko irytować od
praktycznie samego początku jak tylko podłączyłem ten komputer do prądu. Chodzi o wentylator
chłodzący radiator procesora, który no troszkę daje o sobie znać i to mimo faktu, że temperatura
CPU jest w granicach 40 stopni. Przeglądając opcje w BIOS nie natrafiłem na nic co mogło by te
obroty wyregulować. Na szczęście w przypadku laptopów Lenovo można programowo zdefiniować obroty
wiatraka posługując się narzędziem <a href="https://github.com/vmatare/thinkfan">thinkfan</a>.</p>
<h2 id="moduł-thinkpad_acpi-i-parametr-fan_control">Moduł thinkpad_acpi i parametr fan_control</h2>
<p>Zanim jednak zajmiemy się samym oprogramowaniem <code>thinkfan</code> , musimy sobie odpowiednio skonfigurować
system. Ze wstępnych ustaleń wynika, że zarządzanie wentylatorem pod linux w tym ThinkPad T430
zajmuje się moduł kernela <code>thinkpad_acpi</code> . Standardowo jednak ten moduł nie jest skonfigurowany w
taki sposób, aby było można ręcznie dostosować obroty wiatraka w zależności od temperatury
procesora, co pokazuje poniższa rozpiska wartości parametrów samego modułu:</p>
<pre><code># systool -v -m thinkpad_acpi
Module = &quot;thinkpad_acpi&quot;
...
  Parameters:
    ...
    fan_control         = &quot;N&quot;
    ...
</code></pre>
<p>Jak można zauważyć, wyżej mamy <code>fan_control=&quot;N&quot;</code> . Trzeba zatem wartość tego parametru przepisać i
ustawić ją na <code>&quot;Y&quot;</code> . W tym celu trzeba stworzyć konfigurację dla modułu w pliku
<code>/etc/modprobe.d/thinkpad.conf</code> i dorzucić w nim tę poniższą linijkę:</p>
<pre><code>options thinkpad_acpi fan_control=1
</code></pre>
<p>Po uzupełnieniu powyższego pliku trzeba będzie zresetować maszynę, by nowe ustawienia modułu
zostały zaaplikowane.</p>
<p>Na necie można się spotkać także z zaleceniem/wymogiem przestawienia opcji <code>experimental</code> na <code>&quot;Y&quot;</code> .
Nie wiem czy to dobry pomysł. Jeśli z jakiegoś powodu nie będziemy mogli sterować obrotami
wentylatora, to sprawdźmy czy czasem aby na pewno napisaliśmy ten parametr prawidłowo. Ja z
początku wpisałem <code>fancontrol</code> zamiast <code>fan_control</code> i po tej drobnej poprawce wszystko już zaczęło
ładnie śmigać.</p>
<h2 id="konfiguracja-thinkfan">Konfiguracja thinkfan</h2>
<p>Mając przygotowany moduł kernela, możemy przejść do konfiguracji narzędzia <code>thinkfan</code> . Jeśli nie
mamy go jeszcze zainstalowanego, to znajduje się on w pakiecie <code>thinkfan</code> (przynajmniej na
Debianie). Z procesem instalacyjnym raczej nie powinno być problemów, zatem przejdźmy od razu do
pliku <code>/etc/thinkfan.conf</code> . Konfiguracja w zasadzie składa się z trzech części.</p>
<h3 id="wybór-wentylatora">Wybór wentylatora</h3>
<p>Po pierwsze, musimy określić wentylator, na którym zamierzamy operować. Póki co możemy zdefiniować
tylko jedno urządzenie (choć nic nie stoi na przeszkodzie, by stworzyć kilka plików
konfiguracyjnych i uruchomić demona kilka razy). By określić pożądane urządzenie potrzebny nam
będzie odpowiedni sterownik ( <code>tp_fan</code> lub <code>pwm_fan</code> ) oraz ścieżka do pliku w katalogu <code>/proc/</code>
lub <code>/sys/</code> . To z którego sterownika skorzystamy, zależy głównie od naszych preferencji.  Niemniej
jednak, każdy z tych sterowników konfiguruje się nieco inaczej. Poniżej jest przykładowa
konfiguracja dla obu sterowników, którą trzeba dodać do pliku <code>/etc/thinkfan.conf</code> (wybrać należy
sobie jeden wpis):</p>
<pre><code>tp_fan /proc/acpi/ibm/fan
pwm_fan /sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/pwm1
</code></pre>
<p>O ile w przypadku sterownika <code>tp_fan</code> ścieżka zawsze będzie ta sama, tj. <code>/proc/acpi/ibm/fan</code> , o
tyle w przypadku <code>pwm_fan</code> odpowiednią ścieżkę trzeba sobie ustalić ręcznie przy pomocy tego
poniższego polecenia:</p>
<pre><code># find /sys -type f -name &quot;pwm?&quot;
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/pwm1
</code></pre>
<h3 id="wybór-czujnikaczujników-temperatury">Wybór czujnika/czujników temperatury</h3>
<p>Z reguły w każdym komputerze jest dostępnych wiele czujników temperatury. W przypadku, gdy w pliku
<code>/etc/thinkfan.conf</code> nie określimy żadnego czujnika temperatury, to <code>thinkfan</code> będzie operował na
najwyższych wartościach temperatury jakie uda mu się pozyskać z systemu. Tego typu zachowanie może
niekoniecznie być pożądane i przydałoby się określić te czujniki, które nas interesują najbardziej,
czyli procesor lub bezpośrednio jego rdzenie.</p>
<p>Podobnie jak w przypadku sterownika wentylatora, musimy wybrać sterownik czujnika temperatury oraz
podać odpowiedni plik w katalogu <code>/proc/</code> lub <code>/sys/</code> . Jeśli chodzi o sterowniki to mamy do wyboru
<code>tp_thermal</code> , <code>hwmon</code> , <code>atasmarti</code> oraz <code>nv_thermal</code> . Z reguły będą nas interesować tylko te dwa
pierwsze sterowniki, bo <code>atasmarti</code> odnosi się do temperatury dysku twardego odczytanej ze SMART
(trzeba podać ścieżkę typu <code>/dev/sda</code> ), zaś <code>nv_thermal</code> odnosi się do kart graficznych Nvidia
(potrzebne ID szyny PCI odczytane z <code>lspci</code> ). Jako, że nas tutaj interesuje głównie temperatura
głównego CPU, to w <code>/etc/thinkfan.conf</code> musimy określić sobie albo <code>tp_thermal</code> :</p>
<pre><code>tp_thermal  /proc/acpi/ibm/thermal
</code></pre>
<p>albo <code>hwmon</code> :</p>
<pre><code>hwmon /sys/devices/platform/coretemp.0/hwmon/hwmon1/temp1_input
hwmon /sys/devices/platform/coretemp.0/hwmon/hwmon1/temp2_input
hwmon /sys/devices/platform/coretemp.0/hwmon/hwmon1/temp3_input
</code></pre>
<p>Jeśli nie wiemy jakie czujniki temperatur ma nasz ThinkPad, to możemy albo podejrzeć wyjście
polecenia <code>sensors</code> (potrzebny pakiet <code>lm-sensros</code> ):</p>
<pre><code># sensors

acpitz-acpi-0
Adapter: ACPI interface
temp1:        +39.0°C  (crit = +104.0°C)

thinkpad-isa-0000
Adapter: ISA adapter
fan1:           0 RPM
temp1:        +39.0°C
temp2:         +0.0°C
temp3:         +0.0°C
temp4:         +0.0°C
temp5:         +0.0°C
temp6:         +0.0°C
temp7:         +0.0°C
temp8:         +0.0°C

coretemp-isa-0000
Adapter: ISA adapter
Package id 0:  +41.0°C  (high = +87.0°C, crit = +105.0°C)
Core 0:        +37.0°C  (high = +87.0°C, crit = +105.0°C)
Core 1:        +43.0°C  (high = +87.0°C, crit = +105.0°C)
</code></pre>
<p>albo też skorzystać z poniższego polecenia:</p>
<pre><code># find /sys -type f -name &quot;temp*_input&quot;
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp6_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp3_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp7_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp4_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp8_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp1_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp5_input
/sys/devices/platform/thinkpad_hwmon/hwmon/hwmon3/temp2_input
/sys/devices/virtual/thermal/thermal_zone0/hwmon0/temp1_input
/sys/devices/platform/coretemp.0/hwmon/hwmon1/temp3_input
/sys/devices/platform/coretemp.0/hwmon/hwmon1/temp1_input
/sys/devices/platform/coretemp.0/hwmon/hwmon1/temp2_input
</code></pre>
<p>W tym przypadku moduł <code>coretemp-isa</code> jest w stanie podać nam dokładne wskazania temperatury dla
konkretnych rdzeni CPU oraz ogólnie dla całego procesora. Są to te trzy ostatnie wpisy wyżej i to
je określiłem w konfiguracji <code>thinkfan</code> . Jeśli interesują nas też i inne czujniki, to również
trzeba je dodać do konfiguracji w pliku <code>/etc/thinkfan.conf</code> .</p>
<p>W tym powyższym przykładzie monitorowaniu zostaną poddane trzy czujniki. Jeśli wskazania któregoś z
nich przekroczą 40 stopni, to wtedy wentylator powinien się załączyć. Z kolei wentylator wyłączy
się dopiero w momencie, gdy wszystkie trzy czujniki zejdą poniżej 38 stopni.</p>
<h4 id="regulacja-czujników-temperatury">Regulacja czujników temperatury</h4>
<p>Temperatura poszczególnych układów czy urządzeń wewnątrz obudowy laptopa może się dość drastycznie
różnić. Dlatego też <code>thinkfan</code> ma opcję regulacji czujników temperatury. Dla przykładu weźmy sobie
dysk twardy oraz główny procesor. Zakresy temperatur, w których te urządzenia mogą pracować jest
powiedzmy od 0-100°C dla CPU, natomiast dla dysku będzie to od 0-55°C. W spoczynku te dwa
urządzenia będą mieć zbliżoną temperaturę około 35-40°C. Niemniej jednak, jeśli zaczniemy
utylizować dość mocno procesor, to jego temperatura może wzrosnąć nam i do 70°C (i więcej). W
przypadku intensywnego wykorzystania dysku twardego, jego temperatura może wzrosnąć do 45-50°C.</p>
<p>Pojawia się tutaj problem różnicy temperatur i interpretacji wartości przez <code>thinkfan</code> -- nie wie
on z jakim urządzeniem ma do czynienia i jakie temperatury pracy są dla niego odpowiednie. Procesor
przy 45-50°C może pracować bez problemu i nawet nie trzeba kręcić wiatrakiem na full w takich
warunkach ale gdyby dysk już złapał taką temperaturę, to trzeba by podkręcić nieco obroty, by
wymusić przepływ powietrza w obudowie laptopa, co powinno schłodzić dysk. Dlatego też przy każdym
czujniku temperatury w pliku <code>/etc/thinkfan.conf</code> możemy podać korektę, tak by <code>thinkfan</code> zaczął
mocniej obracać wentylatorem, gdy temperatura dysku wzrośnie do 45°C, a temperatura procesora do
60°C. Poniżej jest przykład korekty:</p>
<pre><code>tp_thermal /proc/acpi/ibm/thermal (0, 10, 15, 2, 10, 5, 0, 3, 0, 3)
</code></pre>
<p>W tym przypadku korekta ma wiele wartości, bo sam plik <code>/proc/acpi/ibm/thermal</code> ma ich sporo.
Liczba wartości w nawiasie musi się zgadzać z tym co jest w pliku. Jeśli w pliku by była jedna
wartość, to w nawiasie precyzujemy tylko jedną liczbę. Same liczby zaś mogą być dodatnie lub
ujemne.</p>
<h3 id="regulacja-obrotów-wentylatora">Regulacja obrotów wentylatora</h3>
<p>Z reguły dobór czujnika temperatury i wentylatora odbywa się bez większych problemów i raczej nie
będzie potrzeby określania ich. Oczywiście nic nie stoi na przeszkodzie by to zrobić ręcznie.
Niemniej jednak, trzeba jeszcze powiązać prędkość obrotów wentylatora ze wskazaniami czujników
temperatury. Trzeba mieć jednak na uwadze, że tutaj ma ogromne znaczenie to, z jakiego sterownika
wentylatora korzystamy, tj. czy mamy w użyciu <code>tp_fan</code> czy też <code>pwm_fan</code> . Dla każdego z nich
wartości, które trzeba zdefiniować są inne. Poniżej przykładowa konfiguracja.</p>
<p>Dla sterownika <code>tp_fan</code> :</p>
<pre><code>(0,	0,	20)
(1,	18,	55)
(2,	48,	60)
(3,	58,	65)
(4,	63,	70)
(5,	68,	75)
(6,	73,	80)
(7,	78,	32767)
</code></pre>
<p>Dla sterownika <code>pwm_fan</code> :</p>
<pre><code>(0, 	0,	20)
(36,	18,	55)
(72,	48,	60)
(109,	58,	65)
(145,	63,	70)
(182,	68,	75)
(218,	73,	80)
(255,	78,	32767)
</code></pre>
<p>Powyżej znajduje się moja konfiguracja pracy wentylatora. Mamy w zasadzie 8 trybów pracy (oznaczone
numerkami w pierwszej kolumnie). Druga z trzecią kolumną precyzują zakres temperatur, w których
danych tryb pracy wentylatora będzie obowiązywał. W tej powyższej konfiguracji wentylator włączy
się jedynie w momencie, gdy temperatura procesora przekroczy 20 stopni. Innymi słowy wiatrak będzie
obracał się cały czas na wolnych obrotach wymuszając przepływ powietrza przez obudowę. Ten stan
rzeczy jest lepszy według mnie niż ciągłe wyłączanie i załączanie wentylatora, co może ździebko
irytować. Sam wiatrak zaś będzie zwiększał obroty wraz ze wzrostem temperatury, osiągając w
ostatnim trybie około 5,4K obrotów na minutę.</p>
<p>Dodatkowo warto ustawić w drugiej kolumnie nieco niższe wartości niż w trzeciej kolumnie w
poprzednim wierszu. Czyli jak mamy w drugim trybie 18-55°C, to w trzecim dajemy 48-60°C.
Zapobiegnie to ciągłemu przełączaniu trybów wentylatora, gdy temperatura będzie na granicy 50
stopni.</p>
<p>Warto tutaj jeszcze zaznaczyć fakt, że domyślne ustawienia częstotliwości procesora umożliwiają mu
pracę z 3,3 GHz i można pokusić się o obniżenie tej częstotliwości maksymalnej do 2,5 GHz. W takiej
sytuacji i przy takich ustawieniach wentylatora, temperatura procesora nie powinna przekroczyć 60°C.
W efekcie wiatrak nie powinien nam się dawać zbytnio we znaki.</p>
<p>Trzeba także zwracać uwagę na wartości modułów, z których korzystamy. W przypadku <code>tp_fan</code> mamy
numery trybów <code>0-7</code>, natomiast w przypadku <code>hwmon</code> mamy wartości od <code>0-255</code> stopniowane
(przynajmniej w moim przypadku co <code>36</code> punków), zatem tryb <code>1</code> w <code>tp_fan</code> odpowiada wartości <code>36</code> w
<code>hwmon</code>, tryb <code>2</code> odpowiada zaś <code>72</code> , itd.</p>
<p>Problem w tym, że jeśli zapomnimy ustawić wyższych wartości, a będziemy jednocześnie korzystać z
<code>hwmon</code>, to nasz wiatrak może się w ogóle nie włączyć -- potrzebne są wartości zbliżone do
faktycznych wartości przełączających tryb wentylatora. Jeśli teraz mamy <code>1-7</code> i korzystamy z
<code>hwmon</code> , to system potraktuje je jako <code>0</code> i wentylatora nie włączy nawet, gdy ten będzie miał 100°C.
Zatem warto zwrócić uwagę na to jaki sterownik mamy w użyciu.</p>
<h2 id="monitorowanie-temperatury-z-thinkfan">Monitorowanie temperatury z thinkfan</h2>
<p>Gdy już dostosujemy sobie konfigurację <code>thinkfan</code> , to trzeba uruchomić demona, który będzie nam
tym wentylatorem zarządzał w zależności o zmian temperatury. W pakiecie <code>thinkfan</code> była zawarta
usługa dla systemd ale zanim ją włączymy, to wypadałoby najpierw przetestować cały mechanizm i
sprawdzić czy aby działa on prawidłowo. W tym celu przechodzimy do terminala i wpisujemy w nim jak
root to poniższe polecenie:</p>
<pre><code># thinkfan -n
</code></pre>
<p>Ma ono za zadanie uruchomić <code>thinkfan</code> i wypisać wszelkie komunikaty na konsoli. Na ekranie powinny
nam zacząć przeskakiwać linijki podobne do tych poniżej:</p>
<pre><code>sleeptime=5, tmax=40, last_tmax=40, biased_tmax=40 -&gt; fan=&quot;level 1&quot;
sleeptime=5, tmax=38, last_tmax=40, biased_tmax=38 -&gt; fan=&quot;level 0&quot;
</code></pre>
<p>Jeśli tak się dzieje, to powinniśmy być także w stanie usłyszeć różnicę w pracy wentylatora. Jeśli
nie słyszymy, to prawdopodobnie mamy określoną złą ścieżkę do wentylatora w pliku
<code>/etc/thinkfan.conf</code> i jak najszybciej przydałoby się proces <code>thinkfan</code> zabić, bo w takiej sytuacji
procesor może się nam spalić jeśli popracuje nieco intensywniej przez dłuższy czas. Jeśli natomiast
słyszymy zmiany prędkości obrotu wiatraka, to znaczy, że <code>thinkfan</code> realizuje swoje zadanie
prawidłowo. Możemy zatem włączyć usługę, którą będzie uruchamiana wraz z każdym startem laptopa:</p>
<pre><code># systemctl start thinkfan.service
# systemctl enable thinkfan.service
</code></pre>
<p>Od tej pory wentylator w naszym ThinkPad T430 powinien już nieco ciszej się zachowywać. Jeśli
jednak w dalszym ciągu dość mocno hałasuje, to trzeba mu dobrać nieco inne wartości w pliku
<code>/etc/thinkfan.conf</code> ale należy uważać. Może i procesor jest w stanie wytrzymać 100°C ale dysk,
który siedzi zaraz obok w zamkniętej obudowie, już takiej temperatury nie wytrzyma. Im wyżej
podniesiemy progi temperatur, tym rzadziej wentylator będzie się załączał i równocześnie
temperatura wewnątrz obudowy laptopa wzrośnie, a więc i dysk twardy będzie się dodatkowo nagrzewał,
zwłaszcza, gdy mamy do czynienia z dyskiem magnetycznym. W przypadku HDD temperatura mocno wpływa
na błędy odczytu i zapisu danych z racji rozszerzania się ścieżek i sektorów.</p>
<h2 id="zamiana-modułów-i-zmiana-ścieżek">Zamiana modułów i zmiana ścieżek</h2>
<p>Czasami ścieżki do plików, które trzeba określić w pliku <code>/etc/thinkfan.conf</code> stają się błędne po
restarcie maszyny. Dzieje się tak ze względu na obecność kilku modułów, które odpowiedzialne są za
dostarczanie informacji o czujnikach. W tym powyżej opisanym przykładzie mieliśmy do czynienia z
dwoma modułami: <code>thinkpad_acpi</code> oraz <code>coretemp</code> . Jeśli nie określimy w jakiej kolejności te moduły
będą ładowane na starcie systemu, to raz jeden może zostać załadowany jako pierwszy, a innym razem
ten drugi. Owocować to będzie ciągłą zamianą ścieżek, przez co my będziemy musieli je ręcznie
dostosować w pliku konfiguracyjnym. Jeśli mamy więcej modułów niż jeden, to określmy ich kolejność
w pliku <code>/etc/modules</code> :</p>
<pre><code>thinkpad_acpi
coretemp
</code></pre></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/acpi/">acpi</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/thinkpad/">thinkpad</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/lenovo/">lenovo</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/t430/">t430</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&amp;text=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&amp;title=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&amp;title=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&title=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&amp;title=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fregulacja-obrotow-wentylatora-w-zaleznosci-od-zmian-temperatury-w-thinkpad-t430%2f&description=Regulacja%20obrot%c3%b3w%20wentylatora%20w%20zale%c5%bcno%c5%9bci%20od%20zmian%20temperatury%20w%20ThinkPad%20T430" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-zaladowac-profile-apparmor-w-fazie-initrd-initramfs-na-debian-linux/">Jak załadować profile AppArmor w fazie initrd/initramfs na Debian Linux</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wybudzanie-linuxa-ze-stanu-uspienia-za-sprawa-myszy/">Wybudzanie linux&#39;a ze stanu uśpienia za sprawą myszy</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/montowanie-dyskow-jako-zwykly-uzytkownik-z-udisks-i-policykit/">Montowanie dysków jako zwykły użytkownik z UDisks i PolicyKit</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/mechanizm-trigger-dla-apt-aptitude-w-debianie/">Mechanizm trigger&#39;ów dla apt/aptitude w Debianie</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/blokowanie-niepozadanej-komunikacji-z-nftables-na-linux/">Blokowanie niepożądanej komunikacji z nftables na linux</a></li>
		
	</ul>
</div>

	

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2021 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
		<img alt="Licencja Creative Commons" style="border-width:0" src="https://licensebuttons.net/l/by-nc-sa/4.0/80x15.png" />
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
</body>
</html>
