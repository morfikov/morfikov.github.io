<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>WPA/WPA2 Enterprise i serwer freeradius | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="WPA/WPA2 Enterprise i serwer freeradius" />
<meta property="og:description" content="Poniższy wpis ma na celu stworzenie infrastruktury WiFi w oparciu o oprogramowanie freeradius
zainstalowane na debianowym serwerze. Projekt zakłada wykorzystanie osobnego urządzenia NAS (AP), w
tym przypadku jest to router TP-Link TL-WR1043N/ND
v2, na którym jest zainstalowane oprogramowanie
OpenWRT. W oparciu o te dwie maszyny spróbujemy skonfigurować protokół WPA2 Enterprise z obsługą
trzech metod uwierzytelniania, tj. EAP-TLS, EAP-TTLS oraz PEAP (v0) . Będziemy również potrzebować
kilku certyfikatów (w tym CA), bez których to pewne mechanizmy mogą nie działać." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/wpa2-enterprise-serwer-freeradius/" />
<meta property="article:published_time" content="2015-10-13T18:42:28+00:00" />
<meta property="article:modified_time" content="2015-10-13T18:42:28+00:00" />

		<meta itemprop="name" content="WPA/WPA2 Enterprise i serwer freeradius">
<meta itemprop="description" content="Poniższy wpis ma na celu stworzenie infrastruktury WiFi w oparciu o oprogramowanie freeradius
zainstalowane na debianowym serwerze. Projekt zakłada wykorzystanie osobnego urządzenia NAS (AP), w
tym przypadku jest to router TP-Link TL-WR1043N/ND
v2, na którym jest zainstalowane oprogramowanie
OpenWRT. W oparciu o te dwie maszyny spróbujemy skonfigurować protokół WPA2 Enterprise z obsługą
trzech metod uwierzytelniania, tj. EAP-TLS, EAP-TTLS oraz PEAP (v0) . Będziemy również potrzebować
kilku certyfikatów (w tym CA), bez których to pewne mechanizmy mogą nie działać.">
<meta itemprop="datePublished" content="2015-10-13T18:42:28+00:00" />
<meta itemprop="dateModified" content="2015-10-13T18:42:28+00:00" />
<meta itemprop="wordCount" content="5795">



<meta itemprop="keywords" content="szyfrowanie,wifi,sieć," />

		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="WPA/WPA2 Enterprise i serwer freeradius"/>
<meta name="twitter:description" content="Poniższy wpis ma na celu stworzenie infrastruktury WiFi w oparciu o oprogramowanie freeradius
zainstalowane na debianowym serwerze. Projekt zakłada wykorzystanie osobnego urządzenia NAS (AP), w
tym przypadku jest to router TP-Link TL-WR1043N/ND
v2, na którym jest zainstalowane oprogramowanie
OpenWRT. W oparciu o te dwie maszyny spróbujemy skonfigurować protokół WPA2 Enterprise z obsługą
trzech metod uwierzytelniania, tj. EAP-TLS, EAP-TTLS oraz PEAP (v0) . Będziemy również potrzebować
kilku certyfikatów (w tym CA), bez których to pewne mechanizmy mogą nie działać."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/wsparcie/">
					
					<span class="main-nav__text">Wsparcie</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">WPA/WPA2 Enterprise i serwer freeradius</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2015-10-13T18:42:28Z">Opublikowano: 13/10/2015</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">WPA/WPA2 Enterprise i serwer freeradius</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#instalacja-komponentów">Instalacja komponentów</a></li>
    <li><a href="#wstępna-konfiguracja-pakietu-freeradius">Wstępna konfiguracja pakietu freeradius</a>
      <ol>
        <li><a href="#firewall">Firewall</a></li>
      </ol>
    </li>
    <li><a href="#certyfikaty">Certyfikaty</a>
      <ol>
        <li><a href="#implementacja-certyfikatów-na-serwerze">Implementacja certyfikatów na serwerze</a></li>
        <li><a href="#implementacja-certyfikatów-na-kliencie">Implementacja certyfikatów na kliencie</a></li>
        <li><a href="#niedogodności-związane-z-certyfikatami">Niedogodności związane z certyfikatami</a></li>
      </ol>
    </li>
    <li><a href="#protokoły-eap">Protokoły EAP</a>
      <ol>
        <li><a href="#konfiguracja-tunelu-tls">Konfiguracja tunelu TLS</a>
          <ol>
            <li><a href="#konfiguracja-eap-ttls">Konfiguracja EAP-TTLS</a></li>
            <li><a href="#konfiguracja-protokołu-peap">Konfiguracja protokołu PEAP</a></li>
          </ol>
        </li>
        <li><a href="#anonimowa-tożsamość">Anonimowa tożsamość</a></li>
        <li><a href="#weryfikacja-certyfikatu-serwera">Weryfikacja certyfikatu serwera</a></li>
      </ol>
    </li>
    <li><a href="#konfiguracja-klientów-serwera-freeradius">Konfiguracja klientów serwera freeradius</a>
      <ol>
        <li><a href="#konfiguracja-apnas">Konfiguracja AP/NAS</a></li>
        <li><a href="#konfiguracja-użytkowników">Konfiguracja użytkowników</a>
          <ol>
            <li><a href="#moduł-files">Moduł files</a></li>
            <li><a href="#moduł-unix">Moduł unix</a></li>
          </ol>
        </li>
        <li><a href="#restrykcje-czasowe-moduł-logintime">Restrykcje czasowe (moduł logintime)</a></li>
        <li><a href="#liczba-sesji-podłączonych-do-sieci">Liczba sesji podłączonych do sieci</a></li>
        <li><a href="#filtrowanie-nazw-użytkowników-moduł-filter_username">Filtrowanie nazw użytkowników (moduł filter_username)</a></li>
      </ol>
    </li>
    <li><a href="#testowanie-konfiguracji">Testowanie konfiguracji</a>
      <ol>
        <li><a href="#narzędzia-testowe-freeradiusa">Narzędzia testowe freeradius'a</a>
          <ol>
            <li><a href="#test-konfiguracji-eap">Test konfiguracji EAP</a></li>
          </ol>
        </li>
      </ol>
    </li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Poniższy wpis ma na celu stworzenie infrastruktury WiFi w oparciu o oprogramowanie freeradius
zainstalowane na debianowym serwerze. Projekt zakłada wykorzystanie osobnego urządzenia NAS (AP), w
tym przypadku jest to router <a href="http://wiki.openwrt.org/toh/tp-link/tl-wr1043nd">TP-Link TL-WR1043N/ND
v2</a>, na którym jest zainstalowane oprogramowanie
OpenWRT. W oparciu o te dwie maszyny spróbujemy skonfigurować protokół WPA2 Enterprise z obsługą
trzech metod uwierzytelniania, tj. EAP-TLS, EAP-TTLS oraz PEAP (v0) . Będziemy również potrzebować
kilku certyfikatów (w tym CA), bez których to pewne mechanizmy mogą nie działać.</p>
<h2 id="instalacja-komponentów">Instalacja komponentów</h2>
<p>W mojej sieci testowej router ma adres 192.168.1.1 , a serwer z debianem 192.168.1.166 . W tym
przypadku będzie jedna maszyna kliencka (laptop) z adresem 192.168.1.150. Zarówno do serwera debiana
jak i do routera będziemy się łączyć przez ssh. Serwer nie posiada środowiska graficznego, jedynie
podstawowy system + serwer ssh.</p>
<p>Na serwerze będziemy instalować oprogramowanie freeradius wraz z modułem obsługującym MySQL.
Potrzebny nam też będzie sam serwer bazy danych MySQL. Logujemy się zatem na serwer debiana via ssh
i instalujemy tam poniższe pakiety:</p>
<pre><code>$ ssh root@192.168.1.166
...
# aptitude install freeradius freeradius-mysql freeradius-utils mysql-server
...
</code></pre>
<h2 id="wstępna-konfiguracja-pakietu-freeradius">Wstępna konfiguracja pakietu freeradius</h2>
<p>Nie zaleca się odpalania demona freeradius'a z uprawnieniami użytkownika root. W debianie, wszystkie
niezbędne kroki, takie jak zmiana uprawnień plików w katalogu <code>/etc/freeradius/</code> , czy sama
konfiguracja użytkownika/grupy <code>freerad</code>, zostały przeprowadzone przez opiekuna pakietu i my nie
musimy sobie tym głowy zawracać. Warto jednak prześledzić jak wygląda cały setup poinstalacyjny.
Poniżej znajduje się listing plików konfiguracyjnych wraz z ich uprawnieniami:</p>
<pre><code># tree -u -g -p /etc/freeradius/
/etc/freeradius/
├── [-rw-r----- root     freerad ]  acct_users
├── [-rw-r----- root     freerad ]  attrs
├── [-rw-r----- root     freerad ]  attrs.access_challenge
├── [-rw-r----- root     freerad ]  attrs.access_reject
├── [-rw-r----- root     freerad ]  attrs.accounting_response
├── [-rw-r----- root     freerad ]  attrs.pre-proxy
├── [drwxr-s--x freerad  freerad ]  certs
│   ├── [lrwxrwxrwx root     freerad ]  ca.pem -&gt; /etc/ssl/certs/ca-certificates.crt
│   ├── [-rw-r--r-- root     freerad ]  dh
│   ├── [lrwxrwxrwx root     freerad ]  server.key -&gt; /etc/ssl/private/ssl-cert-snakeoil.key
│   └── [lrwxrwxrwx root     freerad ]  server.pem -&gt; /etc/ssl/certs/ssl-cert-snakeoil.pem
├── [-rw-r----- root     freerad ]  clients.conf
├── [-rw-r--r-- root     freerad ]  dictionary
├── [-rw-r----- root     freerad ]  eap.conf
├── [-rw-r----- root     freerad ]  experimental.conf
├── [-rw-r----- root     freerad ]  hints
├── [-rw-r----- root     freerad ]  huntgroups
├── [-rw-r----- root     freerad ]  ldap.attrmap
├── [drwxr-xr-x root     root    ]  modules
│   ├── [-rw-r--r-- root     root    ]  acct_unique
│   ├── [-rw-r--r-- root     root    ]  always
│   ├── [-rw-r--r-- root     root    ]  attr_filter
│   ├── [-rw-r--r-- root     root    ]  attr_rewrite
│   ├── [-rw-r--r-- root     root    ]  chap
│   ├── [-rw-r--r-- root     root    ]  checkval
│   ├── [-rw-r--r-- root     root    ]  counter
│   ├── [-rw-r--r-- root     root    ]  cui
│   ├── [-rw-r--r-- root     root    ]  detail
│   ├── [-rw-r--r-- root     root    ]  detail.example.com
│   ├── [-rw-r--r-- root     root    ]  detail.log
│   ├── [-rw-r--r-- root     root    ]  digest
│   ├── [-rw-r--r-- root     root    ]  dynamic_clients
│   ├── [-rw-r--r-- root     root    ]  echo
│   ├── [-rw-r--r-- root     root    ]  etc_group
│   ├── [-rw-r--r-- root     root    ]  exec
│   ├── [-rw-r--r-- root     root    ]  expiration
│   ├── [-rw-r--r-- root     root    ]  expr
│   ├── [-rw-r--r-- root     root    ]  files
│   ├── [-rw-r--r-- root     root    ]  inner-eap
│   ├── [-rw-r--r-- root     root    ]  ippool
│   ├── [-rw-r--r-- root     root    ]  krb5
│   ├── [-rw-r--r-- root     root    ]  ldap
│   ├── [-rw-r--r-- root     root    ]  linelog
│   ├── [-rw-r--r-- root     root    ]  logintime
│   ├── [-rw-r--r-- root     root    ]  mac2ip
│   ├── [-rw-r--r-- root     root    ]  mac2vlan
│   ├── [-rw-r--r-- root     root    ]  mschap
│   ├── [-rw-r--r-- root     root    ]  ntlm_auth
│   ├── [-rw-r--r-- root     root    ]  opendirectory
│   ├── [-rw-r--r-- root     root    ]  otp
│   ├── [-rw-r--r-- root     root    ]  pam
│   ├── [-rw-r--r-- root     root    ]  pap
│   ├── [-rw-r--r-- root     root    ]  passwd
│   ├── [-rw-r--r-- root     root    ]  perl
│   ├── [-rw-r--r-- root     root    ]  policy
│   ├── [-rw-r--r-- root     root    ]  preprocess
│   ├── [-rw-r--r-- root     root    ]  radutmp
│   ├── [-rw-r--r-- root     root    ]  realm
│   ├── [-rw-r--r-- root     root    ]  redis
│   ├── [-rw-r--r-- root     root    ]  rediswho
│   ├── [-rw-r--r-- root     root    ]  replicate
│   ├── [-rw-r--r-- root     root    ]  smbpasswd
│   ├── [-rw-r--r-- root     root    ]  smsotp
│   ├── [-rw-r--r-- root     root    ]  soh
│   ├── [-rw-r--r-- root     root    ]  sql_log
│   ├── [-rw-r--r-- root     root    ]  sqlcounter_expire_on_login
│   ├── [-rw-r--r-- root     root    ]  sradutmp
│   ├── [-rw-r--r-- root     root    ]  unix
│   └── [-rw-r--r-- root     root    ]  wimax
├── [-rw-r----- root     freerad ]  policy.conf
├── [-rw-r----- root     freerad ]  policy.txt
├── [-rw-r----- root     freerad ]  preproxy_users
├── [-rw-r----- root     freerad ]  proxy.conf
├── [-rw-r----- root     freerad ]  radiusd.conf
├── [drwxr-s--x freerad  freerad ]  sites-available
│   ├── [-rw-r--r-- root     root    ]  README
│   ├── [-rw-r--r-- root     root    ]  buffered-sql
│   ├── [-rw-r--r-- root     root    ]  coa
│   ├── [-rw-r--r-- root     root    ]  control-socket
│   ├── [-rw-r--r-- root     root    ]  copy-acct-to-home-server
│   ├── [-rw-r--r-- root     root    ]  decoupled-accounting
│   ├── [-rw-r--r-- root     root    ]  default
│   ├── [-rw-r--r-- root     root    ]  dhcp
│   ├── [-rw-r--r-- root     root    ]  dynamic-clients
│   ├── [-rw-r--r-- root     root    ]  example
│   ├── [-rw-r--r-- root     root    ]  inner-tunnel
│   ├── [-rw-r--r-- root     root    ]  originate-coa
│   ├── [-rw-r--r-- root     root    ]  proxy-inner-tunnel
│   ├── [-rw-r--r-- root     root    ]  robust-proxy-accounting
│   ├── [-rw-r--r-- root     root    ]  soh
│   ├── [-rw-r--r-- root     root    ]  status
│   ├── [-rw-r--r-- root     root    ]  virtual.example.com
│   └── [-rw-r--r-- root     root    ]  vmps
├── [drwxr-s--x freerad  freerad ]  sites-enabled
│   ├── [lrwxrwxrwx root     freerad ]  default -&gt; ../sites-available/default
│   └── [lrwxrwxrwx root     freerad ]  inner-tunnel -&gt; ../sites-available/inner-tunnel
├── [-rw-r----- root     freerad ]  sql.conf
├── [-rw-r--r-- root     root    ]  sqlippool.conf
├── [-rw-r--r-- root     root    ]  templates.conf
└── [-rw-r--r-- root     root    ]  users

4 directories, 96 files
</code></pre>
<p>Niżej zaś znajduje się konfiguracja użytkownika <code>freerad</code> :</p>
<pre><code># grep freerad /etc/group
shadow:x:42:freerad
freerad:x:109:
ssl-cert:x:110:freerad

# grep freerad /etc/passwd
freerad:x:105:109::/etc/freeradius:/bin/false

# grep freerad /etc/shadow
freerad:*:16321:0:99999:7:::
</code></pre>
<p>Trzeba zaznaczyć, że użytkownik <code>freerad</code> jest członkiem grupy <code>shadow</code> i to umożliwia mu odczyt
zahashowanych haseł użytkowników systemowych, co jest przydatne, np. przy korzystaniu z modułu
<code>unix</code> .</p>
<p>W pliku <code>/etc/freeradius/radiusd.conf</code> są przechowywane informacje na temat interfejsu, adresu,
portów, użytkownika i grupy na jakich będzie operowało oprogramowanie freeradius. Część z opcji
musimy dostosować sobie według naszych potrzeb:</p>
<pre><code>...
user = freerad
group = freerad
...
listen {
        type = auth
        port = 0
        ipaddr = 192.168.1.166
        interface = eth0
...
listen {
        type = acct
        port = 0
        ipaddr = 192.168.1.166
        interface = eth0
...
</code></pre>
<p>Port <code>0</code> w tym wypadku oznacza port domyślny, a jego wartość jest czytana z pliku <code>/etc/services</code> .
Są to 1812 (auth) i 1813 (acct).</p>
<p>Zapisujemy zmiany i testujemy wstępnie serwer odpalając go w trybie debug za pomocą poniższego
polecenia:</p>
<pre><code># freeradius -XXX
</code></pre>
<p>Wygeneruje ono pokaźnych rozmiarów log, na końcu którego powinna być poniższa informacja:</p>
<pre><code>Debug: Listening on authentication interface eth0 address 192.168.1.166 port 1812
Debug: Listening on accounting interface eth0 address 192.168.1.166 port 1813
Debug: Listening on authentication address 127.0.0.1 port 18120 as server inner-tunnel
Debug: Listening on proxy address 192.168.1.166 port 1814
Info: Ready to process requests.
</code></pre>
<h3 id="firewall">Firewall</h3>
<p>Poniższy krok nie jest konieczny, w końcu jakby nie patrzeć w swojej sieci lokalnej raczej wszystkie
maszyny mamy zaufane i nie trzeba dodatkowo dozbrajać serwera freeradius pod kątem restrykcji
dostępu. Czasem jednak potrzebny jest firewall, w którym to musimy przepuścić ruch na porcie
<code>22/tcp</code> (domyślny ssh) z konkretnego adresu IP, ruch na portach <code>1812/udp</code>, <code>1813/udp</code>, <code>1814/udp</code>
(domyślne porty freeradius'a) oraz zapytania do serwera bazy danych MySQL, który operuje standardowo
na porcie <code>3306/tcp</code> , choć nie powinniśmy wystawiać bazy danych na widok publiczny, bo o wiele
lepszym rozwiązaniem jest logowanie się po ssh i lokalne administrowanie bazą.</p>
<p>Jeśli chodzi o samego freeradius'a jeszcze, to portem <code>1812</code> lecą zapytania uwierzytelniające,
portem <code>1813</code> pakiety dotyczące wykorzystania zasobów sieci, a port <code>1814</code> odpowiada za
forwardowanie zapytań (proxy). Domyślnie freeradius nasłuchuje na wszystkich tych portach i jeśli
nie potrzebujemy, np. informacji na temat czasu trwania sesji danego użytkownika, czy bajtów ile
przesłał, lub zwyczajnie nie korzystamy z proxy, to możemy zahashować w pliku
<code>/etc/freeradius/radiusd.conf</code> odpowiednią sekcję.</p>
<p>Tak czy inaczej, reguły firewall'a, które trzeba wziąć pod uwagę, są wypisane poniżej:</p>
<pre><code>iptables -t filter -p udp --dport 1812 -j ACCEPT -m comment --comment &quot;RADIUS AUTH&quot;
iptables -t filter -p udp --dport 1813 -j ACCEPT -m comment --comment &quot;RADIUS ACCT&quot;
iptables -t filter -p udp --dport 1814 -j ACCEPT -m comment --comment &quot;RADIUS PROXY&quot;
iptables -t filter -p tcp --dport 3306 -j ACCEPT -m comment --comment &quot;MySQL&quot;
iptables -t filter -p tcp --dport 22 -s 192.168.1.150 -j ACCEPT -m comment --comment &quot;SSH&quot;
</code></pre>
<h2 id="certyfikaty">Certyfikaty</h2>
<p>Freeradius w katalogu <code>/etc/freeradius/certs/</code> tworzy linki do istniejących już w systemie
certyfikatów. Są to testowe certyfikaty dla usług, które ich wymagają do poprawnego działania i
pochodzą one z pakietu <code>ssl-cert</code> . Świetnie się one nadają do celów testowych i sprawdzenia czy
instalacja freeradius'a działa jak należy. Te certyfikaty nie są zalecane na serwerach
produkcyjnych, dlatego też musimy wygenerować sobie własne certyfikaty.</p>
<p><a href="https://morfikov.github.io
/post/generowanie-certyfikatow/">Generowanie certyfikatów</a> można przeprowadzić
ręcznie. Można także posłużyć się <a href="https://morfikov.github.io
/post/generowanie-certyfikatow-przy-pomocy-easy-rsa/">pakietem
easy-rsa</a>. Istnieje także
możliwość skorzystania z przygotowanego do tego celu narzędzi zawartych w pakiecie freeradius.
Informacje na temat korzystania z narzędzi freeradius'a są dostępne w pliku
<code>/usr/share/doc/freeradius/examples/certs/README</code> .</p>
<p>Po tym jak zainstalowaliśmy pakiet freeradius, kilka plików zostało utworzonych w katalogu
<code>/usr/share/doc/freeradius/examples/certs</code> i mamy tam między innymi <code>bootstrap</code> , <code>ca.cnf</code> ,
<code>client.cnf</code> , <code>server.cnf</code> oraz <code>xpextensions</code> . W zależności od konfiguracji freeradius'a przy
jego kompilacji, podczas uruchomienia serwera jako root w trybie debug ( <code>freeradius -X</code> ), plik
<code>bootstrap</code> może zostać wykonywany i zostaną stworzone w ten sposób certyfikaty dla określonych
maszyn. W przypadku debiana, to jednak nie ma miejsca ale wszystkie potrzebne nam pliki są
dostarczone i możemy ten skrypt wywołać ręcznie z takim samym efektem.</p>
<p>Po tym jak wygenerujemy własne certyfikaty (metoda bez znaczenia), musimy edytować plik
<code>/etc/freeradius/eap.conf</code> i wykomentować pozycję z <code>make_cert_command</code> w podsekcji <code>tls</code> , tak by
wyglądało to jak poniżej:</p>
<pre><code>    tls {
    ...
#   make_cert_command = &quot;${certdir}/bootstrap&quot;
</code></pre>
<p>Po tym kroku, przechodzimy do katalogu <code>/usr/share/doc/freeradius/examples/certs/</code> , gdzie będą
wykonywane kolejne polecenia. Następnie edytujemy pliki <code>ca.cnf</code> , <code>client.cnf</code> i <code>server.cnf</code> . Są
to kopie pliku konfiguracyjnego OpenSSL, który zwykle jest dostępny pod <code>/etc/ssl/openssl.cnf</code> .
Każdy z tych plików został zmieniony tak by maksymalnie uprościć procedurę generowania certyfikatów
i w sumie nasza ingerencja sprowadza się do edycji linijek zawierających <code>input_password</code> oraz
<code>output_password</code> . Można oczywiście dostosować szereg innych parametrów, np. termin ważności
certyfikatu, czy długość klucza RSA. Dobrze jest zatem przejrzeć te pliki.</p>
<p>Wszystkie certyfikaty generowane za pomocą skryptu dostarczonego z pakietem freeradius będą
domyślnie używać MD5 jako funkcji skrótu (hash). Dlatego warto zaznaczyć w tym miejscu by zmienić
wartość parametru <code>default_md</code> w każdym z trzech powyższych plików z <code>md5</code> na <code>sha256</code> lub nawet
<code>sha512</code>.</p>
<p>W przypadku klientów, ważne jest by odpowiednio dobrać parametr <code>commonName</code> , bo to on zostanie
później użyty przy uwierzytelnianiu podczas podłączania się klienta do sieci WiFi.</p>
<p>Teraz już tylko pozostało nam odpalenie skryptu <code>bootstrap</code> , który wygeneruje certyfikaty dla CA i
serwera:</p>
<pre><code># cd /usr/share/doc/freeradius/examples/certs
# ./bootstrap
</code></pre>
<p>Dodatkowo musimy stworzyć certyfikaty dla klientów:</p>
<pre><code># make client
</code></pre>
<p>Teraz powinniśmy mieć już komplet plików.</p>
<p>Listując katalog roboczy możemy dostrzec, że te pliki <a href="https://blogs.msdn.microsoft.com/kaushal/2010/11/04/various-ssltls-certificate-file-typesextensions/">mają różne
rozszerzenia</a>.
Czym zatem różnią się one między sobą? Plik <code>.crt</code> to certyfikat główny. W osobnym pliku <code>.key </code>
znajduje się klucz prywatny od tego certyfikatu. Można rozpoznać to po &quot;-----BEGIN ENCRYPTED PRIVATE
KEY-----&quot; i &quot;-----END ENCRYPTED PRIVATE KEY-----&quot;. W przypadku gdy nie potrzebujemy oddzielać
certyfikatu od klucza, możemy posłużyć się plikiem <code>.p12</code> lub plikiem <code>.pem</code> . Mogą one zawierać
zarówno certyfikat jak i klucz prywatny i zamiast dwóch osobnych plików, jest tylko jeden. Różnica
między nimi polega na tym, że plik <code>.p12</code> jest używany głównie na windowsach, ten drugi zaś przez
OpenSSL. Plik <code>.csr</code> jest prośbą o podpisanie certyfikatu (Certificate Signing Request) wysyłaną
przez aplikację do CA (Certification Authority). Można to poznać po linijkach &quot;-----BEGIN NEW
CERTIFICATE REQUEST-----&quot; oraz &quot;-----END NEW CERTIFICATE REQUEST-----&quot;. Dodatkowo, mamy plik binarny
certyfikatu <code>.der</code> zakodowany w DER. Nie ma jednak możliwości umieszczenia w tym pliku klucza
prywatnego, czy też certyfikatów ze struktury certyfikatów (certification path). Wygenerowany on
został głównie na potrzeby windowsów.</p>
<p>Oprogramowanie freeradius w swojej konfiguracji potrzebuje nastepujących plików: <code>server.key</code> ,
<code>server.pem</code> oraz <code>ca.pem</code> . Te pliki trzeba przenieść do katalogu <code>/etc/freeradius/certs/</code> . Z
kolei na kliencie potrzebne nam będą <code>ca.pem</code> jako certyfikat CA oraz <code>client.p12</code> albo <code>client.key</code>
i <code>client.crt</code> .</p>
<h3 id="implementacja-certyfikatów-na-serwerze">Implementacja certyfikatów na serwerze</h3>
<p>Narobiliśmy trochę plików i teraz trzeba je rozdzielić pomiędzy określone maszyny. Na początek
kopiujemy wszystko co dotyczy serwera freeradius do katalogu <code>/etc/freeradius/certs/</code> . Domyślnie
jednak znajdują się tam certyfikaty stworzone po instalacji pakietu freeradius, które musimy usunąć:</p>
<pre><code># rm /etc/freeradius/certs/*
# cp /etc/CA/ca.pem /etc/CA/server.key /etc/CA/server.pem /etc/freeradius/certs/
</code></pre>
<p>Przechodzimy do katalogu z certyfikatami dla freeradius'a i generujemy przy pomocy OpenSSL plik <code>dh</code>
, który zawiera <a href="https://security.stackexchange.com/questions/94390/whats-the-purpose-of-dh-parameters">szereg parametrów wykorzystywanych przy wymianie kluczy w protokole
Diffie-Hellman'a</a>.
Standardowo ta liczba ma 1024 bity i przydałoby się nieco zwiększyć:</p>
<pre><code># cd /etc/freeradius/certs/
# openssl dhparam -out dh 4096
</code></pre>
<h3 id="implementacja-certyfikatów-na-kliencie">Implementacja certyfikatów na kliencie</h3>
<p>By skonfigurować klienta, który będzie korzystał z WiFi, musimy przekopiować <code>ca.pem</code> oraz
<code>client.p12</code> (ewentualnie <code>client.crt</code> i <code>client.key</code> ) na maszynę kliencką, np. do katalogu
<code>/etc/wifi_cert/radius_192.168.1.166/</code> .</p>
<p>Na linuxach, do konfiguracji sieci WiFi są wykorzystywane narzędzia zawarte w pakiecie
<code>wpasupplicant</code> . Można oczywiście skorzystać z <code>wicd</code> albo <code>network-manager</code> jeśli ktoś nie
przepada za ręczą edycją plików tekstowych. W zależności od wybranej metody, nieco inaczej będzie
wyglądać konfiguracja suplikanta (klienta WiFi). Ja korzystałem z trybu tekstowego przy
<a href="https://morfikov.github.io
/post/konfiguracja-polaczenia-wifi-pod-debianem/">konfiguracji WiFi</a>. Nie będę
tutaj opisywał całego procesu ale jeśli ktoś ma problemy związane z konfiguracją linux'owego
klienta, to odsyłam go do podlinkowanego wpisu.</p>
<h3 id="niedogodności-związane-z-certyfikatami">Niedogodności związane z certyfikatami</h3>
<p>W przypadku wykorzystywania kluczy o większych rozmiarach, np. 4096 bitów, warto zrobić sobie test i
zobaczyć jak radzi sobie nasza maszyna w kalkulacjach RSA. Taki benchmark można przeprowadzić
wydając poniższe polecenie:</p>
<pre><code># openssl speed rsa
...
                  sign    verify    sign/s verify/s
rsa  512 bits 0.000196s 0.000016s   5099.1  61558.5
rsa 1024 bits 0.000837s 0.000049s   1194.1  20247.7
rsa 2048 bits 0.005616s 0.000173s    178.1   5772.5
rsa 4096 bits 0.041405s 0.000668s     24.2   1496.4
</code></pre>
<p>Z powyższego wyniku interesuje nas głównie kolumna <code>sign/s</code> . Jest to ilość jednoczesnych prób
uwierzytelniania klientów WiFi jakie serwer jest w stanie obsłużyć wykorzystując mechanizm EAP-TLS,
EAP-TTLS albo PEAP.</p>
<h2 id="protokoły-eap">Protokoły EAP</h2>
<p><a href="http://www.networkworld.com/article/2223672/access-control/which-eap-types-do-you-need-for-which-identity-projects.html">Jest wiele metod uwierzytelniania
EAP</a>
i nas interesować będą trzy z nich EAP-TLS, EAP-TTLS i PEAP. Metoda <code>EAP-TLS</code>, w odróżnieniu od
EAP-TTLS i PEAP, wymaga wzajemnej weryfikacji certyfikatów na linii serwer-klient. Z kolei
<code>EAP-TTLS</code> i <code>PEAP</code> zbytnio się nie różnią między sobą, no może za wyjątkiem wsparcia, bo ten drugi
jest rozwijany przez MS. Obie te metody wykorzystują szyfrowany tunel TLS, który jest również
podstawą dla uwierzytelniania przy metodzie EAP-TLS i by korzystać z EAP-TTLS lub PEAP, trzeba po
części skonfigurować uwierzytelnianie EAP-TLS. Same certyfikaty klienckie w przypadku EAP-TTLS i
PEAP są nieobowiązkowe i gdy nie korzystamy z nich, uwierzytelnianie klienta odbywa się przy pomocy
loginu i hasła, co znacznie upraszcza wdrożenie protokołu WPA2 Enterprise.</p>
<p>Jeśli chodzi jeszcze o porównanie EAP-TTLS/PEAP w stosunku do EAP-TLS, to proces uwierzytelniania w
przypadku tych pierwszych odbywa się w dwóch fazach. EAP-TLS ma tylko jedną fazę, podczas której
wymieniane są klucze publiczne i zestawiany jest tunel TLS. Sam tunel tworzony jest na podobnej
zasadzie co w przypadku SSL na stronach www. W EAP-TTLS/PEAP występują dwie tożsamości -- zewnętrzna
i wewnętrzna (szyfrowana wewnątrz tunelu TLS). Zewnętrzna tożsamość w EAP-TTLS/PEAP odpowiada
tożsamości w TLS i w obu przypadkach ta tożsamość widnieje w pakietach sieciowych. Dlatego jeśli
zależy nam na anonimowości klientów, nie możemy korzystać z EAP-TLS. Niemniej jednak ta metoda jest
najbezpieczniejsza ze wszystkich dostępnych na rynku.</p>
<p>W protokołach EAP-TTLS/PEAP, wewnątrz tunelu TLS, wykorzystywane są inne protokoły EAP, którymi
przesyłane są login i hasło. Trzeba rozróżnić te dwie kwestie. Pierwszą jest wykorzystanie np.
EAP-MD5 przy uwierzytelnianiu jest poważnym ryzykiem, bo hasło w postaci hasha md5 jest przesyłane
przez sieć, a ten protokół w obecnych czasach nie daje już gwarancji bezpieczeństwa. Natomiast jeśli
wykorzystujemy tunel TLS, to typ zastosowanej metody wewnątrz tunelu nie ma już dla nas większego
znaczenia. Nawet możemy puścić hasło otwartym tekstem i tunel TLS daje nam gwarancję poufności
danych wewnątrz niego i dlatego nie trzeba tych danych dodatkowo szyfrować.</p>
<p>Jeśli chodzi o samą konfigurację klientów, to windowsy standardowo nie działają z metodą EAP-TTLS i
muszą używać PEAP, co trzeba wziąć pod uwagę, przy konfiguracji serwera freeradius.</p>
<p>W związku z powyższym, ustawmy domyślny protokół EAP na PEAP, zakładając, że najwięcej klientów
będzie właśnie go używać. Konfiguracja EAP odbywa się w pliku <code>/etc/freeradius/eap.conf</code> .
Przechodzimy zatem do jego edycji:</p>
<pre><code>...
default_eap_type = peap
...
</code></pre>
<h3 id="konfiguracja-tunelu-tls">Konfiguracja tunelu TLS</h3>
<p>Jeśli już wszystkie pliki są wgrane tam gdzie powinny, możemy przejść do konfigurowania tunelu TLS
pod uwierzytelnianie EAP-TLS, EAP-TTLS i PEAP. Dokonujemy tego w pliku <code>/etc/freeradius/eap.conf</code> w
sekcji <code>tls</code> :</p>
<pre><code>...
tls {
      certdir = ${confdir}/certs
      cadir = ${confdir}/certs

      private_key_password = jakies-haslo-server

      private_key_file = ${certdir}/server.key

      certificate_file = ${certdir}/server.pem

      CA_file = ${cadir}/ca.pem

      dh_file = ${certdir}/dh
      random_file = /dev/urandom
      CA_path = ${cadir}
...
</code></pre>
<p>By się zalogować do sieci WiFi wykorzystując EAP-TLS, potrzebujemy odpowiedniej konfiguracji dla
wpasupplicant'a na kliencie:</p>
<pre><code>network={
      id_str=&quot;home_wifi_static&quot;
      priority=10
      ssid=&quot;Winter Is Coming&quot;
      bssid=E8:94:F6:68:79:EF
      proto=RSN
      key_mgmt=WPA-EAP
      eap=TLS
      pairwise=CCMP
      group=CCMP
      auth_alg=OPEN
      identity=&quot;linux_laptop&quot;
      ca_cert=&quot;/etc/wifi_cert/radius_192.168.1.166/ca.pem&quot;
      client_cert=&quot;/etc/wifi_cert/radius_192.168.1.166/client.pem&quot;
      private_key=&quot;/etc/wifi_cert/radius_192.168.1.166/client.key&quot;
#     private_key=&quot;/etc/wifi_cert/radius_192.168.1.166/client.p12&quot;
      private_key_passwd=&quot;jakies-haslo-client&quot;
      scan_ssid=0
      disabled=0
}
</code></pre>
<p>Interesują nas głównie linijki zawierające <code>ca_cert</code> , <code>client_cert</code> , <code>private_key</code> oraz
<code>private_key_passwd</code> . Powyżej mamy wykomentowaną jedną pozycję i jeśli chcemy wykorzystać plik
<code>.p12</code>, który zawiera certyfikat i klucz prywatny, musimy wykomentować dwie linijki wyżej.</p>
<h4 id="konfiguracja-eap-ttls">Konfiguracja EAP-TTLS</h4>
<p>Mając tunel TLS, możemy przejść do konfiguracji EAP-TTLS. Jest ona trochę niżej, również w pliku
<code>/etc/freeradius/eap.conf</code> :</p>
<pre><code>...
ttls {
   default_eap_type = md5
   copy_request_to_tunnel = no
   use_tunneled_reply = no
   virtual_server = &quot;inner-tunnel&quot;
}
...
</code></pre>
<p>Powyższa konfiguracja jest domyślna i nie musimy zbytnio nic w niej zmieniać. By podłączyć się do
sieci z wykorzystaniem protokołu EAP-TTLS, wrzucamy poniższą zwrotkę do pliku konfiguracyjnego
wpasupplicant'a na kliencie:</p>
<pre><code>network={
      id_str=&quot;home_wifi_static&quot;
      priority=10
      ssid=&quot;Winter Is Coming&quot;
      bssid=E8:94:F6:68:79:EF
      proto=RSN
      key_mgmt=WPA-EAP
      eap=TTLS
      pairwise=CCMP
      group=CCMP
      auth_alg=OPEN
      phase1=&quot;peaplabel=1&quot;
      phase2=&quot;auth=MD5&quot;
      anonymous_identity=&quot;anonymous&quot;
      identity=&quot;morfik&quot;
      password=&quot;super-tajne+haslo&quot;
      ca_cert=&quot;/etc/wifi_cert/radius_192.168.1.166/ca.pem&quot;
      scan_ssid=0
      disabled=0
}
</code></pre>
<p>EAP-TTLS nie jest obsługiwany przez systemy operacyjne spod znaku MS, bo te korzystają z rozwijanego
przez MS protokołu PEAP. Jeśli się chce korzystać z EAP-TTLS, to albo trzeba zmienić system, albo
klienta WiFi, na taki który potrafi obsłużyć EAP-TTLS jako metodę uwierzytelniania.</p>
<h4 id="konfiguracja-protokołu-peap">Konfiguracja protokołu PEAP</h4>
<p>Jeszcze niżej w pliku <code>/etc/freeradius/eap.conf</code> mamy konfigurację dla PEAP:</p>
<pre><code>peap {
   default_eap_type = mschapv2
   copy_request_to_tunnel = no
   use_tunneled_reply = no
   virtual_server = &quot;inner-tunnel&quot;
}
</code></pre>
<p>By się podłączyć do sieci używając protokołu PEAP, tworzymy poniższe wpisy w pliku konfiguracyjnym
wpasupplicant'a na kliencie:</p>
<pre><code>network={
      id_str=&quot;home_wifi_static&quot;
      priority=15
      ssid=&quot;Winter Is Coming&quot;
      bssid=E8:94:F6:68:79:EF
      proto=RSN
      key_mgmt=WPA-EAP
      eap=PEAP
      pairwise=CCMP
      group=CCMP
      auth_alg=OPEN
      phase2=&quot;auth=MSCHAPV2&quot;
      anonymous_identity=&quot;anonymous&quot;
      identity=&quot;morfik&quot;
      password=&quot;super-tajne+haslo&quot;
      ca_cert=&quot;/etc/wifi_cert/radius_192.168.1.166/ca.pem&quot;
      scan_ssid=0
      disabled=0
}
</code></pre>
<h3 id="anonimowa-tożsamość">Anonimowa tożsamość</h3>
<p>W przypadku protokołów EAP-TTLS oraz PEAP mamy możliwość sprecyzowania w pliku konfiguracyjnym
wpasupplicant'a parametru <code>anonymous_identity</code> . Zwykle przyjmuje on wartość <code>anonymous</code> . Jest to
nic innego jak zewnętrzna tożsamość używana do zestawiania tunelu TLS. W przypadku gdybyśmy nie
podali w konfiguracji tego parametru, zostanie użyta realna tożsamość, czyli ta, która służy do
logowania się do sieci.</p>
<p>Poniżej jest krótki wycinek z logu freeradius'a, który obrazuje cały proces:</p>
<pre><code>rad_recv: Access-Request packet from host 192.168.1.1 port 59500, id=220, length=283
        User-Name = &quot;anonymous&quot;
...
Sat Sep 20 12:09:25 2014 : Info: [ttls] Authenticate
Sat Sep 20 12:09:25 2014 : Info: [ttls] processing EAP-TLS
...
Sat Sep 20 12:09:25 2014 : Info: [ttls] Session established.  Proceeding to decode tunneled attributes.
...
Sat Sep 20 12:09:25 2014 : Info: [ttls] Got tunneled request
...
Sat Sep 20 12:09:25 2014 : Info: [ttls] Got tunneled identity of morfik
...
</code></pre>
<p>Powyższe ustawienia dla protokołów EAP-TTLS i PEAP dają gwarancję, że nie da się podsłuchać realnych
tożsamości używanych przy logowaniu się do sieci WiFi. W taki sposób atakujący jedyne co zobaczy
węsząc w sieci, to login <code>anonymous</code>, z którym nic nie da się zrobić.</p>
<h3 id="weryfikacja-certyfikatu-serwera">Weryfikacja certyfikatu serwera</h3>
<p>W przypadku protokołów EAP-TTLS oraz PEAP nie trzeba definiować parametru <code>ca_cert</code> w konfiguracji
wpasupplicant'a. W przypadku gdy tego nie zrobimy, nie zweryfikujemy tym samym certyfikatu serwera
freeradius. Jeśli mamy podaną ścieżkę do certyfikatu serwera w konfiguracji, to w przypadku
niezgodności certyfikatu serwera, nie zostaniemy podłączeni do sieci i zostanie nam zwrócony
poniższy komunikat (na kliencie w wpasupplicant):</p>
<pre><code>SSL: SSL_connect:SSLv3 read server hello A
TLS: Certificate verification failed, error 19 (self signed certificate in certificate chain) depth 1 for '/C=US/ST=California/O=NSA/CN=CA/emailAddress=morfik@nsa.com'
wlan0: CTRL-EVENT-EAP-TLS-CERT-ERROR reason=1 depth=1 subject='/C=US/ST=California/O=NSA/CN=CA/emailAddress=morfik@nsa.com' err='self signed certificate in certificate chain'
SSL: (where=0x4008 ret=0x230)
SSL: SSL3 alert: write (local SSL3 detected an error):fatal:unknown CA
SSL: (where=0x1002 ret=0xffffffff)
SSL: SSL_connect:error in SSLv3 read server certificate B
OpenSSL: openssl_handshake - SSL_connect error:14090086:SSL routines:SSL3_GET_SERVER_CERTIFICATE:certificate verify failed
SSL: 7 bytes pending from ssl_out
SSL: Failed - tls_out available to report error
SSL: 7 bytes left to be sent out (of total 7 bytes)
</code></pre>
<p>Krótko mówiąc, nie udało się zweryfikować certyfikatu serwera. W przypadku nieprzeprowadzenia
weryfikacji certyfikatu serwera (brak parametru <code>ca_cert</code> ), zostaniemy podłączeni do sieci jak
gdyby nigdy nic. Jeśli ktoś w takiej sytuacji spróbuje postawić AP/NAS, na którym będzie miał taką
samą sieć jak nasza (ten sam BSSID i ESSID), istnieje spore prawdopodobieństwo, że podłączymy się do
infrastruktury tego kogoś i wszystkie dane logowania do naszego konta podamy mu jak na tacy.</p>
<h2 id="konfiguracja-klientów-serwera-freeradius">Konfiguracja klientów serwera freeradius</h2>
<p>W tym przypadku słowo klient nie jest równoznaczne ze słowem klient gdy mówimy o sieci WiFi. Tamten
klient jest obsługiwany przez AP, natomiast w przypadku serwera freeradius, klientem dla niego jest
nasz AP, w tym wypadku router. Musimy zdefiniować to urządzenie w konfiguracji freeradius'a w pliku
<code>/etc/freeradius/clients.conf</code> . Domyślnie we wspomnianym pliku widnieje klient <code>localhost</code> i
możliwe jest przetwarzanie jedynie zapytań lokalnych, np. w przypadku gdyby oprogramowanie
freeradius było zainstalowane na urządzeniu AP/NAS. My musimy dodać do tego pliku nasz router:</p>
<pre><code>...
client router_1043nd {
   ipaddr = 192.168.1.1
   netmask = 32
   secret = &quot;tajna-fraza&quot;
   require_message_authenticator = yes
   nastype = other
}
...
</code></pre>
<p>Jeśli w powyższym pliku byśmy nie zdefiniowali odpowiedniego urządzenia lub byśmy zrobili to
błędnie, serwer freeradius zwróci nam poniższy
komunikat:</p>
<pre><code>Error: Ignoring request to authentication interface eth0 address 192.168.1.166 port 1812 from unknown client 192.168.1.1 port 41805
</code></pre>
<p>Na podstawie parametru <code>secret</code>, serwer freeradius decyduje czy ma obsłużyć tego klienta. W
konfiguracji klienta (routera) trzeba będzie również uzupełnić ten parametr by wskazywał dokładnie
tę samą wartość. W przeciwnym wypadku serwer freeradius zrzuci wszystkie zapytania otrzymane od
tego konkretnego AP/NAS co uniemożliwi podłączenie się użytkownikom do sieci. W logu freeradius zaś
będzie widoczny poniższy komunikat:</p>
<pre><code>rad_recv: Access-Request packet from host 192.168.1.1 port 41805, id=10, length=177
Thu Sep 18 11:54:59 2014 : Info: Received packet from 192.168.1.1 with invalid Message-Authenticator!  (Shared secret is incorrect.) Dropping packet without response.
</code></pre>
<h3 id="konfiguracja-apnas">Konfiguracja AP/NAS</h3>
<p>Logujemy się na router po ssh i edytujemy plik <code>/etc/config/wireless</code> , w którym to trzeba
zdefiniować parametry serwera freeradius:</p>
<pre><code>...
config wifi-iface
   option device 'radio0'
   option network 'lan'
   option mode 'ap'
   option ssid 'Winter Is Coming'
   option encryption 'wpa2+aes'
   option key 'tajna-fraza'
   option server '192.168.1.166'
   option port '1812'
   option disabled '0'
   option hidden '0'
   option isolate '0'
...
</code></pre>
<p>Parametr <code>key</code> odpowiada za <code>secret</code> ustawiony w <code>/etc/freeradius/clients.conf</code> .</p>
<p>Musimy także wymienić nieco oprogramowania, bo domyślnie zainstalowany pakiet <code>wpad-mini</code> nie
zawiera obsługi WPA2 Enterprise. Jeśli chcemy mieć obsługę WPA2 Enterprise, to musimy doinstalować
pakiet <code>wpad</code> uprzednio usuwając <code>pakiet wpad-mini</code> :</p>
<pre><code># opkg remove wpad-mini
# opkg install wpad
</code></pre>
<p>Teraz już tylko resetujemy WiFi na routerze:</p>
<pre><code># wifi
</code></pre>
<h3 id="konfiguracja-użytkowników">Konfiguracja użytkowników</h3>
<p>By użytkownik mógł się podłączyć do sieci, potrzebne są mu login i hasło, a te zaś, na serwerze
freeradius, mogą być przechowywane w różny sposób. Domyślnie freeradius trzyma konfigurację
użytkowników w pliku <code>/etc/freeradius/users</code> . Innym rozwiązaniem jest zaprzęgnięcie do obsługi
użytkowników bazy danych, definiując w niej min. parametry logowania.</p>
<p>W przypadku jednoczesnego włączenia szeregu modułów, może się zdarzyć sytuacja, w której dany
użytkownik zostanie zdefiniowany, powiedzmy, dwa razy. W takiej sytuacji będzie decydować kolejność
wywołania modułów w pliku konfiguracyjnym i ostatni moduł przetwarzający danego użytkownika będzie
decydował czy przyznać mu dostęp.</p>
<p>Warto także pamiętać o tym, że każdy moduł posiada swój plik konfiguracyjny w katalogu
<code>/etc/freeradius/modules/</code> , za wyjątkiem kilku podstawowych modułów, które posiadają swoją
konfigurację w odpowiednich plikach w katalogu <code>/etc/freeradius/</code> .</p>
<h4 id="moduł-files">Moduł files</h4>
<p>W przypadku tego modułu, użytkowników definiuje się w pliku <code>/etc/freeradius/users</code> . Dodajmy na
końcu tego pliku dwóch użytkowników -- jeden z nich przetestuje uwierzytelnianie EAP-TTLS/PEAP , a
drugi EAP-TLS:</p>
<pre><code>&quot;morfik&quot;          Cleartext-Password := &quot;morfik-ma-kota&quot;
                  Reply-Message = &quot;Witaj, %{User-Name}&quot;

&quot;morfik_laptop&quot;   Auth-type := EAP
                  Reply-Message = &quot;Witaj, Morfiku!&quot;

DEFAULT           Auth-type := Reject
                  Reply-Message := &quot;SPADAJ NA DRZEWO!&quot;
</code></pre>
<p>Freeradius szuka w powyższym pliku dopasowań i domyślnie jeśli jakieś znajdzie, kończy
przetwarzanie. Takie zachowanie można dostosować ale na razie zostawmy tak jak jest. Jeśli
użytkownik nie zostanie odnaleziony, zadziała linijka z <code>DEFAULT</code> , czyli zapytanie zostanie
odrzucone z odpowiednim komunikatem. Przy czy, jeśli zamierzamy korzystać z anonimowej tożsamości
(przy EAP-TTLS/PEAP), to nie możemy sprecyzować domyślnego zrzucania zapytań, bo wtedy serwer
freeradius nie będzie chciał rozmawiać z użytkownikiem anonimowym.</p>
<p>Użytkownicy posiadający <code>Cleartext-Password</code> będą się łączyć do sieci przy pomocy protokołów
EAP-TTLS/PEAP. Z kolei ci posiadający <code>Auth-type := EAP</code> , przy pomocy jednej z pozostałych metod
EAP, w tym też EAP-TLS, w którym to nazwa zdefiniowana jako użytkownik zależy od pola <code>CommonName</code>
certyfikatu.</p>
<h4 id="moduł-unix">Moduł unix</h4>
<p>Jeśli chodzi o samych użytkowników, nie jest wymagane korzystanie z zewnętrznego oprogramowania
bazodanowego. Możemy skorzystać z bazy danych użytkowników debiana. Po to właśnie freeradius ma
dostęp do pliku <code>/etc/shadow</code> by móc czytać zahashowane hasła użytkowników systemowych. Jeśli jakiś
klient WiFi posiada konto w systemie i jest ono aktywne, będzie mógł wykorzystać jego login i hasło
jako dane dostępowe do sieci WiFi.</p>
<p>Trzeba jednak pamiętać, że to z jakiego modułu będziemy korzystać przy weryfikacji użytkowników, ma
<a href="http://deployingradius.com/documents/protocols/compatibility.html">wpływ na dostępne dla nas metody
uwierzytelniania</a>. Protokół PAP
może być użyty ze wszystkimi dostępnymi metodami, bo przesyła hasła zwykłym tekstem. Podobnie
protokół CHAP. Z kolei MS-CHAP wymaga, albo haseł podanych zwykłym tekstem, albo hashów
NT-Password. W przypadku haseł debiana, musimy skorzystać z protokołu PAP. Nie ma zbytnio dla nas
znaczenia czy przesyłanie haseł jest jakoś zabezpieczone przez dany protokół, bo i tak wszystko
wleci w kanał TLS. Jeśli zdecydujemy się zmienić domyślne zarządzanie hasłami we freeradius'ie,
trzeba zmodyfikować odpowiednie sekcje w plikach konfiguracyjnych. Edytujemy zatem pliki
<code>/etc/freeradius/sites-enabled/default</code> oraz <code>/etc/freeradius/sites-enabled/inner-tunnel</code> i w sekcji
<code>authorize</code> zmieniamy sposób obsługiwania użytkowników:</p>
<pre><code>...
authorize {
      ...
      unix
   ...
#     files
...
</code></pre>
<p>Oczywiście można korzystać z obu tych modułów jednocześnie, tylko trzeba pilnować by dany użytkownik
nie powtarzał się, co może powodować problemy z uwierzytelnianiem. Dodatkowo by zabezpieczyć nieco
sam serwer, należy wyłączyć możliwość używania shella oraz zmienić katalog domowy w kontach
używanych przez freeradius. Na sam początek edytujemy plik <code>/etc/default/useradd</code> i zmieniamy w nim
poniższe linijki:</p>
<pre><code>...
#SHELL=/bin/sh
SHELL=/usr/sbin/nologin_freeradius
...
HOME=/var/run
...
</code></pre>
<p>Shell <code>/usr/sbin/nologin_freeradius</code> jest kopią <code>/usr/sbin/nologin</code> i jak każdy inny shell, który
nie jest faktycznie shellem, zostanie potraktowany przez freeradius'a jako błędny. Problem w tym, że
freeradius nie chce obsługiwać takiego shella. Wyjściem jest dodanie powyższego shella do listy
poprawnych. Dodajemy zatem ścieżkę <code>/usr/sbin/nologin_freeradius</code> do pliku <code>/etc/shells</code> :</p>
<pre><code># echo &quot;/usr/sbin/nologin_freeradius&quot; &gt;&gt; /etc/shells

# cat /etc/shells
# /etc/shells: valid login shells
/bin/sh
/bin/dash
/bin/bash
/bin/rbash
/usr/sbin/nologin_freeradius
</code></pre>
<p>Tworzymy testowe konto użytkownika:</p>
<pre><code># useradd morfikanin
</code></pre>
<p>Sprawdźmy czy jego konfiguracja jest poprawna:</p>
<pre><code># grep morfikanin /etc/passwd
morfikanin:x:1001:1001::/var/run/morfikanin:/usr/sbin/nologin_freeradius

# grep morfikanin /etc/group
morfikanin:x:1001:

# grep morfikanin /etc/shadow
morfikanin:$6$ztDybjKr$w29hLJJIemqD940VyQBOw/VDRtXoxotWsE.DigutD3UjRa9.Zh/5LZ9fcILJ00iZQ4dCycwfL9gd5FOzmWlbA0:16324:0:99999:7:::
</code></pre>
<p>I to z grubsza tyle, przynajmniej jeśli chodzi o konfigurację modułu <code>unix</code> na serwerze freeradius.
Trzeba także zmienić nieco konfigurację wpasupplicant'a na stacji klienckiej. Chodzi o odpowiednie
dostosowanie fazy drugiej połączenia, tej wewnątrz tunelu TLS:</p>
<pre><code>...
phase2=&quot;auth=PAP&quot;
...
</code></pre>
<h3 id="restrykcje-czasowe-moduł-logintime">Restrykcje czasowe (moduł logintime)</h3>
<p>Freeradius pozwala także na ustanowienie limitów czasu połączenia, np. jeśli chcemy by dany
użytkownik miał dostęp do sieci w godzinach 18-22. Do tego celu służy moduł <code>logintime</code> i jest
domyślnie włączony. By ustawić limit użytkownikom, musimy wyedytować plik <code>/etc/freeradius/users</code> i
zmienić nieco domyślne wpisy użytkowników, które ustawiliśmy wyżej, przykładowo:</p>
<pre><code>&quot;morfik&quot;        Cleartext-Password := &quot;morfik-ma-kota&quot;, Login-Time :='Al1800-2200'
</code></pre>
<p>Parametr <code>Login-Time</code> składa się z trzech części. Dwie z nich to godziny, które precyzują czas
(format 24 godzinny) w jakim użytkownik może być zalogowanym do sieci -- start o 18:00 (1800) i
koniec o 22:00 (2200). Ostatnia z trzech części to, w tym wypadku <code>Al</code> (małe L), co oznacza <code>all</code> ,
czyli wszystkie dni tygodnia. Można sprecyzować też szereg innych wartości: <code>Mo</code> , <code>Tu</code> , <code>We</code> ,
<code>Th</code> , <code>Fr</code> , <code>Sa</code> , <code>Su</code> , czyli dwie pierwsze litery angielskiej nazwy dnia tygodnia. Można
również określić przedział, np. od poniedziałku do piątku w postaci <code>Mo-Fr</code> . Dodatkowo, można
stosować kombinacje, przykładowo: <code>&quot;Mo-We1300-1400,Sa,Su2305-0630&quot;</code> , co oznacza, że użytkownik może
się zalogować do sieci od poniedziałku do środy w godzinach 13-14. Dodatkowo może być zalogowany w
sobotę cały czas i w niedzielę w nocy od 23:05 do 6:30 rano w poniedziałek.</p>
<p>Przy logowaniu się do sieci po godzinie 22, serwer freeradius zwróci poniższy komunikat:</p>
<pre><code>Sun Sep 14 22:29:25 2014 : Debug: rlm_logintime: Checking Login-Time: 'Al1800-2200'
Sun Sep 14 22:29:25 2014 : Debug: rlm_logintime: timestr returned reject
Sun Sep 14 22:29:25 2014 : Info: [logintime]    expand: You are calling outside your allowed timespan   -&gt; You are calling outside your allowed timespan
Sun Sep 14 22:29:25 2014 : Info: ++[logintime] returns reject
</code></pre>
<p>A my nie będziemy w stanie się podłączyć do sieci. W przypadku gdyby użytkownik zalogował się
wcześniej, np. o godzinie 21:34, wtedy zostanie wyliczony timeout w sekundach, po którym użytkownik
wyleci z sieci (zostanie rozłączony), przykładowo:</p>
<pre><code>Sun Sep 14 21:34:19 2014 : Debug: rlm_logintime: Checking Login-Time: 'Al1800-1900'
Sun Sep 14 21:34:19 2014 : Debug: rlm_logintime: timestr returned accept
Sun Sep 14 21:34:19 2014 : Debug: rlm_logintime: Session-Timeout set to: 1620
Sun Sep 14 21:34:19 2014 : Info: ++[logintime] returns ok
</code></pre>
<p><code>Session-Timeout set to: 1620</code> to 1620 sekund, czyli 27 minut. O godzinie 22:01:19 powinno nastąpić
rozłączenie.</p>
<p>Rozłączanie w oparciu o <code>Session-Timeout</code> nie zadziała jeśli nie zmienimy domyślnej konfiguracji EAP
w pliku <code>/etc/freeradius/eap.conf</code> . Musimy przepisać poniższe parametry:</p>
<pre><code>...
ttls {
      ...
      copy_request_to_tunnel = yes
      use_tunneled_reply = yes
...
peap {
...
   copy_request_to_tunnel=yes
   use_tunneled_reply = yes
...
</code></pre>
<h3 id="liczba-sesji-podłączonych-do-sieci">Liczba sesji podłączonych do sieci</h3>
<p>Zwykle użytkownik nawiązuje jedno połączenie do sieci. Może ich nawiązać więcej, np. podłączyć
drugie urządzenie i wpisać w nim dokładnie takie same dane do logowania. Może także odsprzedać swój
login komuś trzeciemu i mogą oni we dwóch korzystać z naszej sieci. Możemy taki proceder ukrócić
przez ustawienie limitu jednoczesnych zalogowań do sieci per user.</p>
<p>Jeśli interesuje nas ograniczanie ilości aktywnych sesji użytkownika, edytujemy plik
<code>/etc/freeradius/users</code> :</p>
<pre><code>&quot;morfik&quot;        Cleartext-Password := &quot;morfik-ma-kota&quot;, Simultaneous-Use := '1'
</code></pre>
<p>Jeśli teraz ten użytkownik spróbuje się zalogować na drugim urządzeniu mając przy tym już jedną
aktywną sesję, nowa sesja nie zostanie ustanowiona.</p>
<h3 id="filtrowanie-nazw-użytkowników-moduł-filter_username">Filtrowanie nazw użytkowników (moduł filter_username)</h3>
<p>W celu zapewnienia rozsądnych nazw użytkowników używanych przy logowaniu do sieci WiFi, możemy
wykorzystać moduł <code>filter_username</code> . Jeśli trafią się zapytania, które będą pasować do wzorca
zdefiniowanego w <code>/etc/freeradius/policy.conf</code> , freeradius ich nie zaakceptuje. Jeśli chcemy takiej
weryfikacji, to w pliku <code>/etc/freeradius/sites-enabled/default</code> w sekcji <code>authorize</code> musimy
odkomentować:</p>
<pre><code>...
authorize {
   filter_username
...
</code></pre>
<p>Jeśli nie zadowalają nas domyślne reguły filtra ustawione w <code>/etc/freeradius/policy.conf</code> , możemy
część z nich wykomentować, a także zdefiniować własne filtry. Ja korzystam z tego poniższego:</p>
<pre><code>filter_username {
            #
            #  reject mixed case
            #  e.g. &quot;UseRNaMe&quot;
            #
            if (User-Name != &quot;%{tolower:%{User-Name}}&quot;) {
                        reject
            }

            #
            #  reject all whitespace
            #  e.g. &quot;user@ site.com&quot;, or &quot;us er&quot;, or &quot; user&quot;, or &quot;user &quot;
            #
            if (User-Name =~ / /) {
                        update reply {
                                    Reply-Message += &quot;Rejected: Username contains whitespace&quot;
                        }
                        reject
            }

            #
            #  reject Multiple @'s
            #  e.g. &quot;user@site.com@site.com&quot;
            #
            if(User-Name =~ /@.*@/ ) {
                        update reply {
                                    Reply-Message += &quot;Rejected: Multiple @ in username&quot;
                        }
                        reject
            }

            #
            #  reject double dots
            #  e.g. &quot;user@site..com&quot;
            #
            if (User-Name =~ /\.\./ ) {
                        update reply {
                                    Reply-Message += &quot;Rejected: Username comtains ..s&quot;
                        }
                        reject
            }

            #
            #  must have at least 1 string-dot-string after @
            #  e.g. &quot;user@site.com&quot;
            #
            if (User-Name !~ /@(.+)\.(.+)$/)  {
                        update reply {
                                    Reply-Message += &quot;Rejected: Realm does not have at least one dot seperator&quot;
                        }
                        reject
            }

            #
            #  Realm ends with a dot
            #  e.g. &quot;user@site.com.&quot;
            #
            if (User-Name =~ /\.$/)  {
                        update reply {
                                    Reply-Message += &quot;Rejected: Realm ends with a dot&quot;
                        }
                        reject
            }

            #
            #  Realm begins with a dot
            #  e.g. &quot;user@.site.com&quot;
            #
            if (User-Name =~ /@\./)  {
                        update reply {
                                    Reply-Message += &quot;Rejected: Realm begins with a dot&quot;
                        }
                        reject
            }
}
</code></pre>
<h2 id="testowanie-konfiguracji">Testowanie konfiguracji</h2>
<p>Zaleca się by testować niewielkie zmiany dokonywane w konfiguracji freeradius'a. Także jeśli coś z
powyższego nie działa, najlepiej powrócić domyślne ustawienia całej konfiguracji i jeszcze raz
wprowadzić zmiany, tym razem mniejsze i po każdej zmianie dokonać sprawdzenia poprawności
konfiguracji opisanymi tutaj sposobami.</p>
<p>Jak już wspomniałem wcześniej, freeradius może zostać odpalony w trybie debug przy pomocy poniższego
polecenia:</p>
<pre><code># freeradius -X
</code></pre>
<p>Im więcej <code>X</code> sprecyzujemy, tym bardziej szczegółowe będą logi, maksymalnie można ustawić trzy (
<code>-XXX</code> ). Weryfikacja plików konfiguracyjnych odbywa się przez sprecyzowanie opcji <code>-C</code> ,
przykładowo:</p>
<pre><code>root@radius:~# freeradius -XXXC
...
Sun Sep 14 13:54:37 2014 : Debug: Configuration appears to be OK.
</code></pre>
<p>Jeśli wystąpią jakieś problemy i freeradius nie będzie się chciał nam odpalić, wtedy wystarczy
zajrzeć w log i tam z pewnością będzie wypisane co nawaliło i nawet jak to poprawić.</p>
<p>To mniej więcej tyle jeśli chodzi o debug serwera ale możemy także zajrzeć w logi klienta. Narzędzie
wpasupplicant wypluwa też pokaźne logi. Poniżej znajdują się dwie linijki, które trzeba wpisać jedna
po drugiej w osobnych terminalach,
przykładowo:</p>
<pre><code># /sbin/wpa_supplicant -dd -P /var/run/wpa_supplicant.wlan1.pid -i wlan1 -W -b bond0 -D nl80211,wext -c /etc/wpa_supplicant/wpa_supplicant.conf
...
CTRL_IFACE - wlan1 - wait for monitor to attach
</code></pre>
<p>I teraz wpisujemy drugą z
linijek:</p>
<pre><code># /sbin/wpa_cli -P /var/run/wpa_action.wlan0.pid -i wlan0 -p /var/run/wpa_supplicant -a /sbin/wpa_action
</code></pre>
<p>Po jej wpisaniu powinno się rozpocząć podłączanie klienta do sieci WiFi i powinien zostać
wyświetlony obszerny log na pierwszej konsoli, w którym można prześledzić wszystkie etapy
połączenia, na wypadek gdyby coś poszło nie tak.</p>
<h3 id="narzędzia-testowe-freeradiusa">Narzędzia testowe freeradius'a</h3>
<p>Freeradius dostarcza kilka narzędzi testowych. Są one zawarte w pakiecie <code>freeradius-utils</code> . Nas
głównie interesują dwa z nich <code>radclient</code> oraz <code>radtest</code> , z tym, że <code>radtest</code> jest nakładką na
<code>radclient</code>. Oba programy się używa nieco inaczej ale każdy z nich dostarcza tych samych informacji
na temat przesyłanych pakietów.</p>
<p>Poniżej jest przedstawiony prosty test logowania się do sieci z wykorzystaniem obu wspomnianych
narzędzi:</p>
<pre><code>$ radtest morfik tajne-haslo 192.168.1.166 0 test-test
Sending Access-Request of id 248 to 192.168.1.166 port 1812
        User-Name = &quot;morfik&quot;
        User-Password = &quot;tajne-haslo
        NAS-IP-Address = 192.168.1.150
        NAS-Port = 0
        Message-Authenticator = 0x00000000000000000000000000000000
rad_recv: Access-Accept packet from host 192.168.1.166 port 1812, id=248, length=20

$ echo &quot;User-Name = morfik, User-Password = tajne-haslo&quot; | radclient -x 192.168.1.166 auth test-test
Sending Access-Request of id 200 to 192.168.1.166 port 1812
        User-Name = &quot;morfik&quot;
        User-Password = &quot;tajne-haslo&quot;
rad_recv: Access-Accept packet from host 192.168.1.166 port 1812, id=200, length=20
</code></pre>
<p>Jak widać wyżej, <code>radtest</code> jest nieco prostszy w użyciu. Zwykle z powyższych narzędzi będzie się
korzystać na maszynie, na której jest zainstalowane oprogramowanie freeradius i trzeba się upewnić,
że serwer freeradius'a nie ma sprecyzowanego interfejsu i adresu w pliku
<code>/etc/freeradius/radiusd.conf</code> oraz, że w pliku <code>/etc/freeradius/clients.conf</code> (lub w bazie danych)
widnieje wpis zezwalający przyjmować żądania z adresu <code>127.0.0.1</code> , czyli z lokalnej maszyny. Jeśli
któryś z powyższych warunków nie zostanie spełniony, testy się nie powiodą.</p>
<h4 id="test-konfiguracji-eap">Test konfiguracji EAP</h4>
<p>Oprogramowanie freeradius nie jest w stanie przeprowadzić testów EAP. Do tego celu potrzebne nam
będzie narzędzie <code>eapol_test</code> , które jest dostarczane z pakietem wpasupplicant. Problem w tym, że
domyślnie opcje od <code>eapol_test</code> są zahashowane i by móc używać tego narzędzia, trzeba je sobie
samemu skompilować. Inny problem w tym, że mi na debianie nie udało się tego narzędzia zbudować, bo
przy kompilacji ciągle mi wyrzucało jakiegoś wrednego błęda. W każdym razie, opis kompilacji jak i
samego narzędzia można znaleźć <a href="http://deployingradius.com/scripts/eapol_test/">pod tym linkiem</a>.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/szyfrowanie/">szyfrowanie</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/wifi/">wifi</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/sie%C4%87/">sieć</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&amp;text=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&amp;title=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&amp;title=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&title=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&amp;title=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwpa2-enterprise-serwer-freeradius%2f&description=WPA%2fWPA2%20Enterprise%20i%20serwer%20freeradius" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/interwal-pakietow-beacon-w-sieciach-wifi/">Interwał pakietów Beacon w sieciach WiFi</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/generowanie-certyfikatow-przy-pomocy-easy-rsa/">Generowanie certyfikatów przy pomocy easy-rsa</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/zaszyfrowane-logi-w-rsyslog-i-syslog-ng/">Zaszyfrowane logi w rsyslog i syslog-ng</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/generowanie-certyfikatow/">Generowanie certyfikatów</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/sterowniki-karty-tp-link-archer-t4u-8812au/">Sterowniki do karty TP-LINK Archer T4U (8812au)</a></li>
		
	</ul>
</div>

	
<section class="comments block">
	<div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "morfitronik" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
</section>


	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2020 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">
			<img alt="Licencja Creative Commons" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" />
		</a>
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
</body>
</html>