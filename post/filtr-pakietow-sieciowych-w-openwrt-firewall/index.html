<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Filtr pakietów sieciowych w OpenWRT (firewall) | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Filtr pakietów sieciowych w OpenWRT (firewall)" />
<meta property="og:description" content="Router wyposażony w firmware OpenWRT posiada wbudowany firewall, który ma za zadnie stać na straży
bezpieczeństwa naszej sieci domowej. Standardowo ta zapora przepuszcza cały ruch sieciowy z obszaru
LAN do WAN, czyli z sieci lokalnej do sieci naszego ISP. W ten sposób komputery znajdujące się w
naszej sieci mają dostęp do internetu i mogą z niego korzystać bez przeszkód. Niemniej jednak, ten
mechanizm nie działa tak samo w drugą stronę, czyli z WAN do LAN. Tutaj są już blokowane wszystkie
próby nawiązania nowych połączeń (za wyjątkiem żądań
ping) ale nic nie stoi na
przeszkodzie, by zastosować przekierowanie portów. Dzięki takiemu rozwiązaniu możemy przekierować
ruch, który jest kierowany na dany port w routerze, do określonego hosta w sieci lokalnej. Wszystkie
te zadania realizowane są przez iptables i w tym wpisie postaramy się ogarnąć to narzędzie." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/filtr-pakietow-sieciowych-w-openwrt-firewall/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-05-09T23:26:58+00:00" />
<meta property="article:modified_time" content="2016-05-09T23:26:58+00:00" />


		<meta itemprop="name" content="Filtr pakietów sieciowych w OpenWRT (firewall)">
<meta itemprop="description" content="Router wyposażony w firmware OpenWRT posiada wbudowany firewall, który ma za zadnie stać na straży
bezpieczeństwa naszej sieci domowej. Standardowo ta zapora przepuszcza cały ruch sieciowy z obszaru
LAN do WAN, czyli z sieci lokalnej do sieci naszego ISP. W ten sposób komputery znajdujące się w
naszej sieci mają dostęp do internetu i mogą z niego korzystać bez przeszkód. Niemniej jednak, ten
mechanizm nie działa tak samo w drugą stronę, czyli z WAN do LAN. Tutaj są już blokowane wszystkie
próby nawiązania nowych połączeń (za wyjątkiem żądań
ping) ale nic nie stoi na
przeszkodzie, by zastosować przekierowanie portów. Dzięki takiemu rozwiązaniu możemy przekierować
ruch, który jest kierowany na dany port w routerze, do określonego hosta w sieci lokalnej. Wszystkie
te zadania realizowane są przez iptables i w tym wpisie postaramy się ogarnąć to narzędzie."><meta itemprop="datePublished" content="2016-05-09T23:26:58+00:00" />
<meta itemprop="dateModified" content="2016-05-09T23:26:58+00:00" />
<meta itemprop="wordCount" content="2486">
<meta itemprop="keywords" content="iptables,chaos-calmer,router," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Filtr pakietów sieciowych w OpenWRT (firewall)"/>
<meta name="twitter:description" content="Router wyposażony w firmware OpenWRT posiada wbudowany firewall, który ma za zadnie stać na straży
bezpieczeństwa naszej sieci domowej. Standardowo ta zapora przepuszcza cały ruch sieciowy z obszaru
LAN do WAN, czyli z sieci lokalnej do sieci naszego ISP. W ten sposób komputery znajdujące się w
naszej sieci mają dostęp do internetu i mogą z niego korzystać bez przeszkód. Niemniej jednak, ten
mechanizm nie działa tak samo w drugą stronę, czyli z WAN do LAN. Tutaj są już blokowane wszystkie
próby nawiązania nowych połączeń (za wyjątkiem żądań
ping) ale nic nie stoi na
przeszkodzie, by zastosować przekierowanie portów. Dzięki takiemu rozwiązaniu możemy przekierować
ruch, który jest kierowany na dany port w routerze, do określonego hosta w sieci lokalnej. Wszystkie
te zadania realizowane są przez iptables i w tym wpisie postaramy się ogarnąć to narzędzie."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Filtr pakietów sieciowych w OpenWRT (firewall)</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-05-09T23:26:58Z">Opublikowano: 09/05/2016</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/openwrt/" rel="category">OpenWRT</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Filtr pakietów sieciowych w OpenWRT (firewall)</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#własny-firewall-czy-ten-dostarczany-z-openwrt">Własny firewall, czy ten dostarczany z OpenWRT</a></li>
    <li><a href="#analiza-struktury-firewalla">Analiza struktury firewall'a</a>
      <ol>
        <li><a href="#drop-vs-reject">DROP vs. REJECT</a></li>
      </ol>
    </li>
    <li><a href="#analiza-reguł-dostępnych-w-pliku-etcconfigfirewall">Analiza reguł dostępnych w pliku /etc/config/firewall</a>
      <ol>
        <li><a href="#konfiguracja-zachowania-firewalla-sekcja-config-defaults">Konfiguracja zachowania firewall'a (sekcja config defaults)</a></li>
        <li><a href="#strefy-sekcja-config-zone">Strefy (sekcja config zone)</a></li>
        <li><a href="#forwarding-pakietów-sekcja-config-forwarding">Forwarding pakietów (sekcja config forwarding)</a></li>
        <li><a href="#reguły-sekcja-config-rule">Reguły (sekcja config rule)</a></li>
        <li><a href="#przekierowania-i-port-forwarding-sekcja-config-redirect">Przekierowania i port forwarding (sekcja config redirect)</a></li>
      </ol>
    </li>
    <li><a href="#sprawdzanie-reguł-firewalla">Sprawdzanie reguł firewall'a</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Router wyposażony w firmware OpenWRT posiada wbudowany firewall, który ma za zadnie stać na straży
bezpieczeństwa naszej sieci domowej. Standardowo ta zapora przepuszcza cały ruch sieciowy z obszaru
LAN do WAN, czyli z sieci lokalnej do sieci naszego ISP. W ten sposób komputery znajdujące się w
naszej sieci mają dostęp do internetu i mogą z niego korzystać bez przeszkód. Niemniej jednak, ten
mechanizm nie działa tak samo w drugą stronę, czyli z WAN do LAN. Tutaj są już blokowane wszystkie
próby nawiązania nowych połączeń (<a href="https://morfikov.github.io/post/kompromitacja-firewalla-openwrt-za-sprawa-ping/">za wyjątkiem żądań
ping</a>) ale nic nie stoi na
przeszkodzie, by zastosować przekierowanie portów. Dzięki takiemu rozwiązaniu możemy przekierować
ruch, który jest kierowany na dany port w routerze, do określonego hosta w sieci lokalnej. Wszystkie
te zadania realizowane są przez <code>iptables</code> i w tym wpisie postaramy się ogarnąć to narzędzie.</p>
<h2 id="własny-firewall-czy-ten-dostarczany-z-openwrt">Własny firewall, czy ten dostarczany z OpenWRT</h2>
<p>Przede wszystkim, trzeba powiedzieć, że skoro będziemy operować na <code>iptables</code> , to możemy
zrezygnować całkowicie z mechanizmu firewall'a oferowanego przez OpenWRT. Niemniej jednak, na samym
początku będzie nam trudno opanować składnie reguł dla tego filtra. Jeśli nigdy nie mieliśmy do
czynienia z linux'em i pierwszy raz na oczy widzimy nazwę <code>iptables</code> , to lepiej zostać przy
mechanizmie oferowanym przez OpenWRT. W tym artykule tak właśnie zrobimy. Jeśli jednak ktoś chciałby
się zagłębić w <a href="https://www.frozentux.net/iptables-tutorial/iptables-tutorial.html">tematykę iptables, to może zacząć od tego
linku</a>. Na tym blogu poruszałem
też już zagadnienie dotyczące <a href="https://morfikov.github.io/post/firewall-na-linuxowe-maszyny-klienckie/">budowy firewall'a dla klientów działających pod
linux'em</a>. Jako, że wszystkie
zawarte w tamtym wpisie informacje można zastosować w tym przypadku, to zachęcam też do zajrzenia i
zapoznania się z tamtym artykułem.</p>
<p>Firewall w OpenWRT składa się z grubsza z dwóch plików konfiguracyjnych, na których będziemy
operować. Pierwszym z nich jest <code>/etc/config/firewall</code> . W tym pliku znajduje się cała domyślna
konfiguracja, która zabezpiecza nasz router i sieć przed dostępem od strony interfejsu WAN. To w nim
będziemy definiować podstawowe regułki, które będą mieć za zadanie przekierować czy też zablokować
przepływ pakietów. Drugim z plików jest <code>/etc/firewall.user</code> . Do niego wędrują reguły, które z
jakiegoś powodu nie mogą trafić do pliku <code>/etc/config/firewall</code> . Zwykle w nim będziemy umieszczać
bardziej zaawansowane rzeczy, których nie da się zbytnio wyrzeźbić w oparciu od ten standardowy
mechanizm filtrowania pakietów.</p>
<p>Firewall dostępny w OpenWRT został podzielony na szereg pakietów. Wszystkie niestandardowe lub też
rzadko używane moduły zostały upchnięte w osobnych paczkach. Zatem nie wszystkie opcje oferowane
przez <code>iptables</code> są dostępne. Nic jednak nie stoi na przeszkodzie, by sobie doinstalować dodatkowe
pakiety. Każdy z takich pakietów ma opis na temat tego jaki moduł zostanie zaimplementowany po jego
instalacji. Listę pakietów dostępnych w repozytorium możemy uzyskać wpisując w terminalu to poniższe
polecenie:</p>
<pre><code># opkg list | grep iptables-mod
</code></pre>
<p>Skrypt aplikujący reguły <code>iptables</code> znajduje się w <code>/etc/init.d/firewall</code> . Przy jego pomocy możemy
wyczyścić aktualnie zaaplikowane reguły lub też przeładować konfigurację:</p>
<pre><code># /etc/init.d/firewall reload
</code></pre>
<h2 id="analiza-struktury-firewalla">Analiza struktury firewall'a</h2>
<p>Zanim jednak się weźmiemy za analizę plików <code>/etc/config/firewall</code> oraz <code>/etc/firewall.user</code> , warto
przybliżyć sobie nieco strukturę firewall'a. Przede wszystkim, <code>iptables</code> składa się z czterech
tablic <code>raw</code> , <code>mangle</code> , <code>nat</code> oraz <code>filter</code> . W każdej z tablicy mamy szereg wbudowanych
łańcuchów, przez które przechodzą pakiety. Są też z grubsza trzy kierunki przepływu pakietów: do
routera, z routera i przez router. Wszystkie te rzeczy są dokładnie zobrazowane na poniższych
fotkach (<a href="https://commons.wikimedia.org/wiki/File:Netfilter-packet-flow.svg">źródło</a>):</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2015/06/1.firewall-iptables-przeplyw-pakietow.png" alt="firewall-iptables-przeplyw-pakietow"    class="medium"></p>
<p>oraz:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/05/1.przeplyw-pakietow-netfilter-iptables-openwrt-firewall.png" alt="przeplyw-pakietow-netfilter-iptables-openwrt-firewall"    class="huge"></p>
<p>Te schematy zostały jednak nieco rozbudowane przez OpenWRT. Chodzi generalnie o to, że w każdej z
tych czterech tablic można definiować własne łańcuchy i kierować do nich ruch. OpenWRT dostarcza
szereg takich łańcuchów. Każdy z nich pełni pewną rolę w strukturze filtra. Bez zrozumienia zasady
przepływu pakietów w oparciu o te dodatkowe łańcuchy, nie będziemy w stanie komfortowo operować na
filtrze udostępnianym przez OpenWRT.</p>
<p>Z reguły będziemy operować na tablicach <code>nat</code> oraz <code>filter</code> . W <code>nat</code> będą umieszczane reguły
związane z translacją adresów, np. przekierowanie portów. Z klei w tablicy <code>filter</code> będziemy
zarządzać blokowaniem i przepuszczaniem pakietów.</p>
<h3 id="drop-vs-reject">DROP vs. REJECT</h3>
<p>Reguły mogą być akceptowane (ACCEPT), odrzucane (REJECT) oraz zrzucane (DROP). Te dwie ostatnie
opcje dotyczą negatywnej odpowiedzi na przesłane żądanie połączenia. Która zatem z nich jest lepsza,
DROP czy REJECT? Na dobrą sprawę nie ma jednoznacznej odpowiedzi i musimy się na którąś z tych opcji
zdecydować. Przede wszystkim, DROP nie udostępnia żadnych informacji osobie, która próbuje się
podłączyć. Jeśli taki pakiet zostanie zrzucony, to druga strona o tym może z początku nawet nie
wiedzieć. Utrudnia to trochę ustalanie przyczyny ewentualnych problemów z siecią. Poza tym, szereg
aplikacji sieciowych może reagować w bardzo powolny sposób, jako że nie dostają żadnej odpowiedzi
od routera. W przypadku REJECT mamy te powyższe informacje i te problemy nas nie dotyczą. Z drugiej
zaś strony, skoro my posiadamy te informacje, to i potencjalny atakujący również. Dodatkowo, jako,
że router udziela odpowiedzi na szereg nieprawidłowych żądań komunikatami ICMP, to może to w
pewnych sytuacjach wykończyć router.</p>
<h2 id="analiza-reguł-dostępnych-w-pliku-etcconfigfirewall">Analiza reguł dostępnych w pliku /etc/config/firewall</h2>
<p>Przejdźmy zatem do analizy pliku <code>/etc/config/firewall</code> . Jest on dość rozbudowany ale zaraz sobie
wyjaśnimy za co odpowiadają konkretne sekcje i linijki w nich zawarte. Wszystkie dostępne opcje,
które można umieścić w tym pliku, są do odszukania na <a href="https://wiki.openwrt.org/doc/uci/firewall">wiki
OpenWRT</a>. Plik <code>/etc/config/firewall</code> jest podzielony
szereg na sekcji. Poniżej znajduje się opis każdej z nich.</p>
<h3 id="konfiguracja-zachowania-firewalla-sekcja-config-defaults">Konfiguracja zachowania firewall'a (sekcja config defaults)</h3>
<p>W sekcji <code>config defaults</code> znajdują się ustawienia firewall'a, które nie są przypisane do żadnej
innej sekcji. Poniżej przykład ustawień:</p>
<pre><code>config defaults
    option drop_invalid        1
    option synflood_protect    1
    option synflood_rate       25/second
    option synflood_burst      50
    option tcp_syncookies      1
    option tcp_window_scaling  1
    option accept_redirects    0
    option accept_source_route 0
    option input               DROP
    option output              ACCEPT
    option forward             DROP
#   option disable_ipv6        1
</code></pre>
<p>Jak widzimy wyżej, mamy szereg opcji, które sterują zachowaniem firewall'a. Opcja <code>drop_invalid</code>
jest w stanie blokować pakiety, które mają przykładowo błędną konfigurację flag w protokole TCP. Z
kolei <code>synflood_protect</code> chroni przed nawiązywaniem przez router zbyt dużej ilości nowych połączeń w
danej chwili. Limit zaś jest określony w opach <code>synflood_rate</code> oraz <code>synflood_burst</code> , czyli z
grubsza 25 nowych połączeń na sekundę. Wszystkie połączenia ponad ten limit zostaną zrzucone. Mamy
również <a href="https://morfikov.github.io/post/mechanizm-syn-cookies-w-protokole-tcp/">mechanizm ciasteczek (SYN
cookies)</a> włączony za sprawą opcji
<code>tcp_syncookies</code> . Z kolei opcja <code>tcp_window_scaling</code> włącza <a href="https://morfikov.github.io/post/bufor-polaczen-w-protokole-tcp/">skalowanie okna TCP (bufor dla
połączeń)</a>. Dalej mamy opcje
<code>accept_redirects</code> oraz <code>accept_source_route</code> , które chronią przed zmianami tablic routingu, co
często wykorzystywane jest w różnego rodzaju atakach. Kolejne trzy opcje, tj. <code>input</code> , <code>output</code>
oraz <code>forward</code> odpowiadają za ustawienie domyślnej polityki dla zdefiniowanych stref (o tym za
moment). Opcja <code>disable_ipv6</code> jest w stanie wyłączyć reguły IPv6. Nie oznacza to, że obsługa
protokołu IPv6 zostanie wyłączona, a jedynie nie będą aplikowane same reguły firewall'a, co może
nie być bezpieczne.</p>
<h3 id="strefy-sekcja-config-zone">Strefy (sekcja config zone)</h3>
<p>Dalej w pliku <code>/etc/config/firewall</code> są zdefiniowane strefy, które są wykorzystywane później w
dalszej konfiguracji firewall'a. Poniżej znajduje się przykład strefy <code>wan</code> :</p>
<pre><code>config zone
    option name     wan
    list   network      'wan'
    list   network      'wan6'
    option input        DROP
    option output       ACCEPT
    option forward      DROP
    option masq     1
    option conntrack    1
    option mtu_fix      1
    option log      0
    option log_limit    60/minute
</code></pre>
<p>By móc się odwołać do takiej strefy w regułach, które będziemy umieszczać również w pliku
<code>/etc/config/firewall</code> , musimy nadać strefie nazwę i za to odpowiada opcja <code>name</code> . W <code>list network</code> mamy logiczne interfejsy, które są podpięte pod tę strefę. Nazwy tych logicznych
interfejsów są do odczytania z pliku <code>/etc/config/network</code> . Opcje <code>input</code> , <code>output</code> oraz
<code>forward</code> ustawiają politykę domyślną dla pakietów w tej strefie. Dalej mamy opcję <code>masq</code> , przy
pomocy której ruch z sieci lokalnej może zostać przesłany przez ten interfejs (maskarada). Z kolei
<code>conntrack</code> włącza śledzenie połączeń dla tej strefy. Zwykle ta opcja jest automatycznie aktywowana
jeśli poprzednia jest włączona. Opcja <code>mtu_fix</code> ustawia rozmiar MTU w oparciu o
<a href="https://en.wikipedia.org/wiki/Path_MTU_Discovery">PMTUD</a>. Ostatnie dwie opcje, tj. <code>log</code> oraz
<code>log_limit</code> odpowiadają za logowanie pakietów odrzuconych w tej strefie.</p>
<h3 id="forwarding-pakietów-sekcja-config-forwarding">Forwarding pakietów (sekcja config forwarding)</h3>
<p>Mając zdefiniowane co najmniej dwie strefy, <code>lan</code> i <code>wan</code> , możemy ustawić między nimi forwarding
pakietów. W ten sposób hosty z sieci lokalnej będą mieć dostęp do internetu. Poniżej jest przykład
odpowiedniej sekcji:</p>
<pre><code>config forwarding
    option src      lan
    option dest     wan
</code></pre>
<p>Tutaj mamy tylko dwie opcje, <code>src</code> oraz <code>dest</code> , które określają kierunek przepływu pakietów. W tym
przypadku pakiety z sieci lokalnej będą forward'owane do internetu bez problemu.</p>
<h3 id="reguły-sekcja-config-rule">Reguły (sekcja config rule)</h3>
<p>Dalej w pliku <code>/etc/config/firewall</code> mamy sekcje z regułami. To one sterują przepływem pakietów
przez filtr i decydują czy dane połączenie zostanie zaakceptowane lub odrzucone. Poniżej przykładowe
reguły dla protokołu IPv4:</p>
<pre><code>config rule
    option name         Allow-DHCP-Renew
    option src          wan
    option family       ipv4
    option proto        udp
    option dest_port    68
    option target       ACCEPT
    option src_ip       &quot;192.168.0.0/16 10.0.0.0/8&quot;
    option enabled      1
</code></pre>
<p>oraz dla IPv6:</p>
<pre><code>config rule
    option name         Allow-ICMPv6-Input
    option src          wan
    option proto        icmp
    list icmp_type      echo-request
    list icmp_type      echo-reply
    list icmp_type      destination-unreachable
    list icmp_type      packet-too-big
    list icmp_type      time-exceeded
    list icmp_type      bad-header
    list icmp_type      unknown-header-type
    list icmp_type      router-solicitation
    list icmp_type      neighbour-solicitation
    list icmp_type      router-advertisement
    list icmp_type      neighbour-advertisement
    option limit        1000/sec
    option family       ipv6
    option target       ACCEPT
    option enabled      1
</code></pre>
<p>Reguły dobrze jest nazywać, tak by przy listowaniu ich w filtrze były stosownie oznaczone. Do tego
służy opcja <code>name</code> . Przy pomocy <code>src</code> jest oznaczany kierunek z którego pakiety mają docierać do
routera. W tym przypadku reguły dotyczą strefy <code>wan</code> , tj. tej samej, którą określiliśmy wyżej w
pliku. Tak skonstruowana reguła trafi do łańcucha <code>zone_wan_input</code> . Jeśli opcja <code>family</code> nie
zostanie podana, to reguła tyczy się zarówno protokołu IPv4 jak i IPv6, chyba, że inne opcje reguły
(np. IP) będą wskazywać, że ma być to reguła dla określonego protokołu. Następnie mamy szereg opcji,
które są podawane do <code>iptables</code> . Jeśli opcja <code>enabled</code> jest ustawiona, to taka reguła jest dodawana
do firewall'a. W przypadku takich reguł jak te powyższe, gdzie w jakiejś opcji mamy więcej niż jeden
argument, to ostatecznie zostanie utworzonych po jednej regule dla każdego argumentu.</p>
<p>Poniżej znajduje się lista tych częściej używanych opcji, które można zdefiniować w regule:</p>
<ul>
<li><code>src</code> oraz <code>dest</code> -- źródłowa i docelowa strefa. Jeśli obie są określone, to ruch jest
forward'owany.</li>
<li><code>src_ip</code> oraz <code>dest_ip</code> -- źródłowy i docelowy adres IP.</li>
<li><code>src_port</code> oraz <code>dest_port</code> -- źródłowy i docelowy port. Można podać w formie '80 443', jak i
też w postaci zakresu '1000:2000'.</li>
<li><code>proto</code> -- nazwa (numer) protokołu. Do wyboru tcp, udp, tcpudp, udplite, icmp, esp, ah, sctp,
lub all.</li>
<li><code>list icmp_type</code> -- w przypadku, gdy <code>proto</code> wskazuje na <code>icmp</code> , to można dodatkowo określić
rodzaj komunikatu w formie nazwy lub jego numeru ID.</li>
<li><code>target</code> -- akcja. Możliwe do wyboru ACCEPT, REJECT, DROP, MARK oraz NOTRACK.</li>
<li><code>limit</code> oraz <code>limit_burst</code> -- ustawiają limit dla połączeń. Limit można określić w formie
1/minute, 1/min, lub 1/m.</li>
</ul>
<h3 id="przekierowania-i-port-forwarding-sekcja-config-redirect">Przekierowania i port forwarding (sekcja config redirect)</h3>
<p>Zanim przejdziemy do samych reguł, trzeba zapoznać się z <a href="https://pl.wikipedia.org/wiki/Network_Address_Translation">Network Address Translation
(NAT)</a>, czyli z translacją adresów. Każdy
komputer wpięty w naszą sieć LAN chce uzyskać dostęp do internetu. Niestety liczba adresów IP jest
skończona i do tego na wyczerpaniu, dlatego musimy korzystać z NAT. W tej sytuacji wszystkie te
maszyny lokalne wysyłają pakiety do routera z adresem docelowym znajdującym się gdzieś w internecie.
By komunikacja mogła nastąpić, router podmienia w tych pakietach źródłowy adres IP na swój własny i
taki pakiet przesyła przez sieć. Później przychodzi odpowiedź na adres IP routera, a ten w oparciu o
mechanizm śledzenia połączeń wie, do której maszyny w sieci LAN przesłać dany pakiet. W efekcie
wszystkie maszyny w lokalnej sieci mają ten sam adres zewnętrzny, który otrzymał od ISP nasz router.</p>
<p>Proces translacji adresów jest dokonywany przez firewall, a konkretnie przez tablicę <code>nat</code> w
<code>iptables</code> . W zależności od kierunku pakietów, mamy z grubsza dwa rodzaje NAT. W przypadku
przesyłania pakietów z sieci lokalnej do internetu stosowany jest Source NAT (SNAT). Z kolei w
drugą stronę korzysta się z DNAT (Destination NAT). Istnieje również maskarada (MASQUERADE) i ona
jest specjalną odmianą SNAT, która adaptuje się do zmiennego adresu IP przydzielanego interfejsowi
WAN (najczęściej stosowana).</p>
<p>Translacja adresów w firewall'u OpenWRT jest z reguły włączona na interfejsie WAN. Jest to
warunkowane dodaniem opcji <code>masq</code> do powyżej zdefiniowanych stref w pliku <code>/etc/config/firewall</code> . W
takim przypadku, wszystkie nowe połączenia (stan NEW) przechodzą przez tablicę <code>nat</code> w <code>iptables</code> i
jeśli taki pakiet rozpoczynający nowe połączenie opuszcza router przez interfejs WAN, to jest
przepuszczany przez regułę maskarady. Wszystkie następne pakiety powiązane z ustanowionym
połączeniem są opisywane w oparciu o tablicę conntrack'a, gdzie kernel śledzi sobie dokładnie
każde połączenie. Poniżej znajduje się taki przykładowy wpis (do wglądu w
<code>/proc/net/nf_conntrack</code> ):</p>
<pre><code>ipv4     2 tcp      6 3575 ESTABLISHED src=77.68.11.22 dst=82.160.11.22 sport=41369 dport=8398 packets=195 bytes=13899 src=192.168.1.150 dst=77.68.11.22 sport=8398 dport=41369 packets=193 bytes=143243 [ASSURED] mark=4 use=2
</code></pre>
<p>Mamy tutaj połączenie TCP w protokole IPv4 w stanie ustanowionym (ESTABLISHED). Pakiety są
wymieniane na linii 192.168.1.150:8398 77.68.11.22:41369 . W zależności od tego, która strona
zainicjowała połączenie (wysłała pakiet w stanie NEW), to mielibyśmy do czynienia z SNAT lub DNAT.
Jako, że połączenie jest ustanowione, to pakiety są przesyłane w obu kierunkach automatycznie i
przeadresowane w oparciu o ten powyższy wpis. Każde połączenie jest identyfikowane w oparciu o
protokół, źródłowy i docelowy adres IP oraz źródłowy i docelowy port. Router natomiast potrafi w
oparciu o ten powyższy wpis powiązać ze sobą te informacje i wie gdzie przesłać jaki pakiet.</p>
<p>Biorąc pod uwagę powyższe informacje, pora zapoznać się z regułami, które przekierowują ruch na
routerze. Używane są one w dużej mierze przy port forwarding'u (otwieraniu portów od strony WAN).
Taka reguła różni się nieco od tych opisanych powyżej. Wygląda ona mniej więcej tak:</p>
<pre><code>config redirect
    option name       'ssh'
    option src        'wan'
    option dest       'lan'
    option proto      'tcp'
    option src_dport  '80'
    option dest_ip    '192.168.1.234'
    option dest_port  '80'
    option target     'DNAT'
</code></pre>
<p>Część z powyższych opcji ma takie samo znaczenie co w przypadku zwykłych reguł opisanych wyżej. W
opcji <code>target</code> można określić wartości DNAT lub SNAT. W zależności od wyboru zmienia się nieco
znaczenie opcji <code>src_dip</code> , <code>src_dport</code> , <code>dest_ip</code> oraz <code>dest_port</code> . Poniżej jest rozpiska
dotycząca tych opcji:</p>
<ul>
<li><code>dest_ip</code> -- w przypadku DNAT, ruch kierowany jest do określonego tutaj hosta. Dla SNAT
dopasowywany jest ruch w oparciu i ten adres.</li>
<li><code>src_dip</code> -- w przypadku DNAT, ruch jest kierowany na ten adres IP. Dla SNAT przepisywany jest
źródłowy adres na wartość ustawioną w tej opcji.</li>
<li><code>src_dport</code> -- w przypadku DNAT, ruch jest kierowany na dany port lub zakres portów docelowych.
Dla SNAT przepisywane są porty źródłowe na wartość ustawioną w tej opcji.</li>
<li><code>dest_port</code> -- w przypadku DNAT, ruch jest kierowany na dany port hosta. Dla SNAT dopasowuje
ruch kierowany na podany port.</li>
</ul>
<p>Dodatkowo, po określeniu opcji <code>src_dport</code> ustawiany jest także <a href="https://morfikov.github.io/post/nat-reflection-oraz-nat-loopback-w-openwrt/">NAT Loopback/NAT
Reflection</a>.</p>
<h2 id="sprawdzanie-reguł-firewalla">Sprawdzanie reguł firewall'a</h2>
<p>Wszystkie reguły, które określiliśmy w pliku <code>/etc/config/firewall</code> oraz <code>/etc/firewall.user</code> możemy
w dowolnym momencie sobie podejrzeć. Wystarczy zalogować się na router i w terminalu wpisać to
poniższe polecenie:</p>
<pre><code># iptables -nvL
</code></pre>
<p>Zwróci ono dość obszerny log. Domyślnie są listowane reguły dla tablicy <code>filter</code> . By zobaczyć
reguły w innych tablicach, musimy podać przełącznik <code>-t</code> , przykładowo:</p>
<pre><code># iptables -nvL -t nat
</code></pre>
<p>Wszystkie reguły w formie takiej jak są podawane bezpośrednio do <code>iptables</code> można uzyskać posługując
się przełącznikiem <code>-S</code> :</p>
<pre><code># iptables -S -t filter
</code></pre>
<p>Tak wygenerowane reguły nadają się do dalszego studiowania i analizy. W oparciu o nie można poznać
sporą część składki dla firewall'a, co w przyszłości przełoży się na własny skrypt z regułami, który
ma o wiele większe możliwości niż mechanizm oferowany przez OpenWRT.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/iptables/">iptables</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/chaos-calmer/">chaos-calmer</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/router/">router</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&amp;text=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&amp;title=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&amp;title=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&title=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&amp;title=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2ffiltr-pakietow-sieciowych-w-openwrt-firewall%2f&description=Filtr%20pakiet%c3%b3w%20sieciowych%20w%20OpenWRT%20%28firewall%29" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/nat-reflection-oraz-nat-loopback-w-openwrt/">NAT Reflection oraz NAT Loopback w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kompromitacja-firewalla-openwrt-za-sprawa-ping/">Kompromitacja firewall&#39;a OpenWRT za sprawą ping</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-diod-w-routerze-pod-openwrt-led/">Konfiguracja diod w routerze pod OpenWRT (LED)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wps-czyli-wifi-protected-setup-w-openwrt/">WPS, czyli WiFi Protected Setup w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/automatyczna-blokada-internetu-lte-w-openwrt/">Automatyczna blokada internetu LTE w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/siec-bezprzewodowa-wifi-w-openwrt-wlan/">Sieć bezprzewodowa WiFi w OpenWRT (WLAN)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/podzial-switcha-na-kilka-vlan-w-openwrt/">Podział switch&#39;a na kilka VLAN&#39;ów w OpenWRT</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2022 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
