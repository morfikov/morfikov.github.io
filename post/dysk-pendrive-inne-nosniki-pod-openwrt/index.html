<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Dysk, pendrive i inne nośniki pod OpenWRT | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Dysk, pendrive i inne nośniki pod OpenWRT" />
<meta property="og:description" content="Czym by był router bez portów USB? Obecnie chyba wszystkie routery posiadają przy najmniej jeden
taki port. Umożliwia to podłączenie pendrive, dysku USB, drukarki i innych urządzeń posiadających
interfejs USB. W przypadku, gdy posiadamy jeden port USB i chcemy podłączyć dwa (lub więcej)
urządzenia, musimy skorzystać z hubów USB. Ja w przypadku swojego routera TP-LINK TL-WR1043N/ND
v2 mam zastosowane właśnie takie
rozwiązanie. Niby potrzebuję trzy porty USB, a ten router ma tylko jeden. Co prawda, pojawia się
problem z zapotrzebowaniem na energię ale aktywne huby USB wyposażone w zasilacze niwelują tę
dolegliwość. Ten wpis ma na celu przedstawić zarządzanie tymi wszystkimi nośnikami pod OpenWRT.
Zostanie tutaj pokazane jak stworzyć i zamontować partycje o systemie plików EXT4, NTFS, FAT." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/dysk-pendrive-inne-nosniki-pod-openwrt/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2016-04-27T00:32:19+00:00" />
<meta property="article:modified_time" content="2016-04-27T00:32:19+00:00" />


		<meta itemprop="name" content="Dysk, pendrive i inne nośniki pod OpenWRT">
<meta itemprop="description" content="Czym by był router bez portów USB? Obecnie chyba wszystkie routery posiadają przy najmniej jeden
taki port. Umożliwia to podłączenie pendrive, dysku USB, drukarki i innych urządzeń posiadających
interfejs USB. W przypadku, gdy posiadamy jeden port USB i chcemy podłączyć dwa (lub więcej)
urządzenia, musimy skorzystać z hubów USB. Ja w przypadku swojego routera TP-LINK TL-WR1043N/ND
v2 mam zastosowane właśnie takie
rozwiązanie. Niby potrzebuję trzy porty USB, a ten router ma tylko jeden. Co prawda, pojawia się
problem z zapotrzebowaniem na energię ale aktywne huby USB wyposażone w zasilacze niwelują tę
dolegliwość. Ten wpis ma na celu przedstawić zarządzanie tymi wszystkimi nośnikami pod OpenWRT.
Zostanie tutaj pokazane jak stworzyć i zamontować partycje o systemie plików EXT4, NTFS, FAT."><meta itemprop="datePublished" content="2016-04-27T00:32:19+00:00" />
<meta itemprop="dateModified" content="2016-04-27T00:32:19+00:00" />
<meta itemprop="wordCount" content="2081">
<meta itemprop="keywords" content="pendrive,hdd,ssd,chaos-calmer,router," />
		<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Dysk, pendrive i inne nośniki pod OpenWRT"/>
<meta name="twitter:description" content="Czym by był router bez portów USB? Obecnie chyba wszystkie routery posiadają przy najmniej jeden
taki port. Umożliwia to podłączenie pendrive, dysku USB, drukarki i innych urządzeń posiadających
interfejs USB. W przypadku, gdy posiadamy jeden port USB i chcemy podłączyć dwa (lub więcej)
urządzenia, musimy skorzystać z hubów USB. Ja w przypadku swojego routera TP-LINK TL-WR1043N/ND
v2 mam zastosowane właśnie takie
rozwiązanie. Niby potrzebuję trzy porty USB, a ten router ma tylko jeden. Co prawda, pojawia się
problem z zapotrzebowaniem na energię ale aktywne huby USB wyposażone w zasilacze niwelują tę
dolegliwość. Ten wpis ma na celu przedstawić zarządzanie tymi wszystkimi nośnikami pod OpenWRT.
Zostanie tutaj pokazane jak stworzyć i zamontować partycje o systemie plików EXT4, NTFS, FAT."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Dysk, pendrive i inne nośniki pod OpenWRT</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2016-04-27T00:32:19Z">Opublikowano: 27/04/2016</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/openwrt/" rel="category">OpenWRT</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Dysk, pendrive i inne nośniki pod OpenWRT</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#problemy-związane-z-nieodpowiednim-wyłączaniem-routera">Problemy związane z nieodpowiednim wyłączaniem routera</a></li>
    <li><a href="#tworzenie-partycji-i-systemu-plików">Tworzenie partycji i systemu plików</a></li>
    <li><a href="#montowanie-zasobów-w-openwrt">Montowanie zasobów w OpenWRT</a></li>
    <li><a href="#automatyczne-montowanie-zasobów-w-fazie-boot-z-block-mount">Automatyczne montowanie zasobów w fazie boot z block-mount</a></li>
    <li><a href="#przestrzeń-wymiany-swap">Przestrzeń wymiany SWAP</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Czym by był router bez portów USB? Obecnie chyba wszystkie routery posiadają przy najmniej jeden
taki port. Umożliwia to podłączenie pendrive, dysku USB, drukarki i innych urządzeń posiadających
interfejs USB. W przypadku, gdy posiadamy jeden port USB i chcemy podłączyć dwa (lub więcej)
urządzenia, musimy skorzystać z hubów USB. Ja w przypadku swojego routera <a href="http://www.tp-link.com.pl/products/details/TL-WR1043ND.html">TP-LINK TL-WR1043N/ND
v2</a> mam zastosowane właśnie takie
rozwiązanie. Niby potrzebuję trzy porty USB, a ten router ma tylko jeden. Co prawda, pojawia się
problem z zapotrzebowaniem na energię ale aktywne huby USB wyposażone w zasilacze niwelują tę
dolegliwość. Ten wpis ma na celu przedstawić zarządzanie tymi wszystkimi nośnikami pod OpenWRT.
Zostanie tutaj pokazane jak stworzyć i zamontować partycje o systemie plików EXT4, NTFS, FAT.</p>
<h2 id="problemy-związane-z-nieodpowiednim-wyłączaniem-routera">Problemy związane z nieodpowiednim wyłączaniem routera</h2>
<p>W przypadku, gdy w grę wchodzą systemy plików, trzeba mieć jedną rzecz na uwadze. Jeśli zamontujemy
na routerze jakąś partycję, to nie możemy wyłączać routera za pomocą przycisku na jego obudowie.
Podobnie sprawa ma się z zanikami napięcia, czy resetowaniem routera przez wyciągnięcie zasilacza z
kontaktu. Tego typu akcje mogą uszkodzić dane na tym zewnętrznym nośniku USB. W ten sposób prawie na
pewno stracimy część plików, zwłaszcza przypadku, gdy procesy na routerze będą dokonywać zapisu
danych. Router niczym się praktycznie nie różni w działaniu od zwykłego PC, jest tylko nieco
mniejszy i nie ma tych wszystkich podzespołów, które mają standardowe komputery. Dlatego też trzeba
postępować z nim podobnie jak z komputerami. A tych przecie nie wyłączamy via przycisk na zasilaczu.
Jeśli jednak zapomnimy zdemontować system plików, w skrajnych przypadkach może to nawet doprowadzić
do uszkodzenia całej partycji. Wtedy trzeba będzie ponownie zakładać na niej system plików, co
wyczyści wszelkie dane zgromadzone na tej partycji.</p>
<p>Nie ma się co jednak zniechęcać. Routery nie pobierają znowu aż tak dużo prądu. Jest to wielkość
rzędu 3-4W i nawet jeśli chodzą nonstop, to nie podniosą znacząco rachunku za prąd. W przypadku,
gdy chcemy wyłączyć router, możemy to zrobić logując się przez <code>ssh</code> na router, po czym wpisać w
terminalu to poniższe polecenie:</p>
<pre><code># sync &amp;&amp; poweroff
</code></pre>
<p>To polecenie (a w zasadzie dwa) zsynchronizuje bufory nośników wymuszając zapisanie wszelkich danych
przebywających w pamięci RAM na dysk oraz wyłączy system. W ten sposób stracimy połączenie z
routerem ale nie wyłączy mu to zasilania. W efekcie, diody dalej będą się świecić czy migać.
Niemniej jednak, w takim stanie, router może zostać bezpiecznie odcięty od zasilania w dowolny
sposób bez ryzyka utraty danych zgromadzonych na dyskach.</p>
<h2 id="tworzenie-partycji-i-systemu-plików">Tworzenie partycji i systemu plików</h2>
<p>Partycje na dysku czy pendrive można tworzyć na kilka sposobów. Można to zrobić pod windowsem, pod
linux'em lub pod OpenWRT. Na windowsie jesteśmy nieco ograniczeni co do wyboru systemu plików dla
partycji. Zwykle tam mamy NTFS lub FAT. Odpada nam też możliwość podziału pendrive na partycje. Na
linux'ach, w tym OpenWRT, możemy tworzyć partycje o dowolnym systemie plików i kroić nośniki jak nam
się podoba. Tutaj nie będziemy korzystać z zewnętrznych systemów/narzędzi i ograniczymy się tylko do
tego co zapewnia nam firmware OpenWRT.</p>
<p>Przede wszystkim, musimy się zdecydować na rodzaj systemu plików, który chcemy wykorzystać na
pendrive czy dysku. <a href="https://wiki.openwrt.org/doc/howto/storage">OpenWRT wspiera całą masę systemu
plików</a>. Dokładną listę modułów kernela
odpowiedzialnych za obsługę systemu plików można uzyskać wpisując w terminalu polecenie <code>opkg list | grep kmod-fs</code> . Każdy typ systemu plików wymaga swojego modułu i trzeba go zainstalować. Jako, że
OpenWRT to linux, to najbardziej wpieranym systemem plików jest <code>ext2</code> , <code>ext3</code> i <code>ext4</code> . Obecnie
się używa tego ostatniego. By zaimplementować obsługę systemu plików z rodziny EXT na routerze
trzeba zainstalować pakiet <code>kmod-fs-ext4</code> . Jako, że dostęp do urządzeń będzie odbywał się po
interfejsie USB, to musimy także zainstalować pakiet <code>kmod-usb-storage</code> . W zależności od
specyfikacji portu USB musimy także dociągnąć moduł <code>kmod-usb-ohci</code> (USB 1.1) , <code>kmod-usb-uhci</code> (USB
1.1) lub <code>kmod-usb2</code> (USB 2) oraz <code>kmod-usb3</code> (USB3). Narzędzia do obsługi systemu plików EXT są
zawarte w pakiecie <code>e2fsprogs</code> . To przy ich pomocy możemy utworzyć system plików, czy sprawdzić go
pod kątem ewentualnych błędów. By być w stanie w ogóle partycjonować dyski pod OpenWRT, musimy także
doinstalować pakiet <code>fdisk</code> .</p>
<pre><code># opkg update
# opkg install kmod-fs-ext4 kmod-usb-storage kmod-usb-ohci kmod-usb-uhci kmod-usb2 e2fsprogs fdisk
</code></pre>
<p>Proces partycjonowania dysku czy pendrive zaczyna się od określenia przestrzeni pod konkretną
partycję. Podłączamy zatem nasze urządzenie do portu USB. Powinno ono zostać wykryte i stosownie
oznaczone. Możemy się o tym przekonać zaglądając w log przy pomocy <code>logread</code> :</p>
<pre><code>kernel: usb 1-1.1: new high-speed USB device number 10 using ehci-platform
kernel: usb-storage 1-1.1:1.0: USB Mass Storage device detected
kernel: scsi host7: usb-storage 1-1.1:1.0
kernel: scsi 7:0:0:0: Direct-Access     Kingston DT 101 G2        PMAP PQ: 0 ANSI: 0 CCS
kernel: sd 7:0:0:0: [sdb] 30299520 512-byte logical blocks: (15.5 GB/14.4 GiB)
kernel: sd 7:0:0:0: [sdb] Write Protect is off
kernel: sd 7:0:0:0: [sdb] Mode Sense: 23 00 00 00
kernel: sd 7:0:0:0: [sdb] No Caching mode page found
kernel: sd 7:0:0:0: [sdb] Assuming drive cache: write through
kernel:   sdb: sdb1
kernel: sd 7:0:0:0: [sdb] Attached SCSI removable disk
</code></pre>
<p>W tym przypadku, pendrive uzyskał oznaczenie <code>sdb</code> . By rozpocząć proces formatowania tego
urządzenia, w terminalu wydajemy to poniższe polecenie:</p>
<pre><code># fdisk /dev/sdb
</code></pre>
<p>Wskazówki dotyczące formatowania możemy wyświetlić przez wpisanie <code>m</code> . Wygląda to mniej więcej tak
jak na tej fotce poniżej:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/1.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="big"></p>
<p>W przypadku, gdy mamy do czynienia z nowym dyskiem, który nie posiada jeszcze taliby partycji, to
trzeba mu ją stworzyć. Pendrive zwykle mają tablicę MS-DOS. W przypadku tradycyjnych dysków,
zwłaszcza tych większych, dobrze jest utworzyć tablicę GPT. W zależności od preferencji, tablicę
tworzymy wpisując <code>o</code> (MS-DOS) lub <code>g</code> (GPT). W tym przypadku skorzystamy z tablicy MS-DOS:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/2.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="big"></p>
<p>Teraz sprawdzamy parametry dysku, w tym też ile miejsca mamy do dyspozycji. Robimy to za pomocą
<code>p</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/3.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="big"></p>
<p>Mamy nieco ponad 14 GiB. Podzielmy zatem ten pendrive na 4 partycje. Tworzenie partycji aktywujemy
przez <code>n</code> . Następnie określamy typ partycji (podstawowa <code>p</code>, rozszerzona <code>e</code> ) oraz jej numer.
Jeśli nie planujemy umieszczać na pendrive więcej partycji niż 4, to określamy wszystkie jako
podstawowe. Dalej podajemy początkowy sektor partycji. Zwykle zostanie automatycznie wykryty, tj.
zaraz za końcem poprzedniej partycji. Pierwsza partycja zawsze zaczyna się na 2048 sektorze, z racji
równania do 1 MiB. Na koniec podajemy rozmiar partycji, np. +3G (2 jako podstawa potęgi). Podobnie
postępujemy z kolejnymi partycjami, aż do wykorzystania całej wolnej przestrzeni nośnika.</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/4.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="huge"></p>
<p>Jeśli pomylimy się i określimy złe parametry partycji, to zawsze możemy taką partycję usunąć za
pomocą <code>d</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/5.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="huge"></p>
<p>Po utworzeniu wszystkich partycji, sprawdzamy wygląd tablicy partycji wpisując <code>p</code> . Jeśli wszystko
się zgadza, zapisujemy tablicę partycji przy pomocy <code>w</code> :</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/6.fdisk-openwrt-tworzenie-partycji-dysk-pendrive.png" alt="fdisk-openwrt-tworzenie-partycji-dysk-pendrive"    class="huge"></p>
<p>Jeśli z jakiegoś powodu nie podoba nam się ten układ partycji albo zwyczajnie wybraliśmy nie ten
dysk co potrzeba, to wszelkie zmiany możemy cofnąć wpisując <code>q</code> zamiast tego powyższego <code>w</code> .</p>
<p>Samo stworzenie partycji to nie wszystko. Musimy jeszcze stworzyć system plików na tej partycji.
Jako, że zdecydowaliśmy się na system plików EXT4, to korzystamy z narzędzia <code>mkfs.ext4</code> :</p>
<pre><code># mkfs.ext4 -m 0 -L dane /dev/sdb1
</code></pre>
<p>Wyżej podaliśmy dwa parametry do <code>mkfs.ext4</code> . Standardowo wszystkie linux'y rezerwują 5% wolnego
miejsca na partycji na potrzeby użytkownika root. Opcja <code>-m 0</code> wyłącza rezerwację. Z kolei opcja
<code>-L</code> nadaje systemowi plików odpowiednią etykietę. W przypadku, gdy byśmy tworzyli system plików na
partycji, która już posiada system plików, to zostaniemy o tym fakcie uprzedzeni i będziemy musieli
świadomie wyrazić zgodę na to:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2016/04/6.mkfs-ext4-openwrt-tworzenie-system-plikow-dysk-pendrive.png" alt="mkfs-ext4-openwrt-tworzenie-system-plikow-dysk-pendrive"    class="huge"></p>
<h2 id="montowanie-zasobów-w-openwrt">Montowanie zasobów w OpenWRT</h2>
<p>Mając przygotowany pendrive lub dysk możemy przejść do zamontowania poszczególnych jego partycji. By
zamontować przykładową partycję w katalogu <code>/mnt/</code> posługujemy się narzędziem <code>mount</code> , przykładowo:</p>
<pre><code># mount /dev/sdb3 /mnt/
</code></pre>
<p>I od tej pory możemy zapisywać dane na partycji. Gdy skończymy się bawić, system plików należy
odmontować w poniższy sposób:</p>
<pre><code># umount /mnt/
</code></pre>
<h2 id="automatyczne-montowanie-zasobów-w-fazie-boot-z-block-mount">Automatyczne montowanie zasobów w fazie boot z block-mount</h2>
<p>Wyżej był przestawiony manualny sposób montowania zasobów. Działa on zawsze, z tym, że wymagana
naszej ingerencji za każdym razem, gdy resetujemy router. Jeśli chcemy mieć podpięty dysk albo
pendrive na stałe do routera i udostępniać system plików takiego urządzenia w sieci lokalnej, to
przydałoby się zautomatyzować montowanie zasobów przy starcie systemu. Za taką funkcjonalność
odpowiada <a href="https://wiki.openwrt.org/doc/techref/block_mount">pakiet block-mount</a>. Zainstalujmy go
zatem:</p>
<pre><code># opkg install block-mount
</code></pre>
<p>Konfiguracja tego pakietu jest trzymana w pliku <code>/etc/config/fstab</code> . Standardowo jest on pusty i
musimy go sami uzupełnić. Możemy to zrobić przy pomocy polecenia <code>block</code> . Można mu podać kilka
opcji, min. <code>detect</code> , która wykrywa i konfiguruje wszystkie podpięte urządzenia. Wystarczy zatem
podpiąć pendrive czy dysk i wykonać to poniższe polecenie:</p>
<pre><code># block detect &gt; /etc/config/fstab
</code></pre>
<p>W przypadku, gdy mamy już jakieś wpisy w pliku <code>/etc/config/fstab</code> , to powyższe polecenie nadpisze
ją nam. Dlatego też nie kierujmy wyjścia tego polecenia do pliku. Jeśli tego nie zrobimy, to
konfiguracja zostanie nam wyświetlona w oknie terminala. Później możemy tylko skopiować odpowiednie
wpisy i umieścić w pliku <code>/etc/config/fstab</code> .</p>
<p>Poleceniu <code>block</code> może także podać opcję <code>info</code> , po której wywołaniu zostanie zwróconych trochę
informacji o podłączonych zasobach. Z kolei za pomocą opcji <code>mount</code> oraz <code>umount</code> możemy montować i
demontować zasoby w oparciu o konfigurację w pliku <code>/etc/config/fstab</code> .</p>
<p>Poniżej znajduje się przykładowy plik <code>/etc/config/fstab</code> :</p>
<pre><code>config 'global'
      option      anon_swap   '0'
      option      anon_mount  '0'
      option      auto_swap   '1'
      option      auto_mount  '1'
      option      delay_root  '5'
      option      check_fs    '0'

config 'mount'
      option  target  '/mnt/sdb3/'
#     option  device  '/dev/sdb3'
      option  uuid    '409d5fe7-46f0-4887-bf23-b3882e906c14'
      option  fstype  'ext4'
      option  enabled '1'
</code></pre>
<p>Wszystkie partycje, które chcemy montować automatycznie na starcie routera musimy umieścić w
sekcjach <code>config 'mount'</code> . Poza tymi sekcjami, mamy także ustawienia globalne, które są w sekcji
<code>config 'global'</code> . Na początek omówmy sobie sekcję z ustawieniami globalnymi.</p>
<p>Opcje <code>anon_swap</code> oraz <code>anon_mount</code> odpowiadają za montowanie zasobów, które nie posiadają
konfiguracji w pliku <code>/etc/config/fstab</code> . Lepiej nie ruszać ich wartości domyślnych. Następnie mamy
opcje <code>auto_swap</code> oraz <code>auto_mount</code> , które montują zasoby określone w pliku <code>/etc/config/fstab</code> i
mające status <code>enabled</code> (o tym za moment). Jeśli chodzi zaś o opcję <code>delay_root</code> , to ma ona
kluczowe znaczenie <a href="https://morfikov.github.io/post/extroot-whole_root-fullroot-pod-openwrt/">w przypadku
extroot/whole_root</a>. Może się tak
zdarzyć, że nasz pendrive zostanie wykryty z pewnym opóźnieniem podczas startu systemu routera. W
takim przypadku partycja nie zostanie zamontowana. Wartość tego parametru jest w sekundach i oznacza
ile czasu system ma czekać zanim zamontuje partycję. Ostatnia opcja, tj. <code>check_fs</code> , odpowiada za
sprawdzanie systemu plików aktywnych zasobów.</p>
<p>Dalej w pliku mamy sekcje <code>config 'mount'</code> . Opcje w niej trochę się różnią w stosunku do tych z
sekcji globalnej. Mamy tutaj opcję <code>target</code> , który określa gdzie zamontować daną partycję. W
<code>device</code> jest ścieżka do urządzenia/partycji. Niemniej jednak, w przypadku podpięcia innego
pendrive, OpenWRT będzie próbował zamontować jedną z jego partycji. Dlatego też, lepiej unikać
definiowania zasobów w taki sposób. Zamiast tego, lepiej jest wykorzystać opcję <code>uuid</code> , która
identyfikuje konkretne urządzenie (partycję) podpięte do portu USB routera. Następnie mamy opcję
<code>fstype</code> , która określa system plików partycji. Opcja <code>enabled</code> ustawiona na <code>1</code> sprawi, że zasób
zostanie zamontowany w fazie boot routera.</p>
<h2 id="przestrzeń-wymiany-swap">Przestrzeń wymiany SWAP</h2>
<p>OpenWRT to taka minimalistyczna dystrybucja linux'a. Obowiązują ją te same zasady, co każdego innego
pingwina w tej branży. Jak wiadomo, routery domowe mają niewiele pamięci operacyjnej RAM. W efekcie
niektórych aplikacji możemy nie być w stanie uruchomić. Jeśli routerowi braknie pamięci, to
zwyczajnie się powiesi. Możemy nieco złagodzić skutki niewielkich zasobów RAM za pomocą przestrzeni
wymiany SWAP. Takie rozwiązanie może nie nie powala pod względem osiągów ale jeśli alternatywą jest
kupienie nowego sprzętu, to co nam szkodzi rzucić okiem na to rozwiązanie?</p>
<p>Przestrzeń wymiany SWAP, to zwykła partycja. Każdy linux, w tym też i OpenWRT, ma możliwość jej
utworzenia. Wyżej stworzyliśmy przy pomocy <code>fdisk</code> kilka partycji. Jedna z nich w dalszym ciągu nie
ma utworzonego systemu plików. Przeznaczmy ją na SWAP. W terminalu wpisujemy zatem to poniższe
polecenie:</p>
<pre><code># mkswap /dev/sdb4
</code></pre>
<p>Tak utworzoną przestrzeń wymiany można aktywować i dezaktywować ręcznie w poniższy sposób:</p>
<pre><code># swapon /dev/sdb4
# swapoff /dev/sdb4
</code></pre>
<p>Statystyki wykorzystania SWAP można odczytać przez <code>swapon -s</code> :</p>
<pre><code># swapon -s
Filename                      Type        Size  Used  Priority
/dev/sdb4                               partition     2097148     0     -1
</code></pre>
<p>Podobnie jak w przypadku zwykłych partycji, również i przestrzeń wymiany może być automatycznie
montowana wraz ze startem systemu routera. W tym celu musimy dopisać sekcję <code>config 'swap'</code> do pliku
<code>/etc/config/fstab</code> . Poniżej przykład:</p>
<pre><code>config 'swap'
#     option device '/dev/sda3'
      option  uuid    '1bd99fa0-bba9-453e-b042-1e593082f88e'
      option  enabled '1'
</code></pre>
<p>W przypadku włączenia SWAP, trzeba rozważyć przestawienie jednego parametru kernela. Mowa o
<code>/proc/sys/vm/swappiness</code> . Domyślna wartość w tym pliku to <code>60</code>. Zakres na jakim możemy operować to
od 0-100. Im większa wartość tym kernel chętniej zrzuca dane z RAM do SWAP. Parametry kernela
ustawiamy w pliku <code>/etc/sysctl.conf</code> . Dopisujemy tam poniższą linijkę:</p>
<pre><code>vm.swappiness = 30
</code></pre>
<p>Aplikujemy zmiany przez wpisanie w terminalu <code>sysctl -p</code> . Następnie odczytujemy wartość tego
parametru by się upewnić czy został poprawnie ustawiony:</p>
<pre><code># sysctl -a | grep swap
vm.swappiness = 30
</code></pre>
<p>Ten parametr będzie ustawiany automatycznie za każdym razem przy starcie systemu.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/pendrive/">pendrive</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/hdd/">hdd</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/ssd/">ssd</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/chaos-calmer/">chaos-calmer</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/router/">router</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&amp;text=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&amp;title=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&amp;title=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&title=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&amp;title=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fdysk-pendrive-inne-nosniki-pod-openwrt%2f&description=Dysk%2c%20pendrive%20i%20inne%20no%c5%9bniki%20pod%20OpenWRT" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/udevil-i-montowanie-zasobow-bez-uprawnien-root/">Udevil i montowanie zasobów bez uprawnień root</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/autostart-i-automatyczne-montowanie-nosnikow/">Autostart i automatyczne montowanie nośników</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/extroot-whole_root-fullroot-pod-openwrt/">Extroot i whole_root (fullroot) pod OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-dnscrypt-proxy-w-openwrt/">Konfiguracja dnscrypt-proxy w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/opkg-czyli-menadzer-pakietow-w-openwrt/">OPKG, czyli menadżer pakietów w OpenWRT</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/klucze-szyfrujace-rsa-w-openwrt-ssh/">Klucze szyfrujące RSA w OpenWRT (ssh)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/dostep-routera-openwrt-telnet-ssh-sshfs/">Dostęp do routera OpenWRT (telnet, ssh, sshfs)</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2024 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
