<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Automatyczne podpisywanie modułów kernela przez DKMS | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Automatyczne podpisywanie modułów kernela przez DKMS" />
<meta property="og:description" content="Budując kernel linux&#39;a trzeba zastanowić się nad kwestią modułów, które nie są wbudowane
bezpośrednio w samo jądro operacyjne. Nie chodzi tutaj bezpośrednio o funkcjonalność kernela,
którą można zbudować jako moduł w procesie jego kompilacji ale raczej o wszystkie zewnętrzne
moduły, które przez zespół kernela są traktowane jako out-of-tree . By poprawić nieco
bezpieczeństwo związane z takimi modułami, można wdrożyć podpisy cyfrowe, które takie moduły
muszą okazać podczas próby załadowania ich w systemie. Gdy moduł nie został podpisany, to kernel
go nie załaduje zwracając przy tym błąd modprobe: ERROR: could not insert &#39;module&#39;: Required key not available . W ten sposób można ochronić się przed częścią ataków, w których moduły pochodzenia
trzeciego mogą zostać załadowane i poczynić nam ogromne spustoszenie w systemie. Problem w tym, że
w dystrybucji Debian wykorzystywany jest mechanizm DKMS (Dynamic Kernel Module Support). Może i
mamy dzięki niemu możliwość instalacji w systemie całej masy dodatkowych modułów ale ich również
nie będzie można załadować, bo nie zostały podpisane kluczem, którego certyfikat został zaszyty
w kernelu. Można jednak zmusić mechanizm DKMS, by wskazane przez nas moduły podpisywał
automatycznie przy ich instalacji i aktualizacji." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/automatyczne-podpisywanie-modulow-kernela-przez-dkms/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2019-01-05T04:10:10+00:00" />
<meta property="article:modified_time" content="2020-03-15T23:37:00+01:00" />

		<meta itemprop="name" content="Automatyczne podpisywanie modułów kernela przez DKMS">
<meta itemprop="description" content="Budując kernel linux&#39;a trzeba zastanowić się nad kwestią modułów, które nie są wbudowane
bezpośrednio w samo jądro operacyjne. Nie chodzi tutaj bezpośrednio o funkcjonalność kernela,
którą można zbudować jako moduł w procesie jego kompilacji ale raczej o wszystkie zewnętrzne
moduły, które przez zespół kernela są traktowane jako out-of-tree . By poprawić nieco
bezpieczeństwo związane z takimi modułami, można wdrożyć podpisy cyfrowe, które takie moduły
muszą okazać podczas próby załadowania ich w systemie. Gdy moduł nie został podpisany, to kernel
go nie załaduje zwracając przy tym błąd modprobe: ERROR: could not insert &#39;module&#39;: Required key not available . W ten sposób można ochronić się przed częścią ataków, w których moduły pochodzenia
trzeciego mogą zostać załadowane i poczynić nam ogromne spustoszenie w systemie. Problem w tym, że
w dystrybucji Debian wykorzystywany jest mechanizm DKMS (Dynamic Kernel Module Support). Może i
mamy dzięki niemu możliwość instalacji w systemie całej masy dodatkowych modułów ale ich również
nie będzie można załadować, bo nie zostały podpisane kluczem, którego certyfikat został zaszyty
w kernelu. Można jednak zmusić mechanizm DKMS, by wskazane przez nas moduły podpisywał
automatycznie przy ich instalacji i aktualizacji."><meta itemprop="datePublished" content="2019-01-05T04:10:10+00:00" />
<meta itemprop="dateModified" content="2020-03-15T23:37:00+01:00" />
<meta itemprop="wordCount" content="2154">
<meta itemprop="keywords" content="debian,dkms,kernel,moduły-kernela," />
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Automatyczne podpisywanie modułów kernela przez DKMS"/>
<meta name="twitter:description" content="Budując kernel linux&#39;a trzeba zastanowić się nad kwestią modułów, które nie są wbudowane
bezpośrednio w samo jądro operacyjne. Nie chodzi tutaj bezpośrednio o funkcjonalność kernela,
którą można zbudować jako moduł w procesie jego kompilacji ale raczej o wszystkie zewnętrzne
moduły, które przez zespół kernela są traktowane jako out-of-tree . By poprawić nieco
bezpieczeństwo związane z takimi modułami, można wdrożyć podpisy cyfrowe, które takie moduły
muszą okazać podczas próby załadowania ich w systemie. Gdy moduł nie został podpisany, to kernel
go nie załaduje zwracając przy tym błąd modprobe: ERROR: could not insert &#39;module&#39;: Required key not available . W ten sposób można ochronić się przed częścią ataków, w których moduły pochodzenia
trzeciego mogą zostać załadowane i poczynić nam ogromne spustoszenie w systemie. Problem w tym, że
w dystrybucji Debian wykorzystywany jest mechanizm DKMS (Dynamic Kernel Module Support). Może i
mamy dzięki niemu możliwość instalacji w systemie całej masy dodatkowych modułów ale ich również
nie będzie można załadować, bo nie zostały podpisane kluczem, którego certyfikat został zaszyty
w kernelu. Można jednak zmusić mechanizm DKMS, by wskazane przez nas moduły podpisywał
automatycznie przy ich instalacji i aktualizacji."/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Automatyczne podpisywanie modułów kernela przez DKMS</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2019-01-05T04:10:10Z">Opublikowano: 05/01/2019</time>
	<time class="entry__meta-lastmod meta-lastmod" datetime="2020-03-15T23:37:00&#43;01:00">Zaktualizowano: 15/03/2020</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/linux/" rel="category">Linux</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Automatyczne podpisywanie modułów kernela przez DKMS</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#opcjonalne-podpisy-modułów">Opcjonalne podpisy modułów</a></li>
    <li><a href="#generowanie-klucza-do-podpisywania-modułów">Generowanie klucza do podpisywania modułów</a></li>
    <li><a href="#sprawdzenie-certyfikatu">Sprawdzenie certyfikatu</a></li>
    <li><a href="#jak-ustalić-czy-moduł-jest-podpisany">Jak ustalić czy moduł jest podpisany</a></li>
    <li><a href="#podpisywanie-modułów-dkms">Podpisywanie modułów DKMS</a></li>
    <li><a href="#konfiguracja-dkms-na-potrzeby-podpisywania-modułów-kernela">Konfiguracja DKMS na potrzeby podpisywania modułów kernela</a>
      <ol>
        <li><a href="#budowanie-modułu-via-dkms-i-brak-klucza-prywatnego">Budowanie modułu via DKMS i brak klucza prywatnego</a></li>
      </ol>
    </li>
    <li><a href="#automatyczne-podpisywanie-modułów-a-bezpieczeństwo-systemu">Automatyczne podpisywanie modułów, a bezpieczeństwo systemu</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>Budując kernel linux'a trzeba zastanowić się nad kwestią modułów, które nie są wbudowane
bezpośrednio w samo jądro operacyjne. Nie chodzi tutaj bezpośrednio o funkcjonalność kernela,
którą można zbudować jako moduł w procesie jego kompilacji ale raczej o wszystkie zewnętrzne
moduły, które przez zespół kernela są traktowane jako <code>out-of-tree</code> . By poprawić nieco
bezpieczeństwo związane z takimi modułami, można wdrożyć podpisy cyfrowe, które takie moduły
muszą okazać podczas próby załadowania ich w systemie. Gdy moduł nie został podpisany, to kernel
go nie załaduje zwracając przy tym błąd <code>modprobe: ERROR: could not insert 'module': Required key not available</code> . W ten sposób można ochronić się przed częścią ataków, w których moduły pochodzenia
trzeciego mogą zostać załadowane i poczynić nam ogromne spustoszenie w systemie. Problem w tym, że
w dystrybucji Debian wykorzystywany jest mechanizm DKMS (Dynamic Kernel Module Support). Może i
mamy dzięki niemu możliwość instalacji w systemie całej masy dodatkowych modułów ale ich również
nie będzie można załadować, bo nie zostały podpisane kluczem, którego certyfikat został zaszyty
w kernelu. Można jednak zmusić mechanizm DKMS, by wskazane przez nas moduły podpisywał
automatycznie przy ich instalacji i aktualizacji.</p>
<h2 id="opcjonalne-podpisy-modułów">Opcjonalne podpisy modułów</h2>
<p>Technicznie rzecz ujmując, to w konfiguracji linux'a mamy możliwość określenia czy żądać podpisów
przy ładowaniu modułów, a jeśli tak to czy ich wymagać. Oczywiście nie musimy wymagać, by ładowane
moduły były podpisane ale w takiej sytuacji system nam zwróci poniższą informację (sam moduł
zostanie jak najbardziej załadowany):</p>
<pre><code>kernel: module verification failed: signature and/or required key missing - tainting kernel
</code></pre>
<p>Dla niektórych osób tego typu rozwiązanie może być wyjściem, choć jest ono w pewnych sytuacjach
mało bezpieczne. Można co prawda zwiększyć tutaj nieco bezpieczeństwo przez zainteresowanie się
poniższym parametrem <code>sysctl</code> :</p>
<pre><code>kernel.modules_disabled = 1
</code></pre>
<p>Gdy ten parametr zostanie dopisany do pliku <code>/etc/sysctl.conf</code> , to chwilę po starcie systemu,
żadne moduły już nie będą mogły być załadowane do momentu restartu maszyny. Niemniej jednak, w
dalszym ciągu nasz system jest narażony na załadowanie trefnych modułów podczas początkowej fazy
startu systemu. Jeśli chcemy wyeliminować to okno, to trzeba wymusić na kernelu, by akceptował
jedynie tylko te moduły, które zostały podpisane tylko wyłączenie naszym kluczem prywatnym, tj.
przez ustawienie tych poniższych opcji:</p>
<pre><code># zcat /proc/config.gz | grep -i module_sig
CONFIG_MODULE_SIG=y
CONFIG_MODULE_SIG_FORCE=y
CONFIG_MODULE_SIG_ALL=y
CONFIG_MODULE_SIG_SHA512=y
CONFIG_MODULE_SIG_HASH=&quot;sha512&quot;
CONFIG_MODULE_SIG_KEY=&quot;/etc/kernel_key/signing_key.pem&quot;
</code></pre>
<h2 id="generowanie-klucza-do-podpisywania-modułów">Generowanie klucza do podpisywania modułów</h2>
<p>Kompilując kernel z ustawioną opcją <code>CONFIG_MODULE_SIG</code> , klucz jest generowany automatycznie i
przechowywany w katalogu <code>certs/</code> patrząc względem katalogu ze źródłami kernela, zwykle
<code>/usr/src/linux-source-*/</code> . Klucz prywatny możemy też sobie stworzyć sami i podać go w parametrze
<code>CONFIG_MODULE_SIG_KEY</code> . W ten sposób kernel już nie będzie automatycznie tworzył klucza, np. w
momencie, gdy będziemy kompilować nowszą wersję kernela.</p>
<p>Stwórzmy sobie zatem katalog roboczy i przejdźmy do niego:</p>
<pre><code># mkdir /etc/kernel_key/
# chmod 700 /etc/kernel_key/
# cd /etc/kernel_key/
</code></pre>
<p>Następnie kopiujemy do tego katalogu plik <code>certs/x509.genkey</code> ze źródeł kernela:</p>
<pre><code># /usr/src/linux-source-4.20/certs/x509.genkey ./
</code></pre>
<p>Edytujemy ten plik i uzupełniamy, by wyglądał mniej więcej tak:</p>
<pre><code>[ req ]
default_bits = 4096
distinguished_name = req_distinguished_name
prompt = no
string_mask = utf8only
x509_extensions = myexts

[ req_distinguished_name ]
C = IT
L = LocalHost
O = Morfikownia
CN = morfikov's kernel-signing key
emailAddress = morfik@nsa.com

[ myexts ]
basicConstraints=critical,CA:FALSE
keyUsage=digitalSignature
subjectKeyIdentifier=hash
authorityKeyIdentifier=keyid
</code></pre>
<p>Zapisujemy plik i wpisujemy w terminal poniższe polecenie:</p>
<pre><code># openssl req -new -nodes -utf8 -sha256 -days 36500 -batch -x509 \
   -config x509.genkey -outform PEM -out signing_key.pem \
   -keyout signing_key.pem
Generating a RSA private key
............++++
.......................++++
writing new private key to 'kernel_key.pem'
-----
</code></pre>
<p>W katalogu roboczym powinniśmy mieć dwa dodatkowe pliki: <code>signing_key.pem</code> (klucz prywatny) oraz
<code>signing_key.x509</code> (certyfikat).</p>
<h2 id="sprawdzenie-certyfikatu">Sprawdzenie certyfikatu</h2>
<p>Po skompilowaniu i zainstalowaniu kernela, uruchamiamy system ponownie i patrzymy w log, czy w
kernelu został zaszyty certyfikat, który wygenerowaliśmy wyżej:</p>
<pre><code># dmesg | grep -i 'x.*509'
Asymmetric key parser 'x509' registered
Loading compiled-in X.509 certificates
Loaded X.509 cert 'morfikov's kernel-signing key: 8d9ac6d38bbf26e45a55454c54c448059f530633'
</code></pre>
<p>Można też zajrzeć do pliku <code>/proc/keys</code> :</p>
<pre><code># cat /proc/keys | egrep &quot;X509|builtin&quot;
055e9058 I------     1 perm 1f010000     0     0 asymmetri morfikov's kernel-signing key: 8d9ac6d38bbf26e45a55454c54c448059f530633: X509.rsa 9f530633 []
1833ebdf I------     1 perm 1f0b0000     0     0 keyring   .builtin_trusted_keys: 1
</code></pre>
<p>Widać zatem, że kernel posiada jeden zaufany klucz, którego odcisk wskazuje na ten użyty przy
podpisywaniu modułów podczas kompilacji kernela.</p>
<p>Gdybyśmy w tej chwili próbowali załadować jakiś zewnętrzny moduł, np. któryś dostarczany wraz z
paczkami DKMS, to kernel nam na to nie pozwoli:</p>
<pre><code># modprobe sysdig-probe
modprobe: ERROR: could not insert 'sysdig-probe': Required key not available
</code></pre>
<h2 id="jak-ustalić-czy-moduł-jest-podpisany">Jak ustalić czy moduł jest podpisany</h2>
<p>Praktycznie każdy moduł zewnętrzny, który będziemy instalować w systemie nie będzie podpisany.
Możemy ten fakt zweryfikować na kilka sposobów. Najprościej jest po prostu odpalić <code>modinfo</code> i
poszukać informacji o sygnaturach i kluczach użytych w procesie podpisywania:</p>
<pre><code># modinfo sysdig-probe | grep '^sig'
</code></pre>
<p>W przypadku, gdy powyższe polecenie nam nic nie zwróci, to informacji o podpisie brak, zatem moduł
nie został podpisany i dlatego też nie może zostać załadowany.</p>
<p>Podpisany moduł prezentowałby się mniej więcej tak:</p>
<pre><code># modinfo sysdig-probe | grep '^sig'
sig_id:         PKCS#7
signer:         morfikov's kernel-signing key
sig_key:        41:72:D5:0F:5C:43:2C:B4:D7:90:E7:6C:9D:07:74:7F:57:C6:7F:C7
sig_hashalgo:   sha512
signature:      76:C3:FC:CD:99:2E:49:11:A2:E2:EA:38:43:4A:9D:58:BC:7B:AD:9D:
</code></pre>
<p>Jakiś czas temu był <a href="https://bugzilla.redhat.com/show_bug.cgi?id=1320921">błąd w kmod</a>, przez który system nie był w stanie poprawnie zinterpretować
danych dotyczących podpisu i zwracał coś na poniższy wzór:</p>
<pre><code># modinfo sysdig-probe | grep '^sig'
sig_id:         PKCS#7
signer:
sig_key:
sig_hashalgo:   md4
signature:      30:82:02:A5:06:09:2A:86:48:86:F7:0D:01:07:02:A0:82:02:96:30:
</code></pre>
<p>Brakowało tutaj klucza, a algorytm użyty wskazywał na <code>md4</code> , który od lat już nie jest używany.
Nawet w przypadku kernela, który tego algorytmu nie ma wkompilowanego, zostanie zwrócony tego typu
komunikat, co może sprawiać mylne wrażenie, że moduł nie został podpisany albo został podpisany
błędnie lub jakoś niewłaściwie. Warto o tym pamiętać, gdy mamy do czynienia ze starszą wersją
<code>kmod</code> .</p>
<p>By się upewnić czy moduł jest podpisany, możemy skorzystać z <code>hexdump</code> , bo <a href="https://www.kernel.org/doc/html/v4.17/admin-guide/module-signing.html#signed-modules-and-stripping">dokumentacja kernela
jednoznacznie wskazuje</a>, że podpisane moduły mają sygnaturę doczepianą na końcu pliku <code>.ko</code> :</p>
<pre><code># hexdump -C /lib/modules/4.20.0-amd64-morficzny/updates/dkms/sysdig-probe.ko | tail
000a91a0  08 00 00 00 00 00 00 00  18 00 00 00 00 00 00 00  |................|
000a91b0  09 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
000a91c0  00 00 00 00 00 00 00 00  28 48 09 00 00 00 00 00  |........(H......|
000a91d0  b6 13 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000a91e0  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000a91f0  11 00 00 00 03 00 00 00  00 00 00 00 00 00 00 00  |................|
000a9200  00 00 00 00 00 00 00 00  f0 86 0a 00 00 00 00 00  |................|
000a9210  7f 01 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000a9220  01 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
000a9230
</code></pre>
<p>Brak wzmianki na temat sygnatury, zatem moduł nie jest podpisany. Gdyby sygnatura była, to powyższe
wyjście wyglądałoby mniej więcej tak:</p>
<pre><code># hexdump -C /lib/modules/4.20.0-amd64-morficzny/updates/dkms/sysdig-probe.ko | tail
000a9480  f8 d9 fe 6d b2 28 0f bc  ba f6 62 cd 8a 58 6b a0  |...m.(....b..Xk.|
000a9490  d6 df 3e 7e fa 42 7b f8  a9 b1 83 6d 3b f9 12 aa  |..&gt;~.B{....m;...|
000a94a0  6f 80 c8 09 9c 4a e8 76  31 32 f7 e4 c5 87 87 43  |o....J.v12.....C|
000a94b0  a2 52 6f 53 5d 51 43 e9  03 de c8 1e a7 f1 ba db  |.RoS]QC.........|
000a94c0  16 2b d6 6f 72 60 65 3a  79 a5 b8 7d f4 03 2e b7  |.+.or`e:y..}....|
000a94d0  12 a5 e9 9e de 8a 55 23  8d 00 00 02 00 00 00 00  |......U#........|
000a94e0  00 00 00 02 a9 7e 4d 6f  64 75 6c 65 20 73 69 67  |.....~Module sig|
000a94f0  6e 61 74 75 72 65 20 61  70 70 65 6e 64 65 64 7e  |nature appended~|
000a9500  0a                                                |.|
000a9501
</code></pre>
<p>Informacja na końcu, tj. <code>~Module signature appended~</code> jednoznacznie wskazuje, że moduł został
podpisany, choć nie wiadomo jakim kluczem.</p>
<p>Sygnaturę modułu można również usunąć przy pomocy <code>strip</code> :</p>
<pre><code># strip --strip-debug /lib/modules/4.20.0-amd64-morficzny/updates/dkms/sysdig-probe.ko
</code></pre>
<h2 id="podpisywanie-modułów-dkms">Podpisywanie modułów DKMS</h2>
<p>Wszystko czego nam trzeba przy podpisywaniu modułów DKMS, to klucz prywatny, który już sobie
wygenerowaliśmy. By podpisać przykładowy moduł DKMS instalujemy stosowny pakiet z modułem oraz w
terminalu wydajemy poniższe polecenie:</p>
<pre><code># /usr/src/linux-source-4.20/scripts/sign-file \
    sha512 \
    signing_key.pem \
    signing_key.x509 \
    /lib/modules/4.20.0-amd64-morficzny/updates/dkms/sysdig-probe.ko
</code></pre>
<p>Wykorzystane wyżej polecenie przyjmuje cztery argumenty. Pierwszym z nich jest rodzaj użytego
hash'a, który niekoniecznie musi pasować do tego algorytmu używanego przy kompilacji kernela. Drugi
argument, to ścieżka do klucza prywatnego. Trzeci zaś to ścieżka do certyfikatu (klucza
publicznego), a ostatnim argumentem jest naturalnie ścieżka do podpisywanego modułu.</p>
<p>Tak podpisany moduł przetrwa w naszym systemie jedynie do momentu aktualizacji paczki DKMS. Dlatego
też trzeba zastosować nieco inne podejście przy podpisywaniu modułów.</p>
<h2 id="konfiguracja-dkms-na-potrzeby-podpisywania-modułów-kernela">Konfiguracja DKMS na potrzeby podpisywania modułów kernela</h2>
<p>Pliki konfiguracyjne DKMS znajdują się w katalogu <code>/etc/dkms/</code> . W tym katalogu tworzymy plik
<code>kernel-module.conf</code> i dodajemy do niego poniższą treść:</p>
<pre><code>POST_BUILD=../../../../../../etc/kernel_key/sign-kernel.sh
</code></pre>
<p>Następnie tworzymy skrypt <code>sign-kernel.sh</code> w katalogu <code>/etc/kernel_key/</code> i wrzucamy do niego
poniższy kod:</p>
<pre><code>#!/bin/sh

[ -z &quot;$kernelver&quot; ] &amp;&amp; kernelver=$(uname -r)
[ -z &quot;$arch&quot; ] &amp;&amp; arch=$(arch)

cd ../$kernelver/$arch/module/

for kernel_object in *.ko; do
    echo &quot;Signing kernel_object: $kernel_object&quot;
      /usr/src/linux-headers-$kernelver/scripts/sign-file \
      sha512 \
      /etc/kernel_key/signing_key.pem \
      /etc/kernel_key/signing_key.x509 \
      &quot;$kernel_object&quot;;
done
</code></pre>
<p>Skryptowi nadajemy naturalnie prawa do wykonywania:</p>
<pre><code># chmod 700 /etc/kernel_key/sign-kernel.sh
</code></pre>
<p>Następnie tworzymy dowiązania symboliczne do tego skryptu dla każdej paczki DKMS jaką mamy w
systemie. Interesują nas nazwy podfolderów, które są widoczne w katalogu <code>/var/lib/dkms/</code> . W tym
przypadku mamy tam: <code>sysdig/</code> oraz <code>xtables-addons/</code> , zatem tworzymy dwa dowiązania (dowiązania
symboliczne muszą mieć sufiks <code>.conf</code> ):</p>
<pre><code># ln -s /etc/dkms/kernel-module.conf /etc/dkms/sysdig.conf
# ln -s /etc/dkms/kernel-module.conf /etc/dkms/xtables-addons.conf
</code></pre>
<p>Każdy link odpowiada za konkretny moduł DKMS, tj. jeśli byśmy stworzyli tylko dowiązanie do
<code>sysdig</code> , to pliki <code>*.ko</code> z <code>xtables-addons</code> nie zostałyby podpisane. Dlatego też jeśli w
systemie znajdzie się kolejny moduł DKMS, to bez tej dodatkowej konfiguracji nie zostanie
automatycznie podpisany i nie będzie można go używać OOTB.</p>
<h3 id="budowanie-modułu-via-dkms-i-brak-klucza-prywatnego">Budowanie modułu via DKMS i brak klucza prywatnego</h3>
<p>Brak klucza nie powstrzyma mechanizmu DKMS przed zbudowaniem modułu ale z racji, że wymagany jest
podpis, to nawet jeśli jakiś złowrogi proces w naszym systemie już zbuduje sobie moduł, to w żaden
sposób go nie załaduje. Możemy sprawdzić jak tego typu sytuacja wygląda w praktyce budując
przykładowy moduł ręcznie.</p>
<p>Na początku trzeba jednak usunąć stary moduł, który został wgrany za sprawą instalacji paczki
<code>-dkms.deb</code> :</p>
<pre><code># dkms remove sysdig/0.24.1 --all
</code></pre>
<p>Poniżej jest wariant budowania i instalacji modułu DKMS bez dostępu do klucza prywatnego:</p>
<pre><code># dkms install sysdig/0.24.1 -k 4.20.0-amd64-morficzny

Creating symlink /var/lib/dkms/sysdig/0.24.1/source -&gt;
                 /usr/src/sysdig-0.24.1

DKMS: add completed.

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
make -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build clean
make: Entering directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'
make: Leaving directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'

{ make -j2 KERNELRELEASE=4.20.0-amd64-morficzny -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build; } &gt;&gt; /var/lib/dkms/sysdig/0.24.1/build/make.log 2&gt;&amp;1


Warning: The post_build script is not executable.
make -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build clean
make: Entering directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'
  CLEAN   /var/lib/dkms/sysdig/0.24.1/build/.tmp_versions
  CLEAN   /var/lib/dkms/sysdig/0.24.1/build/Module.symvers
make: Leaving directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'


DKMS: build completed.

sysdig-probe.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/4.20.0-amd64-morficzny/updates/dkms/

do_depmod 4.20.0-amd64-morficzny


DKMS: install completed.
</code></pre>
<p>Mamy tam informację <code>Warning: The post_build script is not executable</code> , czyli, że skrypt, który ma
zostać wykonany po procesie budowy modułu nie ma atrybutu wykonywalności. W sumie ten komunikat
jest nieco mylący ale oddaje stan faktyczny, bo przecie skryptu, którego nie ma w systemie również
nie da rady wykonać. Jeśli teraz taki moduł byśmy spróbowali załadować, to kernel się zbuntuje, a
przecie dokładnie o takie jego zachowanie nam chodzi.</p>
<p>Poniżej zaś jest wariant budowy modułu DKMS, gdy mamy dostęp do klucza:</p>
<pre><code># dkms install sysdig/0.24.1

Creating symlink /var/lib/dkms/sysdig/0.24.1/source -&gt;
                 /usr/src/sysdig-0.24.1

DKMS: add completed.

Kernel preparation unnecessary for this kernel.  Skipping...

Building module:
make -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build clean
make: Entering directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'
make: Leaving directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'

{ make -j2 KERNELRELEASE=4.20.0-amd64-morficzny -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build; } &gt;&gt; /var/lib/dkms/sysdig/0.24.1/build/make.log 2&gt;&amp;1


Running the post_build script:
Signing kernel_object: sysdig-probe.ko
make -C /lib/modules/4.20.0-amd64-morficzny/build M=/var/lib/dkms/sysdig/0.24.1/build clean
make: Entering directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'
  CLEAN   /var/lib/dkms/sysdig/0.24.1/build/.tmp_versions
  CLEAN   /var/lib/dkms/sysdig/0.24.1/build/Module.symvers
make: Leaving directory '/usr/src/linux-headers-4.20.0-amd64-morficzny'


DKMS: build completed.

sysdig-probe.ko:
Running module version sanity check.
 - Original module
   - No original module exists within this kernel
 - Installation
   - Installing to /lib/modules/4.20.0-amd64-morficzny/updates/dkms/

do_depmod 4.20.0-amd64-morficzny


DKMS: install completed.
</code></pre>
<p>I tu już widzimy informację <code>Signing kernel_object: sysdig-probe.ko</code> i to w tym momencie właśnie
skrypt podpisuje moduł DKMS naszym kluczem prywatnym.</p>
<h2 id="automatyczne-podpisywanie-modułów-a-bezpieczeństwo-systemu">Automatyczne podpisywanie modułów, a bezpieczeństwo systemu</h2>
<p>Problem z tego typu rozwiązaniem jest taki, że moduły mogą być podpisywane transparentnie. Jeśli
jakiś proces stworzy sobie dowiązania opisane wyżej i będzie próbował zainstalować moduł za pomocą
mechanizmu DKMS, to taki moduł zostanie podpisany, co otworzy mu drogę do bycia załadowanym przez
kernel już bez jakiejkolwiek kontroli i tego faktu nawet nie będziemy świadomi. To rozwiązanie może
dawać złudne i fałszywe poczucie bezpieczeństwa w przypadku, gdy klucz prywatny służący do
podpisywania modułów będzie przechowywany w systemie, którego moduły kernela ma podpisywać, nawet
jeśli do klucza będzie miał dostęp jedynie root.</p>
<p>Rozwiązaniem tego problemu jest naturalnie przeniesienie klucza prywatnego na jakiś zewnętrzny
nośnik, z racji, że klucz prywatny służący do pospisywania modułów będzie wykorzystywany w
zasadzie tylko przy aktualizacji pakietów (ewentualnie też przy ręcznej instalacji modułów DKMS).</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/debian/">debian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/dkms/">dkms</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/kernel/">kernel</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/modu%C5%82y-kernela/">moduły-kernela</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&amp;text=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&amp;title=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&amp;title=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&title=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&amp;title=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fautomatyczne-podpisywanie-modulow-kernela-przez-dkms%2f&description=Automatyczne%20podpisywanie%20modu%c5%82%c3%b3w%20kernela%20przez%20DKMS" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/dkms-czyli-automatycznie-budowane-moduly/">DKMS, czyli automatycznie budowane moduły</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/budowanie-kernela-linux-dla-konkretnej-maszyny-z-debianem/">Budowanie kernela linux dla konkretnej maszyny z Debianem</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/sterowniki-karta-wifi-archer-t1u-mt7610u_sta/">Sterowniki dla karty WiFi Archer T1U (mt7610u_sta)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/sterowniki-tp-link-tl-wn823n-8192eu/">Sterowniki do karty TP-LINK TL-WN823N (8192eu)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-interfejsow-bond-bonding/">Jak skonfigurować bonding w Debian linux (eth0&#43;wlan0)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/konfiguracja-interfejsow-imq-w-linuxie/">Konfiguracja interfejsów IMQ w linux&#39;ie</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/modul-kernela-i-wartosci-jego-parametrow/">Moduł kernela i wartości jego parametrów</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2023 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
