<!DOCTYPE html>
<html class="no-js" lang="pl-PL">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo | Morfitronik</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo" />
<meta property="og:description" content="W poprzednim artykule, który traktował o odszyfrowaniu kontenera LUKS przez SSH z poziomu
initramfs/initrd na Raspberry Pi, została poruszona kwestia adresacji IP, która w opisanym tam
rozwiązaniu miała pewne ograniczenia. Chodziło o to, że połączenie SSH do RPI mogło być realizowane
jedynie przez przewodowy interfejs sieciowy eth0 . Trzeba było zatem się zastanowić nad
rozwiązaniem, które umożliwiłoby korzystanie również z bezprzewodowego interfejsu WiFi, tj.
wlan0 . Celem niniejszego wpisu jest pokazanie w jaki sposób można dorobić wsparcie dla
połączeń WiFi w naszej malinie, tak by szło odszyfrować kontener LUKS przez SSH, w sytuacji gdy z
jakiegoś powodu nie chcemy lub też nie możemy korzystać z przewodowego interfejsu sieciowego tego
minikomputera z zainstalowanym system RasPiOS/Raspbian." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://morfikov.github.io/post/wsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2021-11-13T13:26:00+01:00" />
<meta property="article:modified_time" content="2021-11-13T13:26:00+01:00" />


		<meta itemprop="name" content="Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo">
<meta itemprop="description" content="W poprzednim artykule, który traktował o odszyfrowaniu kontenera LUKS przez SSH z poziomu
initramfs/initrd na Raspberry Pi, została poruszona kwestia adresacji IP, która w opisanym tam
rozwiązaniu miała pewne ograniczenia. Chodziło o to, że połączenie SSH do RPI mogło być realizowane
jedynie przez przewodowy interfejs sieciowy eth0 . Trzeba było zatem się zastanowić nad
rozwiązaniem, które umożliwiłoby korzystanie również z bezprzewodowego interfejsu WiFi, tj.
wlan0 . Celem niniejszego wpisu jest pokazanie w jaki sposób można dorobić wsparcie dla
połączeń WiFi w naszej malinie, tak by szło odszyfrować kontener LUKS przez SSH, w sytuacji gdy z
jakiegoś powodu nie chcemy lub też nie możemy korzystać z przewodowego interfejsu sieciowego tego
minikomputera z zainstalowanym system RasPiOS/Raspbian."><meta itemprop="datePublished" content="2021-11-13T13:26:00+01:00" />
<meta itemprop="dateModified" content="2021-11-13T13:26:00+01:00" />
<meta itemprop="wordCount" content="1880">
<meta itemprop="keywords" content="luks,raspberry-pi-4b,raspios,raspbian,szyfrowanie,ssh,initramfs,initrd,wifi,firmware," />
		<meta name="twitter:card" content="summary"/><meta name="twitter:title" content="Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo"/>
<meta name="twitter:description" content="W poprzednim artykule, który traktował o odszyfrowaniu kontenera LUKS przez SSH z poziomu
initramfs/initrd na Raspberry Pi, została poruszona kwestia adresacji IP, która w opisanym tam
rozwiązaniu miała pewne ograniczenia. Chodziło o to, że połączenie SSH do RPI mogło być realizowane
jedynie przez przewodowy interfejs sieciowy eth0 . Trzeba było zatem się zastanowić nad
rozwiązaniem, które umożliwiłoby korzystanie również z bezprzewodowego interfejsu WiFi, tj.
wlan0 . Celem niniejszego wpisu jest pokazanie w jaki sposób można dorobić wsparcie dla
połączeń WiFi w naszej malinie, tak by szło odszyfrować kontener LUKS przez SSH, w sytuacji gdy z
jakiegoś powodu nie chcemy lub też nie możemy korzystać z przewodowego interfejsu sieciowego tego
minikomputera z zainstalowanym system RasPiOS/Raspbian."/>
<meta name="twitter:site" content="@mikhailmorfikov"/>

	<link rel="stylesheet" href="https://morfikov.github.io/css/bundle.css">
	<link rel="stylesheet" href="https://morfikov.github.io/css/custom.css">
	<link rel="icon" href="https://morfikov.github.io/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="https://morfikov.github.io/icons/32.png" sizes="32x32" type="image/png">
	<link rel="manifest" href="https://morfikov.github.io/manifest.json">
		
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-119125303-1', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>

</head>
<body>
	<header class="header">
	<a class="logo" href="https://morfikov.github.io/">Morfitronik</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/categories/">
					
					<span class="main-nav__text">Kategorie</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/tags/">
					
					<span class="main-nav__text">Tagi</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="https://morfikov.github.io/page/info-kontakt/">
					
					<span class="main-nav__text">Info/Kontakt</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/">Home</a>
		</li>
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="https://morfikov.github.io/post/">Posts</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo</li>
	</ol>
</nav>
		<div class="single block">
			<article class="entry">
	<div class="entry__meta meta mb">
	<time class="entry__meta-published meta-published" datetime="2021-11-13T13:26:00&#43;01:00">Opublikowano: 13/11/2021</time>

<span class="entry__meta-categories meta-categories">
	<span class="meta-categories__list">Kategorie:
		<a class="meta-categories__link" href="https://morfikov.github.io/categories/raspberrypi/" rel="category">RaspberryPi</a>
	</span>
</span>
	</div>
				<h1 class="entry__title">Wsparcie dla WiFi w initramfs/initrd by odszyfrować LUKS przez SSH bezprzewodowo</h1>
<details class="entry__toc toc" >
	<summary class="toc__title">Spis treści</summary>
	<nav id="TableOfContents">
  <ol>
    <li><a href="#problematyczne-wsparcie-dla-wifi-w-initramfsinitrd">Problematyczne wsparcie dla WiFi w initramfs/initrd</a></li>
    <li><a href="#konfiguracja-obrazu-initramfsinitrd-na-potrzeby-wifi">Konfiguracja obrazu initramfs/initrd na potrzeby WiFi</a>
      <ol>
        <li><a href="#plik-etcinitramfs-toolsscriptsinit-premounta_enable_wireless">Plik /etc/initramfs-tools/scripts/init-premount/a_enable_wireless</a></li>
        <li><a href="#plik-etcinitramfs-toolshooksenable-wireless">Plik /etc/initramfs-tools/hooks/enable-wireless</a></li>
        <li><a href="#plik-etcinitramfs-toolsscriptslocal-bottomkill_wireless">Plik /etc/initramfs-tools/scripts/local-bottom/kill_wireless</a></li>
        <li><a href="#plik-etcinitramfs-toolswpa_supplicantconf">Plik /etc/initramfs-tools/wpa_supplicant.conf</a></li>
        <li><a href="#plik-etcinitramfs-toolsinitramfsconf">Plik /etc/initramfs-tools/initramfs.conf</a></li>
      </ol>
    </li>
    <li><a href="#regeneracja-obrazu-initramfsinitrd">Regeneracja obrazu initramfs/initrd</a></li>
    <li><a href="#test-połączenia-ssh-przez-wifi-z-poziomu-initramfsinitrd">Test połączenia SSH przez WiFi z poziomu initramfs/initrd</a></li>
    <li><a href="#podsumowanie">Podsumowanie</a></li>
  </ol>
</nav>
</details>
				<div class="entry__content"><p>W poprzednim artykule, który traktował o <a href="https://morfikov.github.io/post/odszyfrowanie-luks-przez-ssh-z-poziomu-initramfs-initrd-na-raspberry-pi/">odszyfrowaniu kontenera LUKS przez SSH z poziomu
initramfs/initrd na Raspberry Pi</a>, została poruszona kwestia adresacji IP, która w opisanym tam
rozwiązaniu miała pewne ograniczenia. Chodziło o to, że połączenie SSH do RPI mogło być realizowane
jedynie przez przewodowy interfejs sieciowy <code>eth0</code> . Trzeba było zatem się zastanowić nad
rozwiązaniem, które umożliwiłoby korzystanie również z bezprzewodowego interfejsu WiFi, tj.
<code>wlan0</code> . Celem niniejszego wpisu jest pokazanie w jaki sposób można dorobić wsparcie dla
połączeń WiFi w naszej malinie, tak by szło odszyfrować kontener LUKS przez SSH, w sytuacji gdy z
jakiegoś powodu nie chcemy lub też nie możemy korzystać z przewodowego interfejsu sieciowego tego
minikomputera z zainstalowanym system RasPiOS/Raspbian.</p>
<h2 id="problematyczne-wsparcie-dla-wifi-w-initramfsinitrd">Problematyczne wsparcie dla WiFi w initramfs/initrd</h2>
<p>Te nieco bardziej spostrzegawcze osobniki zapewne zdążyły już zauważyć, że w przypadku przewodowego
interfejsu sieciowego nie trzeba było za bardzo zmieniać konfiguracji obrazu initramfs/initrd. No i
faktycznie połączenie przewodowe w tym stadium rozruchu systemu działa w zasadzie OOTB. W przypadku
interfejsów bezprzewodowych trzeba się będzie trochę wysilić, a to ze względu na fakt, że w obrazie
initramfs/initrd brakuje oprogramowania odpowiedzialnego za zestawienie połączenia WiFi.</p>
<p>W dystrybucjach bazujących na Debianie, w tym też RasPiOS/Raspbian, oprogramowaniem odpowiedzialnym
za konfigurację połączenia WiFi jest pakiet <code>wpasupplicant</code> , który jest domyślnie zainstalowany w
Raspberry Pi. Niemniej jednak, binarki pokroju <code>wpa_supplicant</code> czy <code>wpa_cli</code> to nie wszystko, by
komunikacja bezprzewodowa mogła zostać ustanowiona. Potrzebne są sterowniki i firmware od tego
modelu karty WiFi, który siedzi w naszym RPI. Dodatkowo trzeba też określić parametry dla
połączenia WiFi, takie jak ESSID czy hasło, które zwykle trzymane są w pliku
<code>/etc/wpa_supplicant.conf</code> .</p>
<p>O ile te wszystkie wyżej wymienione rzeczy są standardowo dostępne w działającym systemie
RasPiOS/Raspbian, o tyle żadna z nich nie jest dostępna w obrazie initramfs/initrd, przez co
połączenie WiFi na tym etapie startu systemu nam zwyczajnie działać nie może. Dobre wieści są
jednak takie, że skoro WiFi działa nam po uruchomieniu systemu, to możne też działa w fazie
initramfs/initrd. Trzeba tylko te wyżej wypisane komponenty zapakować do tego obrazu i odpowiednio
skonfigurować.</p>
<p>Chciałbym tutaj wyraźnie zaznaczyć, że informacje na temat tego <a href="https://morfikov.github.io/post/odszyfrowanie-luks-przez-ssh-z-poziomu-initramfs-initrd-na-raspberry-pi/">jak skonfigurować usługę SSH, tak
by działała ona w fazie initramfs/initrd na Raspberry Pi</a> znajdują się w osobnym artykule i
nie będę tutaj tego zagadnienia opisywał ponownie. Dalsza część artykułu zakłada, że jesteśmy w
stanie podłączyć się po SSH z wykorzystaniem przewodowego interfejsu sieciowego w naszej malinie.</p>
<h2 id="konfiguracja-obrazu-initramfsinitrd-na-potrzeby-wifi">Konfiguracja obrazu initramfs/initrd na potrzeby WiFi</h2>
<p>Szukając informacji na temat tego jak włączyć wsparcie dla WiFi w obrazie initramfs/initrd
natrafiłem na <a href="https://gist.github.com/telenieko/d17544fc7e4b347beffa87252393384c">ten oto dość przyzwoicie napisany post</a>. Problem z przedstawionym w tym poście
rozwiązaniem jest jednak taki, że po uruchomieniu się systemu (do momentu, w którym trzeba
odszyfrować kontener LUKS) wcina nam całkowicie interfejs WiFi. Jest to efektem braku dołączenia do
obrazu initramfs/initrd plików z firmware, których wymaga karta WiFi do pracy. Postanowiłem zatem w
oparciu o tego podlinkowanego wyżej posta naskrobać nieco bardziej aktualną wersję opisanego tam
rozwiązania, które będzie działać na Raspberry Pi 4B i być może też i innych malinach.</p>
<h3 id="plik-etcinitramfs-toolsscriptsinit-premounta_enable_wireless">Plik /etc/initramfs-tools/scripts/init-premount/a_enable_wireless</h3>
<p>W katalogu <code>/etc/initramfs-tools/scripts/init-premount/</code> tworzymy plik <code>a_enable_wireless</code> .
Nadajemy mu również prawa wykonywania:</p>
<pre><code>root@raspberrypi:~# touch /etc/initramfs-tools/scripts/init-premount/a_enable_wireless
root@raspberrypi:~# chmod +x /etc/initramfs-tools/scripts/init-premount/a_enable_wireless
</code></pre>
<p>Następnie wrzucamy do tego pliku poniższą zawartość, odpowiednio zmieniając wartości w zmiennych
<code>AUTH_LIMIT=</code> oraz <code>INTERFACE=</code> :</p>
<pre><code>#!/bin/sh
# this goes into /etc/initramfs-tools/scripts/init-premount/a_enable_wireless
PREREQ=&quot;&quot;
prereqs()
{
    echo &quot;$PREREQ&quot;
}

case $1 in
prereqs)
    prereqs
    exit 0
    ;;
esac

. /scripts/functions

AUTH_LIMIT=30
INTERFACE=&quot;wlan0&quot;
alias WPACLI=&quot;/sbin/wpa_cli -p/tmp/wpa_supplicant -i$INTERFACE &quot;

log_begin_msg &quot;Setting WLAN regdomain&quot;
# Set this to your region
/sbin/iw reg set PL

log_begin_msg &quot;Starting WLAN connection&quot;
sleep 1 &amp;&amp; /sbin/wpa_supplicant  -i$INTERFACE -c/etc/wpa_supplicant.conf -P/run/initram-wpa_supplicant.pid -B -f /tmp/wpa_supplicant.log

# Wait for AUTH_LIMIT seconds, then check the status
limit=${AUTH_LIMIT}

echo -n &quot;Waiting for connection (max ${AUTH_LIMIT} seconds)&quot;
while [ $limit -ge 0 -a `WPACLI status | grep wpa_state` != &quot;wpa_state=COMPLETED&quot; ]
do
    sleep 1
    echo -n &quot;.&quot;
    limit=`expr $limit - 1`
done
echo &quot;&quot;

if [ `WPACLI status | grep wpa_state` != &quot;wpa_state=COMPLETED&quot; ]; then
  ONLINE=0
  log_failure_msg &quot;WLAN offline after timeout&quot;
  panic
else
  ONLINE=1
  log_success_msg &quot;WLAN online&quot;
fi

configure_networking
</code></pre>
<p>Celem tego skrypt jest podłączenia nas do określonej sieci WiFi. W moim przypadku przy
wykorzystaniu oryginalnego skryptu pojawił się błąd: <code>Failed to connect to non-global ctrl_ifname error: No such file or directory</code> , co można zaobserwować na poniższej fotce:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/11/001.raspberry-pi-initramfs-initrd-ssh-wifi-luks-error.jpg" alt="raspberry-pi-initramfs-initrd-ssh-wifi-luks-error"    class="huge"></p>
<p>Efektem naturalnie był brak połączenia WiFi w Raspberry Pi, przez co nie szło się zalogować do
systemu po SSH. Natomiast rozwiązaniem tego problemu okazało się opóźnienie wywołania polecenia
<code>/sbin/wpa_supplicant</code> przy pomocy <code>sleep 1 &amp;&amp;</code> .</p>
<h3 id="plik-etcinitramfs-toolshooksenable-wireless">Plik /etc/initramfs-tools/hooks/enable-wireless</h3>
<p>W katalogu <code>/etc/initramfs-tools/hooks/</code> tworzymy plik <code>enable-wireless</code> i nadajemy mu prawa
wykonywania:</p>
<pre><code>root@raspberrypi:~# touch /etc/initramfs-tools/hooks/enable-wireless
root@raspberrypi:~# chmod +x /etc/initramfs-tools/hooks/enable-wireless
</code></pre>
<p>Następnie wrzucamy do tego pliku poniższą zawartość, odpowiednio dostosowując moduły, których
wymaga karta WiFi (w tym przypadku <code>brcmfmac</code> ):</p>
<pre><code># !/bin/sh
# This goes into /etc/initramfs-tools/hooks/enable-wireless
set -e
PREREQ=&quot;&quot;
prereqs()
{
    echo &quot;${PREREQ}&quot;
}
case &quot;${1}&quot; in
    prereqs)
        prereqs
        exit 0
        ;;
esac

. /usr/share/initramfs-tools/hook-functions

# CHANGE HERE for your correct modules.
manual_add_modules brcmfmac

copy_exec /sbin/wpa_supplicant
copy_exec /sbin/wpa_cli
copy_exec /sbin/iw

copy_file config /etc/initramfs-tools/wpa_supplicant.conf /etc/wpa_supplicant.conf

#copy_file firmware /lib/firmware/brcm/brcmfmac43455-sdio.bin
copy_file firmware /lib/firmware/brcm/brcmfmac43455-sdio.clm_blob
copy_file firmware /lib/firmware/brcm/brcmfmac43455-sdio.txt

copy_file config /lib/crda/regulatory.bin
copy_file config /lib/firmware/regulatory.db
copy_file config /lib/firmware/regulatory.db.p7s
</code></pre>
<p>Ten plik różni się trochę od oryginału. Wszystko dlatego, że gdy próbowałem uruchomić system na
oryginalnej wersji tego pliku, to w systemie nie został wykryty interfejs <code>wlan0</code> , a w logu można
było zaobserwować poniższy komunikat:</p>
<pre><code>raspberrypi kernel: brcmfmac: F1 signature read @0x18000000=0x15264345
raspberrypi kernel: brcmfmac: brcmf_fw_alloc_request: using brcm/brcmfmac43455-sdio for chip BCM4345/6
raspberrypi kernel: brcmfmac mmc1:0001:1: Direct firmware load for brcm/brcmfmac43455-sdio.txt failed with error -2
raspberrypi kernel: Console: switching to colour frame buffer device 160x64
raspberrypi kernel: vc4-drm gpu: [drm] fb0: vc4drmfb frame buffer device
raspberrypi kernel: brcmfmac: brcmf_sdio_htclk: HT Avail timeout (1000000): clkctl 0x50
raspberrypi kernel: usbcore: registered new interface driver brcmfmac
</code></pre>
<p>W przypadku mojego Raspberry Pi 4B, mamy do czynienia z kartą Broadcom, która wymaga do pracy
modułu kernela <code>brcmfmac</code> . Gdy się zajrzy w informacje o tym module, to zobaczymy listę plików
firmware, które ten moduł może chcieć zażądać. Na tej liście są uwzględnione firmware do różnych
kart WiFi ale nas w tym momencie interesuje jedynie brakujący plik <code>brcm/brcmfmac43455-sdio.txt</code> :</p>
<pre><code>root@raspberrypi:/tmp# modinfo -F firmware /lib/modules/5.10.63-v7l+/kernel/drivers/net/wireless/broadcom/brcm80211/brcmfmac/brcmfmac.ko
...
brcm/brcmfmac43455-sdio.bin
...
</code></pre>
<p>Jak widać, jedyny plik mający w nazwie <code>brcm/brcmfmac43455-sdio</code> , to
<code>brcm/brcmfmac43455-sdio.bin</code> , a potrzebnego nam pliku <code>brcm/brcmfmac43455-sdio.txt</code> nie ma już na
tej liście. Dlatego też polecenie <code>manual_add_modules</code> , z którego korzystaliśmy w powyższym
skrypcie, nie było w stanie skopiować wszystkich potrzebnych plików do obrazu initramfs/initrd.</p>
<p>Jeśli zajrzymy do katalogu <code>/lib/firmware/</code> , to zastaniemy tam te trzy poniższe pliki zamiast
jednego:</p>
<pre><code>root@raspberrypi:~# ls -al /lib/firmware/brcm/brcmfmac43455*
-rw-r--r-- 1 root root 631467 Nov  1 23:07 /lib/firmware/brcm/brcmfmac43455-sdio.bin
-rw-r--r-- 1 root root   7163 Nov  1 23:07 /lib/firmware/brcm/brcmfmac43455-sdio.clm_blob
-rw-r--r-- 1 root root   2074 Nov  1 23:07 /lib/firmware/brcm/brcmfmac43455-sdio.txt
</code></pre>
<p>Wszystkie te pliki firmware trzeba skopiować do obrazu initramfs/initrd, by karta WiFi w Raspberry
Pi działała prawidłowo. Możemy naturalnie te wszystkie pliki skopiować do obrazu via <code>copy_file firmware</code> ale lepszym rozwiązaniem jest pozostawić <code>manual_add_modules</code> i skopiować jedynie
brakujące pliki. Chodzi generalnie o to, że <code>manual_add_modules</code> <a href="https://manpages.debian.org/stretch/initramfs-tools-core/initramfs-tools.8.en.html">bierze pod uwagę zależności
modułów</a>, czego efektem będzie skopiowanie wszystkich niezbędnych modułów do obrazu
initramfs/initrd. Jeśli jednak chcielibyśmy ręcznie kopiować wszystkie rzeczy, to zależności
modułów możemy wyciągnąć w poniższy sposób:</p>
<pre><code>root@raspberrypi:~# modprobe --show-depends --ignore-install brcmfmac
insmod /lib/modules/5.10.63-v7l+/kernel/net/rfkill/rfkill.ko
insmod /lib/modules/5.10.63-v7l+/kernel/net/wireless/cfg80211.ko
insmod /lib/modules/5.10.63-v7l+/kernel/drivers/net/wireless/broadcom/brcm80211/brcmutil/brcmutil.ko
insmod /lib/modules/5.10.63-v7l+/kernel/drivers/net/wireless/broadcom/brcm80211/brcmfmac/brcmfmac.ko
</code></pre>
<p>Ewentualne pliki z firmware wymagane przez te moduły również trzeba uwzględnić w obrazie
initramfs/initrd.</p>
<p>Ja jeszcze dodatkowo skopiowałem sobie <a href="https://www.kernel.org/doc/html/latest/networking/regulatory.html">bazę danych regulacji WiFi</a>, tj. pliki <code>regulatory.db*</code> ,
które kernel zwykle żąda przy konfiguracji połączeń bezprzewodowych.</p>
<h3 id="plik-etcinitramfs-toolsscriptslocal-bottomkill_wireless">Plik /etc/initramfs-tools/scripts/local-bottom/kill_wireless</h3>
<p>W katalogu <code>/etc/initramfs-tools/scripts/local-bottom/</code> tworzymy skrypt <code>kill_wireless</code> i nadajemy
mu prawa wykonywania:</p>
<pre><code>root@raspberrypi:~# touch /etc/initramfs-tools/scripts/local-bottom/kill_wireless
root@raspberrypi:~# chmod +x /etc/initramfs-tools/scripts/local-bottom/kill_wireless
</code></pre>
<p>Następnie wrzucamy do tego pliku poniższą zawartość:</p>
<pre><code>#!/bin/sh
# this goes into /etc/initramfs-tools/scripts/local-bottom/kill_wireless
PREREQ=&quot;&quot;
prereqs()
{
    echo &quot;$PREREQ&quot;
}

case $1 in
prereqs)
    prereqs
    exit 0
    ;;
esac

echo &quot;Killing wpa_supplicant so the system takes over later.&quot;
kill `cat /run/initram-wpa_supplicant.pid`
</code></pre>
<p>Zadaniem tego skryptu jest zerwanie połączenia WiFi po pomyślnym odszyfrowaniu kontenera LUKS. W
późniejszym czasie startu systemu, Raspberry Pi ponownie się podłączy do WiFi, gdy już system się w
pełni zainicjuje.</p>
<h3 id="plik-etcinitramfs-toolswpa_supplicantconf">Plik /etc/initramfs-tools/wpa_supplicant.conf</h3>
<p>W katalogu <code>/etc/initramfs-tools/</code> tworzymy plik <code>wpa_supplicant.conf</code> , w którym będzie
przechowywana konfiguracja sieci WiFi jedynie na potrzeby fazy initramfs/initrd:</p>
<pre><code>root@raspberrypi:~# touch /etc/initramfs-tools/wpa_supplicant.conf
</code></pre>
<p>Następnie wrzucamy do tego pliku poniższą zawartość:</p>
<pre><code># sample /etc/initramfs-tools/wpa_supplicant.conf
# note that this is independent of the system /etc/wpa_supplicant.conf (if any)
# only add the network you need at boot time. **And keep the ctrl_interface** !!
ctrl_interface=/tmp/wpa_supplicant
country=PL

network={
    ssid=&quot;Ever_Vigilant&quot;
    scan_ssid=1
    psk=&quot;DontLookAtMe&quot;
    key_mgmt=WPA-PSK
}
</code></pre>
<h3 id="plik-etcinitramfs-toolsinitramfsconf">Plik /etc/initramfs-tools/initramfs.conf</h3>
<p>W pliku <code>/etc/initramfs-tools/initramfs.conf</code> musimy jedynie zmienić interfejs z przewodowego na
bezprzewodowy, tak by system skonfigurował na nim adresację IP:</p>
<p>Dla statycznej adresacji IP:</p>
<pre><code>IP=&quot;192.168.1.239::192.168.1.1:255.255.255.0:rpi:wlan0:none&quot;
</code></pre>
<p>Dla dynamicznej adresacji IP via DHCP:</p>
<pre><code>IP=&quot;::::rpi:wlan0:dhcp&quot;
</code></pre>
<h2 id="regeneracja-obrazu-initramfsinitrd">Regeneracja obrazu initramfs/initrd</h2>
<p>Po dostosowaniu tych wszystkich powyższych plików musimy wygenerować nowy obraz initramfs/initrd
przy pomocy polecenia <code>update-initramfs</code> :</p>
<pre><code>root@raspberrypi:~# update-initramfs -u -k $(uname -r)
ln: failed to create hard link '/boot/initrd.img-5.10.63-v7l+.dpkg-bak' =&gt; '/boot/initrd.img-5.10.63-v7l+': Operation not permitted
update-initramfs: Generating /boot/initrd.img-5.10.63-v7l+
Building v7l+ image, updating top initrd
</code></pre>
<h2 id="test-połączenia-ssh-przez-wifi-z-poziomu-initramfsinitrd">Test połączenia SSH przez WiFi z poziomu initramfs/initrd</h2>
<p>Pozostało nam już tylko uruchomić Raspberry Pi ponownie i sprawdzić czy w fazie initramfs/initrd
adresacja IP na interfejsie <code>wlan0</code> jest przydzielana oraz czy jesteśmy w stanie bez problemu
nawiązać połączenie SSH z RPI:</p>
<pre><code>$ ssh 192.168.1.239
Please unlock disk rpi_crypt:
</code></pre>
<p>Połączenie zostało ustanowione i pojawił się prompt z prośbą o hasło by odszyfrować kontener LUKS.</p>
<p>Patrząc na monitor podłączony do Raspberry Pi, mamy taki oto obrazek chwilę przed wpisaniem hasła
do kontenera:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/11/002.raspberry-pi-initramfs-initrd-ssh-wifi-luks-ip-config.jpg" alt="raspberry-pi-initramfs-initrd-ssh-wifi-luks-ip-config"    class="huge"></p>
<p>Komunikat <code>Success: &quot;WLAN online&quot;</code> świadczy o fakcie podłączenia do zdefiniowanej sieci WiFi.
Adresacja na interfejsie <code>wlan0</code> również została skonfigurowana. Po wpisaniu prawidłowego hasła
przez SSH, kontener LUKS powinien zostać odszyfrowany, a system powinien kontynuować procedurę
startu w tradycyjny sposób:</p>
<p><img loading="lazy" src="https://morfikov.github.io/img/2021/11/003.raspberry-pi-initramfs-initrd-ssh-wifi-luks-system-boot.jpg" alt="raspberry-pi-initramfs-initrd-ssh-wifi-luks-system-boot"    class="huge"></p>
<p>Jako, że mam na swoim domowym routerze WiFi wgrany firmware OpenWRT, to mogę podejrzeć o czym te
dwa urządzenia ze sobą rozmawiają. Chwilę po uruchomieniu Raspberry Pi ale przed otworzeniem
kontenera w logu routera można zarejestrować poniższe komunikaty:</p>
<pre><code>hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: authenticated
hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: associated (aid 2)
hostapd: wifi2g: AP-STA-CONNECTED dc:a6:32:af:5b:03
hostapd: wifi2g: STA dc:a6:32:af:5b:03 RADIUS: starting accounting session 49BEFF3343C481BD
hostapd: wifi2g: STA dc:a6:32:af:5b:03 WPA: pairwise key handshake completed (RSN)
</code></pre>
<p>Zatem Raspberry Pi uwierzytelnia się i podłącza bez problemu do routera po WiFi.</p>
<p>Po wpisaniu hasła do kontenera LUKS via SSH, po chwili w logu na routerze pojawiają się takie oto
komunikaty:</p>
<pre><code>hostapd: wifi2g: AP-STA-DISCONNECTED dc:a6:32:af:5b:03
hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: disassociated
hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: deauthenticated due to inactivity (timer DEAUTH/REMOVE)
</code></pre>
<p>Mamy tutaj informację, żę Raspberry Pi rozłącza połączenie WiFi po odszyfrowaniu kontenera LUKS,
czyli dokładnie takie zachowanie, o jakie nam chodziło.</p>
<p>Po chwili w logu pojawiają się też te poniższe komunikaty:</p>
<pre><code>hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: authenticated
hostapd: wifi2g: STA dc:a6:32:af:5b:03 IEEE 802.11: associated (aid 2)
hostapd: wifi2g: AP-STA-CONNECTED dc:a6:32:af:5b:03
hostapd: wifi2g: STA dc:a6:32:af:5b:03 RADIUS: starting accounting session FA7A4354549318AB
hostapd: wifi2g: STA dc:a6:32:af:5b:03 WPA: pairwise key handshake completed (RSN)
dnsmasq-dhcp[3510]: DHCPREQUEST(br-lan) 192.168.1.239 dc:a6:32:af:5b:03
dnsmasq-dhcp[3510]: DHCPACK(br-lan) 192.168.1.239 dc:a6:32:af:5b:03 RaspberryPi
</code></pre>
<p>Czego efektem naturalnie jest ponowne uzyskanie przez Raspberry Pi połączenia drogą bezprzewodową
z domowym routerem WiFi i tym razem to router przydziela RPI adresację IP przy wykorzystaniu
protokołu DHCP.</p>
<h2 id="podsumowanie">Podsumowanie</h2>
<p>Implementując wsparcie dla połączeń WiFi w fazie initramfs/initrd usunęliśmy kluczowy problem, z
jakim mogą zmagać się osoby próbujące otworzyć kontener LUKS w tej fazie korzystając z połączenia
SSH. Możemy teraz sobie wybrać czy połączenia do Raspberry Pi mają być realizowane przewodowo, czy
też bezprzewodowo. Opisane tutaj rozwiązanie nie jest specyficzne dla Raspberry Pi i można je
wykorzystać również na innych dystrybucjach linux'a.</p></div>
				
				<footer class="entry__footer">
					
<div class="entry__tags">
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/luks/">luks</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/raspberry-pi-4b/">raspberry-pi-4b</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/raspios/">raspios</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/raspbian/">raspbian</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/szyfrowanie/">szyfrowanie</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/ssh/">ssh</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/initramfs/">initramfs</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/initrd/">initrd</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/wifi/">wifi</a>
			<a class="entry__tag btn" href="https://morfikov.github.io/tags/firmware/">firmware</a>
</div>
					
<div class="entry__share share">
	<a class="share__link btn" title="Podziel się na Facebook" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Facebook', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Facebook" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M330 512V322h64l9-74h-73v-47c0-22 6-36 37-36h39V99c-7-1-30-3-57-3-57 0-95 34-95 98v54h-64v74h64v190z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Twitter" href="https://twitter.com/intent/tweet/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&amp;text=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Twitter', 'width=800,height=450,resizable=yes,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Reddit" href="https://www.reddit.com/submit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&amp;title=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Reddit', 'width=832,height=624,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Reddit" role="img" width="32" height="32" viewBox="0 0 512 512"><path fill-rule="evenodd" d="M375 146a32 32 0 1 0-29-46l-65-13c-5-1-9 2-10 6l-22 97c-45 1-85 15-113 36a42 42 0 1 0-45 69l-1 12c0 65 74 117 166 117s166-52 166-117l-1-11a42 42 0 1 0-44-69c-28-21-67-35-111-37l19-86 58 13a32 32 0 0 0 32 29zM190 353c2-1 4 0 5 1 15 11 38 18 61 18s46-6 61-18a7 7 0 0 1 8 10c-18 14-44 21-69 21-25-1-51-7-69-21a6 6 0 0 1 3-11zm23-44a31 31 0 1 1-44-44 31 31 0 0 1 44 44zm130 0a31 31 0 1 0-44-44 31 31 0 0 0 44 44z"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na Telegram" href="https://t.me/share/url?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&amp;title=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na Telegram', 'width=800,height=600,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na LinkedIn" href="https://www.linkedin.com/shareArticle?mini=true&url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&title=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na LinkedIn', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="LinkedIn" role="img" width="32" height="32" viewBox="0 0 512 512"><circle cx="142" cy="138" r="37"/><path stroke-width="66" d="M244 194v198M142 194v198"/><path d="M276 282c0-20 13-40 36-40 24 0 33 18 33 45v105h66V279c0-61-32-89-76-89-34 0-51 19-59 32"/></svg>
	</a>
	<a class="share__link btn" title="Podziel się na VK" href="https://vk.com/share.php?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Podziel się na VK', 'width=640,height=480,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="VK" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M274 363c5-1 14-3 14-15 0 0-1-30 13-34s32 29 51 42c14 9 25 8 25 8l51-1s26-2 14-23c-1-2-9-15-39-42-31-30-26-25 11-76 23-31 33-50 30-57-4-7-20-6-20-6h-57c-6 0-9 1-12 6 0 0-9 25-21 45-25 43-35 45-40 42-9-5-7-24-7-37 0-45 7-61-13-65-13-2-59-4-73 3-7 4-11 11-8 12 3 0 12 1 17 7 8 13 9 75-2 81-15 11-53-62-62-86-2-6-5-7-12-9H79c-6 0-15 1-11 13 27 56 83 193 184 192z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pocket" href="https://getpocket.com/edit?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&amp;title=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=480,height=320,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pocket" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M388.8 88.9H123.2A47.4 47.4 0 0 0 76 136.5v131.9c0 2.4.2 4.8.5 7.2a101.8 101.8 0 0 0-.5 10.6c0 75.6 80.6 137 180 137s180-61.4 180-137c0-3.6-.2-7.1-.5-10.6.3-2.4.5-4.8.5-7.2v-132A47.4 47.4 0 0 0 388.8 89zm-22.4 132.6l-93 93c-4.7 4.6-11 7-17.1 7a23.8 23.8 0 0 1-17.7-7l-93-93a24 24 0 0 1 33.8-33.8l76.6 76.5 76.6-76.5a24 24 0 0 1 33.8 33.8z"/></svg>
	</a>
	<a class="share__link btn" title="Zapisz do Pinterest" href="https://pinterest.com/pin/create/button/?url=https%3a%2f%2fmorfikov.github.io%2fpost%2fwsparcie-dla-wifi-w-initramfs-initrd-by-odszyfrowac-luks-przez-ssh-bezprzewodowo%2f&description=Wsparcie%20dla%20WiFi%20w%20initramfs%2finitrd%20by%20odszyfrowa%c4%87%20LUKS%20przez%20SSH%20bezprzewodowo" target="_blank" rel="noopener noreferrer" onclick="window.open(this.href, 'Zapisz do Pocket', 'width=800,height=720,toolbar=0,status=0'); return false">
		<svg class="share__icon" aria-label="Pinterest" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="m265 65c-104 0-157 75-157 138 0 37 14 71 45 83 5 2 10 0 12-5l3-18c2-6 1-7-2-12-9-11-15-24-15-43 0-56 41-106 108-106 60 0 92 37 92 85 0 64-28 116-70 116-23 0-40-18-34-42 6-27 19-57 19-77 0-18-9-34-30-34-24 0-42 25-42 58 0 20 7 34 7 34l-29 120a249 249 0 0 0 2 86l3-1c2-3 31-37 40-72l16-61c7 15 29 28 53 28 71 0 119-64 119-151 0-66-56-126-140-126z"/></svg>
	</a>
</div>
				</footer>
				
			</article>
		</div>
	</main>
	
<div class="authorbox block">
	<div class="author">
		<figure class="author__avatar">
			<img class="author__img" alt="Mikhail Morfikov avatar" src="https://morfikov.github.io/img/avatar.png" height="90" width="90">
		</figure>
		<div class="author__body">
			<div class="author__name">
				Mikhail Morfikov
			</div>
			<div class="author__bio">Po ponad 10 latach spędzonych z różnej maści linux&#39;ami (Debian/Ubuntu, OpenWRT, Android) mogę śmiało powiedzieć, że nie ma rzeczy niemożliwych i problemów, których nie da się rozwiązać. Jedną umiejętność, którą ludzki umysł musi posiąść, by wybrnąć nawet z tej najbardziej nieprzyjemniej sytuacji, to zdolność logicznego rozumowania.</div>
		</div>
	</div>
</div>
	



<div class="related block">
	<h3 class="related__title">Powiązane</h3>
	<ul class="related__list">
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/odszyfrowanie-luks-przez-ssh-z-poziomu-initramfs-initrd-na-raspberry-pi/">Odszyfrowanie LUKS przez SSH z poziomu initramfs/initrd na Raspberry Pi</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-zaszyfrowac-raspberry-pi-raspios-raspbian-luks/">Jak zaszyfrować Raspberry Pi (RasPiOS/Raspbian, LUKS)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/wykorzystanie-nosnika-usb-jako-klucz-do-odszyfrowania-raspberry-pi/">Wykorzystanie nośnika USB jako klucz do odszyfrowania Raspberry Pi (LUKS)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/chroot-do-32-bit-systemu-arm-z-poziomu-64-bit-linuxowego-hosta/">Chroot do 32-bit systemu ARM z poziomu 64-bit linux&#39;owego hosta</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-przepisac-linki-initrd-img-old-i-vmlinuz-old-do-boot/">Jak przepisać linki initrd.img{,.old} i vmlinuz{,.old} z / do /boot/</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/kontrola-podswietlenia-klawiatury-via-udev-backlight/">Kontrola podświetlenia klawiatury via UDEV (backlight)</a></li>
		
		<li class="related__item"><a class="related__link" href="https://morfikov.github.io/post/jak-odszyfrowac-linux-przy-pomocy-telefonu-z-androidem/">Jak odszyfrować linux&#39;a przy pomocy telefonu z Androidem</a></li>
		
	</ul>
</div>

	<div id="comments">
		<script src="https://utteranc.es/client.js"
        repo="morfikov/morfitronik-comments"
        issue-term="og:title"
        theme="github-dark"
        crossorigin="anonymous"
        async>
</script>

	</div>

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:morfitronik@gmail.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://twitter.com/mikhailmorfikov">
			<svg class="social__icon" aria-label="Twitter" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M437 152a72 72 0 0 1-40 12 72 72 0 0 0 32-40 72 72 0 0 1-45 17 72 72 0 0 0-122 65 200 200 0 0 1-145-74 72 72 0 0 0 22 94 72 72 0 0 1-32-7 72 72 0 0 0 56 69 72 72 0 0 1-32 1 72 72 0 0 0 67 50 200 200 0 0 1-105 29 200 200 0 0 0 309-179 200 200 0 0 0 35-37"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://t.me/morfikov">
			<svg class="social__icon" aria-label="Telegram" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M199 404c-11 0-10-4-13-14l-32-105 245-144"/><path d="M199 404c7 0 11-4 16-8l45-43-56-34"/><path d="M204 319l135 99c14 9 26 4 30-14l55-258c5-22-9-32-24-25L79 245c-21 8-21 21-4 26l83 26 190-121c9-5 17-3 11 4"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/morfikov">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://gitlab.com/morfikov">
			<svg class="social__icon" aria-label="Gitlab" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M450 282l-22-67-43-133c-2-7-12-7-14 0l-43.3 133H184.3L141 82c-2-7-12-7-14 0L84 215l-22 67c-2 6 0 13 6 16l188 137 188-137c6-3 8-10 6-16z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://stackoverflow.com/users/3015317">
			<svg class="social__icon" aria-label="Stack Overflow" role="img" width="32" height="32" viewBox="0 0 512 512"><g stroke-width="30"><path fill="none" d="M125 297v105h241V297"/><path d="M170 341h150m-144-68l148 31M199 204l136 64m-95-129l115 97M293 89l90 120"/></g></svg>
		</a>
</div>
	<div class="footer__copyright">© 2024 Mikhail Morfikov.
	<span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span>
	<span class="footer__copyright-cc">
		<div class="license-icons">
			<a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/" title="Creative Commons Attribution 4.0 International license">
<i class="icon-cc"></i><i class="icon-cc-by"></i><i class="icon-cc-nc"></i><i class="icon-cc-sa"></i>
</a>
		</div>
		Except where otherwise noted, content on this site is licensed under a <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution-NonCommercial-ShareAlike 4.0 International license</a>.
	</span>
	</div>
</footer>

<script src="https://morfikov.github.io/js/menu.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" async></script>

<script src="https://morfikov.github.io/js/custom.js"></script>
<script src="https://unpkg.com/vanilla-back-to-top@7.2.1/dist/vanilla-back-to-top.min.js"></script>
<script>addBackToTop({
  diameter: 40,
  textColor: '#c3c3c3'
})</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.6/medium-zoom.min.js" integrity="sha512-N9IJRoc3LaP3NDoiGkcPa4gG94kapGpaA5Zq9/Dr04uf5TbLFU5q0o8AbRhLKUUlp8QFS2u7S+Yti0U7QtuZvQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
const images = Array.from(document.querySelectorAll(".entry__content img"));
images.forEach(img => {
  mediumZoom(img, {
    margin: 0,  
    scrollOffset: 40,  
    container: null,  
    template: null,  
    background: 'rgba(0, 0, 0, 0.8)'
  });
});
</script>
</body>
</html>
